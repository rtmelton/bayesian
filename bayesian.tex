\documentclass[
twoside=true,
paper=letter,
fontsize=9pt,
pagesize=auto,
leqno,
openany,
headsepline,
overfullrule,
]{scrbook}
\addtokomafont{pagehead}{\sffamily\upshape}
\usepackage{scrlayer-scrpage}
\pagestyle{scrheadings}
\automark[chapter]{chapter}
\automark*[section]{}
%
%*****************************************
% Package Section
%
%To get 3-digit page numbers to align right in table of contents.
%Why does it work?
\usepackage{tocloft}
%
%For drawing a frame around a figure.
\usepackage{framed}
\usepackage{booktabs}
\usepackage{enumitem}
%For globally setting the list spacings, uncomment some:
\setlist[itemize]{noitemsep, topsep=2pt}
\setlist[enumerate]{noitemsep, topsep=2pt}
%
%Bring in a font that is easy on the eyes.
\usepackage{bookman}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
%Code listings font:
\usepackage{inconsolata}
%
%For drop caps at beginnings of chapters. Fun, though questionable.
\usepackage{lettrine}
%
\usepackage{microtype}
%
\usepackage{makeidx}
\makeindex
%Do \index{sortstring@entrytext}
%
\usepackage[refpage]{nomencl}
\makenomenclature
%Do \nomenclature[prefix]{symbol}{description}
%where prefix is used to order the symbol in the Nomenclature list.
%
%
% The equation numbers will go on the left hand side by default, 
% but you can use \reqnomode at any point to switch to the 
% right.  Then use \leqnomode if you want them to go back to
% the left again:
%\usepackage[leqno]{amsmath} <- seems already loaded
\makeatletter
\newcommand{\leqnomode}{\tagsleft@true}
\newcommand{\reqnomode}{\tagsleft@false}
\makeatother
%
\usepackage{amsthm,amsfonts,amssymb}
%To get bold math symbols:
%\usepackage{bm}
%It's not real clear whether bold math symbols are a good idea.
%[Edit] It is now REAL clear. NOT a good idea. NO bold face math. Just no.
%
%
\usepackage{mathrsfs}
%\usepackage{yfonts}
% With words like "high-dimensionality" which are not in the dictionary, 
% you need to typeset them like high\hyp{}dimensionality to get Latex to 
% hyphenate as necessary. 
\usepackage{hyphenat}
\hyphenation{sub-al-ge-bra}
\hyphenation{sem-i-ring}
\hyphenation{meas-ur-a-ble}
\hyphenation{Bayes-ian}
\hyphenation{co-do-main}
\hyphenation{Dyn-kin}
\hyphenation{mar-gin-al}
%
%
% Epigraphs are questionable. You can have one only, got it?
\usepackage{epigraph}
%
% Quotes don't need a ton of spacing.
\usepackage{quoting}
\quotingsetup{vskip=4pt}
%
%To bring in \coloneqq and \eqqcolon:
\usepackage{mathtools}
%
%
%
%Because {tcolorbox} loads {listings}, you will get a deprecated whatever warning
%from KOMA about floats. This hack, by a KOMA author, Kohm, is to hush that up.
\usepackage{scrhack}
%For surrounding stuff in a colored box.
%Do:
%\begin{tcolorbox}
%\end{tcolorbox}
%\usepackage[breakable,listingsutf8]{tcolorbox}
\usepackage[most]{tcolorbox}
\tcbset{breakable=true,
sharp corners,
boxrule=0mm,
oversize
}
%
%For surrounding R code in a colored box.
%Do:
%\begin{rcode}[mychosenlabel]
%What Ever
%\end{rcode}
%to refer, do \ref{mychosenlabel}
\newtcolorbox[auto counter,number within=chapter]{rcode}[1][]{
colback=red!10!white,
colframe=red!13!white,
coltitle=black,
%top=0mm,
toptitle=2pt,
bottomtitle=2pt,
boxsep=1pt,
fonttitle=\small,
title={R code~\thetcbcounter},
label=#1}
%
%For embedding computer code somewhat verbatim.
%Do:
%\begin{lstlisting}
% whatever code
%\end{lstlisting}
%\usepackage{listings} <- already loaded by tcolorbox
\lstset{%general command to set listings parameters:
 basicstyle=\ttfamily\small,
 columns=fullflexible,
 breaklines=true,
 keepspaces=true
 }
%
%
%
%***************************************
% Graphics Section
%
% To import figures.
%
%Following had been commented out, thinking that the previously loaded
%tcolorbox package is clashing with the [pdflatex] option on graphicx
\usepackage{graphicx}
% Be sure that xy-pic is loaded after all other graphics packages.
\usepackage[all,cmtip]{xy}
%\xyoption{import}
%\CompileMatrices %--- an option that did not speed anything up really
%
%***************************************
%Documentation says load hyperref last of all packages.
%We'll see.
\usepackage{hyperref}
%***************************************
%Showlabels needs loading after math environment.
%Documentation says {showlabels} should come LAST of all
%the packages you include with \usepackage.
\usepackage[outer]{showlabels}
%\usepackage{showlabels}
%***************************************
% Environment Section
%
%Here's how to number your theorems. Only the theorems will be 
%typeset in italics. 
\theoremstyle{plain}
\newtheorem{thm}{Theorem}[chapter]
%
%The rest will be typeset in the usual font (not italics).
%There is also a \theoremstyle{remark}, but it will typeset 
%the word 'remark' in italics, not good. [Note: Ray, RTFM on amsthm.]
%\theoremstyle{definition}
\theoremstyle{plain}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{example}[thm]{Example}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{rmk}[thm]{Remark}
\newtheorem{notn}[thm]{Notation}
\newtheorem{termn}[thm]{Terminology}
\newtheorem{exer}[thm]{Exercise}
\newtheorem{nomn}[thm]{Nomenclature}
\newtheorem{question}[thm]{Question}
\newtheorem{discussion}[thm]{Discussion}
\newtheorem{postmortem}[thm]{Post-Mortem}
\newtheorem{premortem}[thm]{Pre-Mortem}
\newtheorem{observation}[thm]{Observation}
%************************************
\newtheoremstyle{bfnoteitalic}%
{}{}%
{\itshape}{}%
{\bfseries}{.\hspace{2pt}}%
{ }%
{\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}
%
\theoremstyle{bfnoteitalic}
\newtheorem{thmboldnote}[thm]{Theorem}
\newtheorem{propboldnote}[thm]{Proposition}
%
\newtheoremstyle{bfnoteroman}%
{}{}%
{\upshape}{}%
{\bfseries}{.\hspace{2pt}}%
{ }%
{\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}
%
\theoremstyle{bfnoteroman}
\newtheorem{defnboldnote}[thm]{Definition}
%Use like \begin{defnboldnote}[bold text goes here]\label{maybe}
%\end{defnboldnote}
%*************************************
% Fonts Section
%
% For defining new terms:
%\newcommand{\term}[1]{\emph{#1}\index{#1}}
\newcommand{\term}[1]{\textbf{#1}\index{#1}}
\usepackage{eucal}
% All categories will be typeset in the same font.
\newcommand{\cat}[1]{\ensuremath{{\mathcal #1}}}
%For sigma algebras:
\newcommand{\sigalg}[1]{\mathfrak{#1}}
%For caligraphic:
\newcommand{\cali}[1]{\mathscr{#1}}
%For computer commands:
\newcommand{\cf}[1]{\textbf{\texttt{#1}}}
%************************************
% Symbols Section
%
% Some group theory:
%
\newcommand{\normalin}{\vartriangleleft}
\newcommand{\normalup}{\rotatebox{90}{$\normalin$}}
\newcommand{\elementup}{\rotatebox{90}{$\in$}}
\newcommand{\subsetequp}{\rotatebox{90}{$\subseteq$}}
%
% For images and kernels and ranges:
\DeclareMathOperator{\range}{Ran}
\DeclareMathOperator{\kernel}{Ker}
\newcommand{\induced}[1]{\overline{#1}}
%
\renewcommand{\qedsymbol}{$\blacksquare$}
%
\newcommand{\definedby}{\coloneqq}
\newcommand{\defines}{\eqqcolon}
%
% Inner product:
\newcommand{\innerp}[2]{\langle#1,#2\rangle}
%
%  
%San serif font for operators:
\newcommand{\sfop}[1]{\mathsf{#1}}
%
\DeclareMathOperator{\L1embedding}{\mathfrak{I}}
%
%Expected value:
%
%Regular old lone expected value operator:
\newcommand{\expval}{\sfop{E}\,}
%
%Regular old expected value, with argument:
\newcommand{\expvalof}[1]{\expval\bigl(#1\bigr)} 
%
\newcommand{\given}{\mathbin{\vert}}
%\newcommand{\given}{\mid}
%Regular old conditional expected value:
\newcommand{\expvalgvn}[2]{\sfop{E}(#1\given#2)}
%
%
%Regular old lone variance operator:
\newcommand{\variance}{\sfop{Var}}
%
%Regular old variance, with argument:
\newcommand{\varianceof}[1]{\variance\left(#1\right)}
%
%Regular old lone covariance operator:
\newcommand{\covariance}{\sfop{Cov}}
%
%Regular old variance, with argument:
\newcommand{\covarianceof}[2]{\covariance\left(#1,#2\right)}
%
%
% Conditionals:
%
% Expectation:
%
%%Conditional mathematical expectation using the "given" notation:
%It's not real clear whether the "given" 
%Going L1(A) to L1(B): per Kolmogorov
\newcommand{\kondexpgvn}[2]
{\mathop{E}\bigl(#1\given#2\bigr)}
%{\mathop{\mathfrak{E}}\bigl(#1\given#2\bigr)}
%
%Conditional mathematical expectation using subscript notation:
\newcommand{\kondexpsub}[2]
{\mathop{E}\nolimits_{#2}\hspace{-1pt}#1}
%{\mathop{\mathfrak{E}}\nolimits_{#2}\hspace{-1pt}#1}
%
%Lone conditional mathematical expectation operator:
\newcommand{\kondexpop}{\mathop{E}}
%\newcommand{\kondexpop}{\mathop{\mathfrak{E}}}
%
%
%%Conditional mathematical expectation using the "given" notation:
%Going L1(A) to L1(A): per isometric embedding
\newcommand{\condexpgvn}[2]
{\cali{E}\hspace{-1.5pt}\left(#1\given#2\right)}
%
%Conditional mathematical expectation using subscript notation:
%Use like \condexpsub{ function }{ subalgebra }
\newcommand{\condexpsub}[2]
{\mathop{\cali{E}\hspace{-1.5pt}}\nolimits_{#2}\hspace{-1pt}#1}
%{\mathop{\cali{E}\hspace{-1.5pt}}\nolimits_{#2}\hspace{-1pt}\left(#1\right)}
%
%Lone conditional mathematical expectation operator:
\newcommand{\condexpop}[1]{\mathop{\cali{E}\hspace{-1pt}}\nolimits_{#1}}
%
%
%
%
% Probability:
%
%%Conditional probability using the "given" notation:
\newcommand{\condprobgvn}[2]
{\cali{P}\hspace{-1.5pt}\left(#1\given#2\right)}
%
%Conditional probability using subscript notation:
\newcommand{\condprobsub}[2]
{\mathop{\cali{P}\hspace{-1.5pt}}\nolimits_{#2}\hspace{-1pt}\left(#1\right)}
%
%Lone conditional probability operator:
\newcommand{\condprobop}[1]{\mathop{\cali{P}\hspace{-1pt}}\nolimits_{#1}}
%
%
%Variance:
% 
%%Conditional variance using the "given" notation:
\newcommand{\condvargvn}[2]
{\cali{V}\hspace{-3pt}\mathit{ar}\left(#1\given#2\right)}
%
%Conditional variance using subscript notation:
\newcommand{\condvarsub}[2]
{\mathop{\cali{V}\hspace{-3pt}\mathit{ar}}\nolimits_{#2}(#1)}
%
%Lone variance operator:
\newcommand{\condvarop}[1]
{\mathop{\cali{V}\hspace{-3pt}\mathit{ar}\hspace{-0.5pt}}\nolimits_{#1}}
%
%Covariance:
% 
%%Conditional covariance using the "given" notation:
\newcommand{\condcovgvn}[3]
{\cali{C}\hspace{-3pt}\it{ov}\left(#1,#2\given#3\right)}
%
%Conditional variance using subscript notation:
\newcommand{\condcovsub}[3]
{\mathop{\cali{C}\hspace{-3pt}\mathit{ov}}\nolimits_{#3}(#1,#2)}
%
%Lone covariance operator:
\newcommand{\condcovop}[2]
{\mathop{\cali{C}\hspace{-3pt}\mathit{ov}\hspace{-0.5pt}}\nolimits_{#1,#2}}
%
%Borel sets:
\newcommand{\borel}{\mathfrak{Bor}}
%
%Covariance
\DeclareMathOperator{\Cov}{Cov}
\newcommand{\cov}[2]{\Cov(#1,#2)}
%
%Use in math mode for the sigma algebra generated by:
\newcommand{\sagb}{\mathop{\hbox{\large{$\sigma$}}}\nolimits}
%
%Use \textsigma in text for a \sigma a little larger than the math sigma:
\newcommand{\textsigma}{\hbox{\large{$\sigma$}}\kern-1pt}
%
%Use \boldsig in section headings for a little larger \sigma:
\newcommand{\boldsig}{$\bm{\hbox{\Large{$\sigma$}}}$}
%
%\newcommand{\charfunction}[1]{{\raisebox{2pt}{$\chi$}}_{#1}}
\newcommand{\charfunction}[1]{\mathop{{\raisebox{2pt}{$\chi$}}_{#1}}}
%
%\newcommand{\charoperator}{\raisebox{2pt}{$\chi$}}
\newcommand{\charoperator}{\mathop{\raisebox{2pt}{$\chi$}}}
%
%\newcommand{\restrictedto}[1]{_{\vert#1}}
\newcommand{\restrictedto}[1]{_{\lvert#1}\kern-1.5pt}
%
\newcommand{\mtset}{\hbox{\large{$\varnothing$}}}
%
\newcommand{\comp}{^{\hbox{\tiny{$\mathsf C$}}}}
%
%**************************************
% Operators Section
%
\newcommand{\norm}[1]{\left\Vert#1\right\Vert}
\newcommand{\abs}[1]{\left\vert#1\right\vert}
\newcommand{\inv}[1]{#1^{-1}}
\newcommand{\seqof}[2]{\left(#1_{#2}\right)_{#2=1}^{\infty}}
\newcommand{\seq}[1]{\left(#1\right)}
\newcommand{\image}[1]{\overrightarrow{#1}}
%\newcommand{\preimage}[1]{#1^{\leftarrow}}
\newcommand{\preimage}[1]{\mathop{#1^{\leftarrow}}}
%\newcommand{\preimage}[1]{\overset{\raisebox{-1pt}[0pt][0pt]{\footnotesize$\leftarrow$}}{#1}}
\newcommand{\R}{\mathbb{R}}

%**************************************
%***************************************
% Any local shortcuts?
\newcommand{\meets}{\cap}
\newcommand{\semiring}{\sigalg{S}}
\newcommand{\semiringii}{\sigalg{T}}
\newcommand{\semiringiii}{\sigalg{U}}
\newcommand{\uspacesemiring}{\sigalg{R}}
\newcommand{\sigmaalgebra}{\sigalg{A}}
\newcommand{\sigmaalgebraii}{\sigalg{B}}
\newcommand{\sigmaalgebraiii}{\sigalg{C}}
\newcommand{\sigmaalgebraiv}{\sigalg{D}}
\newcommand{\productsemiring}[2]{\mathfrak{Semi}(#1,#2)}
\newcommand{\productsig}[2]{\sagb(#1,#2)}
\newcommand{\powerset}{\mathfrak{P}}
\mathchardef\mhyphen="2D
\newcommand{\measurable}[1]{{#1}\mhyphen\mathfrak{Meas}}
\newcommand{\kernast}{\ast\kern-1pt}
\newcommand{\mbmeasurable}{$(\measurable{\measure^\kernast},\borel_\R)$\hyp{}measurable}
\newcommand{\meas}[1]{\mathsf#1}
\newcommand{\measuresubstar}[1]{\measure\restrictedto{#1}\kern-2pt^*}
\newcommand{\Psubstar}[1]{\measure\restrictedto{#1}\kern-2pt^*}
\newcommand{\sigalgtothe}[2]{\sigalg{#1}^{(#2)}}
\newcommand{\Pstar}{\measure^\kernast}
\newcommand{\Pstarmeasurable}{\measurable{\Pstar}}
\newcommand{\lilstrut}{\vphantom{\bigl(}}
\newcommand{\Lilstrut}{\vphantom{\Bigl(}}
\newcommand{\Lone}{L_1(\measurespace, \sigmaalgebra, \measure)}
\newcommand{\Ltwo}{L_2(\measurespace, \sigmaalgebra, \measure)}
\newcommand{\caliLone}{\cali{L}_1(\measurespace, \sigmaalgebra, \measure)}
%\newcommand{\OpT}{\sfop{T}}
\newcommand{\OpT}{\mathop{\cali T}}
\newcommand{\oneonomega}{1_\measurespace}
\newcommand{\sigalgb}{\sigmaalgebraii}
\newcommand{\Prob}{\mathfrak{Prob}}
\newcommand{\funca}{a}
\newcommand{\funcf}{f}
\newcommand{\funcg}{g}
\newcommand{\funch}{h}
\newcommand{\funcj}{j}
\newcommand{\funck}{k}
\newcommand{\funcl}{l}
\newcommand{\funcm}{m}
\newcommand{\function}{f}
\newcommand{\functionii}{g}
\newcommand{\functioniii}{h}
\newcommand{\functioniv}{k}
\newcommand{\functionv}{j}
\newcommand{\stepfunction}{\phi}
\newcommand{\stepfunctionii}{\psi}
\newcommand{\measurespace}{X}
\newcommand{\measurespaceii}{Y}
\newcommand{\measurespaceiii}{Z}
\newcommand{\measurespaceiv}{W}
\newcommand{\mspaceelt}{x}
\newcommand{\mspaceeltii}{y}
\newcommand{\mspaceeltiii}{z}
%probability spaces
\newcommand{\abscont}{\mathrel{< \kern-3.5pt <}}
\newcommand{\probspace}{X}
\newcommand{\probspaceii}{Y}
\newcommand{\measure}{\mu}
\newcommand{\measmu}{\mu}
\newcommand{\measureii}{\nu}
\newcommand{\measnu}{\nu}
\newcommand{\measureiii}{\lambda}
\newcommand{\measlambda}{\lambda}
\newcommand{\measureiv}{\rho}
\newcommand{\measrho}{\rho}
\newcommand{\diracmeasure}[1]{\delta_{#1}}
\newcommand{\seti}{A}
\newcommand{\setii}{B}
\newcommand{\setiii}{C}
\newcommand{\setiv}{D}
\newcommand{\setv}{E}
%\newcommand{\regular}{\cali{R}}
\newcommand{\regular}{\mathop{\cali{R}}}
%\newcommand{\selection}{\cali{S}}
\newcommand{\selection}{\mathop{\cali{S}}}
\newcommand{\collectionoffunctions}{\mathfrak{Fncs}}
\newcommand{\projectionone}{\pi_1}
\newcommand{\projectiontwo}{\pi_2}
\newcommand{\powerfunc}{\sfop{S}}
\newcommand{\powerfuncsub}[1]{\powerfunc_{#1}}
\newcommand{\powerfuncto}[1]{\powerfunc^{#1}}
\newcommand{\powersection}{\sfop{Sec}}
\newcommand{\markovkernel}{k}
\newcommand{\markovkernelii}{m}
\newcommand{\mkernel}[3]{#1_{#2\mid#3}}
\newcommand{\fixinthefirst}[1]{\sfop{fix}_{#1}}
\newcommand{\fixinthesecond}[1]{\sfop{fix}^{#1}}
\newcommand{\thedata}{{\sf Data}}% measurable function
\newcommand{\parameter}{{\sf Para}}% another measurable function
\newcommand{\uspace}{U}% underlying probability space U
\newcommand{\pspace}{\measurespace}% parameter space A
\newcommand{\sspace}{\measurespaceii}% sample space S
\newcommand{\fspace}{\measurespaceiii}% future space Z
\newcommand{\pspaceset}{A}
\newcommand{\pspacesetii}{C}
\newcommand{\sspaceset}{B}
\newcommand{\sspacesetii}{D}
\newcommand{\uspaceelt}{u}
\newcommand{\pspaceelt}{x}
\newcommand{\sspaceelt}{y}
\newcommand{\fspaceelt}{z}
\newcommand{\uspacesig}{\sigalg{D}}
\newcommand{\fspacesig}{\sigalg{T}} 
\newcommand{\sspacesig}{\sigalg{B}}
\newcommand{\pspacesig}{\sigalg{A}}
\newcommand{\transition}{\,-\kern-6pt <}
\newcommand{\joint}{\Gamma}% joint probability measure
\newcommand{\measonprod}{\Gamma}% measure on a product space
\newcommand{\marginalone}{\alpha}% marginal measure 1st component
\newcommand{\marginaltwo}{\beta}% marginal measure 2nd component
%\newcommand{\marginalone}{\measonprod_{\kern-2pt 1}}% marginal measure
%\newcommand{\marginaltwo}{\measonprod_{\kern-2pt 2}}% marginal measure
\newcommand{\marginalthree}{\gamma}
\newcommand{\postonprod}{\Pi}
%\newcommand{\prior}{\measure}
%\newcommand{\predictive}{P}
\newcommand{\prior}{\marginalone}
\newcommand{\predictive}{\marginaltwo}
\newcommand{\postdictive}{Q}
\newcommand{\wouldbeprior}{\gamma}
\newcommand{\umeasure}{Q}% underlying space measure
\newcommand{\postmeas}{\rho}% posterior predictive narrative measures
\newcommand{\postmeasii}{\sigma}% ditto
\newcommand{\postmeasiii}{\tau}% ditto
\newcommand{\pspacekernel}{\predictive^\pspacesig}
\newcommand{\sspacekernel}{\prior^\sspacesig}
%conditional independence
\newcommand{\condindep}[3]{#1\perp\kern-6pt\perp #2\mid #3}
%-----------------------------------------
\newcommand*\xbar[1]{%
   \hbox{%
     \vbox{%
       \hrule height 0.4pt % The actual bar
       \kern0.4ex%         % Distance between bar and symbol
       \hbox{%
         %\kern-0.12em%      % Shortening on the left side
         \ensuremath{#1}%
         %\kern-0.14em%      % Shortening on the right side
       }%
     }%
   }%
} 
%-----------------------------------------
\makeatletter
\newcommand\tint{\mathop{\mathpalette\tb@int{t}}\!\int}
\newcommand\bint{\mathop{\mathpalette\tb@int{b}}\!\int}
\newcommand\tb@int[2]{%
  \sbox\z@{$\m@th#1\int$}%
  \if#2t%
    \rlap{\hbox to\wd\z@{%
      \hfil
      \vrule width .35em height \dimexpr\ht\z@+1.4pt\relax depth -\dimexpr\ht\z@+1pt\relax
      \kern.05em % a small correction on the top
    }}
  \else
    \rlap{\hbox to\wd\z@{%
      \vrule width .35em height -\dimexpr\dp\z@+1pt\relax depth \dimexpr\dp\z@+1.4pt\relax
      \hfil
    }}
  \fi
}
\makeatother
%-----------------------------------------
\newcommand{\lebclass}[1]{\hspace{.5pt}\xbar{#1}\hspace{0.5pt}}
\newcommand{\ellclass}[2]{\lebclass{#1}^{#2}}
\newcommand{\inducedint}{\tint}





\subject{\textsf{These Notes Are Works\hyp{}In\hyp{}Progress}}
\title{Bayesian Statistics for Mathematicians}
\subtitle{or, A Measure-Theoretic Approach to Bayesian Statistics}
\author{\textsf{Raymond T. Melton}}
\date{\textsf{\today}}



\begin{document}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\frontmatter



\maketitle
{\renewcommand*\normalfont{\usekomafont{disposition}}%
\normalfont%
\tableofcontents
}


\addchap{Preface}
\lettrine{T}{\,hese} notes were never initially intended for anyone else to look at.
I am working to make them easier on the eyes.

The Hilbert space stuff is off a bit, I know.
It was typed up long before I worked through the details of quotient spaces, like $L_p$, so there are a few mis-statements yet to be corrected. Actually, it is mathematically correct in the sense that separable Hilbert space people tend to use `$=$' when they mean `isomorphic.' Still.

Feel free to contact me. I am willing to share ideas.



\mainmatter
\chapter{Introduction}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\epigraph{\textit{Many readers will have noticed the recent trend toward quotations at the beginnings of chapters in scientific books.  Often these quotes are sappy, dippy little things as if the authors of the book were struggling for profundity.}}
{{Heterochrony: The Evolution of Ontogeny}\\ \textsc{--- M. L. McKinney}}

\lettrine{T}{\,he} underlying reason these notes exist is so I could remember what progress I had made while learning statistics.
I am putting these notes online, thinking  they may help another mathematician trying to do the same.

What is the difference between these notes and other texts on Bayesian statistics?
The main difference is that the integration theory here is based upon semi-rings as opposed to \textsigma\hyp{}algebras, to be explained further in the next few paragraphs.
Also,
\begin{itemize}
\item
We do not confuse equivalence classes of functions with the functions themselves.
\item
We do not make topological assumptions when it comes to regular conditional distributions.
\item
We make clear which \textsigma\hyp{}algebras are involved in statistical models.
\end{itemize}


In all  the statistics books that I looked, the Lebesgue integral was defined in terms of a measure on a  \textsigma\hyp{}algebra.
But the integration theory I had learned was based upon a measure on a  semi-ring.
What is the difference?

One main difference: In the case of a measure on a  \textsigma\hyp{}algebra and the consequent Lebesgue integral, say as developed in \textsl{Probability Theory,} Loeve~\cite{pt_loeve_1960}, the resulting conditional mathematical expectation is a class of functions, where each function in the class is measurable with respect to a
\textsigma\hyp{}subalgebra, but in the case of a measure on a semi-ring, as developed in
\textsl{Principles of Real Analysis,} Aliprantis \& Burkinshaw~\cite{pora_aliprantis_1990}, the consequent conditional mathematical expectation is a class of functions from which we can select a representative function which is measurable with respect to the  \textsigma\hyp{}subalgebra.  Not a big difference, but you still need to make the selection. Then again, you always need to make a selection with a regular conditional probability. Sorry about the pun.





Statistical models only started making sense after learning Bayesian statistical models.  That is all you will find here. All of the material regarding frequentist statistics has been edited out, like when the cocoon is left behind.
For mathematicians, this material is more of a measure-theoretic companion to something  comprehensive and explanatory on applied Bayesian statistical models.  I strongly recommend Richard McElreath's \textsl{Statistical Rethinking}~\cite{sr_mcelreath_2020}.


One more thing.
A quote from \textsl{Thinking Like Your Editor,} by Rabiner \& Fortunato, 2002, where the question is raised, and I really hope I am paraphrasing its content correctly here: Once you've defined your audience, to which level of sophistication do you write?
\begin{quoting}\small
The answer is that if you want to write serious nonfiction, and if you want your work to be taken seriously, you never dumb down. You always write up. Writing down runs the risk of having your book read like a young adult book. Assume a high reader level of intellectual sophistication, even though you suspect their knowledge of your particular subject may not be high.  Fully explain, but do not simplify.
\end{quoting}
This is not a children's reader.
No attempt has been made to dumb down anything.





\chapter{Measure Spaces and Measurable Sets}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\lettrine{T}{\,his} is only an abbreviated review of measure theory, based upon semirings.
Roughly, a measure on a semiring is extended to the powerset, and then restricted to the measurable subsets.  Resulting measure spaces are complete in the sense that every subset of a set of measure zero is 
Carath\'{e}odory measurable. That is, every null set is measurable.
It remains to be seen whether this particular notion of completeness will be sufficient.


Any missing detail might be found in  Aliprantis and Burkinshaw, \textsl{Principles of Real Analysis}~\cite{pora_aliprantis_1990}. Except Proposition~\ref{approximation_sigma_finite}. That was found in Aliprantis and Border's book, \textsl{Infinite Dimensional Analysis: A Hitchhiker's Guide}, Third Edition, 2006; see 10.31 Lemma therein, page 386.

\begin{defn}
Let $\measurespace$ be a nonempty set.  A collection $\semiring$ of subsets of $\measurespace$ is a \textbf{semiring}\index{semiring of sets} if it has the following three properties:
\begin{enumerate} %[noitemsep,topsep=2pt]
\item $\mtset\in\semiring.$
\item If $A$ and $B$ are in $\semiring$, then $A\meets B\in\semiring$. 
\item If  $A$ and $B$ in $\semiring$, there exist disjoint sets $C_1, \ldots , C_n$ in $\semiring$ such that $A\setminus B =\bigcup_{i=1}^{n}C_i$.
\end{enumerate}
\end{defn}

 
\begin{defn}
Let $\semiring$ be a semiring of subsets of a set $\measurespace$. A set function $\measure:\semiring\to [0,\infty]$ is a \term{measure} if it has both of the following properties:
\begin{enumerate}
\item $\measure(\mtset) = 0.$
\item $\measure$ is $\textsigma$-additive.
\end{enumerate} 
\end{defn} 

\begin{defn}\label{measure_space}
A triple $(\measurespace, \semiring, \measure)$, where $\measurespace$ is a nonempty set, the collection $\semiring$ is a semiring of subsets of $\measurespace$, and $\measure$ is a measure, is called a \term{measure space}. 
\end{defn}

\begin{defn}\label{algebra}
A nonempty collection $\sigmaalgebra$ of subsets of a nonempty set $\measurespace$ is an 
\textbf{algebra}\index{algebra of sets} if it is closed with respect to finite intersections and complements; that is, if it has both the following properties:
\begin{enumerate}
\item If $A$ and $B$ are in $\sigmaalgebra$, then $A\meets B\in \sigmaalgebra$.
\item If $A\in\sigmaalgebra$, then $A\comp \in \sigmaalgebra$.
\end{enumerate}
Consequently, both $\mtset \in \sigmaalgebra$ and $\measurespace \in \sigmaalgebra$.
\end{defn} 


\begin{quoting}
\small
A concept in between those of semirings and algebras of sets is that of rings of sets.  A nonempty collection of subsets of a set is a \textbf{ring}\index{ring of sets} if it is closed with respect to set differences and finite unions.  Every algebra of sets is also a ring of sets.  Every ring of sets is also a semiring of sets.
\end{quoting}


\begin{defn}
An algebra of subsets of a set is a 
\textbf{\textsigma-algebra}
\index{sigma algebra@$\textsigma$-algebra} 
if it is closed with respect to countable unions, in which case it must also be closed with respect to countable intersections.
If $\sigmaalgebra$ is a \textsigma-algebra and $\sigmaalgebraii\subseteq\sigmaalgebra$, then $\sigmaalgebraii$ is a 
\textbf{\textsigma-subalgebra}
\index{sigma subalgebra@$\textsigma$-subalgebra}
of $\sigmaalgebra$ if $\sigmaalgebraii$ is a \textsigma-algebra.
If $\sigalg{F}$ is a collection of subsets of a nonempty set, then $\sigalg{F}$ is included in a smallest \textsigma-algebra, denoted 
$\textsigma(\sigalg{F})$. It is the intersection of all \textsigma-algebras containing $\sigalg{F}$, and is called the 
\textbf{\textsigma-algebra generated} by $\sigalg{F}$.
\index{sigma algebra generated by a collection@$\textsigma$-algebra generated by a collection}
\end{defn}

\begin{defn}
Let $\powerset(\measurespace)$ be the power set of a set $\measurespace$.  A set function $\measure:\powerset(\measurespace)\to [0,\infty]$ is an \term{outer measure} if it has the following three properties:
\begin{enumerate}
\item $\measure(\mtset)=0$.
\item $\measure$ is monotone. That is, if $A$ and $B$ are in $\powerset(\measurespace)$ with $A\subseteq B$, then $\measure(A)\leq \measure(B)$.
\item $\measure$ is \textsigma-subadditive.  That is, $\measure\bigl(\bigcup_{n=1}^{\infty}A_n\bigr) 
\leq 
\sum_{n=1}^{\infty}\measure(A_n)$ for every sequence $\{A_n\}$ of subsets of $\measurespace$.
\end{enumerate}
\end{defn}

\begin{defnboldnote}[Carath\'{e}odory]\label{caratheodory}
Let $\measure$ be an outer measure on the powerset $\powerset(\measurespace)$ of some set $\measurespace$.  A subset $B$ of $\measurespace$ is a 
\textbf{$\measure$\hyp{}measurable set} 
\index{mu measurable set@$\measure$\hyp{}measurable set}
if 
\[\measure(A)
=
\measure(A\meets B) + \measure(A\meets B\comp)\]
for all $A\subseteq\measurespace$.
Let 
$\measurable{\measure}$\nomenclature[mu measurable]{$\measurable{\measure}$,}{the \textsigma-algebra of $\measure$\hyp{}measurable subsets, where $\measure$ is an outer measure}
denote the collection of all $\measure$\hyp{}measurable subsets of 
$\measurespace$.
\end{defnboldnote}

\begin{rmk}
Measurable catch phrases:
\begin{itemize}
\item A set is $\measure$\hyp{}measurable if it sharply cuts every set.
\item A set is $\measure$\hyp{}measurable if you can always make change with it.
\end{itemize}
\end{rmk}


\begin{defn}\label{outer_measure_generated}
Given a  measure space $(\measurespace, \semiring, \measure)$, define a set function $\measure^*:\powerset(\measurespace)\to [0,\infty]$ by
\[
\measure^*(A) 
= 
\inf \left\{\sum_{n=1}^{\infty}\measure(A_n) : 
\text{$\{A_n\}$ is a sequence of $\semiring$ with $A\subseteq\bigcup_{n=1}^{\infty} A_n$}
\right\},
\]
where $\inf\mtset = \infty$.  The set function $\measure^*$ is the
\textbf{outer measure generated} by $\measure$.
\index{outer measure generated by mu@outer measure generated by $\measure$}

It will turn out that $\measure^*$, when restricted to the collection of $\measure^\kernast$\hyp{}measurable sets, is an honest\hyp{}to\hyp{}God measure. We might also denote this restriction by 
$\measure^*$\nomenclature[mu star]{$\measure^*$}{outer measure on the power set, or its restriction to the $\measure^*$\hyp{}measurable subsets}  for now.  If this reduces clarity at any point, then we will introduce some fairly cumbersome notation, like
$\measure\restrictedto{\measurable{\measure}}$, or
$\measure^\kernast\restrictedto{\measurable{\measure^\kernast}}$.
\end{defn}



\begin{prop}
The outer measure generated by a measure really is an outer measure.
\end{prop}

\begin{prop}\label{extension_from_semiring}
Let $(\measurespace, \semiring, \measure)$ be a measure space. The outer measure $\measure^*$  generated by $\measure$ is an extension of $\measure$ from $\semiring$ to the powerset $\powerset(\measurespace)$ of $\measurespace$. That is, if $A\in\semiring$, then $\measure^*(A) = \measure(A)$. Equivalently, the restriction 
$\measure^\kernast\restrictedto{\semiring}$ of $\measure^*$ to the semiring $\semiring$ is equal to $\measure$.
\end{prop}



\begin{notn}
Let $\measure$ be an outer measure on the powerset $\powerset(\measurespace)$ of some set $\measurespace$.   A subset $A$ of $\measurespace$ is called a 
\textbf{$\measure$\hyp{}null set}\index{mu null set@$\measure$ null set}
if $\measure(A) = 0$.
Any definition or relation on $\measurespace$ that holds except possibly on a $\measure$\hyp{}null set is said to hold
\textbf{$\measure$\hyp{}almost everywhere}\index{mu almost everywhere@$\measure$\hyp{}almost everywhere}, or simply $\measmu$\hyp{}a.e.
We might also say that the relation holds for
\textbf{$\measure$\hyp{}almost all}\index{mu almost all@$\measure$\hyp{}almost all}
$\mspaceelt\in\measurespace$.
For example, if
$\funcf:\measurespace\to\R$ and $\funcg:\measurespace\to\R$, and
$\funcf(\mspaceelt)=\funcg(\mspaceelt)$ except for $\mspaceelt\in\seti$ with
$\measure(\seti)= 0$, then we could say that $\funcf = \funcg$ for $\measure$\hyp{}almost all
$\mspaceelt$ in $\measurespace$.
\end{notn}

\begin{prop}
Let $\measure$ be an outer measure on the powerset $\powerset(\measurespace)$ of some set $\measurespace$.
Every $\measure$\hyp{}null set is $\measure$\hyp{}measurable. 
Consequently, since $\measure$ is monotone,  every subset of a $\measure$\hyp{}null set is 
$\measure$\hyp{}measurable.
\end{prop}




\begin{prop}\label{restricted_outer_measure}
If $\measure$ is an outer measure on the powerset $\powerset(\measurespace)$ of a set $\measurespace$, then the collection $\measurable{\measure}$ of all $\measure$\hyp{}measurable subsets of $\measurespace$ is a \textsigma-algebra, and the triple $(\measurespace, \measurable{\measure}, \measure\restrictedto{\measurable{\measure}})$ is a measure space.  That is, the outer measure $\measure$, when restricted to the \textsigma-algebra $\measurable{\measure}$ of all $\measure$\hyp{}measurable subsets of $\measurespace$, is \textsigma-additive.
\end{prop}



\begin{cor}\label{subtractive}
Let $(\measurespace, \semiring, \measure)$ be a measure space. Let $A$ and $B$ be $\measure^\kernast$\hyp{}measurable sets with $B\subseteq A$ and with $\measure^*(A)< \infty$.
Then $\measure^*(A\meets B\comp) = \measure^*(A) - \measure^*(B)$.
\end{cor}




\begin{prop}\label{semiring_measurable}
If $(\measurespace, \semiring, \measure)$ is a measure space, then every element of the semiring 
$\semiring$ is a $\measure^\kernast$\hyp{}measurable subset. That is, 
$\semiring\subseteq \measurable{\measure^\kernast}$.
\end{prop}



\begin{defn}\label{sigma_finite}
A measure space $(\measurespace, \semiring, \measure)$ is 
\textbf{finite}
\index{finite measure space}
if $\measure^*(\measurespace) < \infty$. We may also say that the measure $\measure$ is finite.
A measure space $(\measurespace, \semiring, \measure)$ is 
\textbf{\textsigma-finite}
\index{sigma finite@$\textsigma$-finite}
if there is a disjoint sequence $\{ \measurespace_n \}$ of subsets of $\semiring$ with 
$\measure(\measurespace_n) < \infty$ 
and 
$\measurespace\subseteq\bigcup_n\measurespace_n$. 
We may also say that measure $\measure$ is \textsigma\hyp{}finite.
\end{defn}



\begin{prop}
Let $(\measurespace, \semiring, \measure)$ be a finite measure space.  
A subset $E\subseteq \measurespace$ is $\measure^\kernast$\hyp{}measurable if and only if 
\[
\measure^*(\measurespace) = \measure^*(E) + \measure^*(E\comp).
\]
\end{prop}



\begin{prop}
Let $(\measurespace, \semiring, \measure)$ be a measure space, and let 
$E\in \measurable{\measure^\kernast}$. Define a collection of sets, the restriction of $\semiring$ to $E$, by
\[
\semiring_E = \{ E\meets A: A\in\semiring \},
\]
and define a function $\measureii:\semiring_E\to [0,\infty]$ by $\measureii(E\meets A)=\measure^*(E\meets A)$.
Then the triple $(\measurespace, \semiring_E, \measureii )$ is a measure space, and 
$\measureii^* ={\measure^\kernast}\restrictedto{\powerset(E)}$. Furthermore, 
$\measurable{\measureii^\kernast} 
= 
\{ F\subseteq E : F\in \measurable{\measure^\kernast} \}$.
\end{prop}


\begin{prop}\label{sufficient_for_measurability}
Let $(\measurespace, \semiring, \measure)$ be a measure space, and let $A \subseteq \measurespace$.  If there is an $E\in\measurable{\measure^\kernast}$ with $A\subseteq E$ such that $\measure^*(E) < \infty$ and $\measure^*(E) = \measure^*(A) + \measure^*(E\meets A\comp)$, then 
$A\in\measurable{\measure^\kernast}$.
\end{prop}



\begin{prop}\label{extension_measure}
Let $(\measurespace, \semiring, \measure)$ be a \textsigma-finite measure space, let $\semiringii$ be a semiring of subsets of $\measurespace$ with 
$\semiring \subseteq \semiringii\subseteq\measurable{\measure^\kernast}$,
and let $\measureii:\semiringii:\to [0,\infty]$ be a measure on $\semiringii$.
If $\measureii=\measure$ on $\semiring$, then $\measureii = \measure^\kernast$ on $\semiringii$.
Consequently, the measure 
$\measure^* : \measurable{\measure^\kernast} \to\ [0, \infty]$ 
is the unique extension of the measure $\measure$ from the semiring $\semiring$ 
to the \textsigma\hyp{}algebra 
$\measurable{\measure^\kernast}$.
\[
\xymatrix@R=-2pt{
\measurable{\measure^\kernast} \ar[r]^{\measmu^*} & [0, \infty ] \\
\subsetequp & \\
\semiringii \ar[r]^\measnu & [0, \infty ] \\
\subsetequp & \\
\semiring   \ar[r]^\measmu & [0, \infty ] \\
}
\]
\end{prop}


\begin{prop}\label{approximation_sigma_algebra}
Let $(\measurespace, \semiring, \measure)$ be a measure space. If 
$A\subseteq\measurespace$, then there is a superset 
$B\in \sagb(\semiring)$ of $A$ with $\measure^*(A) = \measure^*(B)$.
\end{prop}


\begin{proof}
Let $A\subseteq\measurespace$. 
We first look at the case where the outer measure of $A$  is infinite; let $\measure^*(A)=\infty$. We can take $B=\measurespace$; we know $\measurespace\in \sagb(\semiring)$ because $\mtset \in \semiring$ and algebras 
(therefore \textsigma-algebras) are closed with respect to complements.  And outer measures are monotone, so $\measure^*(A) \leq \measure^*(\measurespace)$. But this implies that $\measure^*(\measurespace)=\infty$, so $\measure^*(A) = \measure^*(\measurespace)$, completing the proof of this case.

We now look at the complementary case; let $\measure^*(A)$ be finite. For each $k\in\{1,2,\ldots\}$ there must be, according to the definition of $\measure^*(A)$, a sequence $\{A^k_1, A^k_2, \ldots \}$ of $\semiring$ whose union covers $A$, where
\[
\measure^*(A)\leq \sum_{n=1}^\infty\measure(A^k_n) < \measure^*(A) + 1/k.
\] 
In this case, we can take 
$B= \bigcap_{k=1}^\infty \bigl( \bigcup_{n = 1} A^k_n \bigr)$, which is in $\textsigma(\semiring)$. Because $A\subseteq \bigcup_{n = 1} A^k_n$ for each $k$, it follows that $A\subseteq B$.
Also, 
\[
\measure^*(A) \leq \measure^*(B) 
\leq \measure^*\left(\bigcup_{n = 1} A^k_n \right) 
\leq \sum_{n = 1} \measure^* \bigl( A^k_n \bigr)
= \sum_{n = 1} \measure \bigl( A^k_n \bigr)
< \measure^*(A) + 1/k.
\]
Since this holds for each $k\in\{1,2,\ldots\}$, it follows that $\measure^*(A) = \measure^*(B)$, as required.
\end{proof}





\begin{prop}\label{approximation_sigma_finite}
Let $(\measurespace, \semiring, \measure)$ be a \textsigma-finite measure space. If 
$A\in\measurable{\measure^\kernast}$, then there is a subset $C\subseteq\measurespace$ with $A\meets C =\mtset$ and  such that $\measure^*(C) = 0$ with $A\cup C\in \sagb(\semiring)$. 
\end{prop}

\begin{proof}
Let $A\in\measurable{\measure^\kernast}$.
The measure space  $(\measurespace, \semiring, \measure)$ is supposed to be \textsigma-finite, so there is a sequence $\{ \measurespace_n \}$ of subsets of $\semiring$ with  $\measure(\measurespace_n) < \infty$ 
and $\measurespace\subseteq\bigcup_n\measurespace_n$. 
By Proposition~\ref{approximation_sigma_algebra}, for each subset $A\meets \measurespace_n$ there is a subset $B_n\in\sagb(\semiring)$ with $A\meets\measurespace_n\subseteq B_n$ and $\measure^*(A\meets\measurespace_n) = \measure^*(B_n)$. 
We take $C=\bigl( \bigcup_n B_n \bigr) \meets A\comp$ and show that $C$ has the required properties.

Pure set theory shows that 
$C\subseteq \bigcup_n \bigl(B_n \meets (A\meets\measurespace_n)\comp\bigr)$. 
Since $\measure(\measurespace_n) = \measure^*(\measurespace_n)< \infty$, it follows that 
$\measure^*(A\meets\measurespace_n)=\measure^*(B_n) < \infty $ and so we can apply Corollary~\ref{subtractive} which says 
$\measure^*(B_n \meets (A\meets\measurespace_n)\comp)
=\measure^*(B_n)   \measure^*(A\meets\measurespace_n)$. But $\measure^*(B_n) = \measure^*(A\meets\measurespace_n)$. 
This means $\measure^*(B_n \meets (A\meets\measurespace_n)\comp)=0$
which implies that $\measure^*\bigl(\bigcup_n \bigl(B_n \meets (A\meets\measurespace_n)\comp\bigr) \bigr)=0$. By monotonicity, $\measure^*(C)=0$.

The fact that $C\subseteq A\comp$ implies that $A\meets C =\mtset$.
Finally, to see that $A\cup C\in\sagb(\semiring)$, since we already know that each $B_n$ is in $\sagb(\semiring)$, we simply need to show that $A\cup C = \bigcup_n B_n$. Again, this is pure set theory. Briefly, since $A\subseteq \bigcup_n(A\meets \measurespace_n) \subseteq \bigcup_n B_n$, it follows that $A\cup (\bigcup_n B_n) = \bigcup_n B_n$, and so 
\begin{align*}
A\cup C & = A \cup \left( \bigl(\, \bigcup_n B_n \bigr ) \meets A\comp\right)\\
& = \left( A\cup \bigcup_n B_n \right) \meets (A\cup A\comp)
\quad\text{just distribute}\\
& = A \cup \bigcup_n B_n \\
& = \bigcup_n B_n,
\end{align*}
as required.
\end{proof}





\chapter{Measurable Functions and Integration}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\lettrine{T}{\,hroughout} this section, let $(\measurespace, \semiring, \measure)$ denote a measure space, so $\semiring$ is at least a semiring, and we continue to let $\measurable{\measure^\kernast}$ denote the $\textsigma$-algebra of  $\measure^\kernast$-measurable subsets of $\measurespace$. 

\begin{notn} Let $\measurespace$ and $\measurespaceii$ be sets, and let $\powerset(\measurespace)$ and $\powerset(\measurespaceii)$ denote their respective powersets.
For any function
$f:\measurespace\to \measurespaceii$, the set $\measurespace$ is the \term{domain} of $f$ and the set
$\measurespaceii$ is the \term{codomain}.
For any subset $A\subseteq\measurespace$, the set
\[
f(A) \definedby \{ f(x): x \in A \}
\]
is the \term{image} of $A$ under $f$, which we could denote $f^\rightarrow(A)$.
The subset $f(\measurespace)\subseteq \measurespaceii$ is the \term{range} of $f$.
And for any subset $B\subseteq \measurespaceii$, the set
\[
\preimage{f}(B) \definedby \{ x \in \measurespace : f(x) \in B \}
\]
is the \term{preimage} of $B$ under $f$. We might just as well have said let $\preimage{f}$ denote the image of $f$ under a contravariant powerset functor.
This means that 
\[
\preimage{f}:\powerset(\measurespaceii)\to\powerset(\measurespace): B\mapsto\preimage{f}(B).
\]
The set $\preimage{f}(B)$ might also be denoted $\inv{f}(B)$, but not here.
Any restriction of such a $\preimage{f}$ which maps some subset of $\powerset(Y)$ to some subset of
$\powerset(X)$ may still be denoted $\preimage{f}$, in which case the domain and codomain of $\preimage{f}$ will be made explicit.
 
For any topological space $\measurespace$, we will let $\borel_\measurespace$ 
\nomenclature[Borel sets]{$\borel_\measurespace$}{Borel sets of the topological space $\measurespace$}
denote the $\textsigma$-algebra of subsets of 
$\measurespace$ generated by the topology, namely the \term{Borel subsets} of the topological space $\measurespace$.  
\end{notn}



\begin{defn}\label{measurable_space}
A pair $(\measurespace, \sigmaalgebra)$, where $\measurespace$ is a set and 
$\sigmaalgebra$ is a \textsigma\hyp{}algebra of subsets of $\measurespace$, is called a \term{measurable space}. Better terminology might be something flavored Mackey.
\end{defn}



\begin{defn}\label{measurable_function}
Let $(\measurespace, \sigmaalgebra)$ and $(\measurespaceii,\sigmaalgebraii)$ be measurable spaces.  A function $f:\measurespace\to\measurespaceii$ is called an 
\textbf{$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable function}
\index{measurable function}
if a restriction of $\preimage{f}$ to $\sigmaalgebraii$ is a function 
$\sigmaalgebraii\to\sigmaalgebra\,$; that is,
if $\preimage{f}(B) \in\sigmaalgebra$ for each  $B\in\sigmaalgebraii$.
To indicate that $f:\measurespace\to\measurespaceii$ is 
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, we might use the notation $f:(\measurespace,\sigmaalgebra)\to(\measurespaceii,\sigmaalgebraii)$.
\end{defn}



\begin{rmk}
An attempt at a categorical approach to measurable spaces and measurable functions which does not take into account collections of null sets would be considered a first attempt.  There is nothing wrong with first attempts. Who knows? You may end up factoring by an ideal.
\end{rmk}





\begin{prop}\label{function_induces_measure}
Let $(\measurespace,\sigmaalgebra)$  and  $(\measurespaceii, \sigmaalgebraii)$ be a measurable spaces.  
If $\measure$ is a measure on $\sigmaalgebra$, and a function $f:\measurespace\to\measurespaceii$ is 
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, where $\preimage{f}:\sigmaalgebraii\to\sigmaalgebra$,
then the set function
\[
\measure\circ\preimage{f} 
: \sigmaalgebraii\to [0,\infty] 
: B\mapsto \measure\bigl(\preimage{f}(B)\bigr)
\]
defines a measure on $\sigmaalgebraii$.
\end{prop}


\begin{defn}\label{induced_measure}
The measure $\measure\circ\preimage{\function}$ on the \textsigma-algebra of the codomain of $\function$ in Proposition~\ref{function_induces_measure} is the \textbf{measure induced by $\function$}.\index{measure induced by a function}
\end{defn}



\begin{rmk} 
Should two $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable functions $f$ and $g$ be equal $\measure^\kernast$-almost everywhere, then the induced \textsigma-algebras $\preimage{f}(\sigmaalgebraii)$ and $\preimage{g}(\sigmaalgebraii)$  need not be the same. However, the following proposition says that the induced measures 
$\measure^*\circ \preimage{f}$ and $\measure^*\circ\preimage{g}$ are the same. 
\end{rmk}


\begin{prop}\label{class_induces_measure}
Let $(\measurespace,\semiring,\measure)$ be a measure space, and let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space.  If  the functions 
$f:\measurespace\to\measurespaceii$ 
and
$g:\measurespace\to\measurespaceii$ 
are $(\measurable{\measure^\kernast}, \sigmaalgebraii)$\hyp{}measurable functions with 
$f = g$ $\measure^\kernast$-almost everywhere on $\measurespace$, then 
$\measure^*\bigl(A\meets \preimage{f}(B)\bigr) 
= 
\measure^*\bigl(A\meets \preimage{g}(B)\bigr)$ for all
$A\in \measurable{\measure^\kernast}$ and for all $B\in\sigmaalgebraii$.
So in particular,
$\measure^*\bigl(\preimage{f}(B)\bigr) 
= 
\measure^*\bigl(\preimage{g}(B)\bigr)$ for all
$B\in\sigmaalgebraii$.
\end{prop}

\begin{proof}
Define $M=\{\mspaceelt\in\measurespace : f(\mspaceelt) = g(\mspaceelt)\}$, so that  by hypothesis,
$\measure^*(M\comp) = 0$. Let $A\in \measurable{\measure^\kernast}$ and $B\in\sigmaalgebraii$.
If $\mspaceelt\in\preimage{f}(B)$ and $\mspaceelt\notin\preimage{g}(B)$, then 
$f(\mspaceelt)\in B$ and $g(\mspaceelt)\in B\comp$, implying 
$f(\mspaceelt)\neq g(\mspaceelt)$ and $\mspaceelt\notin M$, meaning 
\[
\preimage{f}(B)\meets (\preimage{g}(B))\comp 
\subseteq 
M\comp.
\]
This says 
\[
\measure^*\bigl(\preimage{f}(B)\meets (\preimage{g}(B))\comp\bigr) = 0
\]
since $\measure^*(M\comp)=0$. 
Because $\preimage{f}(B)$ is a disjoint union, as in
\[
\preimage{f}(B)
=
\bigl(\preimage{f}(B) \meets \preimage{g}(B)\bigr) 
\sqcup
\bigl(\preimage{f}(B) \meets (\preimage{g}(B))\comp\bigr),
\]
we can also write $A\meets\preimage{f}(B)$ as a disjoint union:
\[
A\meets \preimage{f}(B)
=
\Bigl(A\meets\bigl(\preimage{f}(B) \meets \preimage{g}(B)\bigr) \Bigr)
\sqcup
\Bigl(A\meets\bigl(\preimage{f}(B) \meets (\preimage{g}(B))\comp\bigr)\Bigr).
\]
Because $A\meets\preimage{f}(B)$ is $\measure^\kernast$-measurable, it follows by the very definition of what it means to be measurable that
\[
\measure^*\bigl(A\meets \preimage{f}(B)\bigr)
=
\measure^*\bigl(A\meets\preimage{f}(B) \meets \preimage{g}(B)\bigr)
+
\measure^*\bigl(A\meets\preimage{f}(B) \meets (\preimage{g}(B))\comp\bigr).
\]
But the fact that $\measure^*\bigl(\preimage{f}(B)\meets (\preimage{g}(B))\comp\bigr) = 0$
implies that 
$\measure^*\bigl(A\meets\preimage{f}(B)\meets (\preimage{g}(B))\comp\bigr) = 0$,
and so 
\[
\measure^*\bigl(A\meets\preimage{f}(B)\bigr)
=
\measure^*\bigl(A\meets\preimage{f}(B) \meets \preimage{g}(B)\bigr).
\]
By a symmetric argument, 
\[
\measure^*\bigl(A\meets\preimage{g}(B)\bigr)
=
\measure^*\bigl(A\meets\preimage{f}(B) \meets \preimage{g}(B)\bigr).
\]
Therefore by transitivity of equality,
\[
\measure^*\bigl(A\meets\preimage{f}(B)\bigr)
=
\measure^*\bigl(A\meets\preimage{g}(B)\bigr),
\]
as required.
\end{proof}


\begin{rmk}
The following proposition will be used to extend the notion of independence of 
$\cali{L}_p(\measurespace, \semiring, \measure)$
functions to independence of 
$L_p(\measurespace, \semiring, \measure)$
classes, which will appear in Definition~\ref{independent_classes}.
\end{rmk}


\begin{prop}\label{class_induced_measure}
Let $(\measurespace,\semiring,\measure)$ be a measure space, and let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space, and let
$f$, $g$, $h$, $k:\measurespace\to\measurespaceii$ 
be $(\measurable{\measure^\kernast}, \sigmaalgebraii)$\hyp{}measurable functions such that 
$f = h$ $\measure^\kernast$-almost everywhere on $\measurespace$ and
$g = k$ $\measure^\kernast$-almost everywhere on $\measurespace$.

If $\measure^*(A\meets B) =\measure^*(A)\measure^*(B)$ for all $A\in\preimage{f}(\sigmaalgebraii)$ and 
all $B\in\preimage{g}(\sigmaalgebraii)$, then
$\measure^*(C\meets D) =\measure^*(C)\measure^*(D)$ for all $C\in\preimage{h}(\sigmaalgebraii)$ and 
all $D\in\preimage{k}(\sigmaalgebraii)$.
\end{prop}

\begin{proof}
Let $E$, $F\in\sigmaalgebraii$.
Since $f=h$ $\measure^\kernast$-almost everywhere, 
by Proposition~\ref{class_induces_measure},
\[
\measure^*\bigl(\preimage{f}(E)\meets\preimage{k}(F)\bigr) 
= 
\measure^*\bigl(\preimage{h}(E)\meets\preimage{k}(F)\bigr)
\]
and
\[
\measure^*\bigl(\preimage{f}(E)\bigr) 
= 
\measure^*\bigl(\preimage{h}(E)\bigr).
\]
Since $g=k$ $\measure^\kernast$-almost everywhere, again
by Proposition~\ref{class_induces_measure},
\[
\measure^*\bigl(\preimage{f}(E)\meets\preimage{k}(F)\bigr) 
= 
\measure^*\bigl(\preimage{f}(E)\meets\preimage{g}(F)\bigr)
\]
and
\[
\measure^*\bigl(\preimage{k}(F)\bigr) 
= 
\measure^*\bigl(\preimage{g}(F)\bigr).
\]
By hypothesis,
\[
\measure^*\bigl(\preimage{f}(E)\meets\preimage{g}(F)\bigr)
=
\measure^*\bigl(\preimage{f}(E)\bigr)\measure^*\bigl(\preimage{g}(F)\bigr),
\]
and so by transitivity of equality,
\[
\measure^*\bigl(\preimage{h}(E)\meets\preimage{k}(F)\bigr)
=
\measure^*\bigl(\preimage{h}(E)\bigr)\measure^*\bigl(\preimage{k}(F)\bigr),
\]
as required.
\end{proof}


\begin{prop}\label{preimage_of_a_null_set}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra, and let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space.  Let the function $\phi:\measurespace\to\measurespaceii$ be $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable.
If a subset $B$ of $\measurespaceii$ is a $(\measure\circ\preimage{\phi})^\kernast$-null set, then  the subset $\preimage{\phi}(B)$ of $\measurespace$ is a $\measure^\kernast$-null set.
\end{prop}


\begin{proof}
Let $B$ be a subset of $\measurespaceii$ which is a $(\measure\circ\preimage{\phi})^\kernast$-null set. Since $\measure\circ\preimage{\phi}$ is a measure, by Proposition~\ref{function_induces_measure}, it follows that
the triple $(\measurespaceii, \sigmaalgebraii, \measure\circ\preimage{\phi})$ is a measure space. So by Proposition~\ref{approximation_sigma_algebra}, we can take a superset $C$ of $B$ with $C$ in the \textsigma-algebra $\sigmaalgebraii$ and having the same outer measure: 
$(\measure\circ\preimage{\phi})^*(C) =
(\measure\circ\preimage{\phi})^*(B) =0$.
Because the outer measure agrees with the measure on the generating semiring (\textsigma-algebra in this case), and because $\phi$ is assumed measurable, meaning $\preimage{\phi}(C)\in\sigmaalgebra$, the following equalities hold:
\begin{align*}
(\measure\circ\preimage{\phi})^*(C)
& = (\measure\circ\preimage{\phi})(C)
&& \text{$C\in\sigmaalgebraii$,}
\\
& = \measure\bigl(\preimage{\phi}(C)\bigr)
&& \text{definition of induced measure,}
\\
& = \measure^*\bigl(\preimage{\phi}(C)\bigr)
&& \text{$\preimage{\phi}(C)\in\sigmaalgebra$.}
\\
\end{align*}
With $B\subseteq C$, it follows that $\preimage{\phi}(B)\subseteq\preimage{\phi}(C)$ and since outer measure is monotone, 
$\measure^*\bigl(\preimage{\phi}(B)\bigr)
\leq
\measure^*\bigl(\preimage{\phi}(C)\bigr)$. The comparison
$0 \leq \measure^*\bigl(\preimage{\phi}(B)\bigr)
\leq
\measure^*\bigl(\preimage{\phi}(C)\bigr) = 0$ then shows that $\preimage{\phi}(B)$ is a $\measure^\kernast$-null subset of $\measurespace$, as required.
\end{proof}


\begin{prop}\label{preimage_of_a_measurable_set}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra, and let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space.  Let the function $\phi:\measurespace\to\measurespaceii$ be $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, and let  $B$ be a
$(\measure\circ\preimage{\phi})^\kernast$-measurable subset of $\measurespaceii$ with $(\measure\circ\preimage{\phi})^*(B)< \infty$.
Then $\preimage{\phi}(B)$ is a $\measure^\kernast$-measurable subset of $\measurespace$, and 
$\measure^*\bigl(\preimage{\phi}(B)\bigr) = (\measure\circ\preimage{\phi})^*(B)$. 
\end{prop}


\begin{proof}
As in the proof of Proposition~\ref{preimage_of_a_null_set}, and according to Proposition~\ref{approximation_sigma_algebra}, we can take a superset $C$ of $B$ with $C\in\sigmaalgebraii$ and having the same outer measure: 
\[
(\measure\circ\preimage{\phi})^*(C) =
(\measure\circ\preimage{\phi})^*(B).
\]
With $C\in\sigmaalgebraii$, it follows that $C$ is $(\measure\circ\preimage{\phi})^\kernast$-measurable by Proposition~\ref{semiring_measurable}.
Since $B$ is a subset of $C$, we can write $C$ as the disjoint union
\[
C=B\sqcup (C\meets B\comp).
\]

Because both $C$ (by construction) and $B$ (by hypothesis) are $(\measure\circ\preimage{\phi})^\kernast$-measurable, it follows that their set difference $C\meets B\comp$ is also $(\measure\circ\preimage{\phi})^\kernast$-measurable. And the outer measure 
$(\measure\circ\preimage{\phi})^*$ is additive on the \textsigma-algebra $\measurable{(\measure\circ\preimage{\phi})^*}$, so
\[
(\measure\circ\preimage{\phi})^*(C) =
(\measure\circ\preimage{\phi})^*(B) +
(\measure\circ\preimage{\phi})^*(C\meets B\comp).
\]
We have assumed that $(\measure\circ\preimage{\phi})^*(B) <\infty$, and by construction 
$(\measure\circ\preimage{\phi})^*(C) =
(\measure\circ\preimage{\phi})^*(B)$, so $(\measure\circ\preimage{\phi})^*(C) <\infty$.
It follows that 
$(\measure\circ\preimage{\phi})^*(C\meets B\comp) =0$. This would not follow were 
$(\measure\circ\preimage{\phi})^*(B) = \infty$

Since $C\meets B\comp$ is a $(\measure\circ\preimage{\phi})^\kernast$-null set of $\measurespaceii$, it follows by Proposition~\ref{preimage_of_a_null_set} that 
$\preimage{\phi}(C\meets B\comp)$ is a $\measure^\kernast$-null set of $\measurespace$, and therefore $\measurable{\measure^*}$. And since $\preimage{\phi}(C)$ is $\measurable{\measure^*}$, it follows that the set difference $\preimage{\phi}(B)$ of $\preimage{\phi}(C)$ with $\preimage{\phi}(C\meets B\comp)$ is $\measurable{\measure^*}$.
We can also write $\preimage{\phi}(C)$ as the disjoint union
\[
\preimage{\phi}(C) =
\preimage{\phi}(B) \sqcup \preimage{\phi}(C\meets B\comp).
\]
The outer measure $\measure^*$ is additive on these $\measurable{\measure^*}$ sets, so
\[
\measure^*\bigl(\preimage{\phi}(C)\bigr) = 
\measure^*\bigl(\preimage{\phi}(B)\bigr) +
\measure^*\bigl(\preimage{\phi}(C\meets B\comp)\bigr).
\]

But $\preimage{\phi}(C\meets B\comp)$ is a $\measure^\kernast$-null set, so 
\[
\measure^*\bigl(\preimage{\phi}(C)\bigr) = 
\measure^*\bigl(\preimage{\phi}(B)\bigr).
\]
Also, as displayed in the proof of Proposition~\ref{preimage_of_a_null_set},
\[
(\measure\circ\preimage{\phi})^*(C)
=
\measure^*\bigl(\preimage{\phi}(C)\bigr).
\] 
It follows by transitivity of equality that 
\[
\measure^*\bigl(\preimage{\phi}(B)\bigr) = (\measure\circ\preimage{\phi})^*(B),
\]
as required.
\end{proof}


\begin{rmk}
One of the difficulties in working with $\textsigma$\hyp{}subalgebras is that
the restriction of a $\textsigma$\hyp{}finite measure to a $\textsigma$\hyp{}subalgebra need not be 
$\textsigma$\hyp{}finite.  This is a clear indication that our definitions of \textsigma\hyp{}finite measures and/or \textsigma\hyp{}subalgebras need more work. A definition that does not respect sub\hyp{}objects must not yet be right.
\end{rmk}





\begin{prop}\label{measurable_inclusion}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a finite measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra.  If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$, then 
$\measurable{\measuresubstar{\sigmaalgebraii}} \subseteq \measurable{\measure^\kernast}$, and
$\measuresubstar{\sigmaalgebraii}(A) = \measure^*(A)$ for all 
$A \in \measurable{\measuresubstar{\sigmaalgebraii}}$.
\end{prop}



\begin{proof}
Let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$, and let 
$A\in \measurable{\measuresubstar{\sigmaalgebraii}}$.
The function $i:\measurespace\to\measurespace : A \mapsto A$, where $\preimage{i}:\sigmaalgebraii\to\sigmaalgebra$, is $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable since $\sigmaalgebraii$ is supposed to be a \textsigma-subalgebra of $\sigmaalgebra$.
In order to apply Proposition~\ref{preimage_of_a_measurable_set}, we first show that $\measure\restrictedto{\sigmaalgebraii} = \measure\circ\preimage{i}$ on $\sigmaalgebraii$: If $B\in\sigmaalgebraii$, then 
$\measure\restrictedto{\sigmaalgebraii}(B) 
= \measure(B) 
= \measure\bigl(\preimage{i}(B)\bigr)
= (\measure\circ\preimage{i})(B)$.
And so by Proposition~\ref{extension_measure}, it follows that $\measuresubstar{\sigmaalgebraii}=(\measure\circ\preimage{i})^*$ on 
$\measurable{\measuresubstar{\sigmaalgebraii}} 
= 
\measurable{(\measure\circ\preimage{i})^\kernast}$.


Since $A\in \measurable{\measuresubstar{\sigmaalgebraii}} =\measurable{(\measure\circ\preimage{i})^\kernast}$,
and since $(\measurespace, \sigmaalgebra, \measure)$ is finite,
it follows by Proposition~\ref{preimage_of_a_measurable_set} that 
$\preimage{i}(A) = A$ is a $\measure^\kernast$-measurable set.  This shows that 
$\measurable{\measuresubstar{\sigmaalgebraii}} \subseteq \measurable{\measure^\kernast}$. 
It also follows by Proposition~\ref{preimage_of_a_measurable_set} that 
$\measure^*\bigl(\preimage{i}(A)\bigr) = (\measure\circ\preimage{i})^*(A)$, which shows that $\measure^*(A) = \measuresubstar{\sigmaalgebraii}(A)$, as required.
\end{proof}



\begin{rmk}
The following proposition says that two functions which are equal almost everywhere are either simultaneously measurable or not. As it should be.  
\end{rmk}



\begin{prop}\label{measurable_almost_everywhere}
If a function $\function:\measurespace\to\R$ is \mbmeasurable, and 
a function $\functionii$ is equal to $\function$
$\measure^\kernast$-almost everywhere, then $\functionii$ is also \mbmeasurable. 
\end{prop}




\begin{thm}\label{measurable_limits}
Let $\{f_n\}$ be a sequence of \mbmeasurable\ functions. If $f:\measurespace\to\R$ is a function such that $f_n\to f$ $\measure^\kernast$-almost everywhere, then $f$ is also \mbmeasurable.
\end{thm}




\begin{quoting}
\small
Underlying the mechanics of Proposition~\ref{measurable_almost_everywhere} and Theorem~\ref{measurable_limits} is the property of completeness. This property describes a tight interplay between a measure and the collection of sets which forms its domain; let's say a measure space is \emph{complete}\index{complete measure space} if every subset of a set of measure zero is measurable. It is almost worth ferreting this out, and then restating the proposition and theorem in these terms.   Vaguely, let $(\measurespace, \sigmaalgebra, \measure)$ be a complete measure space, where $\sigmaalgebra$ is at least an algebra of sets. Then if $f:\measurespace\to\R$ is an 
$(\sigmaalgebra,\borel_\R)$\hyp{}measurable function, and $g:\measurespace\to\R$ is a function  with $g = f$ $\measure$\hyp{}almost everywhere, then $g$ is also an 
$(\sigmaalgebra,\borel_\R)$\hyp{}measurable function. Since the measure space 
$(\measurespace, \measurable{\measure^\kernast}, \measure^*)$ \emph{is} a complete measure space, the proposition would follow. But this is a type of interference that generates problems which I do not want to solve here.
\end{quoting}



\begin{prop}
The collection of all \mbmeasurable\ functions forms a vector lattice.
\end{prop}








\begin{defn}\label{simple_function}
Let $(\measurespace, \sigmaalgebra)$ be a measurable space.
An $(\sigmaalgebra, \borel_\R)$\hyp{}measurable function  having finite range is called an $(\sigmaalgebra, \borel_\R)$\hyp{}\term{simple function}.
\end{defn}



\begin{prop}\label{measurable_implies_simple_function_limit}
Let $(\measurespace, \sigmaalgebra)$ be a measurable space, and let $f:\measurespace\to\R$ be an $(\sigmaalgebra, \borel_\R)$\hyp{}measurable function such that $f(x)\geq 0$ for all $x\in\measurespace$. 
There is a sequence $\{\phi_n\}$ of $(\sigmaalgebra, \borel_\R)$-simple functions such that $\phi_n(x)\geq 0$ and $\phi_n(x)\uparrow f(x)$ for all $x\in\measurespace$.
\end{prop}



\begin{prop}\label{measurable_equivalent_simple_function_limit}
Let $(\measurespace, \sigmaalgebra)$ be a measurable space.
A function $f:\measurespace\to\R$ is $(\sigmaalgebra,\borel_\R)$\hyp{}measurable if and only if there is a sequence $\{\phi_n\}$ of $(\sigmaalgebra, \borel_\R)$-simple functions such that $\lim \phi_n(x) = f(x)$ for all $x\in\measurespace$.
\end{prop}



\begin{thm}\label{mixing_measurable_functions}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a $\textsigma$-finite measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra.  If $f:\measurespace\to\R$ is a \mbmeasurable\ function, then there exists an $(\sigmaalgebra,\borel_\R)$\hyp{}measurable function $g:\measurespace\to\R$ with $f=g$ $\measure^\kernast$-almost everywhere.
\end{thm}

\begin{proof}
Roughly, we show the result holds for characteristic functions, then for simple functions, then for pointwise limits of simple functions. 
Assume $f(x)\geq 0$ for all $x\in\measurespace$.

Let $A$ be a  $\measure^\kernast$-measurable subset of $\measurespace$, and suppose $f=\charfunction{A}$, so $f$ is a \mbmeasurable\ characteristic function. By Proposition~\ref{approximation_sigma_finite}, there is a subset $C\subseteq\measurespace$ with $A\meets C =\mtset$ and  such that $\measure^*(C) = 0$ with $A\cup C\in \sigmaalgebra$.
Take $g=\charfunction{A\cup C}$, so $g$ is an $(\sigmaalgebra,\borel_\R)$\hyp{}measurable characteristic function. Then $g-f = \charfunction{C}$, and $\measure^*(C) = 0$, which says that $f=g$ $\measure^\kernast$-almost everywhere.

Now let $f$ be a $(\measurable{\measure^\kernast},\borel_\R)$-simple function, so by definition we can let the set $\{a_1,\ldots, a_n\}$ denote the range of $f$. Further, let $A_i = \preimage{f}(a_i)$, so each $A_i$ is a $\measure^\kernast$-measurable subset of $\measurespace$. We can write $f=\sum_{i=1}^n a_i\charfunction{A_i}$.
Again, by Proposition~\ref{approximation_sigma_finite}, there are subsets $C_i\subseteq\measurespace$ with $A_i\meets C_i =\mtset$ and  such that $\measure^*(C_i) = 0$ with $A_i\cup C_i\in \sigmaalgebra$.  
Now take $g=\sum_{i=1}^n a_i\charfunction{A_i\cup C_i}$, so $g$ is an $(\sigmaalgebra,\borel_\R)$-simple function. The difference $g-f = \sum_{i=1}^n a_i\charfunction{C_i}$. Since $\measure^*(C_i)=0$, this says that $g-f = 0$ $\measure^\kernast$-almost everywhere; equivalently, $f=g$ $\measure^\kernast$-almost everywhere.

Finally, let $f:\measurespace\to\R$ be any \mbmeasurable\ function.
By Proposition~\ref{measurable_implies_simple_function_limit}, there is a sequence $\{ \phi_n \}$ of $(\measurable{\measure^\kernast},\borel_\R)$-simple functions such that $\phi_n(x)\geq 0$ and $\phi_n(x)\uparrow f(x)$ for all $x\in\measurespace$.
And we have just shown that for each of these $\phi_n$, there is an $(\sigmaalgebra,\borel_\R)$-simple function, call it $\mspaceeltii_n$, such that $\phi_n = \mspaceeltii_n$  $\measure^\kernast$-almost everywhere. That is, $\phi_n(x) = \mspaceeltii_n(x)$ for all $x$ in the complement of some set, call it $A_n$, with $\measure^*(A_n) = 0$. 
The fact that $\measure^*(A_n)=0$ only says that $A_n\in\measurable{\measure^\kernast}$.
However, by Proposition~\ref{approximation_sigma_algebra}, there is a superset $B_n\in \sigmaalgebra$ with $A_n\subseteq B_n$ and $\measure^*(A_n) = \measure^*(B_n)$.
Then $\phi_n(x) = \mspaceeltii_n(x)$ for all $x$ in the complement of $B_n$ with $\measure^*(B_n) = 0$ and $B_n\in\sigmaalgebra$. 
Write $B=\bigcup B_n$, so $B\in\sigmaalgebra$.  
It follows that $\mspaceeltii_n(x) \uparrow f(x)$ for all $x$ in the complement of $B$. Consequently, $\mspaceeltii_n \charfunction{B\comp} \uparrow f \charfunction{B\comp}$ on all of $\measurespace$. This time take $g=f \charfunction{B\comp}$. Then $f = g$ $\measure^\kernast$-almost everywhere. To complete the proof, we need only show that $g$ is $(\sigmaalgebra,\borel_\R)$\hyp{}measurable. See that $B\in\sigmaalgebra$ implies $B\comp\in\sigmaalgebra$, so $\charfunction{B\comp}$ is $(\sigmaalgebra,\borel_\R)$\hyp{}measurable. Each $\mspaceeltii_n$ is $(\sigmaalgebra,\borel_\R)$\hyp{}measurable, and so the product $\mspaceeltii_n \charfunction{B\comp}$ is an $(\sigmaalgebra,\borel_\R)$\hyp{}measurable function and consequently an $(\sigmaalgebra,\borel_\R)$-simple function. Therefore by Proposition~\ref{measurable_equivalent_simple_function_limit}, the function $g$ is $(\sigmaalgebra,\borel_\R)$\hyp{}measurable, as required.
\end{proof}



\begin{defn}\label{step_function}
Let us say that a
$(\measurable{\measure^\kernast}, \borel_\R)$\hyp{}simple function is a
$(\measurable{\measure^\kernast},\borel_\R)$\hyp{}\term{step function} if it can be expressed as a linear combination of characteristic functions of $\measure^\kernast$\hyp{}measurable sets of finite measure.  For example, $\phi=\sum_{i=1}^n a_i\charfunction{A_i}$, where each $A_i$ is a $\measure^\kernast$-measurable set with $\measure^*(A_i) < \infty$, where we can suppose the $A_i$ to be pairwise disjoint.
\end{defn}



\begin{prop}\label{sigma_finite_step_functions}
If $(\measurespace, \semiring, \measure)$ is a $\textsigma$-finite measure space, and $f:\measurespace\to\R$ is a \mbmeasurable\ function with $f(x)\geq 0$ on $\measurespace$, 
then there is a sequence $\{\phi_n\}$ of $(\measurable{\measure^\kernast},\borel_\R)$ step functions such that $\phi_n(x)\geq 0$ and $\phi_n(x)\uparrow f(x)$ for all $x\in\measurespace$.
\end{prop}







\begin{defn}\label{integral_step_function}
Let $\phi:\measurespace\to\R$ be a $(\measurable{\measure^\kernast},\borel_\R)$-step function such that $\phi=\sum_{i=1}^{n}a_i\charfunction{A_i},$ where the range of $\phi$ is the set $\{a_1, \ldots, a_n\}$, and each $A_i=\preimage{\phi}(\{ a_i\} )$. Then the Lebesgue \emph{integral}\index{integral}  of $\phi$, denoted by $\int_\measurespace\phi\,d\measure$, or simply $\int \phi$,  is defined to be the real number
\[
\int_\measurespace\phi\,d\measure = \sum_{i=1}^{n}a_i\measure^*(A_i).
\]
\end{defn}


\begin{prop}
Let $\phi:\measurespace\to\R$ be a $(\measurable{\measure^\kernast},\borel_\R)$-step function.
\begin{enumerate}
\item
If $\phi \geq 0$ $\measure^\kernast$-almost everywhere, then 
$\int_\measurespace\phi\,d\measure \geq 0$.
\item
If $\phi = 0$ $\measure^\kernast$-almost everywhere, then 
$\int_\measurespace\phi\,d\measure = 0$.
\end{enumerate}
\end{prop}


\begin{prop}\label{continuity_at_zero}
Let $\{\phi_n\}$ be a sequence of $(\measurable{\measure^\kernast},\borel_\R)$-step functions.  If $\phi_n\downarrow 0$ $\measure^\kernast$-almost everywhere, then $\int \phi_n\downarrow 0$.
\end{prop}



\begin{prop}\label{integral_is_unique}
Let $f:\measurespace\to\R$. If $\{\phi_n\}$ and $\{\mspaceeltii_n\}$ are sequences of $(\measurable{\measure^\kernast},\borel_\R)$-step functions with 
$\phi_n\uparrow f$ $\measure^\kernast$-almost everywhere, and with 
$\mspaceeltii_n\uparrow f$ $\measure^\kernast$-almost everywhere,
then 
$\lim \int_\measurespace\phi_n\,d\measure 
=
\lim \int_\measurespace\mspaceeltii_n\,d\measure.$
\end{prop}



\begin{defn}\label{upperfunction}
Let $f:\measurespace\to\R$.  If there is a sequence $\{\phi_n\}$ of $(\measurable{\measure^\kernast}, \borel_\R)$-step functions such that $\phi_n\uparrow f$ $\measure^\kernast$-almost everywhere, and $\lim \int_\measurespace\phi_n\,d\measure < \infty$, then $f$ is called an \term{upper function}, and the Lebesgue integral  of $f$, denoted by $\int_\measurespace f\, d\measure$, or simply $\int f$, is  defined to be the real number
\[
\int_\measurespace f\, d\measure
=
\lim \int_\measurespace\phi_n\,d\measure.
\]
We might also call $\funcf$ a
$(\measurable{\measure^\kernast}, \borel_\R)$-upper function.
By Proposition~\ref{integral_is_unique}, the value of the Lebesgue integral of an upper function is independent of a chosen sequence of step functions 
$\phi_n\uparrow f$.
By Theorem~\ref{measurable_limits}, every upper function is \mbmeasurable.
\end{defn}


\begin{prop}
If $f$ and $g$ are upper functions such that $f\geq g$ $\measure^\kernast$-almost everywhere, then 
$\int f \geq \int g$.
\end{prop}



\begin{prop}
Let $\{f_n\}$ be a sequence of upper functions.  If $f_n\downarrow 0$ $\measure^\kernast$-almost everywhere, then $\int f_n\downarrow 0$.
\end{prop}


\begin{defn}\label{integrable}
A function $f:\measurespace\to\R$ is 
\textbf{integrable}\index{integrable function} over $\measurespace$ with respect to $\measure$
if there exist two upper functions $g$ and $h$ such that $f = g - h$ $\measure^\kernast$-almost everywhere.  Then the Lebesgue integral  of $f$ over $\measurespace$ with respect to $\measure$, denoted by $\int_\measurespace f\, d\measure$, or simply $\int f$, is defined to be the real number
\[
\int_\measurespace f\,d\measure = \int_\measurespace g\, d\measure -\int_\measurespace h \, d \measure.
\]
The value of this integral is independent of the representation of $f$ as a difference of upper functions.
A function $f:\measurespace\to\R$ is 
\emph{integrable over a $\measure^\kernast$-measurable subset $A$ with respect to $\measure$}
if $f\cdot\charfunction{A}$ is integrable over $\measurespace$ with respect to
$\measure$, in which case $\int_A f\, d\measure$ is defined to be $\int_\measurespace f\cdot\charfunction{A}\, d\measure$.

An extended real function $\function:\measurespace\to [-\infty,+\infty]$ 
\term{defines an integrable function} over $\measurespace$
with respect to $\measure$
if the function $\function$ ``attains'' $-\infty$ or $+\infty$, or is undefined, on a set of at most 
$\measure^\kernast$-measure zero, so it is possible to redefine the values of $\function$ on this set in order that the corresponding redefined function 
$\measurespace\to\R$ is integrable over $\measurespace$ with respect to $\measure$.
We assume all such functions have been so redefined, and consequently lie in the domain of the Lebesgue integral, if that makes sense. Extended real functions are hard to avoid when it comes to dealing with signed measures, or even positive measures.
\end{defn}






\begin{prop}\label{integrable_and_positive_is_upper}
Let $f:\measurespace\to\R$ be a function integrable over $\measurespace$ with respect to $\measure$.   If $f\geq 0$ $\measure^\kernast$-almost everywhere, then $f$ is an upper function.
\end{prop}


\begin{prop}\label{sigma_algebra_measurable}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a \textsigma\hyp{}finite measure space, where $\sigmaalgebra$ is a \textsigma\hyp{}algebra.
If $f:\measurespace\to\R$ is a function integrable over $\measurespace$ with respect to $\measure$,
then there is an $(\sigmaalgebra,\borel_\R)$\hyp{}measurable
function $\funcg:\measurespace\to\R$
with $\funcf = \funcg$ $\measure^\kernast$\hyp{}almost everywhere.
\end{prop}

\begin{proof}
Let
$f:\measurespace\to\R$ be integrable over $\measurespace$ with respect to $\measure$.
By Theorem~\ref{measurable_limits},  the function $\funcf$ is
$(\measurable{\measure^\kernast}, \borel_\R)$\hyp{}measurable, and
by Theorem~\ref{mixing_measurable_functions}, the function $\funcf$ is $\measure^\kernast$\hyp{}almost everywhere equal to an $(\sigmaalgebra,\borel_\R)$\hyp{}measurable function, as required.
\end{proof}


\begin{rmk}
The collection of real functions on $\measurespace$ that can be written as the difference of upper functions forms a vector lattice, and the integral is a positive linear functional on this vector lattice. Maybe the integral here should have been defined as a positive linear functional with a continuity condition at zero, per Daniell. Of which, the Lebesgue, and so the Riemann, integral is simply a concrete example.
\end{rmk}



\begin{prop}\label{dominated_by_integrable}
If $\function:\measurespace \to \R$ be an integrable function,
and if $\functionii:\measurespace \to \R$ is a $(\measurable{\measure^\kernast},\borel_\R)$\hyp{}measurable function with
$0\leq \functionii \leq \function$ $\measure^\kernast$\hyp{}almost everywhere, then $\functionii$ is an integrable function.
\end{prop}



\begin{prop}\label{integral_absolute_zero}
Let $f:\measurespace\to\R$ be a function integrable over $\measurespace$ with respect to $\measure$.  
Then $\int \abs{f} \,d\measure = 0$ if and only if $f=0$ $\measure^\kernast$\hyp{}almost everywhere.
\end{prop}


\begin{prop}\label{uniqueness_radon_nikodym}
Let
$(\measurespace,\semiring,\measure)$
be a measure space, and let $\funcf:\measurespace\to\R$ be integrable over
$\measurespace$
with respect to $\measure$.
If
$\int_\seti f\, d\measmu = 0$ for all $\seti\in\semiring$, then
$f = 0$ $\measure^\kernast$\hyp{}almost everywhere.
\end{prop}



\chapter{Function Spaces and Quotient Spaces}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\lettrine{I}{n order} to deal with the $L_p$ spaces in a manner that is actually mathematically correct, 
we will use three theorems from algebra; namely, 
the induced homomorphism theorem, the correspondence theorem, and the induced quotient homomorphism corollary. These appear respectively as Proposition~\ref{induced_homomorphism}, Proposition~\ref{correspondence_theorem}, and Proposition~\ref{induced_quotient_homomorphism}. These propositions are couched in terms of group theory because that is all it takes to get to the heart of the matter. Understand that each of these three theorems has a straightforward extension to modules or vector spaces.

We pay attention to the difference between a function and an equivalence class of functions for at least two reasons.  The first reason is that  clarity is more important here.  The second reason is that we will deal with so-called \emph{versions} of maps defined on \textsigma-algebras which will require selecting representatives from equivalence classes of functions. These will appear in Definition~\ref{regular_version}.
%\end{quoting}


\begin{defn}\label{Lp}
Let $(\measurespace, \semiring, \measure)$ be a measure space, and let $p \in (0, \infty)$.
The collection of all \mbmeasurable\ functions $f:\measurespace\to\R$ for which $\abs{f}^p$ is integrable forms a semi-normed vector space, denoted by 
$\cali{L}_p(\measurespace, \semiring, \measure)$.
\index{Lp@$L_p(\measurespace, \semiring, \measure)$}
If $f\in\cali{L}_p(\measurespace, \semiring, \measure)$, then $\int\abs{f}^p\,d\measure=0$ if and only if $f = 0$ $\measure^\kernast$-almost everywhere.
A quotient space defined by identifying those functions in $\cali{L}_p(\measurespace, \semiring, \measure)$ which agree $\measure^\kernast$-almost everywhere forms a normed vector space, denoted by $L_p(\measurespace, \semiring, \measure)$, where the norm will be defined in terms of the integral. That is, let 
$\cali{N}_p(\measurespace, \semiring, \measure)$ denote the subspace of functions in 
$\cali{L}_p(\measurespace, \semiring, \measure)$ which are equal to zero $\measure^\kernast$-almost everywhere, then
\[
L_p(\measurespace, \semiring, \measure) :=
\cali{L}_p(\measurespace, \semiring, \measure)/
\cali{N}_p(\measurespace, \semiring, \measure).
\]


For each $f\in\cali{L}_p(\measurespace, \semiring, \measure)$, we will let $\ellclass{f}{\measure}$ denote the equivalence class $f + \cali{N}_p(\measurespace, \semiring, \measure)$ in 
$L_p(\measurespace, \semiring, \measure)$.  Should $(\measurespace, \semiring, \measure)$ and $(\measurespace, \semiringii, \measureii)$
both be measure spaces, and should the function $f:\measurespace\to\R$ be in  both 
$\cali{L}_p(\measurespace, \semiring, \measure)$ and
$\cali{L}_p(\measurespace, \semiringii, \measureii)$,
then the equivalence class $\ellclass{f}{\measure}$ need not be related to the equivalence class  
$\ellclass{f}{\measureii}$.
Not even when $\semiringii\subseteq\semiring$ and $\measureii=\measure\restrictedto{\semiringii}$, as shown in Example~\ref{unequal_kernel}.
Should a discussion or proposition involve only a single measure $\mu$, we might inconsistently drop the superscript and denote
$\ellclass{f}{\mu}$ by $\lebclass{f}$.

Since $\cali{N}_1(\measurespace, \semiring, \measure)$ is in the kernel of the integral $\int$, there is a unique operator $\inducedint$ which makes the following diagram commute:
\[
\xymatrix@R=16pt{ 
\cali{L}_1(\measurespace, \semiring, \measure) \ar[r]^-{\int} 
\ar@{->>}[d]_{\text{quotient}}
&
\R  
\\
L_1(\measurespace, \semiring, \measure)
 \ar@{.>}[ur]_-{\inducedint}
\\
}
\]
It means that for a class 
$\ellclass{f}{\measure}\in L_p(\measurespace, \semiring, \measure)$, the value of 
$\inducedint_\measurespace \ellclass{f}{\measure}\, d\measure$ is defined to be equal to the value of
$\int_\measurespace f\, d\measure$. Verify that the map $\inducedint$ is constant on the cosets of 
$L_p(\measurespace, \semiring, \measure)$.
The integral symbol `$\inducedint$' with the overbar was chosen to somewhat distinguish itself from the plain integral symbol `$\int$'.  We have a very large number of symbols in mathematics. Do not use the exact same symbol for everything. As usual, define the $L_p$ norm by 
\[
\bigl\Vert\ellclass{f}{\measure}\bigr\Vert_p
\definedby
\left(\int\abs{f}^p\,d\measure\right)^{1/p}.
\]

The quotient space $L_p(\measurespace, \semiring, \measure)$ need not form an algebra with respect to pointwise multiplication. Still, for classes $\ellclass{f}{\measure}$ and $\ellclass{g}{\measure}$ in $L_p(\measurespace, \semiring, \measure)$, if the function $\abs{fg}^p$ is integrable with respect to the measure $\measure$, then we can define the product
$\ellclass{f}{\measure}\ellclass{g}{\measure}$ of classes to be the class $\ellclass{fg}{\measure}$. In this case, verify that if $h\in\ellclass{f}{\measure}$, and $k\in\ellclass{g}{\measure}$, then $\ellclass{hk}{\measure} = \ellclass{fg}{\measure}$.
\index{product of classes in $L_1$}

\end{defn}



\begin{rmk}
The extension of the following proposition to modules, or vector spaces, underlies the commutative diagram in Definition~\ref{Lp}. 
\end{rmk}

\begin{prop}\label{induced_homomorphism}
If $A$ and $B$ are groups with $C \normalin A$, and $\phi$ is a homomorphism ${A\to B}$ with $C$ contained in the $\kernel \phi$, there is a unique induced homomorphism ${\overline \phi}:A/C\to B$ mapping the coset $a+C$ to $\phi(a)$, so that the following diagram commutes.
\[
\xymatrix@R=14pt@C=16pt{
 A  \ar[r]^{\phi} \ar@{->>}[d]_<<<{Q_C} &  B \\
 A/C \ar@{.>}[ur]_{\overline \phi} &                     \\}
\]
The $\range {\overline \phi} = \range \phi$ and the $\kernel {\overline \phi} =(\kernel \phi) /C$. The induced homomorphism is an isomorphism exactly when both $\phi$ is epic and $C=\kernel \phi$.

\end{prop}



\begin{rmk}
The $L_p(\measurespace, \semiring, \measure)$ spaces can be comparable; for example, let $(\measurespace, \semiring, \measure)$ be a finite measure space, then the quotient space $L_2(\measurespace, \semiring, \measure)$ is a vector subspace of the quotient space
$L_1(\measurespace, \semiring, \measure)$. This is the heart of the correspondence theorem, stated in Proposition~\ref{correspondence_theorem},  which extends to vector spaces, and it would be necessary that 
$\cali{N}_2(\measurespace, \semiring, \measure) = \cali{N}_1(\measurespace, \semiring, \measure)$
in order for the proposition to apply.
The result then that 
$L_2(\measurespace, \semiring, \measure)$ is a vector subspace of
$L_1(\measurespace, \semiring, \measure)$ follows from the fact that for a finite measure space, 
$\cali{L}_2(\measurespace, \semiring, \measure)
\subseteq
\cali{L}_1(\measurespace, \semiring, \measure)$, which in turn is an application of H\"older's inequality.
\end{rmk}


\begin{prop}\label{correspondence_theorem}
If $f:G\twoheadrightarrow H$ is an epimorphism of groups, then the assigment $K\mapsto f(K)$ defines a one-to-one correspondence between the set of all subgroups $K$ of $G$ which contain the $\kernel f$ and the set of all subgroups of $H$. 
\[
\xymatrix@R=10pt@C=0pt{ 
\kernel f  & \leq  & K \ar@{|->}[d] & \leq & G \ar@{|->}[d]\\
 &  & f(K) & \leq & H\\
}
\]
Consequently, if $N$ is a normal subgroup of a group $G$, then every subgroup of $G/N$ is of the form $K/N$, where $K$ is a subgroup of $G$ that contains $N$. 
\[
\xymatrix@R=10pt@C=0pt{ 
N \ar@{|->}[d] & \leq  & K \ar@{|->}[d] & \leq & G \ar@{|->}[d]\\
N/N & \leq & K/N & \leq & G/N\\
}
\]
\end{prop}



\begin{prop}
If $(\measurespace, \semiring, \measure)$ is a measure space, then
$\cali{N}_2(\measurespace, \semiring, \measure) = \cali{N}_1(\measurespace, \semiring, \measure)$.
\end{prop}

\begin{proof}
If 
$f\in \cali{L}_2(\measurespace, \semiring, \measure)$ and $f=0$ $\measure^\kernast$-almost everywhere, then $f\in \cali{L}_1(\measurespace, \semiring, \measure)$, and if 
$f\in \cali{L}_1(\measurespace, \semiring, \measure)$ and $f=0$ $\measure^\kernast$-almost everywhere, then $f\in \cali{L}_2(\measurespace, \semiring, \measure)$.
\end{proof}



\begin{prop}
If $(\measurespace, \semiring, \measure)$ is finite, then $L_2(\measurespace, \semiring, \measure)$ is a vector subspace of the quotient space
$L_1(\measurespace, \semiring, \measure)$. 
\[
\xymatrix@R=10pt@C=0pt{ 
\cali{N}_1(\measurespace, \sigmaalgebra, \measure) \ar@{|->}[d] & \leq  & 
\cali{L}_2(\measurespace, \sigmaalgebra, \measure) \ar@{|->}[d] & \leq & 
\cali{L}_1(\measurespace, \sigmaalgebra, \measure) \ar@{|->}[d]\\
\text{trivial} & \leq & 
L_2(\measurespace, \sigmaalgebra, \measure) & \leq &
L_1(\measurespace, \sigmaalgebra, \measure)\\
}
\]
\end{prop}






\begin{prop}\label{null_set_test}
Let $(\measurespace, \semiring, \measure)$ be a measure space, and let $f$ be an integrable function such that $f>0$ $\measure^\kernast$-almost everywhere.  If 
$A$ is a $\measure^\kernast$-measurable subset of $\measurespace$, and $\int_A f\, d\measure=0$, then $\measure^*(A)=0$.
\end{prop}



\begin{prop}\label{equal_function_test}
Let $(\measurespace, \semiring, \measure)$ be a measure space. If the class
$\ellclass{f}{\measure}\in L_1 (\measurespace, \semiring, \measure)$, and if  $\int_A f\, d\measure =0$ for all $A\in \semiring$, then $\ellclass{f}{\measure} = \ellclass{0}{\measure}$. Alternately,  if
$\ellclass{f}{\measure}$, $\ellclass{g}{\measure} \in L_1 (\measurespace, \semiring, \measure)$, and if 
$\int_A f\, d\measure = \int_A g\, d\measure$ for all $A\in \semiring$, then 
$\ellclass{f}{\measure} = \ellclass{g}{\measure}$.
\end{prop}



Compare the following Proposition~\ref{step_functions_dense} (where we assume integrability) with Proposition~\ref{sigma_finite_step_functions} (where we do not assume integrability, but we do assume 
$\textsigma$-finiteness):
\begin{quoting}
\small
Proposition~\ref{sigma_finite_step_functions}.
If $(\measurespace, \semiring, \measure)$ is a $\textsigma$-finite measure space, and $f:\measurespace\to\R$ is a \mbmeasurable\ function with $f(x)\geq 0$ on $\measurespace$, 
then there is a sequence $\{\phi_n\}$ of $(\measurable{\measure^\kernast},\borel_\R)$ step functions such that $\phi_n(x)\geq 0$ and $\phi_n(x)\uparrow f(x)$ for all $x\in\measurespace$.
\end{quoting}



\begin{prop}\label{step_functions_dense}
For every $p\in [1, \infty)$, the equivalence classes of $(\measurable{\measure^\kernast}, \borel_\R)$-step functions form a vector sublattice of the Banach lattice $L_p(\measurespace, \semiring, \measure)$, which is norm dense.
\end{prop}



\begin{prop}\label{integral_continuous}
If $E$ is a Banach lattice and $F$ is a normed vector lattice, then every positive operator $E\to F$ is continuous.
\end{prop}



\begin{rmk}
The integral $\inducedint$ on $L_1(\measurespace, \semiring, \measure)$ is an example of a positive operator on a Banach lattice, and so the integral on $L_1(\measurespace, \semiring, \measure)$ is necessarily continuous. But with respect to which topologies?
\end{rmk}







The following proposition describes what is sometimes called a \emph{change of variable}, and perhaps should have been couched as:
\[
\xymatrix@R=0pt@C=30pt{ 
(\measurespace,\sigmaalgebra,\measure)
\ar[r]_-{T} \ar@/^16pt/[rr]^{f\circ T}
& (\measurespaceii,\sigmaalgebraii,\measure\circ\preimage{T})
\ar[r]_-{\function}
& (\R,\borel_\R), \\
\scriptstyle{\preimage{T}(\setii)} & \scriptstyle{\setii} & \\
}
\]
with
\[
\int_{\preimage{T}(\setii)} (\function\circ T) \, d\measure
= \int_\setii \function \, d (\measure\circ\preimage{T}).
\]


\begin{propboldnote}[Change of Variable]\label{change_of_variable}\index{change of variable}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra, and let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space.  Also, let the function $T:\measurespace\to\measurespaceii$ be $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, and momentarily let 
$\measureii = \measure\circ\preimage{T}$.
If
$\ellclass{\function}{\measureii} 
\in L_1(\measurespaceii, \sigmaalgebraii, \measureii)$, 
then 
$\ellclass{\function\circ T}{\measure}
\in
L_1(\measurespace, \sigmaalgebra, \measure)$
and
\[
\int_\measurespace (f\circ T) \, d\measure
= \int_\measurespaceii f \, d\measureii.
\]
\end{propboldnote}


\begin{proof}
This proof relies upon the fact that 
$\charfunction{\setii}\circ T = \charfunction{\preimage{T}(\setii)}$. We will show that the displayed equality holds in case $f=\charfunction{\setii}$, where we let  the subset $\setii$ of $\measurespaceii$ be a 
$(\measure\circ\preimage{T})^\kernast$-measurable set with $(\measure\circ\preimage{T})^\kernast(\setii) < \infty$, and note that the outer measure $(\measure\circ\preimage{T})^\kernast(\setii)$ should be finite in order that $\charfunction{\setii}$ be integrable with respect to the induced measure  $\measure\circ\preimage{T}$.


By Proposition~\ref{preimage_of_a_measurable_set}, the set
$\preimage{T}(\setii)$ is $\measure^\kernast$-measurable with 
\[
\measure^*\bigl(\preimage{T}(\setii)\bigr)
=
(\measure\circ\preimage{T})^*(\setii),
\]
and so
\begin{align*}
\int_\measurespace \charfunction{\setii}\circ  T\, d\measure
& =
\int_\measurespace\charfunction{\preimage{T}(\setii)}\, d\measure 
&& \text{$\charfunction{\setii}\circ T = \charfunction{\preimage{T}(\setii)}$} \\
& =
\measure^*\bigl(\preimage{T}(\setii)\bigr) 
&& \text{by Definition~\ref{integral_step_function}} \\
& =
(\measure\circ\preimage{T})^*(\setii) 
&& \text{Proposition~\ref{preimage_of_a_measurable_set}}\\
& =
\int_\measurespaceii\charfunction{\setii}\, d(\measure\circ\preimage{T})
&& \text{by Definition~\ref{integral_step_function},} \\
\end{align*}
as claimed.
\end{proof}





\begin{prop}\label{integral_over_subalgebra}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a finite measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra, and  $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$. 
If
$\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}
\in L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$, 
then 
$\ellclass{f}{\measure}
\in L_1(\measurespace, \sigmaalgebra, \measure)$ and
\[
\int_\measurespace f \, d\measure\restrictedto{\sigmaalgebraii}
=
\int_\measurespace f \, d\measure.
\]
Consequently, the operator
\[
\L1embedding:
L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\to
L_1(\measurespace, \sigmaalgebra, \measure)
\]
defined by $\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}
\mapsto
\ellclass{f}{\measure}$
has norm 1. Furthermore, the operator $\L1embedding$ is injective.
\end{prop}






\begin{proof}
Let $\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}
\in L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$.
The idea is to apply a change of variable.
Define the function $i:\measurespace\to\measurespace:\mspaceelt\mapsto\mspaceelt$, where 
$\preimage{i}:\sigmaalgebraii\to\sigmaalgebra:B\mapsto B$.
The function 
$i$ is
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable because $\sigmaalgebraii$ is supposed to be a 
$\textsigma$-subalgebra of $\sigmaalgebra$.



We now show that $\int_\measurespace f\circ i \, d\measure
= \int_\measurespace f \, d(\measure\circ\preimage i)$
by applying Proposition~\ref{change_of_variable} to the measure space $(\measurespace, \sigmaalgebra, \measure)$ and the measurable space $(\measurespace, \sigmaalgebraii)$ and the function $i$. 
Since $i$ is
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, and
$\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}
\in L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
$,
it follows by Proposition~\ref{change_of_variable} that 
$\ellclass{f}{\measure}
\in L_1(\measurespace, \sigmaalgebra, \measure)$ and
\[
\int_\measurespace (f\circ i) \, d\measure
= \int_\measurespace f \, d(\measure\circ\preimage i).
\]



We next show that 
$\int_\measurespace f \, d(\measure\circ\preimage{i})
= \int_\measurespace f \, d \measure\restrictedto{\sigmaalgebraii}$ 
by applying Proposition~\ref{measurable_inclusion}.
The assumption that the measure space $(\measurespace, \sigmaalgebra, \measure)$ be finite is essential here.
The measure $\measure\circ\preimage i$ is equal to $\measure$ on $\sigmaalgebraii$; that is, if $B\in\sigmaalgebraii$, then $\measure\circ\preimage i(B) = \measure\bigl(\preimage{i}(B)\bigr) = \measure(B)$.  
This means that $\measure\circ\preimage i$ and $\measure$ generate the same outer measure on the \textsigma-algebra
$\measurable{\measuresubstar{\sigmaalgebraii}}$. That is, $(\measure\circ\preimage i)^\kernast = \measure^\kernast$
on $\measurable{\measuresubstar{\sigmaalgebraii}}$.
Because the measure space 
$(\measurespace, \sigmaalgebra, \measure)$ is finite, it follows by Proposition~\ref{measurable_inclusion} that 
$\measure^\kernast = \measuresubstar{\sigmaalgebraii}$ on $\measurable{\measuresubstar{\sigmaalgebraii}}$.
Since 
$(\measure\circ\preimage i)^\kernast = \measuresubstar{\sigmaalgebraii}$ on the \textsigma-algebra $\measurable{\measuresubstar{\sigmaalgebraii}}$,
it now follows by the definition of the integral that 
\[
\int_\measurespace f \, d(\measure\circ\preimage{i})
= \int_\measurespace f \, d \measure\restrictedto{\sigmaalgebraii}.
\]



We finally see that 
\[
\int_\measurespace f\, d\measure 
=
\int_\measurespace f\circ i \, d\measure,
\]
and this follows from the fact that $f = f\circ i$ on $\measurespace$.

Therefore, by transitivity of equality, 
\begin{equation}\label{preserves_the_integral}
\int_\measurespace f \, d \measure\restrictedto{\sigmaalgebraii}
=
\int_\measurespace f \, d\measure
\end{equation}
as required; in other words, the operator
$\L1embedding$ preserves the integral.

To see that $\norm{\L1embedding} =1$, witness:
\begin{align*}
\norm{\L1embedding} 
& = \sup \bigl\{ \Vert \L1embedding \ellclass{f}{\measure\restrictedto{\sigmaalgebraii}} \Vert : 
\Vert \ellclass{f}{\measure\restrictedto{\sigmaalgebraii}} \Vert =1 \bigr\}
\\
& = \sup \bigl\{ \Vert \ellclass{f}{\measure} \Vert  : 
\Vert \ellclass{f}{\measure\restrictedto{\sigmaalgebraii}} \Vert =1\bigr\} 
\\
& = \sup \{\textstyle \int \abs{f}\, d\measure : 
\textstyle\int \abs{f} \, d\measure\restrictedto{\sigmaalgebraii} = 1\bigr\}.
\end{align*}
And we have just barely shown in equation (\ref{preserves_the_integral}) that  
the operator
$\L1embedding$ preserves the integral, so
$\int \abs{f}\, d\measure = \int \abs{f} \, d\measure\restrictedto{\sigmaalgebraii}$
for all $f$ in $\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$. 
Since an algebra is nonempty, there is at least one 
$f$ in $\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$ 
such that 
$\int \abs{f} \, d\measure\restrictedto{\sigmaalgebraii} = 1$, it follows that $\norm{\L1embedding} =1$.




To show that $\L1embedding$ is injective, it is sufficient to show that the kernel
$\preimage{\L1embedding}\bigl( \ellclass{0}{\measure} \bigr)$
of 
$\L1embedding$ is trivial, which means showing that
$\preimage{\L1embedding}\bigl( \ellclass{0}{\measure} \bigr)
=
\{ \ellclass{0}{\measure\restrictedto{\sigmaalgebraii}} \} $
in $L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$.  



To show the inclusion
$\{ \ellclass{0}{\measure\restrictedto{\sigmaalgebraii}} \} \subseteq \preimage{\L1embedding}\bigl( \ellclass{0}{\measure} \bigr)$ means showing that 
$\L1embedding(\ellclass{0}{\measure\restrictedto{\sigmaalgebraii}}) =\ellclass{0}{\measure}$. But this holds by the very  definition of $\L1embedding$.



To show the inclusion
$\preimage{\L1embedding}\bigl( \ellclass{0}{\measure} \bigr)
\subseteq
\{ \ellclass{0}{\measure\restrictedto{\sigmaalgebraii}} \} $, let 
$\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}$ be any element of 
$\preimage{\L1embedding}\bigl( \ellclass{0}{\measure} \bigr)$, and we want to see that this implies $\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}} =\ellclass{0}{\measure\restrictedto{\sigmaalgebraii}}$.
To assume that $\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}$ is in 
$\preimage{\L1embedding}\bigl( \ellclass{0}{\measure} \bigr)$
means to assume that $\L1embedding \ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}=\ellclass{0}{\measure}$, or equivalently that $\ellclass{f}{\measure} = \ellclass{0}{\measure}$. 
In turn, this means to assume that $f\in\cali{N}_1(\measurespace,\sigmaalgebra,\measure)$, so that 
$\int \abs{f}\,d\measure=0$. We have just shown
in equation (\ref{preserves_the_integral}) that  
the operator
$\L1embedding$ preserves the integral, so 
$\int \abs{f}\,d\measure=0$ implies that
$\int\abs{f}\,d\measure\restrictedto{\sigmaalgebraii} =0$.
This says $f\in\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$, which also says 
$\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}} =\ellclass{0}{\measure\restrictedto{\sigmaalgebraii}}$, as required.
\end{proof}


\begin{example}\label{unequal_kernel}
Let us show by way of example that 
$\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
need not equal 
$\cali{N}_1(\measurespace, \sigmaalgebra, \measure)$.
Let 
$\sigmaalgebra = 
\{ 
\mtset,
\seti,
\seti\comp,
\measurespace
\}$
with Dirac measure $\diracmeasure{\mspaceelt}$ concentrated at a point $\mspaceelt\in\seti$, with $\seti$ non-empty, and with $\seti$ not equal to $\measurespace$. 
Let
$\sigmaalgebraii = 
\{ 
\mtset,
\measurespace
\}$.  Verify that 
$\diracmeasure{\mspaceelt}^*(\seti)=\diracmeasure{\mspaceelt}(\seti)=1$, and
$\diracmeasure{\mspaceelt}^*(\seti\comp)=\diracmeasure{\mspaceelt}(\seti\comp)=0$.
Then $\charfunction{\seti\comp} = 0$ $\diracmeasure{\mspaceelt}^*$-almost everywhere. 
That is, the set of points in $\measurespace$ where $\charfunction{\seti\comp}$ is not equal to zero, namely the set 
$\seti\comp$, is a set of $\diracmeasure{\mspaceelt}^*$-measure zero.
Since $\charfunction{\seti\comp}$ is $(\sigmaalgebra,\borel_\R)$\hyp{}measurable, 
and
$\charfunction{\seti\comp} = 0$ $\diracmeasure{\mspaceelt}^*$-almost everywhere,
it follows that
$\charfunction{\seti\comp}\in
\cali{N}_1(\measurespace, \sigmaalgebra,\diracmeasure{\mspaceelt})$.
But $\preimage{{\charfunction{\seti\comp}}}{(\{1\})} =\seti\comp$, 
and the set $\seti\comp$ is not in $\sigmaalgebraii$, 
so the function 
$\charfunction{\seti\comp}$ is not  $(\sigmaalgebraii,\borel_\R)$\hyp{}measurable. Then 
$\charfunction{\seti\comp}$
is not in 
$\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
since every function in 
$\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
is required, by definition, to be 
$(\sigmaalgebraii,\borel_\R)$\hyp{}measurable.
Conclude that the set
$\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
need not equal the set
$\cali{N}_1(\measurespace, \sigmaalgebra, \measure)$.
\end{example}





\begin{discussion}\label{L1_subspace_embedding}
What does Proposition~\ref{integral_over_subalgebra} not say?
It does not say that the quotient space $L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
is a subspace of the quotient space 
$L_1(\measurespace, \sigmaalgebra, \measure)$.  This is because the quotient space $L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
is not in general a subspace of the quotient space 
$L_1(\measurespace, \sigmaalgebra, \measure)$, 
and this is because the kernel
$\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
need not equal the kernel
$\cali{N}_1(\measurespace, \sigmaalgebra, \measure)$,
as pointed out in 
Example~\ref{unequal_kernel};
all possible subspaces of quotient spaces are characterized by the correspondence 
in Proposition~\ref{correspondence_theorem}.

Still, the \emph{function} space
$\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$
\emph{is} a subspace of the function space
$\cali{L}_1(\measurespace, \sigmaalgebra, \measure)$,
and the inclusion 
$\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\subseteq
\cali{L}_1(\measurespace, \sigmaalgebra, \measure)$
does preserve the semi-norm, so there is an inclusion of subspaces: 
$\cali{N}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\subseteq
\cali{N}_1(\measurespace, \sigmaalgebra, \measure)$. This implies that
there is a unique map making the following diagram commute:
\[
\xymatrix@R=16pt@C=38pt{ 
L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\ar@{.>}[r]
&
L_1(\measurespace, \sigmaalgebra, \measure)
\\
\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii}) \ar[r]^-{\text{inclusion}} 
\ar@{->>}[u]^{\text{quotient}}
&
\cali{L}_1(\measurespace, \sigmaalgebra, \measure)
\ar@{->>}[u]_{\text{quotient}}
}
\]
\end{discussion}






\label{subset_vs_subspace}
\begin{quoting}
\small
The distinction between a subset and subspace could be a little less blurred.  Rather than the notation 
\[
\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\subseteq
\cali{L}_1(\measurespace, \sigmaalgebra, \measure)
\]
something better might be
\[
\cali{L}_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\leq
\cali{L}_1(\measurespace, \sigmaalgebra, \measure)
\]
suggesting some kind of structure-preserving thing.
\end{quoting}




\begin{rmk}
The extension of the following proposition to modules or vector spaces underlies some of the mechanics of the map
$L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})
\to
L_1(\measurespace, \sigmaalgebra, \measure)$.
\end{rmk}


\begin{prop}\label{induced_quotient_homomorphism}
Whenever $A$ and $B$ are groups with $C\normalin A$ and $D\normalin B$, and $\phi$ is a homomorphism ${A\to B}$ such that its restriction $\phi\vert_C$ is a homomorphism $C\to D$, there is a unique induced homomorphism ${\widehat \phi :A/C\to B/D}$ mapping the coset $a+C$ to the coset $\phi(a)+D$. 
\[
\xymatrix@R=-2pt@C=12pt{
\ A\  \ar[r]^{\phi} & \ B\  & & \ A/C\ \ar[r]^{\widehat \phi} & \ B/D\ \\
\normalup & \normalup & \Longrightarrow & \elementup & \elementup \\
\ C\ \ar[r]^{\phi\vert_C} & \ D\  & & \ a+C\ \ar@{|->}[r] & \ \phi(a)+D\ }
\]
The induced homomorphism $\widehat \phi$ is an isomorphism exactly when both  $(\range \phi) \vee D = B$ and $\preimage{\phi}(D)\leq C$. 
\end{prop}

\begin{rmk}
You may be wondering if there is a more direct way of proving Proposition~\ref{integral_over_subalgebra}, possibly one which more directly uses the mechanics of Proposition~\ref{induced_quotient_homomorphism}, but which avoids the change of variable.  
Propositions~\ref{change_of_variable} and \ref{integral_over_subalgebra} are really just elaborations of Propositions~\ref{preimage_of_a_measurable_set} and \ref{measurable_inclusion}, and it will be interesting to see how you would avoid these latter two.
\end{rmk}








\begin{rmk}
The following proposition is a partial converse to Proposition~\ref{integral_over_subalgebra}.
\end{rmk}


\begin{prop}\label{algebra_to_subalgebra}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a finite measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$. 
If $\ellclass{f}{\measure} 
\in L_1(\measurespace, \sigmaalgebra, \measure)$, and if the function $f$ is $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable, then
$\ellclass{f}{\measure\restrictedto{\sigmaalgebraii}}
\in L_1(\measurespace, \sigmaalgebraii, \measure\restrictedto{\sigmaalgebraii})$.
\end{prop}


\begin{proof}
Let $f\in\cali{L}_1(\measurespace, \sigmaalgebra, \measure)$, and let $f$ be 
$(\sigmaalgebraii, \borel_\R)$\hyp{}measurable. We can suppose that $f\geq 0$.  By Proposition~\ref{measurable_implies_simple_function_limit}, there is a sequence $\{\phi_n\}$ of $(\sigmaalgebraii, \borel_\R)$-simple functions such that 
$\phi_n(x)\geq 0$ and $\phi_n(x)\uparrow f(x)$ for all $x\in\measurespace$.
In a finite measure space, every $(\sigmaalgebraii, \borel_\R)$-simple function is a $(\sigmaalgebraii, \borel_\R)$-step function.
But every $(\sigmaalgebraii, \borel_\R)$-step function is a 
$(\measurable{\measuresubstar{\sigmaalgebraii}},\borel_\R)$-step function since, 
by Proposition~\ref{semiring_measurable}, every element of $\sigmaalgebraii$ is a $\measuresubstar{\sigmaalgebraii}$-measurable subset. 
This says $\{\phi_n\}$ is a sequence of $(\measurable{\measuresubstar{\sigmaalgebraii}},\borel_\R)$-step functions with $\phi_n\uparrow f$ for all $x\in\measurespace$. In order to complete the proof that $f$ is integrable with respect to $\measure\restrictedto{\sigmaalgebraii}$, it is sufficient to show that 
$\lim \int_\measurespace \phi_n \, d \measure\restrictedto{\sigmaalgebraii} < \infty$.

By Proposition ~\ref{integral_over_subalgebra}, it follows that
\[
\int_\measurespace \phi_n \, d\measure
= \int_\measurespace \phi_n \, d\measure\restrictedto{\sigmaalgebraii}
\]
for each $n$.
And each $(\measurable{\measuresubstar{\sigmaalgebraii}},\borel_\R)$-step function is also a $(\measurable{\measure^*},\borel_\R)$-step function, so the sequence
$\{\phi_n\}$ is comprised of $(\measurable{\measure^*},\borel_\R)$-step functions with $\phi_n\uparrow f$ for all $x\in\measurespace$.
Since $f$ is a $(\measurable{\measure^\kernast}, \borel_\R)$-upper function, 
it follows that $\int f\,d\measure<\infty$, and it follows by the uniqueness of the integral that 
$\int_\measurespace f \, d\measure
=
\lim\int_\measurespace \phi_n \, d\measure$.
Then since 
$\int_\measurespace \phi_n \, d\measure
= 
\int_\measurespace \phi_n \, d\measure\restrictedto{\sigmaalgebraii}$,
it follows that 
$\lim\int_\measurespace \phi_n \, d\measure
= 
\lim\int_\measurespace \phi_n \, d\measure\restrictedto{\sigmaalgebraii}<\infty$, completing the proof.
\end{proof}




\begin{rmk}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra, and let $\ellclass{f}{\measure}\in L_1(\measurespace, \sigmaalgebra, \measure)$.  The representative function $f$ is necessarily \mbmeasurable. By Proposition~\ref{semiring_measurable}, we know that $\sigmaalgebra$ is a \textsigma-subalgebra of $\measurable{\measure^\kernast}$, implying that any  
$(\sigmaalgebra, \borel_\R)$\hyp{}measurable is also a  \mbmeasurable\ function.  The converse need not hold.  That is, the function $f$ need \emph{not} also be $(\sigmaalgebra, \borel_\R)$\hyp{}measurable. Regardless, each class in 
$L_1(\measurespace, \sigmaalgebra, \measure)$ \emph{does} have an
$(\sigmaalgebra, \borel_\R)$\hyp{}measurable representative, as claimed in the following proposition, which is just a restatement of Proposition~\ref{mixing_measurable_functions} in terms of the quotient space $L_1(\measurespace, \sigmaalgebra, \measure)$. 
\end{rmk}



\begin{prop}\label{a_measurable_representative}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a \textsigma-finite measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra. 
If $\ellclass{f}{\measure}\in L_1(\measurespace, \sigmaalgebra, \measure)$, then there is an 
$(\sigmaalgebra, \borel_\R)$\hyp{}measurable function 
$g\in \cali{L}_1(\measurespace, \sigmaalgebra, \measure)$ such that 
$\ellclass{g}{\measure} = \ellclass{f}{\measure}$. 
That is, each class of $L_1(\measurespace, \sigmaalgebra, \measure)$ has an 
$(\sigmaalgebra, \borel_\R)$\hyp{}measurable representative.  
\end{prop}


\begin{defn}\label{absolutely_continuous}
Let $\measureii$ and $\measure$ be signed measures on a \textsigma-algebra $\sigmaalgebra$.
The signed measure $\measureii$ is \term{absolutely continuous} with respect to $\measure$ on $\sigmaalgebra$ if 
$\abs{\measure}(\seti) = 0$ 
implies
$\measureii(\seti) = 0$ whenever $\seti\in\sigmaalgebra$. Denote this by 
$\measureii\abscont\measure$.
\end{defn}


\begin{prop}\label{abscont_properties}
Let $(\measurespace,\sigmaalgebra)$ be a measurable space, and let 
$\measure$ and $\measureii$ be measures on $\sigmaalgebra$ with 
$\measureii\abscont\measure$.
\begin{enumerate}
\item
If $\seti \subseteq \measurespace$ and 
$\measure^*(\seti) = 0$, then $\measureii^*(\seti) = 0$.
\item If $\measure$ is \textsigma-finite, then 
$\measurable{\measure^\kernast} \subseteq
\measurable{\measureii^\kernast}$.
\end{enumerate}
\end{prop}



\begin{defn}\label{indefinite_integral}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a measure space, where $\sigmaalgebra$ is a $\textsigma$-algebra.
For every class $\ellclass{f}{\measure}\in L_1(\measurespace, \sigmaalgebra, \measure)$ there is a finite signed measure $\measureii:\sigmaalgebra \to \R$ 
on the measurable space $(\measurespace, \sigmaalgebra)$ defined by
\[
\measureii(A) = \int_A f\, d\measure
\quad\text{for all $A\in\sigmaalgebra$}.
\]
This finite signed measure $\measureii$ is absolutely continuous with respect to $\measure$ on $\sigmaalgebra$.
Call $\measureii$ the \term{indefinite integral} of $\ellclass{f}{\measure}$. 
The idea that an integrable function defines a measure that is absolutely continuous with respect to some measure has the following form of converse.
\end{defn}



\begin{thmboldnote}[Radon-Nikodym]\label{radon-nikodym}
Let $(\measurespace,\sigmaalgebra)$ be a measurable space.
If $\measureii$ is a finite signed measure on $\sigmaalgebra$ that is absolutely continuous with respect to a \textsigma-finite measure 
$\measure$  on 
$\sigmaalgebra$,
then there exists a unique class $\ellclass{f}{\measure}$ in $L_1(\measurespace, \sigmaalgebra, \measure)$ such that
\[
\measureii(A) = \int_A f\,d\measure
\quad\text{for all $A\in \sigmaalgebra$.}
\]
Furthermore, we may suppose the representative function $f$ is
$(\sigmaalgebra, \borel_\R)$\hyp{}measurable.
\end{thmboldnote}




\begin{defn}\label{density_function}
The unique class 
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra, \measure)$
in the previous theorem is called the \term{Radon-Nikodym derivative} of $\measureii$ with respect to 
$\measure$,
and may be denoted 
$\ellclass{{d\measureii/d\measure}}{\measure}$.
The $(\sigmaalgebra, \borel_\R)$\hyp{}measurable representative function $\function$
may be denoted
$d\measureii/d\measure$, and will be referred to as the \term{density function} of $\measureii$ with respect to 
$\measure$ whenever having to say 
``a Radon-Nikodym derivative representative'' 
becomes tiresome, which happens fairly quickly.

Sometimes, as in the case of Proposition~\ref{radon_nikodym_corollary}, the notation
$d\measureii= f\, d\measure$ even makes sense.
\end{defn}


\begin{prop}\label{radon_nikodym_corollary}
Let $(\measurespace,\sigmaalgebra)$ be a measurable space, and let 
$\measureii$ be a finite measure on $\sigmaalgebra$ and $\measure$ be  \textsigma-finite measure on $\sigmaalgebra$ 
with $\measureii\abscont\measure$.
Also let 
$\ellclass{\function}{\measure}
= \ellclass{d\measureii/d\measure}{\measure}
\in
L_1(\measurespace,\sigmaalgebra,\measure)$.
\begin{enumerate}
\item
Let
$\seti = \{ \mspaceelt\in\measurespace : 
\function(\mspaceelt) > 0 \}$. If
$\setii \in \measurable{\measureii^\kernast}$, then 
$\seti\meets\setii \in \measurable{\measure^\kernast}$.
\item
If the class
$\ellclass{\functionii}{\measureii}
\in
L_1(\measurespace,\sigmaalgebra,\measureii)$,
then the class
$\ellclass{\functionii\function}{\measure}
\in
L_1(\measurespace,\sigmaalgebra,\measure)$,
and 
\[
\int_\measurespace\functionii \, d\measureii
=
\int_\measurespace \functionii\function \,  d\measure,
\]
in which case
``$d\measureii =\function \,  d\measure$.''
\end{enumerate}
\end{prop}


Let us combine a change of variable with the previous proposition.

\begin{prop}\label{combine}
Let $(\measurespace, \sigmaalgebra)$ and $(\measurespaceii,\sigmaalgebraii)$ be measurable spaces, and let $\measmu$ be a finite measure on $\sigmaalgebra$.
Also, let
$\funcf:\measurespace\to\measurespaceii$ be
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable,
and let $\funcg:\measurespaceii\to\R$ be integrable with respect to
$\measmu\circ\preimage{\funcf}$.
If $\measlambda$ is a \textsigma\hyp{}finite measure on $\sigmaalgebraii$ such that
$\measmu\circ\preimage{\funcf} \abscont \measlambda$, then, setting
$p = d(\measmu\circ\preimage{\funcf}) / d\measlambda$,
\[
\int_\measurespace (\funcg\circ\funcf)\, d\measmu
=
\int_\measurespaceii \funcg \cdot p \, d\measlambda.
\]
\end{prop}


\begin{prop}\label{chain_rule}
Let $(\measurespace,\sigmaalgebra)$ be a measurable space, and let 
$\measureii$ and $\measure$ be finite measures on $\sigmaalgebra$, and 
let $\measureiii$ be a \textsigma-finite measure on $\sigmaalgebra$.
If
$\measureii\abscont\measure$ and $\measure\abscont\measureiii$,
then $\measureii\abscont\measureiii$ and
\[
\frac{d\measureii}{d\measureiii}
=
\frac{d\measureii}{d\measure}
\frac{d\measure}{d\measureiii}.
\]
\end{prop}



\begin{defn}\label{induced_sigmaalgebra}
Let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space, and let $f:\measurespace\to\measurespaceii$ be a function, where $\preimage{f}:\sigmaalgebraii \to\powerset(\measurespace)$. Then 
$\preimage{f}(\sigmaalgebraii) := \{\preimage{f} (B) : B \in\sigmaalgebraii\}$ is a 
$\textsigma$-subalgebra of the power set $\powerset(\measurespace )$; it's  the
\emph{$\textsigma$-algebra induced by $f$}.
\index{sigma algebra induced by a function@$\textsigma$-algebra induced by a function}
 The notation $\textsigma(f)$ is also used.
\end{defn}


The function $f: \measurespace\to\measurespaceii$ is always
$\bigl(\preimage{f}(\sigmaalgebraii), \sigmaalgebraii\bigr)$\hyp{}measurable by the very definition of what it means for a function to be measurable.
Should a $\textsigma$-subalgebra $\sigmaalgebra$ of $\powerset(\measurespace)$ be specified, so that $(\measurespace, \sigmaalgebra)$ is a measurable space, and should $f:\measurespace\to\measurespaceii$ be 
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, then $\preimage{f}(\sigmaalgebraii)$ is a \textsigma-subalgebra of $\sigmaalgebra$. 
To indicate that $f:\measurespace\to\measurespaceii$ is 
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, we might use the notation $f:(\measurespace,\sigmaalgebra)\to(\measurespaceii,\sigmaalgebraii)$.



\begin{notn}
When it comes to commutative diagrams, you have to decide what it means to commute.  In the following, there will be diagrams that commute up to sets of measure zero.  For example, in the following diagram
\[
\xymatrix@R=16pt{ 
\bigl( \measurespace, \sigmaalgebra \bigr) \ar[r]^-{g} 
\ar[dr]_{f}
&
(\R,\borel_\R)  
\\
&
(\measurespaceii, \sigmaalgebraii) \ar[u]_{h}
\\
}
\]
if $f$ and $h$ are functions, and if $g$ is a representative of an 
$\Lone$ class, then what does it mean to say that the diagram commutes? If we mean that it commutes up to subsets of $\sigmaalgebra$ having $\Pstar$-measure zero, or equivalently that 
$\ellclass{g}{\measure}=\ellclass{h\circ f}{\measure}$, then we will qualify the diagram, saying just that:
\[
\begin{gathered}
\xymatrix@R=16pt{ 
\bigl( \measurespace, \sigmaalgebra \bigr) \ar[r]^-{g} 
\ar[dr]_{f}
&
(\R,\borel_\R)  
\\
&
(\measurespaceii, \sigmaalgebraii) \ar[u]_{h}
\\
}
\end{gathered}
\quad
\text{meaning}
\quad
\ellclass{g}{\measure}=\ellclass{h\circ f}{\measure}.
\]
\end{notn}


\begin{rmk}
Although the following proposition looks like the Doob-Dynkin lemma, it is not simply about measurability. It's also about a form of converse to Proposition \ref{change_of_variable}.

The double-headed surjective arrow \lq$\twoheadrightarrow$\rq\ indicates that a function is surjective.
\index{Doob-Dynkin lemma}
\end{rmk}



\begin{prop}\label{factoring_functions}
Let $(\measurespace, \sigmaalgebra, \measure)$  be a finite measure space, where $\sigmaalgebra$ is a \textsigma-algebra, and let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space.
Also let $f:\measurespace\to\measurespaceii$ be an $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable function such that 
$\preimage{f}:\sigmaalgebraii \twoheadrightarrow\sigmaalgebra$ is surjective.
Let
$\ellclass{g}{\measure}
\in L_1(\measurespace, \sigmaalgebra, \measure)$,
then there is a unique class
$\ellclass{h}{\measure}
\in L_1 (\measurespaceii, \sigmaalgebraii, \measure\circ\preimage{f})$
with 
$\ellclass{g}{\measure} 
= 
\ellclass{h\circ f}{\measure}$
and with $h$ being a $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable function:
\[
\begin{gathered}
\xymatrix@R=16pt{ 
\bigl( \measurespace, \sigmaalgebra \bigr) \ar[r]^-{g} 
\ar[dr]_{f}
&
(\R,\borel_\R)  
\\
&
(\measurespaceii, \sigmaalgebraii) \ar@{.>}[u]_{h}
\\
}
\end{gathered}
\quad
\text{meaning}
\quad
\ellclass{g}{\measure}=\ellclass{h\circ f}{\measure}
\]
\end{prop}



\begin{proof}
The idea is to use the Radon-Nikodym Theorem to get the class 
$\ellclass{h}{\measure\circ\preimage{f}}\in L_1 (\measurespaceii, \sigmaalgebraii, \measure\circ\preimage{f})$ with 
$\ellclass{g}{\measure}  
= 
\ellclass{h\circ f}{\measure}$.

Let $\phi$ denote the indefinite integral of $g$ with respect to 
$\measure$. That is,
\[
\phi(A)=\int_A g\,d\measure
\quad\text{ for all $A \in \sigmaalgebra$.}
\]
The set function 
$\phi\, \circ \preimage{f}:\sigmaalgebraii \to [0,\infty]$
defines a finite measure that is $\textsigma$-additive and absolutely continuous with respect to the finite (and therefore $\textsigma$-finite) measure
$\measure\circ\preimage{f}$
on $(\measurespaceii, \sigmaalgebraii)$.
By the Radon-Nikodym theorem~(\ref{radon-nikodym}), there is a unique class
$\ellclass{h}{\measure\circ\preimage{f}}\in L_1(\measurespaceii, \sigmaalgebraii, \measure\circ\preimage{f})$
such that
\[
(\phi\circ\preimage{f}) (B)
=
\int_B h \, d(\measure\circ\preimage{f})
\quad\text{ for all $B\in\sigmaalgebraii$,}
\]
and with $h$ a $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable function.
On the one hand, by definition,
\[
\bigl(\phi\circ\preimage{f} (B)\bigr)
=
\phi\bigl(\preimage{f}(B)\bigr) 
= 
\int_{\preimage{f}(B)} g\, d\measure .
\]
On the other hand, by Proposition~\ref{change_of_variable},
\[
\int_B h \, d(\measure\circ\preimage{f})
=
\int_{\preimage{f}(B)} h\circ f \, d\measure .
\]
By transitivity of equality, it follows that
\[
\int_{\preimage{f}(B)} g\, d\measure
=
\int_{\preimage{f}(B)} h\circ f \, d\measure
\quad\text{ for all $B\in\sigmaalgebraii$.}
\]
The assumption that $\preimage{f}$ is surjective means that
$\preimage{f}(\sigmaalgebraii)=\sigmaalgebra$, and so
\[
\int_{A} g\, d\measure
=
\int_{A} h\circ f \, d\measure
\quad\text{ for all $A\in\sigmaalgebra$.}
\]
By Proposition~\ref{equal_function_test}, this implies that
$\ellclass{g}{\measure}  
= 
\ellclass{h\circ f}{\measure}$,
completing the proof.
\end{proof}


For comparison with Proposition~\ref{factoring_functions}, let us look at the so-called Doob-Dynkin lemma.

\begin{propboldnote}[Doob-Dynkin]\index{Doob-Dynkin lemma}\label{doob_dynkin}
Let the space $(\measurespaceii,\sigmaalgebraii)$ be measurable,
and let 
$\functionii:\measurespace\to\R$,
and
$\function:\measurespace\to\measurespaceii$.
The function $\functionii$ is
$(\preimage{\function}(\sigmaalgebraii),\borel_\R)$\hyp{}measurable if and only if there is a 
$(\sigmaalgebraii,\borel_\R)$\hyp{}measurable function
$\functioniii:\measurespaceii\to\R$ such that 
$\functionii=\functioniii\circ\function$:
\end{propboldnote}
\[
\xymatrix@R=16pt{
\bigl(\measurespace,\preimage{\function}(\sigmaalgebraii)\bigr) 
\ar[r]^\functionii
\ar[dr]_\function
& (\R,\borel_\R) \\
 & (\measurespaceii,\sigmaalgebraii) \ar@{.>}[u]_{\functioniii}\\
}
\]





\chapter{Product Measures and Product Integration}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\lettrine{T}{\,hroughout} this section, let 
$(\measurespace, \semiring, \measure)$
and
$(\measurespaceii, \semiringii, \measureii)$
be measure spaces, so $\semiring$ and $\semiringii$ are at least semirings.
The powerset of any set $\seti$ is still denoted $\powerset(\seti)$.
And
$\measurable{\measure^\kernast}$ still denotes the \textsigma\hyp{}algebra of 
$\measure^\kernast$\hyp{}measurable subsets of $\measurespace$.
As stated in Definition~\ref{outer_measure_generated}, we may let 
$\measure^*$ also denote a restriction $\measmu^\kernast\restrictedto{}$\,.


\section{Product Measures}
%*********************************************************
%*********************************************************
\begin{defn}\label{product_semiring}
If $\semiring$ and $\semiringii$ are semirings of subsets of respective sets $\measurespace$ and $\measurespaceii$, then the collection of Cartesian products 
\[
\{ \seti\times\setii \subseteq \measurespace\times\measurespaceii: 
\seti \in\semiring, \setii \in\semiringii \}
\]
forms a semiring of subsets of $\measurespace\times\measurespaceii$, generated in the first component by $\semiring$ and in the second component by $\semiringii$, and will consequently be denoted 
$\productsemiring{\semiring}{\semiringii}$.
\nomenclature[semiring of cartesian products]{$\productsemiring{\semiring}{\semiringii}$}{semiring of Cartesian products $\seti\times\setii$ with $\seti\in\semiring$ and $\setii\in\semiringii$}
It may be called the \term{product semiring} of $\semiring$ and $\semiringii$,
however, verify that the semiring
$\productsemiring{\semiring}{\semiringii}$ is a subset of 
$\powerset(\measurespace\times\measurespaceii)$, and it is not the same as the Cartesian product 
$\semiring\times\semiringii$, which is a subset of 
$\powerset(\measurespace)\times\powerset(\measurespaceii)$. Semirings are non-empty; they have at least one element.

The idea of a product semiring generalizes in a clear way to the product of more than two factors if we make an identification.  The Cartesian product is not associative, so we treat
$(\seti\times\setii)\times \setiii$
and
$\seti\times(\setii\times\setiii)$ as equivalent, and may (co)universally write 
$\seti\times\setii\times\setiii$. It means that if $\sigalg{U}$ were a semiring of subsets of a set $Z$, then expressions like $\productsemiring{\semiring}{\semiringii , \semiringiii}$, under the identification, are well-defined.
\end{defn}
 

 

 
 
 
 


 
 

 
 
 
\begin{prop}\label{product_measure}
The set function $\measure\times\measureii$ defined by
\[
\measure\times\measureii : 
\productsemiring{\semiring}{\semiringii} \to [0, \infty] :
\seti\times\setii \mapsto \measure(\seti)\cdot\measureii(\setii)
\]
is a measure, if the symbols $0\cdot\infty = 0$ make sense.
\end{prop}


\begin{prop}\label{product_measure_space}
If $(\measurespace, \semiring, \measure)$
and
$(\measurespaceii, \semiringii, \measureii)$
are measure spaces, then 
$\bigl(\measurespace\times\measurespaceii, 
\productsemiring{\semiring}{\semiringii}, 
\measure\times\measureii\bigr)$
is also a measure space.
And if
$(\measurespace, \semiring, \measure)$
and
$(\measurespaceii, \semiringii, \measureii)$ 
are \textsigma\hyp{}finite, then 
$\bigl(\measurespace\times\measurespaceii, 
\productsemiring{\semiring}{\semiringii}, 
\measure\times\measureii\bigr)$ is also \textsigma\hyp{}finite.
\end{prop}


\begin{rmk}
By Proposition~\ref{restricted_outer_measure}, the triples
\[
(\measurespace, \measurable{\measure^\kernast}, 
\measure^*)
\ \text{ and }\
(\measurespaceii, \measurable{\measureii^\kernast}, 
\measureii^*)
\]
are measure spaces. 
By Proposition~\ref{product_measure_space}, the triple
\[
\bigl(\measurespace\times\measurespaceii, 
\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}, 
\measure^*
\times
\measureii^*\bigr)
\]
is also measure space. 
\end{rmk}



\begin{prop}\label{outer_product_measure}
If $\seti\in\measurable{\measure^\kernast}$ and 
$\setii\in\measurable{\measureii^\kernast}$ with  
$\measure^*(\seti)<\infty$ and
$\measureii^*(\setii)<\infty$, then
\begin{align*}
(\measure\times\measureii)^*(\seti\times\setii)
&=
\bigl(
\measure^*
\times
\measureii^*
\bigr)
(\seti\times\setii)\\
&=
\measure^*(\seti)
\cdot
\measureii^*(\setii).
\end{align*}
\end{prop}


\begin{prop}\label{semiring_inclusion}
If
$\seti\in\measurable{\measure^\kernast}$ and 
$\setii\in\measurable{\measureii^\kernast}$, then
$\seti\times\setii \in \measurable{(\measure\times\measureii)^\kernast}$.  
That is,
$\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}
\subseteq
\measurable{(\measure\times\measureii)^\kernast}$.
\end{prop}


\begin{prop}\label{agreeable_product_measures}
If the measure spaces
$(\measurespace, \semiring, \measure)$
and
$(\measurespaceii, \semiringii, \measureii)$ 
are both \textsigma\hyp{}finite, then the measure
$\measure^*\times\measureii^*$ agrees with
$(\measure\times\measureii)^*$ on the semiring
$\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}$.
\end{prop}

\begin{proof}
We will apply Proposition~\ref{extension_measure}.

The measure space  
$\bigl(\measurespace\times\measurespaceii, 
\productsemiring{\semiring}{\semiringii}, 
\measure\times\measureii\bigr)$ is \textsigma\hyp{}finite by Proposition~\ref{product_measure_space}.
Since
$\semiring\subseteq \measurable{\measure^\kernast}$
and
$\semiringii\subseteq \measurable{\measureii^\kernast}$, it follows that
\[
\productsemiring{\semiring}{\semiringii}
\subseteq
\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}},
\]
and by Proposition~\ref{semiring_inclusion}, it follows that
\[
\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}
\subseteq
\measurable{(\measure\times\measureii)^\kernast}.
\]
By Proposition~\ref{product_measure_space}, the set function 
$\measure^*\times\measureii^*$
is a measure on the semiring
$\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}$.
Further, the measure 
$\measure^*\times\measureii^*$
agrees with the measure
$\measure\times\measureii$ on the semiring
$\productsemiring{\semiring}{\semiringii}$ for if 
$\seti\in\semiring$ and $\setii\in\semiringii$, then 
\begin{align*}
(\measure^*\times\measureii^*)(\seti\times\setii)
& = \measure^*(\seti)\cdot\measureii^*(\setii)
&\text{Proposition~\ref{product_measure}} 
\\
& = \measure(\seti)\cdot\measureii(\setii)
&\text{Proposition~\ref{extension_from_semiring}}
\\
& =(\measure\times\measureii)(\seti\times\setii)
&\text{Proposition~\ref{product_measure} again}
\\
\end{align*}
Since  
$\measure^*\times\measureii^*
=
\measure\times\measureii$ on 
$\productsemiring{\semiring}{\semiringii}$, 
it follows by Proposition~\ref{extension_measure} that 
$\measure^*\times\measureii^*
=
(\measure\times\measureii)^*$ on
$\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}$,
completing the proof. 
\end{proof}

\begin{defn}\label{product_sigmaalgebra}
Let $\semiring$ and $\semiringii$ be semirings of subsets of respective sets
$\measurespace$ and $\measurespaceii$. The \textsigma-algebra generated by
$\productsemiring{\semiring}{\semiringii}$
may be called the \textbf{product \textsigma-algebra}
\index{product sigma-algebra@product \textsigma-algebra} of $\semiring$ and $\semiringii$,
and will be denoted
$\productsig{\semiring}{\semiringii}$.
\nomenclature[product sigma-algebra]{$\productsig{\semiring}{\semiringii}$}{product \textsigma-algebra generated by $\productsemiring{\semiring}{\semiringii}$}
It is the smallest \textsigma-algebra of
$\powerset(\measurespace\times\measurespaceii)$
which contains the product semiring $\productsemiring{\semiring}{\semiringii}$.
The notation $\semiring\otimes\semiringii$ might also be used,  but not here.
The notation $\semiring\vee\semiringii$ is compelling.
\end{defn}

\begin{rmk}
A consequence of the identification of
$\seti\times\setii\times\setiii$
with
$(\seti\times\setii)\times\setiii$
and
$\seti\times(\setii\times\setiii)$
is that
\[
\productsig{\sigmaalgebra}{\sigmaalgebraii,\sigmaalgebraiii}
=
\productsig{\productsig{\sigmaalgebra}{\sigmaalgebraii}}{\sigmaalgebraiii}
=
\productsig{\sigmaalgebra}{\productsig{\sigmaalgebraii}{\sigmaalgebraiii}}.
\]
\end{rmk}


\begin{notn}\label{extension_to_sigmaalgebra}
Let us apply Proposition~\ref{extension_measure} to the inclusion
\[
\productsemiring{\semiring}{\semiringii}
\subseteq
\productsig{\semiring}{\semiringii}
\subseteq
\measurable{(\measure\times\measureii)^\kernast}.
\]
The proposition says that if a measure on
$\productsig{\semiring}{\semiringii}$
agrees with $\measmu\times\measnu$ on
$\productsemiring{\semiring}{\semiringii}$, then that measure agrees with
$(\measmu\times\measnu)^*$ on
$\productsig{\semiring}{\semiringii}$.
We will let $(\measmu\times\measnu)^*$ denote both the measure
$(\measmu\times\measnu)^*$ on $\measurable{(\measure\times\measureii)^\kernast}$
and its restriction
$(\measmu\times\measnu)^*\restrictedto{\productsig{\semiring}{\semiringii}}$
to $\productsig{\semiring}{\semiringii}$,
but we will always make the domain clear.
\[
\xymatrix@R=-2pt@C=50pt{
\measurable{(\measmu\times\measnu)^\kernast}
\ar[r]^{(\measmu\times\measnu)^*} & [0, \infty ] \\
\subsetequp & \\
\productsig{\semiring}{\semiringii}
\ar[r]^{(\measmu\times\measnu)^*} & [0, \infty ] \\
\subsetequp & \\
\productsemiring{\semiring}{\semiringii}
\ar[r]^{\measmu\times\measnu} & [0, \infty ] \\
}
\]
\end{notn}




\section{Product Integration}
%*********************************************************
%*********************************************************
 
 



\begin{notn}\label{projections}
Let $\projectionone$ and $\projectiontwo$ denote the respective \term{coordinate projections} of 
$\measurespace\times\measurespaceii$ onto $\measurespace$ and $\measurespaceii$.
That is, 
$\projectionone(\mspaceelt,\mspaceeltii) = \mspaceelt$
and
$\projectiontwo(\mspaceelt,\mspaceeltii) = \mspaceeltii$.
\end{notn}


\begin{defn}\label{sections}
Let $\setv\subseteq\measurespace\times\measurespaceii$, and let 
$\mspaceelt\in\measurespace$ and $\mspaceeltii\in\measurespaceii$.
Define sets
\[
\setv_\mspaceelt
\definedby
\projectiontwo\bigl(\setv\meets\preimage{\projectionone}\{\mspaceelt\}\bigr)
=
\{ \mspaceeltii\in \measurespaceii : 
(\mspaceelt,\mspaceeltii) \in \setv\} \subseteq \measurespaceii, 
\]
and
\[
\setv^\mspaceeltii
\definedby
\projectionone\bigl(\setv\meets\preimage{\projectiontwo}\{\mspaceeltii\}\bigr)
=
\{ \mspaceelt\in \measurespace : 
(\mspaceelt,\mspaceeltii) \in \setv\} \subseteq \measurespace. 
\]
The set $\setv_\mspaceelt$ is the
\textbf{$x$-section} of $\setv$
\index{x-section@$x$-section},
and the set $\setv^\mspaceeltii$ is the
\textbf{$y$-section} of $\setv$
\index{y-section@$y$-section}.
\end{defn}
 

 
 
\begin{prop}\label{measurable_sections} 
Let 
$(\measurespace,\sigmaalgebra)$ and
$(\measurespaceii,\sigmaalgebraii)$
be measurable spaces. 
If 
$\setv\subseteq\productsig{\sigmaalgebra}{\sigmaalgebraii}$,
then
$\setv_\mspaceelt\in\sigmaalgebraii$ for all 
$\mspaceelt\in\measurespace$, and
$\setv^\mspaceeltii\in\sigmaalgebra$ for all
$\mspaceeltii\in\measurespaceii$.
\end{prop}
 
 
 
\begin{notn}
Whenever $\measurespace$, $\measurespaceii$, and 
$\measurespaceiii$ are sets and 
$\function
:\measurespace\times\measurespaceii\to\measurespaceiii$ is a function, we will let 
$\function^\mspaceeltii$ denote the map
\[
\function^\mspaceeltii
:\measurespace\to\measurespaceiii: 
\mspaceelt \mapsto \function(\mspaceelt,\mspaceeltii),
\]
and we will let $\function_\mspaceelt$ denote the map
\[
\function_\mspaceelt
:\measurespaceii\to\measurespaceiii: 
\mspaceeltii \mapsto \function(\mspaceelt,\mspaceeltii).
\]
Also, for each $\mspaceeltii\in\measurespaceii$ let
$\fixinthesecond{\mspaceeltii}$ denote the map
\[
\fixinthesecond{\mspaceeltii}
:\measurespace\to\measurespace\times\measurespaceii
:\mspaceelt\mapsto (\mspaceelt,\mspaceeltii)
\]
and for each $\mspaceelt\in\measurespace$ let
$\fixinthefirst{\mspaceelt}$ denote the map
\[
\fixinthefirst{\mspaceelt}
:\measurespaceii\to\measurespace\times\measurespaceii
:\mspaceeltii\mapsto (\mspaceelt,\mspaceeltii)
\]
as illustrated:
\[
\xymatrix@R=18pt@C=30pt{ 
\measurespace \ar[d]_-{\fixinthesecond{\mspaceeltii}}
\ar[dr]^{\function^\mspaceeltii}
\\
\measurespace\times \measurespaceii
\ar[r]^{\function} & \measurespaceiii
\\
\measurespaceii
\ar[ur]_{\function_\mspaceelt}
\ar[u]^{\fixinthefirst{\mspaceelt}} & \\
}
\]
\end{notn}
 
 
\begin{prop}\label{measurable_out_of_product}
Let 
$(\measurespace,\sigmaalgebra)$,
$(\measurespaceii,\sigmaalgebraii)$, and
$(\measurespaceiii,\sigmaalgebraiii)$
be measurable spaces. 
Let 
$\function
:\measurespace\times\measurespaceii\to\measurespaceiii$.
If $\function$ is 
$\bigl(
\productsig{\sigmaalgebra}{\sigmaalgebraii},
\sigmaalgebraiii
\bigr)$\hyp{}measurable, then
$\function^\mspaceeltii$ is 
$(\sigmaalgebra,\sigmaalgebraiii)$\hyp{}measurable for each 
$\mspaceeltii\in\measurespaceii$, and
$\function_\mspaceelt$ is
$(\sigmaalgebraii,\sigmaalgebraiii)$\hyp{}measurable for each 
$\mspaceelt\in\measurespace$.
\end{prop}
 

\begin{prop}\label{measurable_into_product}
Let
$(\measurespace,\sigmaalgebra)$,
$(\measurespaceii,\sigmaalgebraii)$, and
$(\measurespaceiii,\sigmaalgebraiii)$
be measurable spaces.
Let
$\funcg
:\measurespaceiii \to \measurespace\times\measurespaceii$.
Then the function $\funcg$ is
$(\sigmaalgebraiii, \productsig{\sigmaalgebra}{\sigmaalgebraii} )$\hyp{}measurable
if and only if both
$\projectionone\circ\funcg : \measurespaceiii \to \measurespace$
is $(\sigmaalgebraiii,\sigmaalgebra)$\hyp{}measureable
and
$\projectiontwo\circ\funcg : \measurespaceiii \to \measurespaceii$
is $(\sigmaalgebraiii,\sigmaalgebraii)$\hyp{}measureable.
\end{prop}


\begin{defn}\label{section_functions}
Let $\setv\subseteq \measurespace\times\measurespaceii$.
Define the \term{section functions}
\[
\powersection_{\measurespace}\setv :
\measurespace \to \powerset(\measurespaceii):
\mspaceelt \mapsto \setv_\mspaceelt,
\]
and
\[
\powersection^{\measurespaceii}\setv :
\measurespaceii \to \powerset(\measurespace):
\mspaceeltii \mapsto \setv^\mspaceeltii.
\]
See that 
$\measureii^*\circ\powersection_{\measurespace}\setv
:\measurespace\to\R$
and
$\measure^*\circ\powersection^{\measurespaceii}\setv
:\measurespaceii\to\R$.
%Let 
%$\collectionoffunctions\bigl(\measurespace,\powerset(\measurespaceii)\bigr)$ 
%denote the collection of functions from $\measurespace$ into the powerset 
%$\powerset(\measurespaceii)$, and define a map 
%\[
%\powerfuncsub{\measurespace} : 
%\powerset(\measurespace\times\measurespaceii)\to
%\collectionoffunctions\bigl(\measurespace,\powerset(\measurespaceii)\bigr):
%\setv \mapsto \powersection_{\measurespace}\setv
%\]
%Also, let 
%$\collectionoffunctions\bigl(\measurespaceii,\powerset(\measurespace)\bigr)$ 
%denote the collection of functions from $\measurespaceii$ into the powerset 
%$\powerset(\measurespace)$, and define a map 
%\[
%\powerfuncto{\measurespaceii} : 
%\powerset(\measurespace\times\measurespaceii)\to
%\collectionoffunctions\bigl(\measurespaceii,\powerset(\measurespace)\bigr):
%\setv \mapsto \powersection^{\measurespaceii}\setv
%\]
\end{defn}


\begin{prop}
Let $\setv \in\measurable{(\measure\times\measureii)^\kernast}$ with
$(\measure\times\measureii)^*(\setv)< \infty$. 
For $\measure^\kernast$-almost all $\mspaceelt\in\measurespace$, the set 
$\setv_\mspaceelt$ is  $\measureii^\kernast$-measurable. 
The function 
$\measureii^\kernast\circ\powersection_{\measurespace}\setv$ 
defines an integrable function over $\measurespace$ with respect to $\measure$, and
\[
(\measure\times\measureii)^*(\setv)
=
\int_\measurespace (\measureii^\kernast\circ\powersection_{\measurespace}\setv) \,  d\measure.
\]
Likewise, 
for $\measureii^\kernast$-almost all $\mspaceeltii\in\measurespaceii$, the set 
$\setv^\mspaceeltii$ is $\measure^\kernast$-measurable. 
The function 
$\measure^\kernast\circ\powersection^{\measurespaceii}\setv$ defines an integrable function over 
$\measurespaceii$ with respect to $\measureii$, and
\[
(\measure\times\measureii)^*(\setv)
=
\int_\measurespaceii (\measure^\kernast\circ\powersection^{\measurespaceii}\setv) \,  d\measureii.
\]
\end{prop}


\begin{defn}\label{product_integration}
Let $\function:\measurespace\times\measurespaceii \to \R$. Say that the \term{iterated integral}
$\int_\measurespaceii \int_\measurespace f\,d\measure\, d\measureii$ \textbf{exists}
\index{iterated integral exists}
if, for 
$\measureii^\kernast$-almost all 
$\mspaceeltii\in\measurespaceii$, the function
\[
\function^\mspaceeltii:\measurespace\to\R 
:\mspaceelt\mapsto\function(\mspaceelt,\mspaceeltii)
\]
is integrable over $\measurespace$ with respect to $\measure$, and the function
\[ 
\functionii:
\measurespaceii\to\R:
\mspaceeltii\mapsto 
\int_\measurespace \function^\mspaceeltii\, d\measure 
\]
defines an integrable function over $\measurespaceii$ with respect to $\measureii$. 
In this case, define
\[
\int_\measurespaceii \int_\measurespace f\,d\measure\, d\measureii
\definedby
\int_\measurespaceii 
\left(
\int_\measurespace 
f^\mspaceeltii \,d\measure
\right)
d\measureii
=
\int_\measurespaceii \functionii\, d\measureii
\]
\end{defn}



\begin{thmboldnote}[Fubini]\label{fubini}\index{Fubini's}
Let
$(\measurespace, \semiring, \measure)$
and
$(\measurespaceii, \semiringii, \measureii)$
both be measure spaces.
If $\function:\measurespace\times\measurespaceii\to\R$ is a
$\measure\times\measureii$-integrable function, then both of the iterated integrals
$\int_\measurespaceii\int_\measurespace \function\, d\measure\,d\measureii$ 
and
$\int_\measurespace\int_\measurespaceii \function \, d\measureii\,d\measure$
exist, and
\[
\int_{\measurespace\times\measurespaceii} \function\, d(\measure\times\measureii)
=
\int_\measurespaceii\int_\measurespace \function\, d\measure\, d\measureii
=
\int_\measurespace\int_\measurespaceii \function\, d\measureii\, d\measure.
\]
\end{thmboldnote}



\begin{thmboldnote}[Tonelli]\label{tonelli}\index{Tonelli's}
Let 
$(\measurespace, \semiring, \measure)$
and
$(\measurespaceii, \semiringii, \measureii)$
both be \textsigma-finite measure spaces, and let
$\function:\measurespace\times\measurespaceii\to\R$ be a 
$(\measure\times\measureii)^\kernast$\hyp{}measurable function.
If one of the iterated integrals
$\int_\measurespaceii\int_\measurespace \abs{\function} \, d\measure\,d\measureii$ 
or
$\int_\measurespace\int_\measurespaceii \abs{\function} \, d\measureii\,d\measure$
exists, then the function $\function$ is $\measure\times\measureii$-integrable. Consequently, 
\[
\int_{\measurespace\times\measurespaceii} \function\, d(\measure\times\measureii)
=
\int_\measurespaceii\int_\measurespace \function\, d\measure\, d\measureii
=
\int_\measurespace\int_\measurespaceii \function\, d\measureii\, d\measure.
\]
\end{thmboldnote}


\begin{rmk}
It has been said that, ``It is a difficult problem to determine whether a given function 
$\function:\measurespace\times\measurespaceii\to\R$ is $\measmu\times\measnu$-measurable.''
Maybe a slight understatement.
\end{rmk}



\section{Applications}\label{product_integration_applications}
%*********************************************************
%*********************************************************





\begin{defn}\label{marginals}
Let $(\measurespace,\sigmaalgebra)$ and 
$(\measurespaceii,\sigmaalgebraii)$ be measurable spaces.
Let $\measonprod$ be any measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
Set
\[
\marginalone
=
\measonprod \circ \preimage{\projectionone}
\quad
\text{on }
\sigmaalgebra
\]
and set
\[
\marginaltwo
=
\measonprod \circ \preimage{\projectiontwo}
\quad
\text{on }
\sigmaalgebraii.
\]
Call $\measonprod$ the \textbf{joint}\index{joint measure} measure.
Call the induced measures
$\marginalone$ and $\marginaltwo$ the \textbf{marginal}\index{marginal measure} measures, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{
\measurespace 
\\
\measurespace\times\measurespaceii 
\ar[u]_{\projectionone}
\ar[d]^{\projectiontwo} 
\\
\measurespaceii
}
\qquad
\xymatrix@R=16pt@C=30pt{ 
 & \sigmaalgebra 
 \ar[d]^-{\preimage{\projectionone}} 
 \ar[dl]_-{\marginalone} 
\\
[0,\infty] 
& \productsig{\sigmaalgebra}{\sigmaalgebraii} \ar[l]_{\measonprod}
\\
 & \sigmaalgebraii \ar[u]_-{\preimage{\projectiontwo}} 
 \ar[ul]^-{\marginaltwo}
\\
}
\]
The marginal measures are determined by the joint,
meaning that
\[
\marginalone(\seti)=\measonprod(\seti\times\measurespaceii)
\quad
\text{for all $\seti\in\sigmaalgebra$}
\]
and
\[
\marginaltwo(\setii)=\measonprod(\measurespace\times\setii)
\quad
\text{for all $\setii\in\sigmaalgebraii$}
\]
since
$\preimage{\projectionone}(\seti) = \seti\times\measurespaceii$
and
$\preimage{\projectiontwo}(\setii) = \measurespace\times\setii$.


In case  $(\measurespace,\sigmaalgebra,\measmu)$ and
$(\measurespaceii,\sigmaalgebraii,\measnu)$ are already measure spaces, we might refer to the measures
$\measmu$ and $\measnu$ as \textbf{reference}\index{reference measure} measures, with the understanding that the reference measures are usually not the same as the marginal measures.
\end{defn}


\begin{rmk}
In the remaining propositions of this section,
the only assumptions we will make about the joint measure $\measonprod$ on $\productsig{\sigmaalgebra}{\sigmaalgebraii}$ will be that it is a finite measure, and that it is absolutely continuous with respect to various product measures.
\end{rmk}






\begin{prop}\label{reference_implies_marginals}
Let 
$(\measurespace, \sigmaalgebra)$
and
$(\measurespaceii, \sigmaalgebraii)$
be measurable spaces, and let $\measure$ and $\measureii$
be \textsigma-finite measures on respective \textsigma-algebras 
$\sigmaalgebra$ and $\sigmaalgebraii$.
Let $\measonprod$ be a finite measure on 
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$. 
If $\,\measonprod \abscont (\measure\times\measureii)^*$ on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$, 
then 
$\marginalone\abscont\measure$
on $\sigmaalgebra$
and
$\marginaltwo\abscont\measureii$
on $\sigmaalgebraii$.
In particular,
\[
\frac{d \marginalone}
{d\measure}
: \measurespace\to\R :
\mspaceelt\mapsto
\int_{\measurespaceii}
\frac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)
\,d\measureii(\mspaceeltii)
\]
and
\[
\frac{d \marginaltwo}
{d\measureii}
: \measurespaceii\to\R :
\mspaceeltii\mapsto
\int_{\measurespace}
\frac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)\,d\measure(\mspaceelt).
\]
\end{prop}


\begin{proof}
Set
$\function = d\measonprod / d(\measure\times\measureii)^*$.
We will only show that the Radon-Nikodym derivative
$d \marginalone / d \measure$
is the map
$\measurespace\to\R:
\mspaceelt\mapsto
\int_{\measurespaceii}\function(\mspaceelt,\mspaceeltii)\,d\measureii(\mspaceeltii)$.
This is just an application of Fubini's theorem.

The function $\function$ is supposed to be integrable over $\pspace\times\sspace$ with respect to 
$\measure\times\measureii$. It follows by
Fubini's Theorem~\ref{fubini} that
the function
\[
\function_\mspaceelt : 
\measurespaceii \to\R
: \mspaceeltii \mapsto \function(\mspaceelt,\mspaceeltii)
\]
is integrable over $\measurespaceii$ with respect to $\measureii$
 for
$\measure^\kernast$-almost all 
$\mspaceelt\in\measurespace$, 
and the function
\[
\funcj :\measurespace\to\R :\mspaceelt\mapsto
\int_\measurespaceii\function_\mspaceelt\,d\measureii
=
\int_{\measurespaceii}\function(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)
\]
defines an integrable function over $\measurespace$ with respect to 
$\measure$, with
\[
\int_{\measurespace\times\measurespaceii} 
\function \, d (\measure\times\measureii)
=
\int_\measurespace \funcj \,d \measure
=
\int_\measurespace
\left(
\int_\measurespaceii
\function(\mspaceelt,\mspaceeltii) 
\, d\measureii(\mspaceeltii)
\right) \, d\measure(\mspaceelt).
\]
For each set $\seti\in\sigmaalgebra$,
we know 
\[
\marginalone(\seti) 
= \measonprod\circ\preimage{\projectionone}(\seti)
= \measonprod(\seti\times\measurespaceii).
\]
By hypothesis, 
\[
\measonprod(\seti\times\measurespaceii)
=
\int_{\seti\times\measurespaceii} \function \, d(\measure\times\measureii).
\]
By Fubini's,
\[
\int_{\seti\times\measurespaceii} \function 
\, d(\measure\times\measureii)
= \int_{\seti} \funcj \,d\measure.
\]
By transitivity of equality, 
\[
\marginalone(\seti)
=
\int_{\seti} \funcj \,d\measure
\quad
\text{for all $\seti\in\sigmaalgebra$,}
\]
and this says $\marginalone\abscont \measure$
on $\sigmaalgebra$ with
$d\marginalone/d\measure = \funcj$.
\end{proof}


\begin{prop}\label{reference_implies_mixed_and_marginals}
Let
$(\measurespace, \sigmaalgebra)$
and
$(\measurespaceii, \sigmaalgebraii)$
be measurable spaces, and let $\measure$ and $\measureii$
be \textsigma-finite measures on  respective \textsigma-algebras
$\sigmaalgebra$ and $\sigmaalgebraii$.
Let $\measonprod$ be a finite measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
If\,
$\measonprod \abscont (\measure\times\measureii)^*$
on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$,
then 
$\measonprod \abscont (\marginalone\times\measureii)^*$,
and
$\measonprod \abscont (\measure\times\marginaltwo)^*$,
and furthermore,
$\measonprod \abscont (\marginalone\times\marginaltwo)^*$.
In particular,
\[
\frac{d\measonprod}{d(\marginalone\times\measnu)^*}
: \measurespace\times\measurespaceii
\to \R
: (\mspaceelt,\mspaceeltii)\mapsto
\frac{\dfrac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)}
{\dfrac{d\marginalone\lilstrut}{d\measmu}(\mspaceelt)},
\]
\[
\frac{d\measonprod}{d(\measmu\times\marginaltwo)^*}
: \measurespace\times\measurespaceii
\to \R
: (\mspaceelt,\mspaceeltii)\mapsto
\frac{\dfrac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)}
{\dfrac{d\marginaltwo\lilstrut}{d\measnu}(\mspaceeltii)},
\]
and
\[
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
: \measurespace\times\measurespaceii
\to \R
: (\mspaceelt,\mspaceeltii)\mapsto
\frac{\dfrac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)}
{\dfrac{d\marginalone\lilstrut}{d\measmu}(\mspaceelt)
\cdot
\dfrac{d\marginaltwo\lilstrut}{d\measnu}(\mspaceeltii)}.
\]
\end{prop}


\begin{proof}
Let
$\measonprod \abscont (\measure\times\measureii)^*$.
Let
$\function = d\measonprod / d(\measure\times\measureii)^*$
and let
\[
\funcj : \measurespace\to\R
: \mspaceelt \mapsto \int_\measurespaceii \function_\mspaceelt \, d\measureii
\]
and
\[
\funck : \measurespaceii\to\R
: \mspaceeltii \mapsto \int_\measurespace \function^\mspaceeltii \, d\measure,
\]
and define
\[
\functionii : \measurespace\times\measurespaceii \to \R
: (\mspaceelt,\mspaceeltii) \mapsto
\begin{cases}
\dfrac{\function(\mspaceelt,\mspaceeltii)}{\funcj(\mspaceelt)}
& \text{if $\funcj(\mspaceelt) > 0$} \\
1 
& \text{if $\funcj(\mspaceelt)=0$} \\
\end{cases}
\]
and
\[
\functioniii : \measurespace\times\measurespaceii \to \R
: (\mspaceelt,\mspaceeltii) \mapsto
\begin{cases}
\dfrac{\function(\mspaceelt,\mspaceeltii)} 
{\funcj(\mspaceelt)\funck(\mspaceeltii)}
& \text{if $\funcj(\mspaceelt)\funck(\mspaceeltii) > 0$} \\
1 
& \text{if $\funcj(\mspaceelt)\funck(\mspaceeltii)=0$} \\
\end{cases}
\]
The claim is that 
$\functionii
=
d\measonprod / d(\marginalone\times\measureii)^*$
and
$\functioniii
=
d\measonprod / d(\marginalone\times\marginaltwo)^*$.


Let us now show that 
$\measonprod \abscont (\marginalone\times\measureii)^*$.
It is sufficient to show that 
$\functionii
=
d\measonprod / d(\marginalone\times\measureii)^*$,
meaning
\[
\measonprod(\setiii)
=
\int_\setiii\functionii
\,d(\marginalone\times\measureii)
\quad
\text{for all $\setiii\in
\productsig{\sigmaalgebra}{\sigmaalgebraii}$}.
\]
In order to apply Tonelli's Theorem~\ref{tonelli} to show that the function $\functionii$ is integrable with respect to 
$\marginalone\times\measureii$, we first show that  the iterated integral
$\int_\measurespace\int_\measurespaceii \funcg \,d\measureii\,d\marginalone$
exists.

We have assumed
$\function = d\measonprod / d(\measure\times\measureii)^*$,
which implies that we have assumed the function $\function$ is integrable with respect to 
$\measure\times\measureii$.
By Fubini's Theorem~\ref{fubini} then, the corresponding iterated integral
$\int_\measurespace\int_\measurespaceii \funcf \,d\measureii\,d\measure$
exists.
This means that the function
\[
\function_\mspaceelt:\measurespaceii\to\R :
\mspaceeltii\mapsto\function(\mspaceelt,\mspaceeltii)
\]
is integrable over $\measurespaceii$ with respect to $\measureii$ for 
$\measure^\kernast$-almost all 
$\mspaceelt\in\measurespace$,
and the function 
$\mspaceelt\mapsto 
\int_\measurespaceii \function_\mspaceelt \, d\measureii$ 
defines an integrable function over $\measurespace$ with respect to $\measure$.
Let us carry this
a little further.  
Since $\measonprod \abscont (\measure\times\measureii)^*$, it follows by Proposition~\ref{reference_implies_marginals} that
$\marginalone\abscont\measure$ on $\sigmaalgebra$.
We can then apply Proposition~\ref{abscont_properties} which says that if
$\measure^*(\seti)=0$, then $\marginalone^*(\seti)=0$ for any $\seti\in\measurespace$.
It means the function 
$\function_\mspaceelt$ 
is integrable over $\measurespaceii$ with respect to $\measureii$ for 
$\marginalone^*$-almost all $\mspaceelt\in\measurespace$.
Since the function
$\measurespaceii\to\R:\mspaceeltii\mapsto 1/ \funcj(\mspaceelt)$ 
is  constant, it follows that the function
\[
\frac{\function_\mspaceelt}{\funcj(\mspaceelt)} :
\measurespaceii\to\R :
\mspaceeltii\mapsto
\frac{\function(\mspaceelt,\mspaceeltii)}{\funcj(\mspaceelt)}
\]
is also integrable over $\measurespaceii$ with respect to $\measureii$ for 
$\marginalone^*$-almost all $\mspaceelt\in\measurespace$.
See that the function
\[
\measurespace\to\R :
\mspaceelt \mapsto 
\int_\measurespaceii 
\frac{\function_\mspaceelt}{\funcj(\mspaceelt)} 
\, d\measureii
\]
defines an integrable function over $\measurespace$ with respect to 
$\marginalone$; in fact,
\[
\int_\measurespaceii 
\frac{\function_\mspaceelt}{\funcj(\mspaceelt)} 
\, d\measureii
= 1,
\]
and constant functions are integrable with respect to finite measures.

Consequently, for $\setiii\in\productsig{\sigmaalgebra}{\sigmaalgebraii}$, 
the function
\[
\measurespaceii\to\R :
\mspaceeltii \mapsto
\frac{\charfunction{\setiii}(\mspaceelt,\mspaceeltii)
\function_\mspaceelt(\mspaceeltii)}
{\funcj(\mspaceelt)}
\]
is also integrable over $\measurespaceii$ with respect to $\measureii$ for 
$\marginalone^*$-almost all $\mspaceelt\in\measurespace$,
and the function
\[
\measurespace\to\R :
\mspaceelt \mapsto 
\int_\measurespaceii 
\frac{
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)}{\funcj(\mspaceelt)} 
\, d\measureii(\mspaceeltii)
\]
defines an integrable function over $\measurespace$ with respect to 
$\marginalone$.
Applying Tonelli's Theorem~\ref{tonelli} then,
\begin{align*}
\int_{\measurespace\times\measurespaceii}
\charfunction{\setiii}
\functionii
\, d(\marginalone\times\measureii)
& =
\int_{\measurespace\times\measurespaceii}
\frac{
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)}
{\funcj(\mspaceelt)} 
\, d(\marginalone\times\measureii)(\mspaceelt,\mspaceeltii)
\\
& =
\int_\measurespaceii
\int_\measurespace 
\frac{
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)}{\funcj(\mspaceelt)} 
\, d\marginalone(\mspaceelt)
\, d\measureii(\mspaceeltii).
\end{align*}
By Proposition~\ref{radon_nikodym_corollary}, we can change measures, after
$d\marginalone = \funcj \, d\measure$:
\begin{align*}
\int_\measurespace 
\frac{
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)}{\funcj(\mspaceelt)} 
\, d\marginalone(\mspaceelt)
& =
\int_\measurespace 
\frac{
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)}{\funcj(\mspaceelt)} 
\cdot \funcj(\mspaceelt)
\, d\measure(\mspaceelt)
\\
& =
\int_\measurespace 
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)
\, d\measure(\mspaceelt).
\end{align*}
Using these last two strings of equalities:
\begin{align*}
\int_\setiii \functionii
\,d(\marginalone\times\measureii)
& = 
\int_{\measurespace\times\measurespaceii}
\charfunction{\setiii}
\functionii
\, d(\marginalone\times\measureii)
\\
& =
\int_\measurespaceii
\int_\measurespace 
\charfunction{\setiii}(\mspaceelt,\mspaceeltii) 
\function_\mspaceelt(\mspaceeltii)
\, d\measure(\mspaceelt)
\, d\measureii(\mspaceeltii)
\\
& =
\int_{\setiii} 
\function(\mspaceelt,\mspaceeltii)
\, d(\measure\times\measureii)
\\
& =
\measonprod(\setiii),
\end{align*}
as required.

Let us sketch the proof that
$\functioniii
=
d\measonprod / d(\marginalone\times\marginaltwo)^*$.
We have shown that 
$\measonprod \abscont (\measure\times\measureii)^*$
implies
$\measonprod \abscont (\marginalone\times\measureii)^*$. 
Simply use the symmetric proof to show 
$\measonprod \abscont (\marginalone\times\measureii)^*$
implies
$\functioniii
=
d\measonprod / d(\marginalone\times\marginaltwo)^*$.
Use the fact shown earlier that 
$\funcg$ is integrable with respect to $\marginalone$ and so
\[
\int_\measurespace\funcg(\mspaceelt,\mspaceeltii)\,d\marginalone(\mspaceelt)
=
\int_\measurespace
\frac{\funcf(\mspaceelt,\mspaceeltii)}{\funcj(\mspaceelt)}
\,d\marginalone(\mspaceelt)
=
\int_\measurespace
\frac{\funcf(\mspaceelt,\mspaceeltii)}{\funcj(\mspaceelt)}
\funcj(\mspaceelt)
\,d\measure(\mspaceelt)
=
\funck(\mspaceeltii)
\]
to get
\[
\int_\measurespace
\frac{\funcg^\mspaceeltii}{\funck(\mspaceeltii)}
\, d\marginalone
= 1
\]
in order to show that the function 
\[
\measurespaceii\to\R :
\mspaceeltii\mapsto
\int_\measurespace
\frac{\funcg^\mspaceeltii}{\funck(\mspaceeltii)}
\, d\marginalone
\]
defines an integrable function over $\measurespaceii$ with respect to the finite measure $\marginaltwo$.
And, for future reference:
\[
\int_\measurespace
\frac{\funcg^\mspaceeltii}{\funck(\mspaceeltii)}
\, d\marginalone
=
\int_\measurespace
\frac{\dfrac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)}
{\dfrac{d\marginalone\lilstrut}{d\measmu}(\mspaceelt)
\cdot
\dfrac{d\marginaltwo\lilstrut}{d\measnu}(\mspaceeltii)}
\,d\marginalone(\mspaceelt).
\]
\end{proof}



\begin{prop}\label{bayes_rule}
Let
$(\measurespace, \sigmaalgebra)$
and
$(\measurespaceii, \sigmaalgebraii)$
be measurable spaces, and let $\measure$ and $\measureii$
be \textsigma-finite measures on respective \textsigma-algebras
$\sigmaalgebra$ and $\sigmaalgebraii$.
Let $\measonprod$ be a finite measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
If $\,\measonprod \abscont (\measure\times\measureii)^*$ on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$,
then
\[
\dfrac{d\joint}{d(\measmu\times\marginaltwo)^*}(\mspaceelt,\mspaceeltii)
=
\dfrac{
\dfrac{d\joint}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\cdot
\dfrac{d\marginalone}{d\measmu}(\mspaceelt)
}
{
\displaystyle\int_\measurespace
\dfrac{d\joint}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\cdot
\dfrac{d\marginalone}{d\measmu}(\mspaceelt)\,
d\measmu(\mspaceelt)
}.
\]
\end{prop}

\begin{proof}
This just combines Proposition~\ref{reference_implies_marginals} and Proposition~\ref{reference_implies_mixed_and_marginals}.

It follows from Proposition~\ref{reference_implies_mixed_and_marginals} that
\[
\dfrac{d\joint}{d(\measmu\times\marginaltwo)^*}(\mspaceelt,\mspaceeltii)
=
\dfrac{
\dfrac{d\joint}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\cdot
\dfrac{d\marginalone}{d\measmu}(\mspaceelt)
}
{
\dfrac{d \marginaltwo\lilstrut}
{d\measnu}(\mspaceeltii)
}.
\]
We will simply make a substitution for
$d\marginaltwo / d\measnu$.
By Proposition~\ref{reference_implies_marginals},
\[
\frac{d \marginaltwo}
{d\measnu}(\mspaceeltii)
=
\int_{\measurespace}
\frac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)
\,d\measmu(\mspaceelt)
\]
and by Proposition~\ref{reference_implies_mixed_and_marginals},
\[
\frac{d\joint}{d(\measmu\times\measnu)^*}
(\mspaceelt,\mspaceeltii)
=
\dfrac{d\joint}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\cdot
\dfrac{d\marginalone}{d\measmu}(\mspaceelt),
\]
so
\[
\frac{d \marginaltwo}
{d\measnu}(\mspaceeltii)
=
\displaystyle\int_\measurespace
\dfrac{d\joint}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\cdot
\dfrac{d\marginalone}{d\measmu}(\mspaceelt)\,
d\measmu(\mspaceelt),
\]
as required.
\end{proof}




\begin{prop}\label{mixed_implies_marginal}
Let
$(\measurespace, \sigmaalgebra)$
and
$(\measurespaceii, \sigmaalgebraii)$
be measurable spaces, and let $\measure$ and $\measureii$
be \textsigma-finite measures on  respective \textsigma-algebras
$\sigmaalgebra$ and $\sigmaalgebraii$.
Let $\measonprod$ be a finite measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
If\,
$\measonprod \abscont (\marginalone\times\measnu)^*$, then
$\marginaltwo\abscont\measnu$ and
$\measonprod\abscont(\marginalone\times\marginaltwo)^*$. In particular,
\[
\frac{d\marginaltwo}{d\measnu}
: \measurespaceii \mapsto\R
:\mspaceeltii\mapsto
\int_\measurespace
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\, d\marginalone(\mspaceelt),
\]
and
\[
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
: \measurespace\times\measurespaceii
\to \R
: (\mspaceelt,\mspaceeltii)\mapsto
\frac{\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}
(\mspaceelt,\mspaceeltii)}
{\dfrac{d\marginaltwo\lilstrut}{d\measnu}(\mspaceeltii)}.
\]
Likewise,
if\,
$\measonprod \abscont (\measmu\times\marginaltwo)^*$, then
$\marginalone\abscont\measmu$ and
$\measonprod\abscont(\marginalone\times\marginaltwo)^*$. In particular,
\[
\frac{d\marginalone}{d\measmu}
: \measurespace \mapsto\R
:\mspaceelt\mapsto
\int_\measurespaceii
\dfrac{d\measonprod}{d(\measmu\times\marginaltwo)^*}(\mspaceelt,\mspaceeltii)
\, d\marginaltwo(\mspaceeltii),
\]
and
\[
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
: \measurespace\times\measurespaceii
\to \R
: (\mspaceelt,\mspaceeltii)\mapsto
\frac{\dfrac{d\joint}{d(\measmu\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)}
{\dfrac{d\marginalone\lilstrut}{d\measmu}(\mspaceelt)}.
\]
\end{prop}


\begin{proof}
This is nothing but an application of Proposition~\ref{reference_implies_marginals} and Proposition~\ref{reference_implies_mixed_and_marginals}. First set $\measmu=\marginalone$ and apply them, then set $\measnu=\marginaltwo$ and apply them again, noting that $\marginalone$ and $\marginaltwo$ are both finite and therefore \textsigma\hyp{}finite.
\end{proof}


\begin{prop}\label{mixed_implies_half}
Let
$(\measurespace, \sigmaalgebra)$
and
$(\measurespaceii, \sigmaalgebraii)$
be measurable spaces, and let $\measure$ and $\measureii$
be \textsigma-finite measures on  respective \textsigma-algebras
$\sigmaalgebra$ and $\sigmaalgebraii$.
Let $\measonprod$ be a finite measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
If\,
$\measonprod \abscont (\marginalone\times\measnu)^*$, then
\[
\int_\seti
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\,d\marginalone(\mspaceelt)
=
\frac{\displaystyle
\int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\,d\marginalone(\mspaceelt)
}
{\displaystyle
\int_\measurespace
\dfrac{d\measonprod\lilstrut}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\,d\marginalone(\mspaceelt)
}
\]
for all $\seti\in\sigmaalgebra$.
\end{prop}


\begin{proof}
This is the slightest possible re-statement of the first half of Proposition~\ref{mixed_implies_marginal}.
\end{proof}



\begin{prop}\label{almost_a_measure}
Let
$(\measurespace, \sigmaalgebra)$
and
$(\measurespaceii, \sigmaalgebraii)$
be measurable spaces, and let  $\measonprod$ be a finite measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
If\, $\measonprod \abscont (\marginalone\times\marginaltwo)^*$, then
\[
\measurespace\to\R
:\mspaceelt\mapsto
\int_\measurespaceii \dfrac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
\,d\marginaltwo(\mspaceeltii)
=
1
\quad
\text{$\marginalone^\kernast$\hyp{}\,a.e.\ on $\measurespace$,}
\]
and
\[
\measurespaceii\to\R:\mspaceeltii\mapsto
\int_\measurespace \dfrac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
\,d\marginalone(\mspaceelt)
=
1
\quad
\text{$\marginaltwo^\kernast$\hyp{}\,a.e.\ on $\measurespaceii$.}
\]
\end{prop}
\begin{proof}
We will prove the first displayed equality.
Let $\measonprod\abscont(\marginalone\times\marginaltwo)^*$.
With $\measonprod$ finite, it follows that
$\marginalone\definedby
\measonprod \circ \preimage{\projectionone}$
on $\sigmaalgebra$
and
$\marginaltwo\definedby
\measonprod \circ \preimage{\projectiontwo}$
on $\sigmaalgebraii$
are finite, therefore \textsigma\hyp{}finite.
If we now set
$\measmu = \marginalone$
and set
$\measnu=\marginaltwo$ and apply Proposition~\ref{reference_implies_marginals}, then we get:
\[
\frac{d \marginalone}{d\marginalone}(\mspaceelt)
=
\int_{\measurespaceii}
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
\,d\marginaltwo(\mspaceeltii),
\]
or equivalently,
\[
\marginalone(\seti)
=
\int_\seti
\left(
\int_{\measurespaceii}
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
\,d\marginaltwo(\mspaceeltii)
\right)
\,d\marginalone(\mspaceelt)\quad\text{for all $\seti\in\sigmaalgebra$.}
\]
But also
\[
\marginalone(\seti)
=
\int_\seti
1
\,d\marginalone(\mspaceelt)\quad\text{for all $\seti\in\sigmaalgebra$.}
\]
By the uniqueness of the Radon-Nikodym derivative, which in this case is a class in
$L_1(\measurespace, \sigmaalgebra,\marginalone)$, it follows that
\[
\int_{\measurespaceii}
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
\,d\marginaltwo(\mspaceeltii)
= 1
\quad
\text{$\marginalone^\kernast$\hyp{}almost everywhere,}
\]
as required.
\end{proof}


\chapter{Probability, Independence, and Sampling}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************



%***************************************************************
%***************************************************************
\section{Probability Spaces and Distributions}

\begin{defn}\label{probability_space}
A \term{probability space} is a measure space $(\measurespace, \sigmaalgebra,\measure)$ such that 
$\sigmaalgebra$ is a $\textsigma$-algebra of subsets of a set $\measurespace$ with 
$\measure(\measurespace)=1$. 
Any measure $\measureii$ on a measurable space $(\measurespace, \sigmaalgebra)$ for which 
$\measureii(\measurespace) =1$ is called a \term{probability measure}. If $\function:\measurespace\to\R^n$ is an
$(\sigmaalgebra, \borel_{\R^n})$\hyp{}measurable function, then $\function$ might be called a \term{random variable}.  
\end{defn}

\begin{rmk}\label{semiring_to_sigmaalgebra}
When it comes to probability spaces, why change structure from measure spaces
$(\measurespace,\semiring,\measure)$, where $\semiring$ is only assumed to be a semiring,
to
$(\measurespace,\sigmaalgebra,\measure)$, where $\sigmaalgebra$ is assumed to be a
\textsigma\hyp{}algebra?
One reason may be the use of \emph{density} functions, which represent Radon-Nikodym derivatives.
Recall that the Radon-Nikodym Theorem~\ref{radon-nikodym} applies to measures on a measurable space
$(\measurespace, \sigmaalgebra)$, in which case $\sigmaalgebra$ is supposed to be a \textsigma\hyp{}algebra.  Density functions are described further in Notation~\ref{density_functions}.

Even for probability spaces
$(\measurespace,\sigmaalgebra,\measmu)$
and
$(\measurespaceii,\sigmaalgebraii,\measnu)$,
the measure $\measmu\times\measnu$ on the semiring
$\productsemiring{\sigmaalgebra}{\sigmaalgebraii}$ need not be a measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$, unless possibly
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$
happens to equal
$\productsemiring{\sigmaalgebra}{\sigmaalgebraii}$.
But its unique extension
$(\measmu\times\measnu)^*$ restricts to a measure on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$.
This was described in Notation~\ref{extension_to_sigmaalgebra}, and is reproduced somewhat here:
Let us apply Proposition~\ref{extension_measure} to the inclusion
\[
\productsemiring{\semiring}{\semiringii}
\subseteq
\productsig{\semiring}{\semiringii}
\subseteq
\measurable{(\measure\times\measureii)^\kernast}.
\]
The proposition says that if a measure agrees with $\measmu\times\measnu$ on
$\productsemiring{\semiring}{\semiringii}$, then that measure agrees with
$(\measmu\times\measnu)^*$ on
$\productsig{\semiring}{\semiringii}$.
We will let $(\measmu\times\measnu)^*$ denote both the measure
$(\measmu\times\measnu)^*$ on $\measurable{(\measure\times\measureii)^\kernast}$
and its restriction
$(\measmu\times\measnu)^*\restrictedto{\productsig{\semiring}{\semiringii}}$
to $\productsig{\semiring}{\semiringii}$.
We will always make the domain clear.
\[
\xymatrix@R=-2pt@C=50pt{
\measurable{(\measmu\times\measnu)^\kernast}
\ar[r]^{(\measmu\times\measnu)^*} & [0, \infty] \\
\subsetequp & \\
\productsig{\semiring}{\semiringii}
\ar[r]^{(\measmu\times\measnu)^*} & [0, \infty] \\
\subsetequp & \\
\productsemiring{\semiring}{\semiringii}
\ar[r]^{\measmu\times\measnu} & [0, \infty] \\
}
\]
\end{rmk}


\begin{defn}\label{probability_distribution}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a probability space, and let 
$(\measurespaceii, \sigmaalgebraii)$ be a measurable space, so $\sigmaalgebraii$ is supposed to be a 
$\textsigma$-algebra.
If a function $\function:\measurespace\to\measurespaceii$ is 
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, where 
$\preimage{\function}:\sigmaalgebraii\to\sigmaalgebra$,
then the induced probability measure 
$\measure\circ\preimage{\function}$ on
the \textsigma\hyp{}algebra  $\sigmaalgebraii$ of the codomain of $\funcf$,
defined by 
\[
\measure\circ\preimage{\function} 
: \sigmaalgebraii\to [0,1] 
: B\mapsto\measure\bigl(\preimage{\function}(B)\bigr),
\]
and illustrated
\[
\xymatrix@R=18pt@C=30pt{\measurespace \ar[r]^\funcf & \measurespaceii \\}
\quad
\xymatrix@R=18pt@C=30pt{
[0,1]
& \sigmaalgebra 
\ar[l]^-\measmu
& \sigmaalgebraii
\ar[l]^{\preimage{\funcf}} 
\ar@/_12pt/[ll]_-{\measmu\,\circ\,\function^{\makebox[0pt][l]{$\scriptstyle\leftarrow$}}}
}
\]
is called the 
\term{probability distribution}\index{distribution} of $\function$ on 
$\sigmaalgebraii$, or simply the \emph{probability distribution} of $\function$.
It is a probability measure composed with a preimage: $\measmu\circ\preimage{\funcf}$.
\end{defn}


\begin{notn}\label{density_functions}
Probability distributions are probabilities induced on a \textsigma-algebra of the codomain of a measurable function. The notation
\[
\function \sim \measure\circ\preimage{\function}
\]
is used to denote the map from the measurable function to the probability distribution, although seldom so explicitly.
For example, suppose an author writes 
\[
\function\sim \text{Normal}(m,s),
\]
or maybe something like $\function\sim \cali{N}(m,s)$.
There is an underlying probability space
$(\measurespace,\sigmaalgebra,\measmu)$, where 
$\funcf:\measurespace\to\R$
is  
$\bigl(\sigmaalgebra,\borel_\R \bigr)$\hyp{}measurable,
as illustrated:
\[
\xymatrix@R=18pt@C=30pt{\measurespace \ar[r]^\funcf & \R \\}
\quad
\xymatrix@R=18pt@C=30pt{
[0,1]
& \sigmaalgebra 
\ar[l]^-\measmu
& \borel_\R
\ar[l]^{\preimage{\funcf}} 
\ar@/_12pt/[ll]_{\measmu\,\circ\,
\funcf
\makebox[0pt][l]{$\scriptstyle{^\leftarrow =\, \text{Normal}(m,s)}$}}
}
\]
%
%
%
See that
$\function\sim \measmu\circ \preimage{\function}$.
That is, $\measmu\circ \preimage{\function}$ is the probability distribution of $\function$ on 
$\borel_\R$.
By writing $\function\sim \text{Normal}(m,s)$, the author has indicated that the measures 
$\measmu\circ \preimage{\function}$ and
$\text{Normal}(m,s)$ are equal,
which means
\begin{align*}
\measmu\circ \preimage{\function}(\seti) 
&= \text{Normal}(m,s)(\seti) \\
&\definedby\int_\seti \functionii(t)\,d\lambda(t)\quad\text{for all $\seti\in\borel_\R$},
\end{align*}
where 
\[
\functionii :\R\to\R:
t\mapsto
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t-m}{s}
\right)^2
\right\},
\]
and $\measlambda$ is Lebesgue measure.
The function 
$\functionii \in\cali{L}_1(\R,\borel_\R,\lambda)$
in this case represents the Radon-Nikodym derivative of the probability measure
$\measmu \circ \preimage{\function}$
with respect to Lebesgue measure $\lambda$ on $\borel_\R$.
Should an author write 
\[\text{Normal}(\function\mid m,s),\] they are likely referring to the function $\functionii$ itself, and might call it the \term{density} of $\function$. 

If an author  writes $\int \funcg(t)\,dt$, then we assume the `$dt$' means with respect to Lebesgue measure. If instead there is a summation sign and they use the term `probability function,' or use the word `discrete,' then they likely mean integration with respect to counting measure.  In any case, with a density function it is always the Lebesgue integral with respect to some measure.
\end{notn}

\begin{rmk}
To be sure:
\begin{itemize}
\item A \emph{density} is an integrable function that represents a Radon-Nikodym derivative of a finite measure with respect to  a \textsigma-finite measure.
\item A \emph{probability distribution} is a probability measure induced on a \textsigma-algebra of the codomain of a measurable function.
\end{itemize}
There is no intelligible sense in which the terms \emph{density} and \emph{probability distribution} are interchangeable.
\end{rmk}


\section{Expected Value}
%*********************************************************
%*********************************************************
\begin{defn}\label{expected_value}
For a class $\ellclass{\function}{\measure}$ in $L_1(\measurespace, \semiring,\measure)$, the
\term{expected value} $\expval{\ellclass{\function}{\measure}}$ of the class
$\ellclass{\function}{\measure}$ is
$\int\function\,d\mu$. That is, the operator $\expval$ is the linear functional defined by
\[
\expval:
L_1(\measurespace, \semiring,\measure)\to\R :
\ellclass{\function}{\measure}\mapsto \int_\measurespace \function\, d\measure.
\]
\end{defn}



\begin{rmk}\label{expected_value_probability}
In the case that
$(\measurespace,\sigmaalgebra,\measure)$ is a probability space, and
the probability distribution
$\measmu\circ\preimage{\funcf}$ of $\funcf$ is absolutely continuous with respect to some
\textsigma\hyp{}finite reference measure
$\measlambda$ on $\borel_\R$, then,
setting
$p = d(\measmu\circ\preimage{\funcf})/d \measlambda$,
the expected value of $\ellclass{\funcf}{\measure}$ can be computed by
\[
\int_\measurespace \funcf \, d\measmu
=
\int_\R t \, p(t) \, d\measlambda(t),
\]
and to see this, let $\funcg:\R \to\R$ be any function integrable with respect to
$\measmu\circ\preimage{\funcf}$.  By Proposition~\ref{combine},
\[
\int_\measurespace (\funcg \circ \funcf)\, d\measmu
=
\int_\R \funcg \, p \, d\measlambda.
\]
Taking $\funcg$ to be the identity function $\funcg(t)=t$, so that
$\funcg \bigl( \funcf(x)\bigr) = \funcf(x)$, see that
\[
\int_\measurespace \funcf \, d\measmu
=
\int_\R t \, p(t) \, d\measlambda(t).
\]
\end{rmk}


\section{Independence}
%*********************************************************
%*********************************************************
\begin{defn}
Let $(\measurespace, \semiring, \measure)$ be a measure space,
and let $\semiringii$ and $\semiringiii$ be subsets of the semiring $\semiring$.
Then  $\semiringii$ and $\semiringiii$ are \term{independent collections} of sets with respect to 
the measure $\measure$ if 
\[
\measure(A\meets B) =\measure(A)\cdot\measure(B)
\quad
\text{for all $A\in\semiringii$ and for all $B\in\semiringiii$.}
\]
\end{defn}

The `$\sigalg{V}$' symbol is a fraktur V, and `$\sigalg{W}$' is fraktur W.

\begin{prop}
If $\semiringii$ and $\semiringiii$ are independent collections with
$\sigalg{V}\subseteq\semiringii$ and $\sigalg{W}\subseteq\semiringiii$, then
$\sigalg{V}$ and $\sigalg{W}$ are independent collections.
\end{prop}



\begin{defn}\label{independent_functions} 
Let  
$\function: (\measurespace,\sigmaalgebra) \to (\measurespaceii,\sigmaalgebraii)$ 
and 
$\functionii: (\measurespace,\sigmaalgebra) \to (\measurespaceiii,\sigmaalgebraiii)$ 
be measurable functions.
Then $\function$ and $\functionii$ are 
\term{independent functions} with respect to a measure $\measure$ on $\sigmaalgebra$ if the 
\textsigma-algebras 
$\preimage{\function}(\sigmaalgebraii)$ and $\preimage{\functionii}(\sigmaalgebraiii)$ are independent with respect to $\measure$, 
where $\preimage{\function}:\sigmaalgebraii\to\sigmaalgebra$ and 
$\preimage{\functionii}:\sigmaalgebraiii\to\sigmaalgebra$. 
It means
\[
\measure\bigl( \preimage{\function}(\seti) \meets \preimage{\functionii}(\setii) \bigr)
=
\measure\bigl(\preimage{\function}(\seti)\bigr) 
\cdot
\measure\bigl(\preimage{\functionii}(\setii)\bigr)
\quad
\text{for all $\seti\in\sigmaalgebra$ and $\setii\in\sigmaalgebraii$.}
\]
\end{defn}


\begin{prop}\label{independent_compositions}
If functions
$\funch : (\measurespace,\sigmaalgebra) \to (\measurespaceii,\sigmaalgebraii)$
and
$\funck : (\measurespace,\sigmaalgebra) \to (\measurespaceii,\sigmaalgebraii)$
are independent, and
$\funcg: (\measurespaceii,\sigmaalgebraii) \to (\measurespaceiii,\sigmaalgebraiii)$
is measurable, then 
$\funcg\circ\funch$
and
$\funcg\circ\funck$
are independent.
\end{prop}




\begin{defn}\label{independent_classes}
Let $(\measurespace, \semiring, \measure)$ be a measure space,
and let $\ellclass{\function}{\measure}$ and $\ellclass{\functionii}{\measure}$  be classes in 
$L_p(\measurespace, \semiring, \measure)$. 
Then $\ellclass{\function}{\measure}$ and $\ellclass{\functionii}{\measure}$ are 
\term{independent classes} with respect to $\measure^*$ if the 
\mbmeasurable\
functions $\function$ and $\functionii$ are independent with respect to $\measure^*$. 
Proposition~\ref{class_induced_measure} says that the independence of classes $\ellclass{\function}{\measure}$ and 
$\ellclass{\functionii}{\measure}$ does not depend on the respective chosen representative functions $\function$ and $\functionii$, meaning if $\functioniii\in\ellclass{\function}{\measure}$ and 
$\functioniv\in\ellclass{\functionii}{\measure}$, then $\function$ and $\functionii$ are independent if and only if 
$\functioniii$ and $\functioniv$ are independent.
\end{defn}











\begin{prop}\label{expected_value_independent}  
If classes $\ellclass{\function}{\measure}$ and $\ellclass{\functionii}{\measure}$ in 
$L_1(\measurespace, \semiring,\measure)$ are independent with respect to 
$\measure^*$, and if 
$\ellclass{\function}{\measure}\ellclass{\functionii}{\measure} \in 
L_1(\measurespace, \semiring,\measure)$, then 
\[
\expvalof{\ellclass{\function}{\measure}\ellclass{\functionii}{\measure}} 
=
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\bigl(\expval{\ellclass{\functionii}{\measure}}\bigr).
\]
\end{prop}


\begin{proof}
This is nothing more imaginative than wading through the definitions of independence,
and showing that the equality holds for step functions. Then use the continuity of the integral by recalling that the equivalence classes of step functions are norm dense in 
$L_1(\measurespace, \semiring,\measure)$.
For example, let 
$\function = a\charfunction{\seti} + b\charfunction{\setii}$ and 
$\functionii = c\charfunction{\setiii} + d\charfunction{\setiv}$ be independent with respect to $\measure^*$,
where we suppose $\seti$, $\setii$, $\setiii$, and $\setiv$ to be disjoint and $\measure^\kernast$-measurable sets of finite measure. Then
\begin{align*}
\function\functionii 
& =
(a\charfunction{\seti} + b\charfunction{\setii})
(c\charfunction{\setiii} + d\charfunction{\setiv}) \\
& = ac\charfunction{\seti\meets\setiii}
+ ad\charfunction{\seti\meets\setiv}
+ bc\charfunction{\setii\meets\setiii}
+ bd\charfunction{\setii\meets\setiv},
\end{align*}
and so 
\begin{align*}
\int fg 
& = ac\measure^*(\seti\meets\setiii)
+ ad\measure^*(\seti\meets\setiv)
+ bc\measure^*(\setii\meets\setiii)
+ bd\measure^*(\setii\meets\setiv)\\
& = ac\measure^*(\seti)\measure^*(\setiii)
+ ad\measure^*(\seti)\measure^*(\setiv)
+ bc\measure^*(\setii)\measure^*(\setiii)
+ bd\measure^*(\setii)\measure^*(\setiv)\\
& = \bigl(a\measure^*(\seti) + b\measure^*(\setii)\bigr)
\bigl(c\measure^*(\setiii) + d\measure^*(\setiv)\bigr) \\
& = \int \function \int \functionii.
\end{align*}
\end{proof}




\section{Strong Law of Large Numbers}
%*********************************************************
%*********************************************************
\begin{thmboldnote}[Strong Law of Large Numbers]\index{strong law of large numbers}\label{large_numbers}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a probability space, and let
$\{\function, \function_1,\function_2,\ldots\}$ be a collection of functions in  $\cali{L}_1(\measurespace,\sigmaalgebra,\measure)$. Define the subset
\[
\seti \definedby
\left\{ \mspaceelt\in\measurespace : 
\frac{(\function_1 + \cdots + \function_n)(\mspaceelt)}{n}
\to 
\int_\measurespace \function \, d\measure
\right\}.
\]
If the $\function_i$ are independent and all have the same probability distribution as $\function$, then 
$\measure(\seti) = 1$.
\end{thmboldnote}


\section{Sampling}
%*********************************************************
%*********************************************************
There are some terms we will not even try to define for now.
Terms like \emph{draw}, or \emph{sample}, or even \emph{random}. Especially \emph{random}.



\begin{prop}\label{sampling}
Let $(\measurespace,\sigmaalgebra,\measmu)$ be a probability space, and let 
$(\measurespaceii,\sigmaalgebraii,\measnu)$ be \textsigma-finite.
Also let
$\{ \funch_i:\measurespace\to\measurespaceii \}$ be a collection of 
$(\sigmaalgebra,\sigmaalgebraii)$\hyp{}measurable functions.
If the $\funch_i$ are independent, and if the probability distributions of the 
$\funch_i$ all have the same density function 
$\funcf$ 
with respect to the measure $\measnu$,
and if 
$\funcg\in
\cali{L}_1(\measurespaceii,\sigmaalgebraii,\measmu\circ\preimage{\funch_i})$,
then the subset of $\measurespace$ defined by
\[
\seti \definedby
\left\{ 
\mspaceelt\in\measurespace : 
\frac{1}{n} \sum_{i=1}^n \bigl( \functionii\circ \functioniii_i \bigr) (x) 
\to
\int_\measurespaceii \functionii \function \,d\measnu 
\right\}
\]
has $\measure(\seti) = 1$.
\end{prop}

\begin{proof}
Let the $\funch_i$ be independent, and let the probability distributions 
$\measure\circ\preimage{\funch_i}$
of the $\funch_i$ all have the same density function $\function$ with respect to 
$\measnu$ on $\sigmaalgebraii$, and let 
$\funcg\in
\cali{L}_1(\measurespaceii,\sigmaalgebraii,\measmu\circ\preimage{\funch_i})$.
We will use the strong law of large numbers to show that the $\measure$-measure of the subset
\[
\left\{ 
\mspaceelt\in\measurespace : 
\frac{1}{n} \sum_{i=1}^n \bigl( \funcg \circ \funch_i \bigr) (x) \to
\int_\measurespace (\funcg \circ \funch_1) \,d\measure 
\right\}
\]
is $1$, and to complete the proof we will note that
\[
\int_\measurespace (\funcg \circ \funch_1) \,d\measure
=
\int_\measurespaceii \funcg \funcf \,d\measnu.
\]


For the probability distributions 
$\measure\circ\preimage{\funch_i}$
of the $\funch_i$ to have the same density function 
$\funcf$ in $\cali{L}_1(\measurespaceii,\sigmaalgebraii,\measnu)$ 
with respect to  $\measnu$ on $\sigmaalgebraii$ means
\[
(\measmu\circ\preimage{\funch_i})(\setii)
=
\int_\setii \funcf\, d\measnu
\quad\text{for all $\setii\in\sigmaalgebraii$,}
\]
as somewhat illustrated:
\[
\xymatrix@R=18pt{
\measurespace \ar[r]^{\funch_i} 
& \measurespaceii \ar[r]^{\funcf} 
& \R \\
}
\quad
\xymatrix@R=18pt@C=30pt{
[0,1]
& \sigmaalgebra 
\ar[l]^-\measmu
& \sigmaalgebraii
\ar[l]^{\preimage{\funch_i}} 
\ar@/_12pt/[ll]_-{\measmu\,\circ\,\preimage{\funch_i}}
}
\]

The collection 
$\{
\funcg\circ\funch_i
\}$
of functions are independent with respect to $\measmu$
by Proposition~\ref{independent_compositions}.
By hypothesis
$\funcg\in
\cali{L}_1(\measurespaceii,\sigmaalgebraii,\measmu\circ\preimage{\funch_i})$,
and so by Proposition~\ref{change_of_variable}, each
$\funcg\circ\funch_i
\in
\cali{L}_1(\measurespace, \sigmaalgebra, \measmu)$.
To show that the collection 
$\{
\functionii\circ\functioniii_i
\}$
of functions all have the same probability distribution as $\functionii\circ\functioniii_1$, 
see first that the 
$\measure\circ \preimage{\functioniii_i} = \measure\circ\preimage{\functioniii_1}$ since by hypothesis the 
$\measure\circ \preimage{\functioniii_i}$ all have the same density function with respect to 
$\measureiii$:
\[
\measure\circ \preimage{\functioniii_i} (\setii) 
=
\int_\setii \function\, d\measureiii
=
\measure\circ \preimage{\functioniii_1} (\setii) 
\quad\text{for all $\setii\in\borel_\R$.}
\]
See next that the $\{
\functionii\circ\functioniii_i
\}$
all have the same probability distribution as $\funcg\circ\funch_1$ since
\begin{align*}
\measure\circ \preimage{(\functionii \circ\functioniii_i)}
& = \measure\circ(\preimage{\functioniii_i}\circ\preimage{\functionii}) \\
& = (\measure\circ\preimage{\functioniii_i})\circ\preimage{\functionii} \\
& = (\measure\circ\preimage{\functioniii_1})\circ\preimage{\functionii} \\
& = \measure\circ \preimage{(\functionii \circ\functioniii_1)}.
\end{align*}
Since the collection 
$\{
\functionii\circ\functioniii_i
\}$
of
$\cali{L}_1(\measurespace, \sigmaalgebra, \measure)$
functions are independent with respect to the measure $\measure$, and they all have the same probability distribution as
$\functionii\circ\functioniii_1$, it follows by the strong law of large numbers, Theorem~\ref{large_numbers}, that the subset 
\[
\seti\definedby
\left\{ 
\mspaceelt\in\measurespace : 
\frac{1}{n} \sum_{i=1}^n \bigl( \functionii\circ \functioniii_i \bigr) (x) \to
\int_\measurespace (\functionii \circ \functioniii_1) \,d\measure 
\right\}
\]
of $\measurespace$ has $\measure(\seti)=1$. 


Finally, let us note that
\[
\int_\measurespace (\funcg \circ \funch_1) \, d \measmu
=
\int_\measurespaceii \funcg \funcf \, d\measnu
\]
by Proposition~\ref{combine},
which completes the proof.
\end{proof}






\chapter{Conditional Mathematical Expectation}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************

\lettrine{C}{onditional} mathematical expectation is not difficult to define, but there \emph{seems} to be a subtlety in the proof of its existence, especially when it comes to applying the Radon-Nikodym theorem.

We are supposing that the `$\sigmaalgebra$' in any probability space $(\measurespace, \sigmaalgebra,\measure)$ is a
$\textsigma$-algebra, as opposed to merely a semi-ring.
The reason for supposing this is because the Radon-Nikodym theorem applies to measurable spaces.


\begin{defnboldnote}
\label{cme_sigma_algebra}
\index{conditional expectation with respect to a sigma algebra@conditional expectation with respect to a $\textsigma$-algebra}
%Do \nomenclature[prefix]{symbol}{description}
%where prefix is used to order the symbol in the Nomenclature list.
\nomenclature[conditional expectation a]{$\condexpsub{{\lebclass{\funcf}}}{\sigmaalgebraii}$}{conditional expectation in $L_1(\measurespace, \sigmaalgebra,\measure)$}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space.
For each class
$\lebclass{\function}$ in $L_1(\measurespace, \sigmaalgebra,\measure)$,
the \textbf{conditional mathematical expectation}
$\condexpsub{{\lebclass{\funcf}}}{\sigmaalgebraii}$
of $\lebclass{\funcf}$
with respect to the \textsigma-algebra
$\sigmaalgebraii$, or simply the \emph{conditional expectation} of
$\lebclass{\function}$ with respect to $\sigmaalgebraii$,
is the unique class in
$L_1(\measurespace, \sigmaalgebra,\measure)$
having a $(\sigmaalgebraii,\borel_\R)$\hyp{}measurable representative function
$\funcg$
such that
%
\[
\int_\setii \function\, d\measure 
= 
\int_\setii \functionii\, d\measure 
\quad\text{for all $\setii \in \sigmaalgebraii$}.
\]
\end{defnboldnote}






\begin{thm}\label{existence_of_conditional}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space, with
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$. For every $\textsigma$-sub\-algebra $\sigmaalgebraii$ of $\sigmaalgebra$ there exists a unique class in
$L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
having a
$(\sigmaalgebraii, \borel_\R)$\hyp{}measurable representative function
$\funcg$
such that
%
\[
\int_B \function\, d\measure = \int_B \functionii\, d\measure\restrictedto{\sigmaalgebraii} 
\quad\text{for all $B \in \sigmaalgebraii$.}
\]
%
\end{thm}


\begin{proof}
The existence of such a  class is an application of the Radon-Nikodym theorem, and to see this, let $\measureii\restrictedto{\sigmaalgebraii}$ denote the restriction of the indefinite integral $\measureii$ of $\ellclass{\function}{\measure}$ to the $\textsigma$-subalgebra $\sigmaalgebraii$, which means that $\measureii\restrictedto{\sigmaalgebraii} :\sigmaalgebraii\to\R$ is defined by
\[
\measureii\restrictedto{\sigmaalgebraii}(B) 
=
\int_B \function\, d\measure
\quad\text{for all $B\in\sigmaalgebraii$.}
\]
The set function $\measureii\restrictedto{\sigmaalgebraii}$ is a finite signed measure that is absolutely continuous with respect to the $\textsigma$-finite measure $\measure\restrictedto{\sigmaalgebraii}$ on $\sigmaalgebraii$, and so by the Radon-Nikodym Theorem~\ref{radon-nikodym} there is a unique class
$\ellclass{\functionii}{\measure\restrictedto{\sigmaalgebraii}}$ in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
such that
\[
\measureii\restrictedto{\sigmaalgebraii}(B) 
= 
\int_B \functionii \, d\measure\restrictedto{\sigmaalgebraii}
\quad\text{for all $B\in\sigmaalgebraii$,}
\]
where the representative function $\functionii$ may be taken to be $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable,
which completes the proof.
\end{proof}  



\begin{defn}\label{cme_sigmaalgebra}
%Do \nomenclature[prefix]{symbol}{description}
%where prefix is used to order the symbol in the Nomenclature list.
\nomenclature[conditional expectation b]
{$\kondexpsub{{\lebclass{\funcf}}}{\sigmaalgebraii}$}
{conditional expectation in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space, and let
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
By Theorem~\ref{existence_of_conditional},
for each $\textsigma$-sub\-algebra $\sigmaalgebraii$ of $\sigmaalgebra$ there is a unique class, 
which may be denoted by 
$\kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}$ or 
$\kondexpgvn{\ellclass{\function}{\measure}}{\sigmaalgebraii}$,
in $L_1\bigl(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii}\bigr)$
having a $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable representative
such that
%
\[
\int_B \function\, d\measure 
= 
\inducedint_B \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii} 
\quad\text{for all $B \in \sigmaalgebraii$.}
\]
The class $\kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}$ is the
\textbf{conditional expectation} of
$\ellclass{\function}{\measure}$
with respect to the $\textsigma$\hyp{}subalgebra $\sigmaalgebraii$. This defines an operator:
\[
\kondexpop\nolimits_{\sigmaalgebraii}
:
L_1(\measurespace, \sigmaalgebra,\measure) \to
L_1\bigl(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii}\bigr):
\ellclass{\function}{\measure}\mapsto \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}.
\]
The fact that
\[
\inducedint_\measurespace{\ellclass{\function}{\measure}}\, d\measure
= \int_\measurespace \function\, d\measure
= \inducedint_\measurespace \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii}
\]
implies that the operator $\kondexpop\nolimits_{\sigmaalgebraii}$ has norm 1.
\end{defn}



\begin{notn}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space.
Let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space, and let $\functionii:\measurespace\to\measurespaceii$ be any function, where $\preimage{\functionii}:\sigmaalgebraii\to\powerset(\measurespace)$,
with the qualification that in case no $\textsigma$-algebra $\sigmaalgebraii$ is supplied, we take $\sigmaalgebraii$ to be the powerset $\powerset(\measurespaceii)$ of $\measurespaceii$. 
Let $\sigmaalgebra^{(\functionii)}$ denote the $\textsigma$-subalgebra of $\sigmaalgebraii$ consisting of those sets in $\sigmaalgebraii$ whose preimages under $\functionii$ lie in $\sigmaalgebra$:
\[
\sigmaalgebra^{(\functionii)}
=
\{ B\in \sigmaalgebraii : \preimage{\functionii}(B)\in \sigmaalgebra \} 
\subseteq \sigmaalgebraii.
\]
The $\textsigma$-subalgebra
\[
\sigalg{G}\definedby
\preimage{\functionii}(\sigmaalgebraii)\meets\sigmaalgebra
\]
is comprised of the preimages under $\functionii$ of the sets in $\sigmaalgebra^{(\functionii)}$:
\[
\sigalg{G}
=
\bigl\{ \preimage{\functionii}(B) : B \in \sigmaalgebra^{(\functionii)} \bigr\} 
\subseteq \sigmaalgebra.
\]
Consequently, the function $\functionii$ is
$\bigl(\sigalg{G}, \sigmaalgebra^{(\functionii)}\bigr)$\hyp{}measurable. Furthermore, the function defined by
\[
\preimage{\functionii}:\sigmaalgebra^{(\functionii)} 
\twoheadrightarrow
\sigalg{G}:
C \mapsto \preimage{\functionii}(C)
\]
is surjective.
\end{notn}

In Definition~\ref{cme_sigmaalgebra}, we looked at the conditional mathematical expectation of a class defined with respect to a \textsigma\hyp{}algebra.  But a function can also define a
\textsigma\hyp{}algebra, and we now look at that case.


\begin{defn}\label{cme_function}
\index{conditional expectation given a function@conditional expectation given a function}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space, and let
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
Let $(\measurespaceii, \sigmaalgebraii)$ be a measurable space, and let $\functionii:\measurespace\to\measurespaceii$ be any function, where $\preimage{\functionii}:\sigmaalgebraii\to\powerset(\measurespace)$.
Set
\[
\sigalg{G}
=
\preimage{\functionii}(\sigmaalgebraii)\meets\sigmaalgebra.
\]
Then the class 
$\kondexpgvn{\ellclass{\function}{\measure}}{\sigalg{G}}$
in
$L_1\bigl(\measurespace, \sigalg{G},\measure\restrictedto{\sigalg{G}}\bigr)$, 
which may also be denoted by
$\kondexpgvn{\ellclass{\function}{\measure}}{\functionii}$, is the \emph{conditional mathematical expectation of} $\ellclass{\function}{\measure}$ \emph{given the function} $\functionii$, or simply the \emph{conditional expectation} of $\ellclass{\function}{\measure}$ given $\functionii$.
We use this definition of $\kondexpgvn{\ellclass{\function}{\measure}}{\functionii}$ because it is precisely the definition of conditional mathematical expectation as set down in Kolmogorov~\cite{fottop_kolmogorov_1956}. 

In what follows, the fact that 
$(\measure\restrictedto{\sigalg{G}})
\circ\preimage{\functionii}
=
(\measure\circ\preimage{\functionii})\restrictedto{\sigmaalgebra^{(\functionii)}}$ will be used.
By Proposition~\ref{factoring_functions}, there is a unique class 
\[
r + 
\cali{N}_1
\bigl(
\measurespaceii, \sigmaalgebra^{(\functionii)}, 
(\measure\circ\preimage{\functionii})\restrictedto{\sigmaalgebra^{(\functionii)}}
\bigr)
\
\in
\
L_1
\bigl(
\measurespaceii, \sigmaalgebra^{(\functionii)}, 
(\measure\circ\preimage{\functionii})\restrictedto{\sigmaalgebra^{(\functionii)}}
\bigr)
\] 
with 
\begin{align*}
\kondexpgvn{\ellclass{\function}{\measure}}{\functionii}
& =
r\circ \functionii + 
\cali{N}_1\bigl(
\measurespace, 
\sigalg{G},
\measure\restrictedto{\sigalg{G}}
\bigr) \\
& =
\ellclass{r \circ \functionii}{\measure\restrictedto{\sigalg{G}}}
\end{align*}
and with the representative  $r$ being an $(\sigmaalgebra^{(\functionii)},\borel_\R)$\hyp{}measurable function,
as illustrated in the following diagram, letting the function $e$ be any representative of the class 
$\kondexpgvn{\ellclass{\function}{\measure}}{\functionii}$:
\[
\begin{gathered}
\xymatrix@R=16pt@C=30pt{ 
(\measurespace, \sigmaalgebra) 
\ar[r]^-{\function} 
& 
(\R, \borel_\R) 
\\
\bigl(\measurespace, \sigalg{G} \bigr) 
\ar[r]^-{e} 
\ar[dr]_{\functionii}
&
(\R,\borel_\R)  
\\
&
(\measurespaceii, \sigmaalgebra^{(\functionii)}) 
\ar@{.>}[u]_{r}
\\
}
\end{gathered}
\quad
\text{meaning}
\quad
\kondexpgvn{\ellclass{\function}{\measure}}{\functionii} 
= 
\ellclass{r \circ \functionii}{\measure\restrictedto{\sigalg{G}}}
\]
Call the induced function $r$ the \term{regression function}.
\end{defn}


\begin{discussion}
In a special case of Definition~\ref{cme_function}, if the function $\functionii:\measurespace\to\measurespaceii$ is known to be $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable, then 
\[
\sigmaalgebra^{(\functionii)} = \sigmaalgebraii
\]
and
\[
\sigalg{G}
= \preimage{\functionii}(\sigmaalgebraii).
\]
In this case, the conditional expectation
$\kondexpgvn{\ellclass{\function}{\measure}}{\functionii}$ 
of 
$\ellclass{\function}{\measure}$ given the function $\functionii$ denotes the same class as the conditional expectation 
$\kondexpsub{\ellclass{\function}{\measure}}{\sigalg{G}}$ of 
$\ellclass{\function}{\measure}$ with respect to the \textsigma-algebra $\sigalg{G}$.
\end{discussion}




\begin{defn}\label{conditional_expectation_operator}
Let $\sigmaalgebraii$ be a \textsigma-subalgebra of $\sigmaalgebra$. The following defines a contractive operator:
\[
\kondexpop\nolimits_{\sigmaalgebraii}
:
L_1(\measurespace, \sigmaalgebra,\measure) \to
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii}).
\]
By Proposition~\ref{integral_over_subalgebra}, there is another contractive operator:
\[
\L1embedding :
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})
\rightarrowtail
L_1(\measurespace, \sigmaalgebra,\measure )
:
\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}
\mapsto
\ellclass{\function}{\measure}.
\]
Define the \term{conditional expectation operator} 
\[
\condexpop{\sigmaalgebraii}:L_1(\measurespace, \sigmaalgebra,\measure)\to L_1(\measurespace, \sigmaalgebra,\measure)
\]
to be their composition $\L1embedding\circ\kondexpop_{\sigmaalgebraii}$:
\[
\xymatrix@R=16pt{ 
L_1(\measurespace, \sigmaalgebra,\measure )
\ar[r]^-{\condexpop{\sigmaalgebraii}} 
\ar[dr]_{\kondexpop\nolimits_{\sigmaalgebraii}}
&
L_1(\measurespace, \sigmaalgebra,\measure ) 
\\
&
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\ar@{>->}[u]_{\L1embedding}
\\
}
\]
\end{defn}



%*********************************************************
%*********************************************************
\section{Fundamental Properties}
%


\begin{prop}\label{L1embedding}
The map $\L1embedding$  preserves the integral, meaning if\,
$\ellclass{\functionii}{\measure} \in L_1(\measurespace, \sigmaalgebra,\measure)$, then
\[
\inducedint_B \condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}\, d\measure
=
\inducedint_B \kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii}
\quad\text{for all $B \in \sigmaalgebraii$.}
\]
\end{prop}

\begin{rmk}
For each class $\ellclass{\functionii}{\measure}$ in $L_1(\measurespace, \sigmaalgebra,\measure)$, the class
$\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}$ in $L_1(\measurespace, \sigmaalgebra,\measure)$ has a $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable representative, and to see this,
say the function 
$e\in \cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$ 
is the $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable representative of the class
$\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}$, as in Definition~\ref{cme_sigmaalgebra}. 
This means 
$\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii} = \ellclass{e}{\measure\restrictedto{\sigmaalgebraii}}.$
Then the equalities
\[
\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii} 
=
\L1embedding\bigl(\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}\bigr)
=
\L1embedding \bigl(\ellclass{e}{\measure\restrictedto{\sigmaalgebraii}}\bigr)
=
\ellclass{e}{\measure}
\]
show that $\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}$ 
also has the function $e$, as included in 
$\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$, as a $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable representative. You may recall the inclusion 
$\cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})
\subseteq 
\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$
of Discussion~\ref{L1_subspace_embedding}.
\end{rmk}




\begin{prop}\label{conditional_expectation_operator_linear}
Let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$.
The conditional expectation operator 
\[
\condexpop{\sigmaalgebraii}:
L_1 (\measurespace, \sigmaalgebra,\measure)\to
L_1 (\measurespace, \sigmaalgebra,\measure):
\ellclass{\function}{\measure} \mapsto 
\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\]
is positive, linear, and contractive.
\end{prop}




\begin{quoting}
\small
The correct and complete proof of the functional equation 
\[
\expval{\ellclass{\function}{\measure}}
= 
\expvalof{\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}}
\]
in the following proposition took some effort, as tracing back through at least Proposition~\ref{integral_over_subalgebra}, shows.
Let my early and admittedly naive attempts to try to simply throw a monotone convergence theorem at this proposition at least bring a  smile to your face. Of course there was more to it.
\end{quoting}



\begin{prop}\label{equality_of_expected_values}
If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$, then
\[
\int_\measurespace \funcf \, d\measure
= 
\inducedint_\measurespace \condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\,d\measure
\]
for all classes $\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
Alternately,
\[
\expval{\ellclass{\function}{\measure}}
=
\expvalof{\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}}.
\]
\end{prop}


\begin{proof}
Let $\sigmaalgebraii$ be a \textsigma\hyp{}subalgebra of $\sigmaalgebra$.
Let $\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
By definition of conditional mathematical expectation, we know that 
\[
\int_B \function\, d\measure 
= 
\inducedint_B \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii}
\]
for all $B \in \sigmaalgebraii$,
and by taking $B = \measurespace$, it follows that
\[
\int_\measurespace \function\, d\measure 
= 
\inducedint_\measurespace \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii}.
\]
By Proposition~\ref{L1embedding},
\[
\inducedint_\measurespace \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii}
=
\inducedint_\measurespace 
\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}
\, d\measure.
\]
It follows by transitivity of equality that
\[
\int_\measurespace \function\, d\measure 
= 
\inducedint_\measurespace \condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\, d\measure,
\]
which means 
$\expval\ellclass{\function}{\measure} = 
\expvalof{\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}}$,
as required.
\end{proof}


\begin{prop}\label{L1_subalgebra_fixed}
If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$,
then 
\[
\kondexpsub{\L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}) }{\sigmaalgebraii}
=
\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}
\]
for all classes
$\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}
\in
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
\end{prop}

\begin{proof}
From the definition of conditional mathematical expectation: 
if
$\L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}})$
in 
$L_1(\measurespace, \sigmaalgebra,\measure)$,
there is a unique class 
$\kondexpsub{\L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}) }{\sigmaalgebraii}$
in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$ such that
%
\[
\inducedint_B \L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}})\, d\measure 
= 
\inducedint_B \kondexpsub{\L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}})}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii} 
\quad\text{for all $B \in \sigmaalgebraii$.}
\]
It follows by Proposition~\ref{integral_over_subalgebra} that
\[
\inducedint_B \L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}})\, d\measure 
= 
\inducedint_B \ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}\, d\measure\restrictedto{\sigmaalgebraii} 
\quad\text{for all $B \in \sigmaalgebraii$.}
\]
By uniqueness, 
$\kondexpsub{\L1embedding(\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}) }{\sigmaalgebraii}
=
\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}$,
completing the proof.
\end{proof}



\begin{rmk}
Proposition~\ref{L1_subalgebra_fixed} says that the following diagram commutes:
\[
\xymatrix@R=24pt@C40pt{ 
L_1(\measurespace, \sigmaalgebra,\measure )
\ar[dr]^{\kondexpop\nolimits_{\sigmaalgebraii}}
\\
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\ar[r]^{\text{identity}}
\ar@{>->}[u]^{\L1embedding}
&
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\\
}
\]
which is part of a larger commutative diagram:
\[
\xymatrix@R=24pt@C=40pt{ 
L_1(\measurespace, \sigmaalgebra,\measure )
\ar[r]^-{\condexpop{\sigmaalgebraii}} 
\ar[dr]^{\kondexpop\nolimits_{\sigmaalgebraii}}
&
L_1(\measurespace, \sigmaalgebra,\measure ) 
\\
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\ar[r]^{\text{identity}}
\ar@{>->}[u]^{\L1embedding}
&
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\ar@{>->}[u]_{\L1embedding}
\\
}
\]
\end{rmk}





%*********************************************************
%*********************************************************
\section{Averaging Properties}
%




\begin{defn}
Let $(\measurespace, \semiring, \measure)$ be a measure space.  A $\measure^\kernast$-measurable set $A$ with $\measure^*(A)>0$ is called an \term{atom} of $(\measurespace, \semiring, \measure)$ if for every $\measure^\kernast$-measurable subset $B$ of $A$ either $\measure^*(B) = 0$, or $\measure^*(A\meets B\comp)=0$. 
\end{defn}



\begin{prop}\label{atom}
Let $(\measurespace, \semiring, \measure)$ be a finite measure space.  A
$\measure^\kernast$\hyp{}measurable set $A$ with $\measure^*(A)>0$ is an atom of $(\measurespace, \semiring, \measure)$ if for every $\measure^\kernast$-measurable subset $B$ of $A$ either $\measure^*(B) = \measure^*(A)$, or $\measure^*(A\meets B\comp)= \measure^*(A)$.
\end{prop}



\begin{rmk}
If the measure space $(\measurespace, \semiring, \measure)$ is not finite, then the condition that either $\measure^*(B) = \measure^*(A)$, or $\measure^*(A\meets B\comp)= \measure^*(A)$
is not strong enough to imply the condition that
either $\measure^*(B) = 0$, or $\measure^*(A\meets B\comp)=0$. 
\end{rmk}



\begin{prop}\label{countable_partition_of_atoms}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space.
Let $\sigalgb$ denote the $\textsigma$-subalgebra of $\sigmaalgebra$ generated by a countable partition $\{B_i\}$ of $\measurespace$, where each set $B_i\in\sigmaalgebra$. Then every set $B_i$ with 
$\measure(B_i) > 0$ is an atom of the probability space
$(\measurespace, \sigalgb,\measure\restrictedto{\sigalgb})$.
\end{prop}

\begin{proof} 
Let us suppose that the set $B_1$ has $\measure(B_1)> 0$, and let us show that this implies $B_1$ is an atom of
$(\measurespace, \sigalgb,\measure\restrictedto{\sigalgb})$.
We first need to show both that $B_1$ is a $\Psubstar{\sigalgb}$-measurable set, and that $\Psubstar{\sigalgb}(B_1)>0$. We then need to show (by Proposition~\ref{atom}) that if $A$ is a $\Psubstar{\sigalgb}$-measurable subset of $B_1$, then either $\Psubstar{\sigalgb}(A) = \Psubstar{\sigalgb}(B_1)$, 
or 
$\Psubstar{\sigalgb}(B_1\meets A\comp) = \Psubstar{\sigalgb}(B_1)$. 

First, by Proposition~\ref{semiring_measurable}, we know that 
$\sigalgb\subseteq \measurable{\Psubstar{\sigalgb}}$, and since $B_1\in \sigalgb$, it follows that $B_1$ is a $\Psubstar{\sigalgb}$-measurable subset of $\measurespace$. Also, by Proposition~\ref{measurable_inclusion}  and Proposition~\ref{extension_from_semiring}, we know that 
$\measure(B_1) = 
\measure\restrictedto{\sigalgb}(B_1) =
\Psubstar{\sigalgb}(B_1)$, and so $P(B_1) > 0$ means that  
$\Psubstar{\sigalgb}(B_1) > 0$.

Next, let $A$ be a $\Psubstar{\sigalgb}$-measurable subset of $B_1$. We need to see that either $\Psubstar{\sigalgb}(A) = \Psubstar{\sigalgb}(B_1)$,
or 
$\Psubstar{\sigalgb}(B_1\meets A\comp) = \Psubstar{\sigalgb}(B_1)$. Should $A$ be empty, then $B_1\meets A\comp = B_1$, and so 
$\Psubstar{\sigalgb}(B_1\meets A\comp) = \Psubstar{\sigalgb}(B_1)$, rather vacuously.
Suppose then that $A$ is non-empty, and let us see that this implies 
$\Psubstar{\sigalgb}(A) = \Psubstar{\sigalgb}(B_1)$.
Let us determine $\Psubstar{\sigalgb}(A)$ by tending to the definition:
\begin{align*}
& \Psubstar{\sigalgb}(A) = \\
& \quad \inf \left\{
\sum_{n=1}^{\infty}
\measure\restrictedto{\sigalgb}(A_n) : 
\text{$\{A_n\}$ is a sequence of $\sigalgb$ with $A\subseteq\bigcup_{n=1}^{\infty} A_n$}
\right\}.
\end{align*}
If $\{A_n\}$ is a sequence of $\sigalgb$ with $A\subseteq\bigcup_{n=1}^{\infty} A_n$, then because $\sigalgb$ is generated by a countable collection of disjoint sets $B_i$, we may assume that each of the $A_n$ is either empty, or equal to one of the $B_i$. Furthermore, since $A$ is non-empty, at least one of the $A_n$ must equal $B_1$ in order that $A\subseteq\bigcup_{n=1}^{\infty} A_n$. This means that for any sequence, $\{C_n\}$ say, of $\sigalgb$ where exactly one of the $C_n$ is equal to $B_1$ and the rest of the $C_n$ are empty, we must have 
\[
\sum_{n=1}^{\infty}
\measure\restrictedto{\sigalgb}(C_n)
\leq 
\sum_{n=1}^{\infty}
\measure\restrictedto{\sigalgb}(A_n)
\]
if $\{A_n\}$ is an arbitrary sequence of $\sigalgb$ with $A\subseteq\bigcup_{n=1}^{\infty} A_n$. And
$\sum_{n=1}^{\infty}
\measure\restrictedto{\sigalgb}(C_n) 
=\measure\restrictedto{\sigalgb}(B_1) 
= \Psubstar{\sigalgb}(B_1)$. So
$\Psubstar{\sigalgb}(B_1)$ is a lower bound for the set
\[
\left\{
\sum_{n=1}^{\infty}
\measure\restrictedto{\sigalgb}(A_n) : 
\text{$\{A_n\}$ is a sequence of $\sigalgb$ with $A\subseteq\bigcup_{n=1}^{\infty} A_n$}
\right\}.
\]
But $\Psubstar{\sigalgb}(A)$ is the greatest such lower bound, so 
$\Psubstar{\sigalgb}(A) 
\geq 
\Psubstar{\sigalgb}(B_1)$.
On the other hand, $A\subseteq B_1$, so $\Psubstar{\sigalgb}(A) 
\leq 
\Psubstar{\sigalgb}(B_1)$.
It follows then that $\Psubstar{\sigalgb}(A) 
= 
\Psubstar{\sigalgb}(B_1)$, completing the proof.
\end{proof}







\begin{lemma}\label{atom_lemma}
If $\function:\measurespace\to\R$ is an $(\sigmaalgebra, \borel_\R)$-simple function, then $\function$ is constant 
$\Pstar$-almost everywhere
on each atom of the probability space $(\measurespace, \sigmaalgebra,\measure)$.
\end{lemma}

\begin{proof}
Let $\function:\measurespace\to\R$ be an $(\sigmaalgebra, \borel_\R)$-simple function, meaning that $\function$ is a $(\sigmaalgebra,\borel_\R)$\hyp{}measurable function having finite range. Suppose the range of $\function$ to be $\{a_1,\ldots,a_n\}\subseteq\R$. If $n=1$, then $\function$ is certainly constant since $\function=a_1$ on $\measurespace$, so suppose $n>1$.  Define subsets 
$A_i\subseteq\measurespace$ to be the preimages $\preimage{\function}(a_i)$.  
Let $A$ be an atom of $(\measurespace, \sigmaalgebra,\measure)$. 
The subsets $\{A_i\}$ partition $\measurespace$, and so the atom $A$ can be written as the disjoint union 
$\bigcup_{i=1}^n(A_i\meets A)$, where
\newcommand{\asubimeetsa}{A_i\meets A}
each $\asubimeetsa$ is a $\Pstar$-measurable subset of $A$. 
Since $\Pstar$ is $\textsigma$-additive on the $\Pstar$-measurable subset of $A$ (by Proposition~\ref{restricted_outer_measure}), it follows that 
$\Pstar(A)=\sum_{i=1}^n\Pstar(\asubimeetsa)$.
Because $A$ is an atom, it follows (by Proposition~\ref{atom}) that for each $A_i$, either $\Pstar(\asubimeetsa)=\Pstar(A)$, or 
$\Pstar\bigl(\bigcup_{j\neq i}(A_j\meets A)\bigr) = \Pstar(A)$.
Let us argue that $\Pstar(A) = \Pstar(\asubimeetsa)$ for exactly one of the $A_i$, for it will then follow that $\function = a_i$ $\Pstar$-almost everywhere on $A$.

Should $\Pstar(A) = \Pstar(\asubimeetsa)$ for at least two of the $A_i$; say for $A_1$ and $A_2$, we would then have
\[
\Pstar(A)=\sum_{i=1}^n \Pstar(\asubimeetsa)
\geq
\Pstar(A_1\meets A) + \Pstar(A_2\meets A)
=
2\cdot\Pstar(A),
\]
which could only happen were $\Pstar(A)=0$. But $\Pstar(A)>0$, by assumption.

Should $\Pstar(A) \neq \Pstar(\asubimeetsa)$ for any of the $A_i$, then 
$\Pstar\bigl(\bigcup_{j\neq i}(A_j\meets A)\bigr) = \Pstar(A)$ for each $A_i$, and so
\begin{align*}
\Pstar(A)
& = \Pstar\left((\asubimeetsa)
\cup
\bigl({\textstyle{\bigcup_{j\neq i}}}(A_j\meets A)\bigr)\right)\\
& = \Pstar(\asubimeetsa)
+
\Pstar\bigl( {\textstyle{\bigcup_{j\neq i}}}(A_j\meets A) \bigr)\\
& = \Pstar(\asubimeetsa) + \Pstar(A),\\
\end{align*}
meaning $\Pstar(\asubimeetsa) = 0$ for each $i$. This would imply that $\Pstar(A) = 0$ because 
$\Pstar(A)=\sum_{i=1}^n\Pstar(\asubimeetsa)$. But $\Pstar(A)>0$ by assumption.

Conclude that $\Pstar(A) = \Pstar(\asubimeetsa)$ for exactly one of the $A_i$, so $\Pstar(A_j\meets A)=0$ for $j\neq i$, and consequently $\function=a_i$ $\Pstar$-almost everywhere on $A$, completing the proof.
\end{proof}



\begin{prop}\label{constant_on_the_atoms}
If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$, and if  $\function:\measurespace\to\R$ is a $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable function, then $\function$ is constant $\Psubstar{\sigalgb}$-almost everywhere on each atom of 
the probability space
$(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$. 
\end{prop}

\begin{proof}
Let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$, and let $\function:\measurespace\to\R$ be $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable. Also, let $B$ be an atom of $(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.  By Proposition~\ref{measurable_equivalent_simple_function_limit}, there is a sequence $\{\function_n\}$ of $(\sigmaalgebraii, \borel_\R)$-simple functions on $\measurespace$ such that 
$\lim  \function_n(\mspaceelt) = \function(\mspaceelt)$ for all $\mspaceelt\in\measurespace$. Because the $\function_n$ converge to $\function$ on $\measurespace$, and because  each $\function_n$ is constant $\Psubstar{\sigalgb}$-almost everywhere on $B$ (by Lemma~\ref{atom_lemma}), it follows that $\function$ is constant $\Psubstar{\sigalgb}$-almost everywhere on $B$, as required.
\end{proof}



\begin{discussion}
If $e\in\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$, and if $B\in\sigmaalgebra$ so that $\charfunction{B}\in\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$, and if the product of functions
$e\charfunction{B}$ is in $\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$
so that the class $\ellclass{e\charfunction{B}}{\measure}$ is in 
$L_1(\measurespace, \sigmaalgebra,\measure)$, then the product 
$\ellclass{e}{\measure}\ellclass{\charfunction{B}}{\measure}$ 
of classes is defined to be the class 
$\ellclass{e\charfunction{B}}{\measure}$ in 
$L_1(\measurespace, \sigmaalgebra,\measure)$.
Should the function $e$ be any representative of the class 
$\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}$, 
then $\ellclass{e}{\measure} = \condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}$
and so  
$\ellclass{e}{\measure}\ellclass{\charfunction{B}}{\measure} 
=
(\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii})\ellclass{\charfunction{B}}{\measure}$ 
in $L_1(\measurespace, \sigmaalgebra,\measure)$.
\end{discussion}



\begin{prop}\label{value_on_the_atoms}
Let $\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$, and if $B$ is an atom of the probability space
$(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$, 
then
\[
\left(\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\right)
\ellclass{\charfunction{B}}{\measure}
=
\left( 
\frac{1}{\measure(B)} 
\int_B \function\,d\measure
\right)
\ellclass{\charfunction{B}}{\measure} \quad \text{ in $L_1(\measurespace, \sigmaalgebra,\measure)$.}
\]
\end{prop}


\begin{proof}
The idea is to show that 
\[
\left(\kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\right)
\ellclass{\charfunction{B}}{\measure\restrictedto{\sigmaalgebraii}}
=
\left(
\frac{1}{\measure(B)}
\int_B \function\, d\measure
\right)\ellclass{\charfunction{B}}{\measure\restrictedto{\sigmaalgebraii}}
\quad\text{in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$,}
\]
and then apply the map $\L1embedding$ of Proposition~\ref{integral_over_subalgebra}.

Let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$, and let $B$ be an atom of 
$(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$. 
We may suppose the function $e\in\cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigalgb})$ to be the $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable representative of the class
$\kondexpsub{\ellclass{\function}{\measure}}{\sigalgb}\in
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigalgb})$.
It follows by Proposition~\ref{constant_on_the_atoms} that the function $e$ 
is constant $\Psubstar{\sigalgb}$-almost everywhere on $B$. Suppose this constant equals $a$, meaning that the value of $e$ is equal to $a$ $\Psubstar{\sigalgb}$-almost everywhere on $B$.  Constants are easy to integrate over sets:
\[
\int_B e \, d\measure\restrictedto{\sigalgb}
=
a\cdot\measure\restrictedto{\sigalgb}(B)
=
a\cdot\measure(B).
\]
On the other hand, by the definition of conditional expectation,
\[
\int_B e \, d\measure\restrictedto{\sigalgb}
=
\inducedint_B \kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii} \, d\measure\restrictedto{\sigalgb}
=
\int_B \function\, d\measure.
\]
This says that 
\[
a\cdot\measure(B)
=
\int_B \function\, d\measure.
\]
By hypothesis, the set $B$ is an atom, and so $\measure(B)>0$. This means we can divide by $\measure(B)$. Therefore
\[
a
=
\frac{1}{\measure(B)}
\int_B \function\, d\measure.
\]
Because 
$e$ is equal to $a$ $\Psubstar{\sigalgb}$-almost everywhere on $B$, it follows that
\[
e
=
\frac{1}{\measure(B)}
\int_B \function\, d\measure
\quad\text{$\Psubstar{\sigalgb}$-almost everywhere on $B$},
\]
and so
\[
e\charfunction{B}
=
\left(
\frac{1}{\measure(B)}
\int_B \function\, d\measure
\right)\charfunction{B}
\quad\text{$\Psubstar{\sigalgb}$-almost everywhere on $\measurespace$}.
\]
By taking equivalence classes in 
$L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigalgb})$, we get 
\[
\ellclass{e\charfunction{B}}{\measure\restrictedto{\sigalgb}}
=
\left(
\frac{1}{\measure(B)}
\int_B \function\, d\measure
\right)\ellclass{\charfunction{B}}{\measure\restrictedto{\sigalgb}}
\quad\text{in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigalgb})$.}
\]
Since 
$\ellclass{e\charfunction{B}}{\measure\restrictedto{\sigalgb}} 
= 
\left(\kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\right)
\ellclass{\charfunction{B}}{\measure\restrictedto{\sigalgb}}$
in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigalgb})$, 
by substitution
\[
\left(\kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\right)
\ellclass{\charfunction{B}}{\measure\restrictedto{\sigalgb}}
=
\left(
\frac{1}{\measure(B)}
\int_B \function\, d\measure
\right)\ellclass{\charfunction{B}}{\measure\restrictedto{\sigalgb}}
\quad\text{in $L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigalgb})$.}
\]
Applying the map $\L1embedding$, we get
\[
\left(\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\right)
\ellclass{\charfunction{B}}{\measure}
=
\left( 
\frac{1}{\measure(B)} 
\int_B \function\,d\measure
\right)
\ellclass{\charfunction{B}}{\measure} 
\quad \text{ in $L_1(\measurespace, \sigmaalgebra,\measure)$,}
\]
completing the proof.
\end{proof}



\begin{prop}\label{conditional_expectation_countable}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space, and suppose that $\sigmaalgebra$ has a 
$\textsigma$-subalgebra $\sigmaalgebraii$ generated by a countable partition $\{B_i\}$ of $\measurespace$, where each $B_i\in\sigmaalgebra$ and $\measure(B_i)>0$. 
If $\ellclass{\function}{\measure} \in L_1(\measurespace, \sigmaalgebra,\measure)$, then
\[
\condexpsub{\ellclass{\function}{\measure}}{\sigalgb}
=
\sum_{i=1}^{\infty}
\left(
\frac{1}{\measure(B_i)}
\int_{B_i} \function\, d\measure
\right)
\ellclass{\charfunction{B_i}}{\measure}
\quad \text{ in $L_1(\measurespace, \sigmaalgebra,\measure)$.}
\]
\end{prop}

\begin{proof}
This simply combines Propositions~\ref{countable_partition_of_atoms} and \ref{value_on_the_atoms}.
\end{proof}



\begin{notn}
Let $\oneonomega$ denote the constant function $\measurespace\to\R:\mspaceelt\mapsto 1$.
\end{notn}




\begin{prop}\label{conditional_is_expected}
Let $\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$, and if the 
$\textsigma$-subalgebras $\sagb(\function)$ and 
$\sigmaalgebraii$ of the \textsigma-algebra $\sigmaalgebra$ are independent with respect to $\measure^*$, then
\[
\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}
=  
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure}
\quad
\text{in $L_1(\measurespace, \sigmaalgebra,\measure)$.}
\]
\end{prop}


\begin{proof}
In order to show that the equality
$\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}
=  
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure}$ holds in
$L_1(\measurespace, \sigmaalgebra,\measure)$, 
it's sufficient to show that 
$\kondexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}
=  
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure\restrictedto\sigmaalgebraii}$ holds in
$L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto\sigmaalgebraii)$, and in turn, to show this, it's sufficient to show
\[
\inducedint_\setii \kondexpsub{\ellclass{\function}{\measure}} {\sigmaalgebraii} \, d\measure\restrictedto{\sigalgb}
=
\inducedint_\setii  
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure\restrictedto\sigmaalgebraii}
\, d\measure\restrictedto\sigmaalgebraii
\quad
\text{for all $\setii\in\sigmaalgebraii$.}
\]

The independence of the 
$\textsigma$-subalgebras $\sagb(\function)$ and 
$\sigmaalgebraii$  with respect to $\measure^*$
implies that the classes  $\ellclass{\function}{\measure}$ and 
$\ellclass{\charfunction{\setii}}{\measure}$ are independent with respect to $\measure^*$ for all $\setii\in\sigmaalgebraii$. And, as an application of Proposition~\ref{integral_over_subalgebra},
\[
\expval{ \ellclass{\charfunction{\setii}}{\measure} }
=
\int_\measurespace \charfunction{\setii}\,d\measure
=
\int_\measurespace \charfunction{\setii}\,d\measure\restrictedto{\setii}
=
\inducedint_\setii
\ellclass{\oneonomega}{\measure\restrictedto\sigmaalgebraii}
\, d\measure\restrictedto\sigmaalgebraii.
\]
Consequently,
\begin{align*}
\inducedint_\setii \kondexpsub{\ellclass{\function}{\measure}} {\sigmaalgebraii} \, d\measure\restrictedto{\sigmaalgebraii}
& = \int_\sigmaalgebraii \function\,d\measure 
&&\text{by definition}
\\
& = \int_\measurespace \function\charfunction{\setii}\, d\measure
\\
& = \expval{ \bigl(
\ellclass{\function\charfunction{\setii}}{\measure}
\bigr) }
\\
& = \expval{ \bigl(
\ellclass{\function}{\measure} 
\ellclass{\charfunction{\setii}}{\measure}
\bigr) }
\\
& = \bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\bigl(\expval{\ellclass{\charfunction{\setii}}{\measure}}\bigr)
&&\text{by Prop.~\ref{expected_value_independent}}
\\
& = 
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\inducedint_\setii
\ellclass{\oneonomega}{\measure\restrictedto\sigmaalgebraii}
\, d\measure\restrictedto\sigmaalgebraii
&&\text{by substitution}
\\
& = 
\inducedint_\setii
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure\restrictedto\sigmaalgebraii}
\, d\measure\restrictedto\sigmaalgebraii,
\end{align*}
as required.
\end{proof}



\begin{discussion}\label{the_cheapest_subalgebra}
On any probability space $(\measurespace, \sigmaalgebra,\measure)$, the $\textsigma$-algebra generated by the constant function $\oneonomega$ is $\{\measurespace, \mtset\}$, which is independent of every $\textsigma$-subalgebra of $\sigmaalgebra$.  It follows by Proposition~\ref{conditional_is_expected} that 
$\condexpsub{\ellclass{\function}{\measure}}{\sigma(\oneonomega)} 
=  
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure}$ for every
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
This means that any equation involving conditional mathematical expectation which holds for all
$\textsigma$-subalgebras of $\sigmaalgebra$ must hold for expected values as well.  You may argue that this is logically backwards since the conditional mathematical expectation is a generalization of the expected value.
\end{discussion}



\begin{prop}\label{conditional_equals_expected}
If classes $\ellclass{\function}{\measure}$ and $\ellclass{\functionii}{\measure}$ in
$L_1(\measurespace, \sigmaalgebra,\measure)$
are independent, then
\[
\condexpsub{\ellclass{\function}{\measure}}{\sigma(\functionii)} 
=
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure}
\]
and 
\[
\condexpsub{\ellclass{\functionii}{\measure}}{\sigma(\function)} 
= 
\bigl(\expval{\ellclass{\functionii}{\measure}}\bigr)
\cdot \ellclass{\oneonomega}{\measure}.
\]
\end{prop}

\begin{proof}
These are just  specific instances of Proposition~\ref{conditional_is_expected}.
\end{proof}


\begin{rmk}
A commutative diagram is reproduced here to keep track of what's going on in the following proposition:
\[
\xymatrix@R=24pt@C=40pt{ 
L_1(\measurespace, \sigmaalgebra,\measure )
\ar[r]^-{\condexpop{\sigmaalgebraii}} 
\ar[dr]^{\kondexpop\nolimits_{\sigmaalgebraii}}
&
L_1(\measurespace, \sigmaalgebra,\measure ) 
\\
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\ar[r]^{\text{identity}}
\ar@{>->}[u]^{\L1embedding}
&
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})\Lilstrut
\ar@{>->}[u]_{\L1embedding}
\\
}
\] 
\end{rmk}





\begin{prop} \label{measurable_functions_factor_out}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a probability space.
Let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$, and let the class
$\ellclass{\functionii}{\measure}
\in L_1(\measurespace, \sigmaalgebra,\measure)$.
If $\function:\measurespace\to\R$ is a
$(\sigmaalgebraii, \borel_\R)$\hyp{}measurable function and $\function$ is bounded 
$\Pstar$-almost everywhere on $\measurespace$,  and if the class
$\ellclass{\function}{\measure} \cdot \ellclass{\functionii}{\measure}
\in L_1(\measurespace, \sigmaalgebra,\measure)$, then
\[
\kondexpsub{\bigl(\ellclass{\function}{\measure} \cdot \ellclass{\functionii}{\measure}\bigr)}{\sigmaalgebraii}
= 
\ellclass{\function}{\measure\restrictedto{\sigmaalgebraii}}
\cdot
\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}
,\]
and consequently
\[
\condexpsub{\bigl(\ellclass{\function}{\measure} \cdot \ellclass{\functionii}{\measure}\bigr)}{\sigmaalgebraii}
= 
\ellclass{\function}{\measure}
\cdot
\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}
.\]
\end{prop}


\begin{proof}
For notational purposes, let a function
$e$
in
$\cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
represent the class 
$\kondexpsub{\ellclass{\functionii}{\measure}}{B}$
of the quotient space
$L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
It means that the equivalence classes
$\ellclass{e}{\measure\restrictedto{\sigmaalgebraii}}$
and
$\kondexpsub{\ellclass{\functionii}{\measure}}{B}$ of
$L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
are the same.
Let the set
$C\in\measurable{\Psubstar{\sigmaalgebraii}}$,
and so by Proposition~\ref{measurable_inclusion}, $C$ is also in
$\measurable{\measure^\kernast}$.
It means that if a set $B$ is in
$\sigmaalgebraii$, and so $B$ is also in $\measurable{\Psubstar{\sigmaalgebraii}}$,
then
$B\meets C$ is in $\measurable{\Psubstar{\sigmaalgebraii}}$,
so expressions like
$\inducedint_B \ellclass{\charfunction{C}\cdot e}{\measure\restrictedto{\sigmaalgebraii}}\, d\measure\restrictedto{\sigmaalgebraii}$ make sense. And
$B\meets C$ is also in $\measurable{\measure^\kernast}$, so expressions like
$\int_B\charfunction{C} \cdot \functionii \, d\measure$ make sense.
See Definition~\ref{integrable} for integration over a subset.

We will show that 
\[
\int_B\charfunction{C} \cdot \functionii \, d\measure
=
\inducedint_B \ellclass{\charfunction{C}\cdot e}{\measure\restrictedto{\sigmaalgebraii}}\, d\measure\restrictedto{\sigmaalgebraii}
\]
for all $B\in\sigmaalgebraii$, which implies, by the uniqueness of conditional mathematical expectation of
$\ellclass{\charfunction{C} \cdot \functionii}{\measure}$ with respect to $\sigmaalgebraii$, that
\[
\kondexpsub{\ellclass{\charfunction{C} \cdot \functionii}{\measure}}{\sigmaalgebraii}
=
\ellclass{\charfunction{C}\cdot e}{\measure\restrictedto{\sigmaalgebraii}}.
\]
See that
\begin{align*}
\int_B\charfunction{C} \cdot \functionii\, d\measure
& =
\int_{B\meets C} \functionii\, d\measure
&& \charfunction{B}\cdot\charfunction{C} = \charfunction{B\meets C}
\\
& =
\inducedint_{B\meets C}
\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}\, d\measure\restrictedto{\sigmaalgebraii}
&& \text{Theorem~\ref{existence_of_conditional}}
\\
& =
\int_{B\meets C} e \,d\measure\restrictedto{\sigmaalgebraii}
&& e\in \kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}
\\
& =
\int_B \charfunction{C} \cdot e\, d\measure\restrictedto{\sigmaalgebraii}
&&\charfunction{B\meets C} =  \charfunction{B}\cdot\charfunction{C}
\\
& =
\inducedint_B \ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}}\, d\measure\restrictedto{\sigmaalgebraii}
&& \text{Definition~\ref{Lp}.}
\end{align*}
This implies that
\[
\kondexpsub{\ellclass{\charfunction{C} \cdot \functionii}{\measure}}{\sigmaalgebraii}
=
\ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}},\]
and since the equivalence class
$\ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}}$
can be expressed as 
\begin{align*}
\ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}}
& =
\ellclass{\charfunction{C}}{\measure\restrictedto{\sigmaalgebraii}}
\cdot
\ellclass{e}{\measure\restrictedto{\sigmaalgebraii}}
\\
& =
\ellclass{\charfunction{C}}{\measure\restrictedto{\sigmaalgebraii}}\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii},
\end{align*}
it follows that 
\[
\kondexpsub{
\bigl(
\ellclass{\charfunction{C}}{\measure} \cdot \ellclass{\functionii}{\measure}
\bigr)}
{\sigmaalgebraii}
=
\ellclass{\charfunction{C}}{\measure\restrictedto{\sigmaalgebraii}}\kondexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii}.
\]
This last equality holds for all
$C\in\measurable{\Psubstar{\sigmaalgebraii}}$, and so by linearity for all equivalence classes of 
$(\measurable{\Psubstar{\sigmaalgebraii}},\borel_\R)$\hyp{}measurable step functions. 

The conditions on $\function$ put it within the limits of linear combinations of functions like
$\charfunction{C}$.
The result then follows by a continuity argument, which fortunately works well in a normed space.  Not so well in a semi-normed space.

To obtain the result
\[
\condexpsub{\bigl(\ellclass{\function}{\measure} \cdot \ellclass{\functionii}{\measure}\bigr)}{\sigmaalgebraii}
=
\ellclass{\function}{\measure}
\cdot
\condexpsub{\ellclass{\functionii}{\measure}}{\sigmaalgebraii},
\]
we will apply the  the embedding $\L1embedding$ to both sides of the equality which we have shown:
\[
\kondexpsub{\ellclass{\charfunction{C} \cdot \functionii}{\measure}}{\sigmaalgebraii}
=
\ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}},
\]
to get:
\[
\L1embedding
\kondexpsub{\ellclass{\charfunction{C} \cdot \functionii}{\measure}}{\sigmaalgebraii}
=
\L1embedding
\ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}}.
\]
See that
\[
\L1embedding
\kondexpsub{\ellclass{\charfunction{C} \cdot \functionii}{\measure}}{\sigmaalgebraii}
=
\condexpsub{\ellclass{\charfunction{C} \cdot \functionii}{\measure}}{\sigmaalgebraii}
=
\condexpsub{\bigl(
\ellclass{\charfunction{C}}{\measure} \cdot \ellclass{\functionii}{\measure}
\bigr)}
{\sigmaalgebraii}
\]
and
\[
\L1embedding
\ellclass{\charfunction{C} \cdot e}{\measure\restrictedto{\sigmaalgebraii}}
=
\ellclass{\charfunction{C} \cdot e}{\measure}
=
\ellclass{\charfunction{C}}{\measure} \cdot \ellclass{e}{\measure}
=
\ellclass{\charfunction{C}}{\measure}
\cdot
\condexpsub{\ellclass{\funcg}{\measure}}{\sigmaalgebraii}.
\]
It follows that
\[
\condexpsub{\bigl(
\ellclass{\charfunction{C}}{\measure} \cdot \ellclass{\function}{\measure}
\bigr)}
{\sigmaalgebraii}
=
\ellclass{\charfunction{C}}{\measure}
\cdot
\condexpsub{\ellclass{\funcg}{\measure}}{\sigmaalgebraii}.
\]
Again, the result follows by a continuity argument.
\end{proof}




\begin{prop}\label{subalgebra_fixed}
Let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$, and let the class
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.  If the function $\function$ is $(\sigmaalgebraii,\borel_\R)$\hyp{}measurable, then 
\[
\ellclass{\function}{\measure}
= \condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}.
\]
\end{prop}

\begin{proof}
Take $\ellclass{\functionii}{\measure} = \ellclass{1_\measurespace}{\measure}$, and apply the previous proposition.
\end{proof}





\chapter{Conditional Probability and Markov Kernels}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\lettrine{S}{ome} authors confuse Markov kernels and conditional distributions. We will not. 
However, as shown in Proposition~\ref{equivalent_definition_regular_distribution} below, a Markov kernel satisfying an extra condition corresponds to a regular conditional distribution.


\section{Conditional Probability}
%*********************************************************
%*********************************************************
\begin{defnboldnote}\label{conditional_probability}
Let
$(\measurespace, \sigmaalgebra, \measure)$
be a probability space, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of 
$\sigmaalgebra$.
The set function 
\[
\condprobop{\sigmaalgebraii}: \sigmaalgebra \to \Lone:
\seti\mapsto
\condexpsub{\ellclass{\charfunction{\seti}}{\measure}}{\sigmaalgebraii}
\]
is the 
\term{conditional probability} on $\sigmaalgebra$ with respect to the $\textsigma$\hyp{}subalgebra
$\sigmaalgebraii$, or the \emph{conditional probability on $\sigmaalgebra$ given} 
$\sigmaalgebraii$, the composition being illustrated in the following diagram:
\[
\xymatrix@R=16pt@C=30pt{ 
\ellclass{\charfunction{\seti}}{\measure} & \Lone \ar[r]^{\condexpop{\sigmaalgebraii}} & \Lone\\
\charfunction{\seti} \ar@{|->}[u] & \caliLone \ar@{->>}[u]^{Q} & \\
\seti\ar@{|->}[u] & \sigmaalgebra \ar[u]^{\chi} \ar[uur]_{\condprobop{\sigmaalgebraii}} & \\
}
\]
\end{defnboldnote}

\begin{rmk}
Should the $\textsigma$-subalgebra $\sigmaalgebraii$ be generated by a countable partition $\{\setii_i\}$ of $\measurespace$, where each $\setii_i\in\sigmaalgebra$ and $\measure(\setii_i)>0$, then using Proposition~\ref{conditional_expectation_countable}, for each 
$\seti\in\sigmaalgebra$,
\begin{align*}
\condprobsub{\seti}{\sigalgb}
& = \condexpsub{\ellclass{\charfunction{\seti}}{\measure}}{\sigmaalgebraii} \\
& =
\sum_{i=1}^{\infty}
\left(
\frac{1}{\measure(\setii_i)}
\int_{\setii_i} \charfunction{\seti}\, d\measure
\right)
\ellclass{\charfunction{\setii_i}}{\measure} \\
& = 
\sum_{i=1}^{\infty}
\left(
\frac{\measure(\seti \meets \setii_i)}{\measure(\setii_i)}
\right)
\ellclass{\charfunction{\setii_i}}{\measure}.
\end{align*}
The coefficient
\[
\dfrac{\measure(\seti \meets \setii_i)}{\measure(\setii_i)}
\]
reminds us of the symbols in the very elementary definition of conditional probability:
\[
P(A\mid B) = \frac{P(A\meets B)}{P(B)}.
\]
\end{rmk}



\begin{prop}
Let
$(\measurespace,\sigmaalgebra,\measure)$
be a probability space, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$.
The conditional probability $\condprobop{\sigmaalgebraii}: \sigmaalgebra \to \Lone$  
has the following measure-like properties:
\begin{enumerate}
\item 
$\condprobsub{\mtset}{\sigmaalgebraii} = \ellclass{0_\measurespace}{\measure}$.
\item
$\condprobop{\sigmaalgebraii}$ is $\textsigma$-additive.
\item
$\condprobsub{\measurespace}{\sigmaalgebraii} = \ellclass{1_\measurespace}{\measure}$.
\end{enumerate}
\end{prop}




\section{Markov Kernels}
%*********************************************************
%*********************************************************
\begin{notn}
Let 
$\measurespace$ be a space and let
$\sigmaalgebraii$ be a \textsigma-algebra.
For each set $\setii$ in the \textsigma-algebra $\sigmaalgebraii$, define the function
\[
\fixinthesecond{\setii}
: \measurespace\to\measurespace\times\sigmaalgebraii
: \mspaceelt\mapsto(\mspaceelt,\setii),
\]
 and for each  element $\mspaceelt$ in the space $\measurespace$, define the function
\[
\fixinthefirst{\mspaceelt}
: \sigmaalgebraii\to\measurespace\times\sigmaalgebraii
: \setii\mapsto(\mspaceelt,\setii).
\]
\end{notn}


\begin{defn}\label{markov_kernel}
Given measurable spaces
$(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$, 
a \term{Markov kernel} is a function 
\[
\markovkernel:\measurespace\times\sigmaalgebraii\to [0,1]
\]
such that for each set $\setii\in\sigmaalgebraii$, the map
\[
\markovkernel\circ\fixinthesecond{\setii}
: \measurespace\to\measurespace\times\sigmaalgebraii\to [0,1]
: \mspaceelt\mapsto (\mspaceelt,\setii)\mapsto
\markovkernel(\mspaceelt,\setii)
\]
is
$\bigl(\sigmaalgebra, \borel_{[0,1]}\bigr)$\hyp{}measurable, and for each element
$\mspaceelt\in\measurespace$, the map
\[
\markovkernel\circ\fixinthefirst{\mspaceelt}
: \sigmaalgebraii\to\measurespace\times\sigmaalgebraii\to [0,1]
: \setii\mapsto (\mspaceelt,\setii)\mapsto
\markovkernel(\mspaceelt, \setii)
\]
is a probability measure on
$\sigmaalgebraii$. 
The map
$\markovkernel\circ\fixinthesecond{\setii}$
may be denoted by
$\markovkernel^{\setii}$,
and likewise the map
$\markovkernel\circ\fixinthefirst{\mspaceelt}$
may be denoted by
$\markovkernel_{\mspaceelt}$.
It means that for each $\mspaceelt\in\measurespace$ and
$\setii\in\sigmaalgebraii$ there is a commutative diagram, only one of which will be illustrated, without quantification:
\[
\xymatrix@R=16pt@C=30pt{ 
\measurespace \ar[d]_-{\fixinthesecond{\setii}} 
\ar[dr]^-{\makebox[0pt][l]
{\scriptsize{$\markovkernel^\setii$
\quad $\bigl(\sigmaalgebra, \borel_{[0,1]}\bigr)$\hyp{}measurable}}}\\
\measurespace\times\sigmaalgebraii \ar[r]^{\markovkernel} & [0,1] \\
\sigmaalgebraii 
\ar[ur]_-{\makebox[0pt][l]
{\scriptsize{$\markovkernel_\uspaceelt$
\quad probability measure}}}
\ar[u]^{\fixinthefirst{\mspaceelt}} & \\
}
\]
A subscript indicating a domain, such as
$\fixinthesecond{\setii}_\measurespace$,
could be used in case more than one kernel
is involved.


A Markov kernel given measurable spaces 
$(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$ 
is also called a \term{transition} from
$(\measurespace, \sigmaalgebra)$ to
$(\measurespaceii, \sigmaalgebraii)$. We may use the notation
\[
\markovkernel:(\measurespace, \sigmaalgebra)\transition
(\measurespaceii, \sigmaalgebraii)
\]
instead of saying that $\funck$ is a Markov kernel given
$(\measurespace, \sigmaalgebra)$ and
$(\measurespaceii, \sigmaalgebraii)$.
%Do \nomenclature[prefix]{symbol}{description}
%where prefix is used to order the symbol in the Nomenclature list.
\nomenclature[Markov kernel]{$(\measurespace,\sigmaalgebra)\transition (\measurespaceii,\sigmaalgebraii)$}{Markov kernel given $(\measurespace, \sigmaalgebra)$ and $(\measurespaceii, \sigmaalgebraii)$}
\end{defn}


\begin{example}
Every measurable function induces a Markov kernel, and to see this, let
$(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$ be measurable spaces, and let 
$\function: \measurespace \to \measurespaceii$ be an $(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable function. 
Define a function $\markovkernel:\measurespace\times\sigmaalgebraii\to [0,1]$ by
\[
(\mspaceelt,\setii) \mapsto
\begin{cases}
1 & \text{if $\function(\mspaceelt) \in\setii$} \\
0 & \text{if $\function(\mspaceelt) \notin\setii$.} \\
\end{cases}
\]
Two other ways to view the value $\markovkernel(\mspaceelt, \setii)$ would be as 
$\markovkernel(\mspaceelt, \setii)
= 
\charfunction{\setii}\bigl(\function(\mspaceelt)\bigr)$,
and as
$\markovkernel(\mspaceelt, \setii)
=
\diracmeasure{\function(\mspaceelt)}(\setii)$ with 
$\diracmeasure{\function(\mspaceelt)}$ denoting Dirac measure concentrated at 
$\function(\mspaceelt)$.
Then for each set $\setii\in\sigmaalgebraii$, the map
\[
\markovkernel\circ\fixinthesecond{\setii}
: \measurespace\to [0,1]
: \mspaceelt\mapsto \markovkernel(\mspaceelt, \setii)
= 
\charfunction{\setii}\bigl(\function(\mspaceelt)\bigr)
\]
can be seen as a composition of the 
$\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable function $\charfunction{\setii}$ with the 
$(\sigmaalgebra, \sigmaalgebraii)$\hyp{}measurable function 
$\function$, and so the composition is 
$\bigl(\sigmaalgebra, \borel_{[0,1]}\bigr)$\hyp{}measurable.
And for each element
$\mspaceelt\in\measurespace$,  the map
\[
\markovkernel\circ\fixinthefirst{\mspaceelt}
: \sigmaalgebraii\to [0,1]
: \setii\mapsto \markovkernel(\mspaceelt, \setii)
= 
\diracmeasure{\function(\mspaceelt)}(\setii)
\]
visibly defines a measure on
$\sigmaalgebraii$, in particular Dirac measure concentrated at 
$\function(\mspaceelt)$.  And since $\function(\mspaceelt)\in\measurespaceii$ implies that the Dirac measure of the whole space $\measurespaceii$ is $1$, the map 
$\markovkernel\circ\fixinthefirst{\mspaceelt}$ further defines a probability measure on
$\sigmaalgebraii$. 
This shows that $\markovkernel$ is a Markov kernel by the very definition of Markov kernel.
\end{example}




\begin{prop}\label{not_a_product_measure}
Let
$(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$ be measurable spaces.
Let $\measure$ be a probability measure on $\sigmaalgebra$.
If
$\{ \funck^\setii : \setii\in\sigmaalgebraii \}$
is a collection of
$\bigl(\sigmaalgebra, \borel_{[0,1]}\bigr)$\hyp{}measurable functions,
and
$\{ \funck_\mspaceelt : \mspaceelt\in\measurespace \}$
is a collection of probability measures on $\sigmaalgebraii$,
where
\[
\funck^\setii (\mspaceelt) = \funck_\mspaceelt (\setii)
\]
for all
$\setii\in\sigmaalgebraii$
and for all
$\mspaceelt\in\measurespace$,
then there is a unique probability measure $\measonprod$ on the \textsigma-algebra 
$\sagb(\sigmaalgebra,\sigmaalgebraii)$ of subsets of 
$\measurespace\times\measurespaceii$
such that
\[
\measonprod(\seti\times\setii)
\definedby
\int_\seti \funck^\setii(\mspaceelt) \, d\measure(\mspaceelt)
\]
for all $\seti\times\setii\in\productsemiring{\sigmaalgebra}{\sigmaalgebraii}$.
Furthermore,
$\measure(\seti) = \measonprod(\seti\times\measurespaceii)$ for all $\seti\in\sigmaalgebra$.
\end{prop}


\begin{proof}
Show that  $\measonprod$ restricted to the product semiring
$\productsemiring{\sigmaalgebra}{\sigmaalgebraii}$ is countably additive.
Then take $\measonprod$ itself to be the corresponding outer measure restricted to 
$\sagb(\sigmaalgebra,\sigmaalgebraii)$. 
Uniqueness follows by Proposition~\ref{extension_measure}.
Since $\funck_\mspaceelt$ is a probability measure, it follows that
$\funck_\mspaceelt(\measurespaceii) = 1$. That is, the measure of the whole space is $1$.
And by hypothesis,
$\funck^\measurespaceii(\mspaceelt)
=
\funck_\mspaceelt(\measurespaceii)
= 1$
so
\[
\measonprod(\seti\times\measurespaceii)
=
\int_\seti \funck^\measurespaceii (\mspaceelt)
\, d\measure(\mspaceelt)
=
\int_\seti 1_\measurespace \, d\measure
=\measure(\seti),
\]
as required.
\end{proof}



\begin{prop}\label{induced_markov_kernel}
Let $(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$ be measurable spaces, 
and let 
$\projectionone: \measurespace\times\measurespaceii \to \measurespace$ denote the canonical projection onto the first component, with 
$\preimage\projectionone: 
\sigmaalgebra\to
\preimage{\projectionone}(\sigmaalgebra)$.
Let
$\markovkernel:\measurespace\times\sigmaalgebraii\to [0,1]$ 
be a Markov kernel given measurable spaces
$(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$. If a function 
$\markovkernelii:
(\measurespace\times\measurespaceii) \times \sigmaalgebraii 
\to
[0,1]$
is defined in terms of the Markov kernel $\markovkernel$ by
\[
\markovkernelii:
(\measurespace\times\measurespaceii) \times \sigmaalgebraii 
\to
[0,1]
: 
\bigl((\mspaceelt,\mspaceeltii),\setii\bigr)\mapsto 
\markovkernel(\mspaceelt,\setii),
\]
then 
$\markovkernelii$ is a Markov kernel given measurable spaces
$\bigl(\measurespace\times\measurespaceii, \preimage\projectionone(\sigmaalgebra)\bigr)$
and
$(\measurespaceii, \sigmaalgebraii)$, as illustrated:
\[
\xymatrix@R=18pt@C=30pt{ 
\measurespace \ar[d]_-{\fixinthesecond{\setii}_\measurespace} 
\ar[dr]^{\qquad\text{ $\bigl(\sigmaalgebra, \borel_{[0,1]}\bigr)$\hyp{}measurable}}\\
\measurespace\times\sigmaalgebraii \ar[r]^-{\markovkernel} & [0,1] \\
\sigmaalgebraii 
\ar[ur]_{\qquad\text{probability measure}} \ar[u]^{\fixinthefirst{\mspaceelt}} & \\
}
%
\xymatrix@R=18pt@C=30pt{ 
\measurespace\times\measurespaceii 
\ar[d]_-{\fixinthesecond{\setii}}
\ar[dr]^{\qquad\text{\qquad$\bigl(\preimage\projectionone(\sigmaalgebra), \borel_{[0,1]}\bigr)$\hyp{}measurable}}\\
(\measurespace\times\measurespaceii)\times\sigmaalgebraii \ar[r]^-{\markovkernelii} & [0,1] \\
\sigmaalgebraii 
\ar[ur]_{\qquad\text{probability measure}} \ar[u]^{\fixinthefirst{(\mspaceelt,\mspaceeltii)}} & \\
}
\]
Conversely, let 
$\markovkernelii :(\measurespace\times\measurespaceii)
\times \sigmaalgebraii
\to [0,1]$ be a Markov kernel given measurable spaces
$\bigl(\measurespace\times\measurespaceii, \preimage\projectionone(\sigmaalgebra)\bigr)$
and
$(\measurespaceii, \sigmaalgebraii)$.
If a function 
$\markovkernel:
\measurespace\times \sigmaalgebraii 
\to
[0,1]$
is defined in terms of the Markov kernel $\markovkernelii$ by
\[
\markovkernel:
\measurespace\times \sigmaalgebraii 
\to
[0,1]
: 
(\mspaceelt,\setii)
\mapsto 
\markovkernelii\bigl((\mspaceelt,\mspaceeltii),\setii\bigr),
\]
for any $\mspaceeltii\in\measurespaceii$ such that
$(\mspaceelt, \mspaceeltii)\in\measurespace\times\measurespaceii$,
then $\markovkernel$
is a Markov kernel given measurable spaces
$(\measurespace, \sigmaalgebra)$ and 
$(\measurespaceii, \sigmaalgebraii)$.
\end{prop}

\begin{proof}
Let
$\markovkernelii:
(\measurespace\times\measurespaceii) \times \sigmaalgebraii 
\to
[0,1]$
be defined by
\[
\markovkernelii:
(\measurespace\times\measurespaceii) \times \sigmaalgebraii 
\to
[0,1]
: 
\bigl((\mspaceelt,\mspaceeltii),\setii\bigr)\mapsto 
\markovkernel(\mspaceelt,\setii).
\]
We want to show that 
$\markovkernelii$ is a Markov kernel given measurable spaces
$\bigl(\measurespace\times\measurespaceii, \preimage\projectionone(\sigmaalgebra)\bigr)$
and
$(\measurespaceii, \sigmaalgebraii)$.

\[
\markovkernelii\circ
\fixinthesecond{\setii}(\mspaceelt,\mspaceeltii)
=
\markovkernelii\bigl((\mspaceelt,\mspaceeltii),\setii\bigr)
=
\markovkernel(\mspaceelt,\setii)
=
\markovkernel\circ\fixinthesecond{\setii}_\measurespace(\mspaceelt)
=
\markovkernel\circ\fixinthesecond{\setii}_\measurespace\circ\projectionone(\mspaceelt,\mspaceeltii),
\]
which is a composition of measurable functions.
Also by definition,
\[
\markovkernelii\circ\fixinthefirst{(\mspaceelt,\mspaceeltii)}(\setii)
=
\markovkernelii\bigl((\mspaceelt,\mspaceeltii),\setii\bigr)
=
\markovkernel(\mspaceelt,\setii)
=
\markovkernel\circ\fixinthefirst{\mspaceelt}(\setii),
\]
so
$\markovkernelii\circ\fixinthefirst{(\mspaceelt,\mspaceeltii)}
=
\markovkernel\circ\fixinthefirst{\mspaceelt}$, which is a probability measure.
\end{proof}




%*********************************************************
%*********************************************************
\section{Regular Version}
\begin{defnboldnote}\label{version}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a measure space.
Let 
$\regular$ be a function $\Lone\to\caliLone$ which selects a representative from each equivalence class.  
If $S$ is a set, and $\cali{P}: S \to \Lone$ is a function, then
the collection $(\regular\circ\cali{P})(S)$ of
$\caliLone$ functions is called a \term{version} of $\cali{P}$.
\[
\xymatrix@R=16pt@C=30pt{ 
\Lone \ar[r]^{\regular} & \caliLone \\
S \ar[ur]_-{\ \regular\circ\cali{F}} \ar[u]^{\cali{P}} & \\
}
\]
\end{defnboldnote}


\begin{defnboldnote}\label{regular_version}
Let the collection
$(\regular\circ\condprobop{\sigmaalgebraii})(\sigmaalgebra)$ of $\caliLone$ functions be a version of the conditional probability
$\condprobop{\sigmaalgebraii}$ on $\sigmaalgebra$ given $\sigmaalgebraii$:
\[
\xymatrix@R=16pt@C=30pt{
\Lone \ar[r]^{\regular}
& \caliLone
\\
\sigmaalgebra 
\ar[u]^{\condprobop{\sigmaalgebraii}}
\ar[ur]_{\ \regular\circ\condprobop{\sigmaalgebraii}}
&
}
\]
If the selection function 
$\regular:\Lone\to\caliLone$
has the additional property that each map
\[
\sigmaalgebra\to [0,1]: \seti \mapsto 
\bigl( \regular\circ\condprobop{\sigmaalgebraii} (\seti)\bigr)(\mspaceelt)
\]
is a probability measure on $\sigmaalgebra$ except for possibly all 
$\mspaceelt$ in a 
${\measure\restrictedto\sigmaalgebraii}^\kernast$-null set, 
and for each
$\seti\in\sigmaalgebra$, the map 
\[
\measurespace\to [0,1] : \mspaceelt\mapsto
\bigl( \regular\circ\condprobop{\sigmaalgebraii} (\seti)\bigr)(\mspaceelt)
\]
is $\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable,
then the collection 
$\regular\circ\condprobop{\sigmaalgebraii}(\sigmaalgebra)$ 
of functions, or any such collection of $\caliLone$ functions without specifying $\regular$,
is called a \term{regular version} of the conditional probability 
$\condprobop{\sigmaalgebraii}$ on $\sigmaalgebra$ given $\sigmaalgebraii$.
If all of these
$\caliLone$
functions are modified on some fixed
${\measure\restrictedto\sigmaalgebraii}^\kernast$-null set, then the new collection of functions is still considered to be a 
regular version of 
$\condprobop{\sigmaalgebraii}$ on $\sigmaalgebra$ given $\sigmaalgebraii$.
It means that any regular version of 
$\condprobop{\sigmaalgebraii}$ on $\sigmaalgebra$ given $\sigmaalgebraii$
could be redefined in such a way that the map
$ \seti \mapsto 
\bigl( \regular\circ\condprobop{\sigmaalgebraii} (\seti)\bigr)(\mspaceelt)$
is a probability measure on all of $\sigmaalgebra$:
should
$\seti \mapsto 
\bigl( \regular\circ\condprobop{\sigmaalgebraii} (\seti)\bigr)(\mspaceelt)
$
be a probability measure on $\sigmaalgebra$ except for  all 
$\mspaceelt$ in a 
${\measure\restrictedto\sigmaalgebraii}^\kernast$-null set $N$,
then choose $\mspaceeltii\in\measurespace$ with 
$\mspaceeltii\notin N$, and set
\[
\bigl(\regular\circ\condprobop{\sigmaalgebraii} (\seti)\bigr)(\mspaceelt)
=
\bigl(\regular\circ\condprobop{\sigmaalgebraii} (\seti)\bigr)(\mspaceeltii)
\]
for all $\mspaceelt\in N$. Unless otherwise stated, all regular conditional probabilites will be considered so selected.

We will call a conditional probability $\condprobop{\sigmaalgebraii}$ on 
$\sigmaalgebra$ given $\sigmaalgebraii$ a 
\term{regular conditional probability} if there exists a regular version of 
$\condprobop{\sigmaalgebraii}$.
\end{defnboldnote}


\begin{rmk}\label{quote_loeve}
To quote a paragraph of Loeve~\cite{pt_loeve_1960} verbatim:
\begin{quote}
A c.pr.~$P^{\sigalg{B}}$ is said to be \emph{regular} if, for every $A\in\sigmaalgebra$, it is possible to select $P^\sigalg{B} A$ within its class of equivalence in such a manner that the $P_\mspaceelt^\sigalg{B}$ are pr.'s on $\sigmaalgebra$ except for points $\mspaceelt$ belonging to a $P_\sigalg{B}$-null event $N$.
A regular pr.f.~$P^\sigalg{B}$ can be said to be defined up to an equivalence, in the sense that if all the functions $P^\sigalg{B}A$ are modified arbitrarily on an arbitrary but fixed $P_\sigalg{B}$-null event, the new c.pr.~is still regular.
In particular, a regular c.pr.~$P^\sigalg{B}$ can be selected within its equivalence class so that $P_\mspaceelt^\sigalg{B}$ is a pr. on $\sigmaalgebra$ for \emph{every} $\mspaceelt\in\measurespace$.
For example, for every $\mspaceelt$ belonging to the exceptional $P_\sigalg{B}$-null event $N$ set $P_\mspaceelt^\sigalg{B} = P_N$ where $P_N$ is a pr. on $\sigmaalgebra$.  Unless otherwise stated, regular c.pr.'s will be so selected.
\end{quote}
Loeve continues on saying that a \emph{regular} conditional probability is just a conditional probability which induces a particular Markov kernel; we leave it as the statement of Definition~\ref{regular_version} and Example~\ref{regular_conditional_probability_induces_markov_kernel}.
\end{rmk}


\begin{discussion}\label{regular_version_equivalence}
Let us compare the conditional probability $P^{\sigalg{B}}$ quoted from Loeve in Remark~\ref{quote_loeve} with the conditional probability $\condprobop{\sigmaalgebraii}$ in Definition~\ref{regular_version}.  The conditional probability
$P^{\sigalg{B}}$ quoted from Loeve in Remark~\ref{quote_loeve} refers to the restriction of the operator
\[
\kondexpop\nolimits_{\sigmaalgebraii}
:
L_1(\measurespace, \sigmaalgebra,\measure) \to
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})
\]
to the family of characteristic functions of events in $\sigmaalgebra$, which we illustrate as:
\[
\xymatrix@R=16pt{
L_1(\measurespace, \sigmaalgebra,\measure )
\ar[r]^{\kondexpop\nolimits_{\sigmaalgebraii}}
&
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})
\\
\sigmaalgebra
\ar[u]^{Q\circ\chi}
\ar[ur]_{P^{\sigalg{B}}}
}
\]
The conditional probability $\condprobop{\sigmaalgebraii}$ in Definition~\ref{conditional_probability} is defined as the composition
$\condexpop{\sigmaalgebraii} \circ\, Q \circ\chi$
in the following diagram:
\[
\xymatrix@R=16pt@C=30pt{
\Lone \ar[r]^{\condexpop{\sigmaalgebraii}} & \Lone\\
\sigmaalgebra \ar[u]^{Q\circ\chi} \ar[ur]_{\condprobop{\sigmaalgebraii}} & \\
}
\]
How do the regular versions of these  conditional probabilities compare? They are equivalent in this sense.
There exists a regular version of
$P^{\sigalg{B}}$ if and only if there exists a regular version of
$\condprobop{\sigmaalgebraii}$.
Briefly, say $\selection$ and $\regular$ are the selection functions which select representatives from equivalence classes as  illustrated in the following diagrams:
\[
\xymatrix@R=16pt@C=30pt{
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})
\ar[r]^{\selection}
& \cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})
\\
\sigmaalgebra
\ar[u]^{P^{\sigmaalgebraii}}
\ar[ur]_{\selection \circ \mathop{P^{\sigmaalgebraii}}}
&
}
\quad
\xymatrix@R=16pt@C=30pt{
\Lone \ar[r]^{\regular}
& \caliLone
\\
\sigmaalgebra
\ar[u]^{\condprobop{\sigmaalgebraii}}
\ar[ur]_{\ \regular\circ\condprobop{\sigmaalgebraii}}
&
}
\]
By Proposition~\ref{integral_over_subalgebra}, if the function
$\selection \bigl( P^\sigmaalgebraii (\seti) \bigr)$
is in
$\cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$,
then
$\selection \bigl( P^\sigmaalgebraii(\seti) \bigr)$
is also in
$\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$,
and we can take
\[
\regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr)
=
\selection \bigl( P^\sigmaalgebraii(\seti) \bigr).
\]
And by Proposition~\ref{algebra_to_subalgebra}, if the function
$\regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr)$
is in
$\cali{L}_1(\measurespace, \sigmaalgebra,\measure)$, and if
$\regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr)$
is $(\sigmaalgebraii,\borel_{[0,1]})$\hyp{}measurable,
then
$\regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr)$
is in
$\cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
and so we can take
\[
\selection \bigl( P^\sigmaalgebraii(\seti) \bigr)
=
\regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr).
\]
The version in both cases is the same family of functions, it just depends on whether they are considered as residing in
$\cali{L}_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
or
$\caliLone$.
Verify that if
$\selection \bigl( P^\sigmaalgebraii(\seti) \bigr)
=
\regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr)$
and either of
\[
\seti\mapsto \regular\bigl( \condprobop{\sigmaalgebraii}(\seti)\bigr)(x)
\]
or
\[
\seti\mapsto \selection \bigl( P^\sigmaalgebraii(\seti) \bigr)(x)
\]
is a probability measure on $\sigmaalgebra$, then so is the other.
\end{discussion}



\begin{example}\label{regular_conditional_probability_induces_markov_kernel}
Every regular conditional probability induces a Markov kernel;
let $(\measurespace,\sigmaalgebra,\measure)$ be a probability space, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$.
Let the collection 
$(\regular\circ\condprobop{\sigmaalgebraii})(\sigmaalgebra)$ 
of 
$\caliLone$ functions
be a regular version of the conditional probability $\condprobop{\sigmaalgebraii}$ on $\sigmaalgebra$ given $\sigmaalgebraii$, which means by definition that the selection function 
$\regular:\Lone\to\caliLone$
has the additional property that for each $\seti\in\sigmaalgebra$, the map 
\[
\measurespace\to [0,1] : \mspaceelt\mapsto
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}) (\seti)\bigr](\mspaceelt)
\]
is $\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable, and for each 
$\mspaceelt\in\measurespace$ the map
\[
\sigmaalgebra\to [0,1]: \seti \mapsto 
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}) (\seti)\bigr](\mspaceelt)
\]
is a probability measure on $\sigmaalgebra$.
Let us define a Markov kernel
\[
\markovkernel : \measurespace\times\sigmaalgebra \to [0,1]
\]
so that
$\markovkernel \circ\fixinthesecond{\seti}
=
(\regular\circ\condprobop{\sigmaalgebraii}) (\seti)$;
that is, define
\[
\markovkernel : \measurespace\times\sigmaalgebra
: (\mspaceelt,\seti)\mapsto  
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}) (\seti)\bigr](\mspaceelt),
\]
which we will show is a Markov kernel given measurable spaces $(\measurespace,\sigmaalgebraii)$ and $(\measurespace, \sigmaalgebra)$.


For each set $\seti\in\sigmaalgebra$, the map
\[
\markovkernel\circ\fixinthesecond{\seti}
: \measurespace\to [0,1]
: \mspaceelt\mapsto \markovkernel(\mspaceelt, \seti)
= 
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}) (\seti)\bigr](\mspaceelt)
\]
is  $\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable by hypothesis, and for each element $\mspaceelt\in\measurespace$, the map
\[
\markovkernel\circ\fixinthefirst{\mspaceelt}
: \sigmaalgebra\to [0,1]
: \seti\mapsto
\markovkernel(\mspaceelt, \seti)
=
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}) (\seti)\bigr](\mspaceelt)
\]
is a probability measure on
$\sigmaalgebra$ by hypothesis, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{ 
\Lone &
\measurespace \ar[d]_-{\fixinthesecond{\seti}} 
\ar[dr]^{\ \quad\markovkernel\,\circ\,\fixinthesecond{\seti}\,
\in
\condprobop{\sigmaalgebraii}(\seti)}
\\
&\measurespace\times\sigmaalgebra \ar[r]^{\markovkernel} & [0,1] 
\\
\sigmaalgebra \ar[uu]_{\condprobop{\sigmaalgebraii}} & \sigmaalgebra
\ar[ur]_{\qquad\text{probability measure}} \ar[u]^{\fixinthefirst{\mspaceelt}} & 
\\
}
\]
This shows that $\markovkernel$ is a Markov kernel given measurable spaces $(\measurespace,\sigmaalgebraii)$ and $(\measurespace, \sigmaalgebra)$, according to definition. 
\end{example}

\begin{rmk}
Instead of using some arbitrary letter $k$ to denote a Markov kernel, notation like
$\measmu^{\sigmaalgebraii}$ seems arguably better. I get the strangest feeling that this kind of notation will be used in the next couple of updates of these notes.
\end{rmk}


\section{Conditional Distributions}
%*********************************************************
%*********************************************************
\begin{defnboldnote}\label{conditional_distribution}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a probability space, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$. Also let $(\measurespaceii, \sigmaalgebraiii)$ be a measurable space, and let 
$\function:\measurespace\to\measurespaceii$ be an
$(\sigmaalgebra, \sigmaalgebraiii)$\hyp{}measurable function, with
$\preimage{\function} : \sigmaalgebraiii \to \sigmaalgebra$.  
Just as the function $\function$ induces the probability distribution 
$\measure\circ\preimage{\function}$ of $\function$ on $\sigmaalgebraiii$, 
so does the function $\function$ together with the $\textsigma$-subalgebra $\sigmaalgebraii$ induce the \term{conditional probability distribution} 
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ of $\function$ on $\sigmaalgebraiii$ given  
$\sigmaalgebraii$:
\[
{\condprobop{\sigmaalgebraii}}\circ \preimage{\function} : \sigmaalgebraiii \to 
L_1(\measurespace, \sigmaalgebra, \measure)
: \setiii \mapsto \condexpsub{\ellclass{\charfunction{\preimage{\function}(\setiii)}}{\measure}}{\sigmaalgebraii},
\] 
or simply the \emph{conditional distribution} of $\function$ on $\sigmaalgebraiii$ given $\sigmaalgebraii$, as illustrated:
\[
\xymatrix@C=30pt{ 
\Lone \ar[r]^{\condexpop{\sigmaalgebraii}} 
& \Lone 
\\
\sigmaalgebra 
\ar[u]^-{Q\circ\chi} 
\ar[ur]_{\condprobop{\sigmaalgebraii}} 
& \sigmaalgebraiii \ar[l]^{\preimage{\function}} 
\ar[u]_{\condprobop{\sigmaalgebraii}\circ\preimage{\function}}
}
\]
\end{defnboldnote}



\begin{rmk}\label{distributions}
Distributions are functions induced on a \textsigma-algebra of subsets of the codomain of a measurable function, whether the distribution is a probability distribution or a conditional distribution:
\begin{itemize}
\item
A probability distribution is a probability measure composed with a preimage. 
\item
A conditional distribution is a conditional probability composed with a preimage.  
\end{itemize}
It is just that simple.
\end{rmk}


\begin{discussion}\label{avoid_function}
You might reasonably try to avoid explicit mention of the map 
$\function:(\measurespace,\sigmaalgebra)\to (\measurespaceii,\sigmaalgebraii)$
in the definition of conditional distribution, perhaps by replacing the \textsigma\hyp{}algebra 
$\sigmaalgebraiii$ with $\preimage{\function}(\sigmaalgebraiii)$, and replacing
$\preimage{\function}$ with 
$\preimage{\text{inc}} \definedby \preimage{\text{inclusion}}$
\[
\xymatrix@C=30pt{ 
\Lone \ar[r]^{\condexpop{\sigmaalgebraii}} 
& \Lone 
\\
\sigmaalgebra 
\ar[u]^-{Q\circ\chi} 
\ar[ur]_{\condprobop{\sigmaalgebraii}} 
& \preimage{\function}(\sigmaalgebraiii) \ar[l]^{\preimage{\text{inc}}} 
\ar[u]_{\condprobop{\sigmaalgebraii}\circ\,\preimage{\text{inc}}}
}
\]
But one way or another, with a distribution, there is a preimage involved.
There is no way around it.  An $\preimage{\function}$ is in there somewhere.
\end{discussion}



\begin{prop}\label{conditional_probability_of_a_set}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a probability space, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$. Also let $(\measurespaceii, \sigmaalgebraiii)$ be a measurable space, and let 
$\function:\measurespace\to\measurespaceii$ be an
$(\sigmaalgebra, \sigmaalgebraiii)$\hyp{}measurable function, with
$\preimage{\function} : \sigmaalgebraiii \to \sigmaalgebra$.  
If $\setii\in\sigmaalgebraii$ and $\setiii\in\sigmaalgebraiii$, then
\[
\inducedint_\setii (\condprobop{\sigmaalgebraii}\circ \preimage{\function})(\setiii)\,d\measure
=
\measure\bigl(\setii\meets\preimage{\function}(\setiii)\bigr).
\]
\end{prop}


\begin{proof}
\begin{align*}
\inducedint_\setii (\condprobop{\sigmaalgebraii}\circ \preimage{\function})(\setiii)\,d\measure
&= \inducedint_\setii 
\condexpsub{\ellclass{\charfunction{\preimage{\function}(\setiii)}}{\measure}}{\sigmaalgebraii}
\,d\measure \\
&= \inducedint_\setii 
\kondexpsub{\ellclass{\charfunction{\preimage{\function}(\setiii)}}{\measure}}{\sigmaalgebraii}
\,d\measure\restrictedto{\sigmaalgebraii} \\
&= \int_\setii \charfunction{\preimage{f}(\setiii)}\,d\mu \\
&= \measure\bigl(\setii\meets\preimage{\function}(\setiii)\bigr).\\
\end{align*}
\end{proof}



\begin{defnboldnote}\label{regular_conditional_distribution}
The definition of a
regular conditional probability \emph{distribution}
is nothing other than Definition~\ref{regular_version} of a regular conditional probability combined with a preimage.

Let the collection
$(\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function})
(\sigmaalgebraiii)$ of $\caliLone$ functions be a version of the conditional distribution
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ of $\function$ on $\sigmaalgebraiii$ given  
$\sigmaalgebraii$.
If the selection function 
$\regular:\Lone\to\caliLone$
has the additional property that the map
\[
\sigmaalgebraiii\to [0,1]: \setiii \mapsto 
\bigl( \regular\circ\condprobop{\sigmaalgebraii} \circ\preimage{\function}
(\setiii)\bigr)(\mspaceelt)
\]
is a probability measure on the \textsigma\hyp{}algebra $\sigmaalgebraiii$ except for possibly all
$\mspaceelt$ in a 
${\measure\restrictedto{\sigmaalgebraii}}^\kernast$-null set,
and for each
$\setiii\in\sigmaalgebraiii$, the map 
\[
\measurespace\to [0,1] : \mspaceelt\mapsto
\bigl( \regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}
(\setiii)\bigr)(\mspaceelt)
\]
is $\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable,
then the collection 
$\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}
(\sigmaalgebraiii)$ 
of functions, or any such collection of
$\caliLone$ functions without specifying $\regular$,
is called a regular version of the conditional distribution 
$\condprobop{\sigmaalgebraii}\circ\preimage{\function}$ of $\function$ on 
$\sigmaalgebraiii$ given $\sigmaalgebraii$,
as illustrated:
\[
\xymatrix@C=30pt{ 
\Lone \ar[r]^{\condexpop{\sigmaalgebraii}} 
& \Lone \ar[r]^{\regular} & \caliLone
\\
\sigmaalgebra \ar[u]^-{Q\circ\chi} \ar[ur]^{\condprobop{\sigmaalgebraii}} 
& \sigmaalgebraiii 
\ar[l]^{\preimage{\function}} 
\ar[u]
\ar[ur]_{\regular
\makebox[0pt][l]{$\scriptstyle{\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}}$}
}
\\
}
\]
If all of the functions in the collection
$(\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function})
(\sigmaalgebraiii)$
are modified on a fixed
${\measure\restrictedto\sigmaalgebraii}^\kernast$-null set, then the new collection of functions is still considered to be a 
regular version of 
$\condprobop{\sigmaalgebraii}\circ\preimage{\function}$ 
of $\function$
on $\sigmaalgebraiii$ given $\sigmaalgebraii$.
It means that any regular version of 
$\condprobop{\sigmaalgebraii}\circ\preimage{\function}$ 
of $\function$
on $\sigmaalgebraiii$ given $\sigmaalgebraii$
could be redefined in such a way that the map
$ \setiii \mapsto 
\bigl( \regular\circ\condprobop{\sigmaalgebraiii}\circ\preimage{\function} 
(\setiii)\bigr)(\mspaceelt)$
is a probability measure on all of $\sigmaalgebra$:
should
$\setiii \mapsto 
\bigl( \regular\circ\condprobop{\sigmaalgebraii} \circ\preimage{\function}
(\setiii)\bigr)(\mspaceelt)
$
be a probability measure on $\sigmaalgebraiii$ except for  all 
$\mspaceelt$ in a 
${\measure\restrictedto\sigmaalgebraii}^\kernast$-null set $N$,
then choose $\mspaceeltii\in\measurespace$ with 
$\mspaceeltii\notin N$, and set
\[
\bigl(\regular\circ\condprobop{\sigmaalgebraii} \circ\preimage{\function}
(\setiii)\bigr)(\mspaceelt)
=
\bigl(\regular\circ\condprobop{\sigmaalgebraii} \circ\preimage{\function}
(\setiii)\bigr)(\mspaceeltii)
\]
for all $\mspaceelt\in N$. Unless otherwise stated, all regular conditional distributions will be considered so selected.

We will call a conditional distribution  ${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ of 
$\function$ on $\sigmaalgebraiii$ given  
$\sigmaalgebraii$ a
\term{regular conditional probability distribution}, or simply a \emph{regular conditional distribution}, if there exists a regular version of the conditional distribution
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$.
Should the function $\function$ here happen to equal the identity function, so that $\sigmaalgebraiii = \sigmaalgebra$, then this definition agrees with the Definition~\ref{regular_version} of a regular conditional probability,  as it should be.   
\end{defnboldnote}

\begin{rmk}
No conditional distribution 
could possibly be a probability measure since the  codomain
of a conditional distribution is an
$L_1$ space rather than the interval $[0,1]$.
However, a regular conditional distribution is equivalent to a particular Markov kernel defining a whole family of probability measures, as shown in
Proposition~\ref{equivalent_definition_regular_distribution}.
\end{rmk}


\begin{prop}\label{equivalent_definition_regular_distribution}
Let $(\measurespace, \sigmaalgebra, \measure)$ be a probability space, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$. Also let $(\measurespaceii, \sigmaalgebraiii)$ be a measurable space, and let 
$\function:\measurespace\to\measurespaceii$ be an
$(\sigmaalgebra, \sigmaalgebraiii)$\hyp{}measurable function, with
$\preimage{\function} : \sigmaalgebraiii \to \sigmaalgebra$.
If, given $(\measurespace, \sigmaalgebraii)$ and $(\measurespaceii, \sigmaalgebraiii)$, 
there is a Markov kernel $\markovkernel:\measurespace\times\sigmaalgebraiii\to [0,1]$ with 
$\markovkernel^{\setiii} \in \condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii)$ for each
$\setiii\in\sigmaalgebraiii$, then the collection 
$\{ 
\markovkernel^{\setiii}
: 
\setiii\in\sigmaalgebraiii
\}$
of $(\sigmaalgebraii,\borel_{[0,1]})$\hyp{}measurable functions
is a regular version of the conditional distribution ${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ of 
$\function$ on $\sigmaalgebraiii$ given $\sigmaalgebraii$, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{ 
\Lone \ar[r]^{\condexpop{\sigmaalgebraii}}
& \Lone 
& \measurespace 
\ar[d]_-{\fixinthesecond{\setiii}} 
\ar[dr]^{\qquad\text{$\markovkernel^{\setiii} \in \condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii)$}}
\\
& 
& \measurespace\times\sigmaalgebraiii \ar[r]^{\markovkernel} 
& [0,1] 
\\
\sigmaalgebra \ar[uu]^{Q\circ\chi} \ar[uur]_{\condprobop{\sigmaalgebraii}} 
& \sigmaalgebraiii 
\ar[uu]_{\condprobop{\sigmaalgebraii}\circ \preimage{\function}} 
\ar[l]_{\preimage{\function}}
& \sigmaalgebraiii \ar[ur]_{\qquad\text{probability measure}} \ar[u]^{\fixinthefirst{\mspaceelt}} 
& 
\\
}
\]
Conversely, if the conditional distribution
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ 
of 
$\function$ on $\sigmaalgebraiii$ given $\sigmaalgebraii$ is regular, then
given $(\measurespace, \sigmaalgebraii)$ and $(\measurespaceii, \sigmaalgebraiii)$ 
there is a Markov kernel $k:\measurespace\times\sigmaalgebraiii\to [0,1]$ with 
$k^{\setiii} \in
\condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii)$ for each 
$\setiii\in\sigmaalgebraiii$.
\end{prop}


\begin{proof}
Let 
$\markovkernel:\measurespace\times\sigmaalgebraiii\to [0,1]$ 
be a Markov kernel given $(\measurespace, \sigmaalgebraii)$ and $(\measurespaceii, \sigmaalgebraiii)$, with each
$\markovkernel^{\setiii} \in \condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii)$.
To show that the collection 
$\{ \markovkernel^{\setiii} :
\setiii\in\sigmaalgebraiii\}$ 
is a regular version of the conditional distribution 
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ of 
$\function$ on $\sigmaalgebraiii$ given $\sigmaalgebraii$, see that we can 
use the hypothesis that 
$\markovkernel^{\setiii} \in \condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii)$
to specify the selection function:
\[
\regular:\Lone\to\caliLone:
\condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii) \mapsto
\markovkernel^{\setiii}.
\]
By the hypothesis that
$\markovkernel:\measurespace\times\sigmaalgebraiii\to [0,1]$ 
is a Markov kernel given $(\measurespace, \sigmaalgebraii)$ and $(\measurespaceii, \sigmaalgebraiii)$,
this selection function has the  additional properties that for each
$\setiii\in\sigmaalgebraiii$, the map 
\[
\measurespace\to [0,1] : \mspaceelt\mapsto
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr](\mspaceelt) 
=
\markovkernel^{\setiii} (\mspaceelt)
\]
is $\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable, and for each 
$\mspaceelt\in\measurespace$ the  map
\[
\sigmaalgebraiii\to [0,1]: \setiii \mapsto 
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr](\mspaceelt)
= \markovkernel\circ\fixinthefirst{\mspaceelt}(\setiii)
\]
is a probability measure on $\sigmaalgebraiii$, 
showing that 
$\{ \markovkernel^{\setiii} :
\setiii\in\sigmaalgebraiii\}$ 
is a regular version of the conditional distribution 
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ of 
$\function$ on $\sigmaalgebraiii$ given $\sigmaalgebraii$ by the very definition.

Now let 
${\condprobop{\sigmaalgebraii}}\circ \preimage{\function}$ 
be a regular conditional distribution of 
$\function$ on $\sigmaalgebraiii$ given $\sigmaalgebraii$, which means we are supposing there is a selection function
$\regular:\Lone\to\caliLone$
with the additional properties that for each
$\setiii\in\sigmaalgebraiii$, the map 
\[
\measurespace\to [0,1] : \mspaceelt\mapsto
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr](\mspaceelt)
\]
is $\bigl(\sigmaalgebraii, \borel_{[0,1]}\bigr)$\hyp{}measurable, and for each 
$\mspaceelt\in\measurespace$ the  map
\[
\sigmaalgebraiii\to [0,1]: \setiii \mapsto 
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr](\mspaceelt)
\]
is a probability measure on $\sigmaalgebraiii$.
It means that we can define the Markov kernel
$\markovkernel:\measurespace\times\sigmaalgebraiii\to [0,1]$ 
given $(\measurespace, \sigmaalgebraii)$ and $(\measurespaceii, \sigmaalgebraiii)$
by 
\[
(\mspaceelt,\setiii)
\mapsto
\bigl[ (\regular\circ\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr](\mspaceelt).
\]
By definition, the selection function has the property that 
\[
\regular
\bigl((\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr)
\in
(\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)
\]
and since 
$k^{\setiii}
=
\regular
\bigl((\condprobop{\sigmaalgebraii}\circ\preimage{\function}) (\setiii)\bigr)$,
it follows that
$k^{\setiii} \in
\condprobop{\sigmaalgebraii}\circ \preimage{\function}(\setiii)$ for each 
$\setiii\in\sigmaalgebraiii$, as required.
\end{proof}


\begin{defn}
Proposition~\ref{equivalent_definition_regular_distribution} says that to each regular conditional distribution there corresponds a particular Markov kernel. We will call that kernel the
\term{corresponding Markov kernel}.
\end{defn}


\begin{prop}\label{induced_marginals}
Let $\measlambda$ be a measure on a \textsigma-algebra
$\uspacesig$,
and let
$(\funcf,\funcg):\uspace\to \measurespace  \times \measurespaceii $
be a
$\bigl(\uspacesig,\productsig{\sigmaalgebra}{\sigmaalgebraii}\bigr)$\hyp{}measurable
function.
Let the joint
$\measonprod
=
\measlambda\circ\preimage{(\funcf,\funcg)}$,
and let the marginal
$\marginalone
=
\measonprod\circ\preimage{\projectionone}$
and the marginal
$\marginaltwo
=
\measonprod\circ\preimage{\projectiontwo}$.
Then
\[
\marginalone
=
\measlambda\circ\preimage{\funcf}
\]
and
\[
\marginaltwo
=
\measlambda\circ\preimage{\funcg}
\]
as illustrated:
\[
\xymatrix@R=16pt@C=30pt{
 & \measurespace
 \\
 \uspace
 \ar[ur]^{\funcf}
 \ar[dr]_{\funcg}
 \ar[r]^{\funcf, \funcg} &
 \measurespace \times \measurespaceii  \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
 & \measurespaceii  \\
}
\qquad
\xymatrix@R=16pt@C=34pt{
 & & \sigmaalgebra
 \ar[dl]_{\preimage{\funcf}}
 \ar[d]^{\preimage{\projectionone}}
 \ar@/_10pt/[lld]_{\makebox[0pt][r]{$\scriptstyle{\marginalone} = $}\measlambda\circ\preimage{\funcf}}
 \\
 [0,\infty] & \uspacesig \ar[l]_-{\measlambda} &
 \productsig{\sigmaalgebra}{\sigmaalgebraii}
 \ar[l]_{\preimage{(\funcf,\funcg)}}
 \\
 & & \sigmaalgebraii
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{\funcg}}
  \ar@/^10pt/[llu]^{\makebox[0pt][r]{$\scriptstyle{\marginaltwo} = $}\measlambda\circ\preimage{\funcg}}
  \\
}
\]
\end{prop}

\begin{proof}
This is just ``set theory.''  For example, while showing
$\measonprod \circ \preimage{\projectionone}
=
\measlambda\circ\preimage{\funcf}$,
you might use the fact that
$\preimage{\projectionone}(S) = S\times \measurespaceii $ for any $S\subseteq \measurespace $.
\end{proof}



\begin{prop}\label{marginal_implies_regular}
Let
$(\uspace, \uspacesig, \measlambda)$
be a probability space, with functions
$\funcf:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$
and
$\funcg:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$
measurable.
Set
$\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$.
Let $\measonprod$ denote the joint measure
$\measlambda\circ\preimage{({\funcf,\funcg})}$,
and let $\marginalone$  denote the marginal measure $\measonprod\circ \preimage{\projectionone}$,
and let $\marginaltwo$ denote the marginal measure $\measonprod\circ \preimage{\projectiontwo}$.

If\,
$\measonprod \abscont (\marginalone\times\marginaltwo)^*$
on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$,
then the conditional distribution
$\condprobop{\sigalg{G}}\circ \preimage{\funcf}$ of $\funcf$ on
$\sigmaalgebra$ given $\sigalg{G}$ is regular, and symmetrically, setting
$\sigalg{F} = \preimage{\funcf}(\sigmaalgebra)$, the conditional distribution
$\condprobop{\sigalg{F}}\circ \preimage{\funcg}$ of $\funcg$ on
$\sigmaalgebraii$ given $\sigalg{F}$ is regular.
\end{prop}

\begin{proof}
Let $\joint \abscont (\marginalone\times\marginaltwo)^*$.
We have set
$\joint = \measlambda\circ\preimage{({\funcf,\funcg})}$:
\[
\xymatrix@R=16pt@C=34pt{
 & \measurespace
 \\
 \uspace
 \ar[ur]^{\funcf}
 \ar[dr]_{\funcg}
 \ar[r]^{\funcf, \funcg} &
 \measurespace \times \measurespaceii  \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
 & \measurespaceii  \\
}
\qquad
\xymatrix@R=18pt@C=34pt{
 & & \sigmaalgebra
 \ar[dl]_{\preimage{\funcf}}
 \ar[d]^{\preimage{\projectionone}}
 \ar@/_10pt/[lld]_{\marginalone}
 \\
 [0,1] & \uspacesig \ar[l]_-{\measlambda} &
 \productsig{\sigmaalgebra}{\sigmaalgebraii}
 \ar[l]_{\hskip8pt \preimage{(\funcf,\funcg)}}
 \\
 & & \sigmaalgebraii
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{\funcg}}
  \ar@/^10pt/[llu]^{\marginaltwo}
  \\
}
\]

We will define a map
$\funck: \uspace\times \sigmaalgebra \to [0,1]$, then show it is a Markov kernel, and then apply Proposition~\ref{equivalent_definition_regular_distribution}.


But first step, define a map
$\funcj:\measurespaceii\times\sigmaalgebra\to \R$. By hypothesis,
$\measonprod \abscont (\marginalone\times\marginaltwo)^*$, and since the measure
$\measonprod$ is finite, and the measure $(\marginalone\times\marginaltwo)^*$ is also finite, therefore \textsigma\hyp{}finite, we can take the Radon-Nikodym derivative
$d\measonprod / d(\marginalone\times\marginaltwo)^*$, and define:
\[
\funcj
:\measurespaceii\times\sigmaalgebra\to \R
:(\mspaceeltii,\seti)\mapsto
\int_\seti
\dfrac{d\,\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\, d\marginalone(\mspaceelt),
\]
which is illustrated in a fashion similar to a Markov kernel:
\[
\xymatrix@R=16pt@C=30pt{
\measurespaceii
\ar[d]_-{\fixinthesecond{\seti}}
\ar[dr]^{\funcj^\seti} &
\\
\measurespaceii\times\sigmaalgebra \ar[r]^{\funcj} & \R
\\
\sigmaalgebra
\ar[ur]_{\funcj_\mspaceeltii}
\ar[u]^{\fixinthefirst{\mspaceeltii}} &
\\
}
\]
We will show this map can be redefined, resulting in a  Markov kernel.

By Proposition~\ref{almost_a_measure},
$j^\measurespace(\mspaceeltii) = 1$
for $\marginaltwo^\kernast$\hyp{}almost all  $\mspaceeltii\in\measurespaceii$; say for all
$\mspaceeltii\in\measurespaceii$ except for  those
$\mspaceeltii$ in a $\marginaltwo^\kernast$\hyp{}null subset $N$ of
$\measurespaceii$.
The set inclusion
$\seti\subseteq\measurespace$
implies the inequality
$\funcj^\seti \leq
\funcj^\measurespace$,
and so $0 \leq \funcj_\mspaceeltii \leq 1$ for all $\mspaceeltii \notin N$.
It means that we can redefine the codomain of each such $\funcj_\mspaceeltii$ to be the interval $[0,1]$, and it implies that each such $\funcj_\mspaceeltii$ is a probability measure.
Fix $\mspaceeltiii\in\measurespaceii$ with $\mspaceeltiii\notin N$, so $\funcj_\mspaceeltiii$ is a probability measure. For each
$\mspaceeltii \in N$,
redefine
$\funcj_\mspaceeltii(\seti)
\definedby
\funcj_\mspaceeltiii(\seti)$,
so now all the $\funcj_\mspaceeltii$ are probability measures.
In summary,
\[
\funcj_\mspaceeltii
:\sigmaalgebra \to [0,1]
:\seti \mapsto
\begin{cases}
\displaystyle \int_\seti
\dfrac{d\,\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\, d\marginalone(\mspaceelt)
& \text{if $\mspaceeltii\notin N$}
\\
\funcj_\mspaceeltiii(\seti) \quad\text{for that fixed $\mspaceeltiii$}
& \text{if $\mspaceeltii \in N$}
\\
\end{cases}
\]

The representative function
$d\,\measonprod/(\marginalone\times\marginaltwo)^*$
is integrable with respect to the measure
$\marginalone\times\marginaltwo$, and this means  by Fubini's~\ref{fubini} that the iterated integrals exist and in particular for each
$\seti\in\sigmaalgebra$,
the map $\funcj^\seti$ defines an integrable function over
$\measurespaceii$ with respect to the measure $\marginaltwo$.
By Proposition~\ref{sigma_algebra_measurable}, each $\funcj^\seti$ can be taken
$(\sigmaalgebraii,\borel_\R)$\hyp{}measurable.
We can redefine the codomain of each
$\funcj^\seti$ to be $[0,1]$ rather than all of $\R$
by modifying each function $\funcj^\seti$ on that $\marginaltwo^\kernast$\hyp{}null set $N$.
Redefine
$\funcj^\seti(\mspaceeltii)
\definedby
\funcj^\seti(\mspaceeltiii)$ if $\mspaceeltii \in N$,
where the
$\mspaceeltiii\in\measurespaceii$ with $\mspaceeltiii\notin N$
is the same fixed element from the previous paragraph.
We know that
$\funcj^\seti(\mspaceeltiii)= \funcj_\mspaceeltiii(\seti)$ by their definitions,
and
$\funcj_\mspaceeltiii(\seti) \in [0,1]$
implies
$\funcj^\seti(\mspaceeltiii) \in [0,1]$,
so the codomain of each $j^\seti$ can be taken $[0,1]$. And each such function $\funcj^\seti$ is
$\bigl( \sigmaalgebraii, \borel_{[0,1]} \bigr)$\hyp{}measurable.
In summary,
\[
\funcj^\seti
:\measurespaceii \to [0,1]
:\mspaceeltii \mapsto
\begin{cases}
\displaystyle \int_\seti
\dfrac{d\,\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\, d\marginalone(\mspaceelt)
& \text{if $\mspaceeltii\notin N$}
\\
\funcj^\seti(\mspaceeltiii)  \quad\text{for that fixed $\mspaceeltiii$}
& \text{if $\mspaceeltii \in N$}
\\
\end{cases}
\]

This gives us a Markov kernel:
\[
\xymatrix@R=16pt@C=30pt{
\measurespaceii
\ar[d]_-{\fixinthesecond{\seti}}
\ar[dr]^{\funcj^\seti} &
\\
\measurespaceii\times\sigmaalgebra \ar[r]^{\funcj} & [0,1]
\\
\sigmaalgebra
\ar[ur]_{\funcj_\mspaceeltii}
\ar[u]^{\fixinthefirst{\mspaceeltii}} &
\\
}
\]

Second step, we define a map
$\funck: \uspace\times \sigmaalgebra \to [0,1]$
by
\[
\funck: \uspace\times \sigmaalgebra \to [0,1] :
(\uspaceelt,\seti) \mapsto \funcj\bigl(\funcg(\uspaceelt),\seti\bigr),
\]
and check that it is a Markov kernel.
The function $\funcg$ is
$(\sigalg{G},\sigmaalgebraii)$\hyp{}measurable just by the very fact that
$\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$. And since each
$\funcj^\seti$ is
$\bigl( \sigmaalgebraii, \borel_{[0,1]} \bigr)$\hyp{}measurable, it follows that the composition
\[
\funck^\seti\definedby\funcj^\seti\circ\funcg
: \uspace \to [0,1]
:\uspaceelt \mapsto (\funcj^\seti\circ\funcg)(\uspaceelt)
\]
is
$\bigl( \sigalg{G}, \borel_{[0,1]} \bigr)$\hyp{}measurable.
And each function
$\funck_\uspaceelt : \sigmaalgebra \to [0,1]$ is a probability measure on
$\sigmaalgebra$ since
$\funck_\uspaceelt = \funcj_{\funcg(\uspaceelt)}$.
This shows that $\funck$ is a Markov kernel.

Verify that
$\funck^\seti \in \condprobop{\sigalg{G}}\circ \preimage{\funcf}(\seti)$ for each $\seti\in\sigmaalgebra$, so the collection of $\funck^\seti$ is a version of
$\condprobop{\sigalg{G}}\circ \preimage{\funcf}$. It follows by Proposition~\ref{equivalent_definition_regular_distribution} that
$\condprobop{\sigalg{G}}\circ \preimage{\funcf}$ is regular, as required.
\end{proof}



\begin{prop}\label{mixed_implies_bayes}
Let
$(\uspace, \uspacesig, \measlambda)$
be a probability space, with functions
$\funcf:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$
and
$\funcg:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$
measurable.
Set
$\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$.
Let $\measonprod$ denote the joint measure
$\measlambda\circ\preimage{({\funcf,\funcg})}$,
and let $\marginalone$  denote the marginal measure $\measonprod\circ \preimage{\projectionone}$,
and let $\marginaltwo$ denote the marginal measure $\measonprod\circ \preimage{\projectiontwo}$.
Let $\measnu$ be a \textsigma\hyp{}finite measure on $\sigmaalgebraii$.

Let
$\measonprod \abscont (\marginalone\times\measnu)^*$
on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$,
and let $\funck$ denote the Markov kernel corresponding to the regular conditional distribution
$\condprobop{\sigalg{G}}\circ \preimage{\funcf}$ of $\funcf$ on
$\sigmaalgebra$ given $\sigalg{G}$.
If
$\funcj^\seti : \measurespaceii \to [0,1]$
is any collection of
$\bigl( \sigmaalgebraii,\borel_{[0,1]} \bigr)$\hyp{}measurable
functions such that
$\funck^\seti = \funcj^\seti \circ \funcg$,
then for $\measnu^\kernast$\hyp{}almost all $\mspaceeltii\in\measurespaceii$,
\[
\funcj^\seti(\mspaceeltii)
=
\int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\, d\marginalone(\mspaceelt).
\]
\end{prop}

\begin{proof}
With
$\measonprod \abscont (\marginalone\times\measnu)^*$
on
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$,
it follows by Proposition~\ref{mixed_implies_marginal} that
$\measonprod \abscont (\marginalone\times\marginaltwo)^*$,
and so by Proposition~\ref{marginal_implies_regular},
the conditional distribution
$\condprobop{\sigalg{G}}\circ \preimage{\funcf}$ of $\funcf$ on
$\sigmaalgebra$ given $\sigalg{G}$
is regular.
We are letting $\funck$ denote the Markov kernel corresponding to
$\condprobop{\sigalg{G}}\circ \preimage{\funcf}$,
illustrated as:
\[%conditional probability markov
\xymatrix@R=16pt@C=30pt{
L_1(\uspace, \uspacesig, \measureiii) \ar[r]^{\condexpop{\sigalg{G}}}
& L_1(\uspace, \uspacesig, \measureiii)
& \uspace
\ar[d]_-{\fixinthesecond{\seti}}
\ar[dr]^{\funck^\seti}
\\
&
& \uspace\times\sigmaalgebra \ar[r]^{\funck}
& [0,1]
\\
\uspacesig
\ar[uu]^{Q\,\circ\,\charfunction{}}
\ar[uur]_{\condprobop{\sigalg{G}}}
& \sigmaalgebra
\ar[uu]_{\condprobop{\sigalg{G}}\circ \preimage{\function}}
\ar[l]_{\preimage{\function}}
& \sigmaalgebra
\ar[u]^{\fixinthefirst{\uspaceelt}}
\ar[ur]_{\funck_\uspaceelt}
&
\\
}
\]
Let
$\funcj^\seti : \measurespaceii \to [0,1]$
be any collection of
$\bigl( \sigmaalgebraii,\borel_{[0,1]} \bigr)$\hyp{}measurable
functions such that
$\funck^\seti = \funcj^\seti \circ \funcg$, as illustrated:
\[
\xymatrix@R=0pt@C=30pt{
(\uspace,\sigalg{G})
\ar[r]_-{\funcg} \ar@/^16pt/[rr]^{\funck^\seti}
& (\measurespaceii,\sigmaalgebraii)
\ar[r]_-{\funcj^\seti}
& \bigl( [0,1], \borel_{[0,1]} \bigr) \\
\scriptstyle{\preimage{\funcg}(\setii)} & \scriptstyle{\setii} & \\
}
\]
With
$\measonprod\abscont(\marginalone\times\measnu)^*$,
we can apply Proposition~\ref{reference_implies_marginals} to get
$\marginaltwo\abscont\measnu$ on $\sigmaalgebraii$.
And in turn, we can apply the Radon-Nikodym corollary, namely Proposition~\ref{radon_nikodym_corollary} to get
\[
\int_\setii \funcj^\seti  \dfrac{d\marginaltwo}{d\measnu} \, d \measnu
=
\int_\setii \funcj^\seti \, d \marginaltwo.
\]
Applying a change of variable according to Proposition~\ref{change_of_variable},
\[
\int_\setii \funcj^\seti \, d \marginaltwo
=
\int_{\preimage{\funcg}(\setii)}
\funck^\seti \, d\measlambda.
\]
With
$\funck^\seti \in \condprobop{\sigalg{G}}\circ \preimage{\funcf}(\seti)$,
it follows that
\[
\int_{\preimage{\funcg}(\setii)}
\funck^\seti \, d\measlambda
=
\inducedint_{\preimage{\funcg}(\setii)}
(\condprobop{\sigalg{G}}\circ \preimage{\funcf})(\seti)\,d\measlambda.
\]
By Proposition~\ref{conditional_probability_of_a_set},
\[
\inducedint_{\preimage{\funcg}(\setii)}
(\condprobop{\sigalg{G}}\circ \preimage{\funcf})(\seti)\,d\measlambda
=
\measlambda\bigl(\preimage{\funcg}(\setii)\meets\preimage{\funcf}(\seti)\bigr).
\]
Since
$\measonprod =
\measlambda\circ\preimage{({\funcf,\funcg})}$,
\[
\measlambda\bigl(\preimage{\funcg}(\setii)\meets\preimage{\funcf}(\seti)\bigr)
=
\measonprod(\seti\times\setii).
\]
By transitivity of equality, we have shown so far that
\[
\measonprod(\seti\times\setii)
=
\int_\setii \funcj^\seti  \dfrac{d\marginaltwo}{d\measnu} \, d \measnu.
\]

Again, with
$\measonprod\abscont(\marginalone\times\measnu)^*$,
we can apply Fubini's Theorem~\ref{fubini} to get
\[
\measonprod(\seti\times\setii)
=
\int_\setii
\int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}
\, d\marginalone
\, d\measnu.
\]
This says that
\[
\int_\setii
\left( \funcj^\seti  \dfrac{d\marginaltwo}{d\measnu} \right)
d \measnu
=
\int_\setii
\left(
\int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}
\, d\marginalone
\right)
d\measnu
\]
for all $\setii\in\sigmaalgebraii$.
By Proposition~\ref{uniqueness_radon_nikodym},
\[
\funcj^\seti(\mspaceeltii)  \dfrac{d\marginaltwo}{d\measnu}(\mspaceeltii)
=
\int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\, d\marginalone(\mspaceelt)
\]
for $\measnu^\kernast$\hyp{}almost all $\mspaceeltii\in\measurespaceii$,
and by Proposition~\ref{reference_implies_marginals},
\[
\frac{d \marginaltwo}
{d\measnu}(\mspaceeltii)
=
\int_{\measurespace}
\frac{d\measonprod}{d(\marginalone\times\measnu)^*}
(\mspaceelt,\mspaceeltii)\,d\marginalone(\mspaceelt),
\]
so
\[
\funcj^\seti(\mspaceeltii)
=
\dfrac{\displaystyle \int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\, d\marginalone(\mspaceelt)}
{\displaystyle\int_{\measurespace}
\frac{d\measonprod\lilstrut}{d(\marginalone\times\measnu)^*}
(\mspaceelt,\mspaceeltii)\,d\marginalone(\mspaceelt)}
\]
for $\measnu^\kernast$\hyp{}almost all $\mspaceeltii\in\measurespaceii$.
By Proposition~\ref{mixed_implies_half},
\[
\int_\seti
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\,d\marginalone(\mspaceelt)
=
\frac{\displaystyle
\int_\seti
\dfrac{d\measonprod}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\,d\marginalone(\mspaceelt)
}
{\displaystyle
\int_\measurespace
\dfrac{d\measonprod\lilstrut}{d(\marginalone\times\measnu)^*}(\mspaceelt,\mspaceeltii)
\,d\marginalone(\mspaceelt)
}
\]
so
\[
\funcj^\seti(\mspaceeltii)
=
\int_\seti
\frac{d\measonprod}{d(\marginalone\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)\,d\marginalone(\mspaceelt)
\]
for $\measnu^\kernast$\hyp{}almost all $\mspaceeltii\in\measurespaceii$,
as required.
\end{proof}







\section{Conditional Densities}
%*********************************************************
%*********************************************************
\begin{rmk}
Proposition~\ref{joint_decomposition} and Proposition~\ref{conditional_density} are supporting lemmas for the conditional independence equivalences given in Proposition~\ref{conditional_independence_equivalence}.
\end{rmk}

\begin{propboldnote}\label{joint_decomposition}
Let
$(\uspace, \uspacesig, \measureiii)$
be a probability space, and let the functions
$\function:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$
and
$\funcg:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$
be measurable. Set
$\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$.
Let $\measonprod$ denote the joint measure  $\measureiii\circ\preimage{(\function,\funcg)}$,
and let $\marginaltwo$ denote the marginal measure $\measlambda\circ\preimage{\funcg}$.
Let the conditional distribution
\[
\condprobop{\sigalg{G}}\circ\, \preimage{\function}:
\sigmaalgebra \to L_1(\uspace,\uspacesig,\measureiii)
\]
of $\function$ on $\sigmaalgebra$ given $\sigalg{G}$
be regular, and let
$\funck$
denote the corresponding Markov kernel given
$(\uspace,\sigalg{G})$ and $(\measurespace,\sigmaalgebra)$ such that
$\funck^\seti\in
\condprobop{\sigalg{G}}\circ\, \preimage{\function}(\seti)$
for all $\seti\in\sigmaalgebra$.

If a function
$j:\measurespace\times\measurespaceii \to \R$
is integrable over
$\measurespace\times\measurespaceii$
with respect to the joint measure $\measonprod$,
then
\[
\int_{\measurespace\times\measurespaceii} \funcj \,
d \measonprod
=
\int_\measurespaceii\int_\measurespace
\funcj(\mspaceelt,\mspaceeltiii) \,
d \funck_\uspaceelt(\mspaceelt)\,
d \marginaltwo(\mspaceeltii),
\]
where  $\funcg(\uspaceelt) = \mspaceeltii$.
\end{propboldnote}


\begin{proof}
We have set
$\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$ because
subscripts do not suffer symbols like
$\preimage{\funcg}(\sigmaalgebraii)$ or $\sagb(\funcg)$
well.
Let the conditional distribution
\[
\condprobop{\sigalg{G}}\circ\, \preimage{\function}:
\sigmaalgebra \to L_1(\uspace,\uspacesig,\measureiii)
\]
of $\function$ on $\sigmaalgebra$ given $\sigalg{G}$
be regular, and we let
$\funck$
denote the corresponding Markov kernel given
$(\uspace,\sigalg{G})$ and $(\measurespace,\sigmaalgebra)$, as illustrated:
\[%conditional probability markov
\xymatrix@R=16pt@C=30pt{
L_1(\uspace, \uspacesig, \measureiii) \ar[r]^{\condexpop{\sigalg{G}}}
& L_1(\uspace, \uspacesig, \measureiii)
& \uspace
\ar[d]_-{\fixinthesecond{\seti}}
\ar[dr]^{\funck^\seti}
\\
&
& \uspace\times\sigmaalgebra \ar[r]^{\funck}
& [0,1]
\\
\uspacesig
\ar[uu]^{Q\,\circ\,\charfunction{}}
\ar[uur]_{\condprobop{\sigalg{G}}}
& \sigmaalgebra
\ar[uu]_{\condprobop{\sigalg{G}}\circ \preimage{\function}}
\ar[l]_{\preimage{\function}}
& \sigmaalgebra
\ar[u]^{\fixinthefirst{\uspaceelt}}
\ar[ur]_{\funck_\uspaceelt}
&
\\
}
\]

For each set $\seti\in\sigmaalgebra$, the function
$\funck^\seti$ factors as some function $\funca$ composed with $\funcg$,
that is, $\funck^\seti= \funca \circ \funcg$,
which was the heart of Proposition~\ref{factoring_functions}:
\[
\xymatrix@R=14pt@C=30pt{
(\uspace,\sigalg{G})
\ar[r]^-{\funck^\seti}
\ar[dr]_{\funcg}
& \bigl([0,1],\borel_{[0,1]}\bigr) \\
 & (\measurespaceii,\sigmaalgebraii) \ar@{.>}[u]_{\funca}\\
}
\]
The evaluation
$\funck^\seti(\uspaceelt)
=
a\bigl(\funcg(\uspaceelt)\bigr)$
may be restated as
$\funck^\seti(\uspaceelt)
=
a\bigl(\mspaceeltii)$
if
$\funcg(\uspaceelt)
=
\mspaceeltii$.
Since $\funck^\seti(\uspaceelt) = \funck_\uspaceelt(\seti),$
we can write
\[
a(\mspaceeltii)=\funck_\uspaceelt(\seti) \text{ for } \mspaceeltii = \funcg(\uspaceelt).
\]

It is sufficient to show that the required equality holds for characteristic functions of the form
$\funcj
=
\charfunction{\seti\times\setii}$
with
$\seti\in\sigmaalgebra$
and
$\setii\in\sigmaalgebraii$.
Set
$\funcj
=
\charfunction{\seti\times\setii}$,
so
\[
\int_{\measurespace\times\measurespaceii}
\funcj
\, d\measonprod
=
\measlambda\bigl(\preimage{\funcf}(\seti)\meets \preimage{\funcg}(\setii)\bigr).
\]
By Proposition~\ref{conditional_probability_of_a_set},
\[
\measlambda\bigl(\preimage{\funcf}(\seti)\meets \preimage{\funcg}(\setii)\bigr)
=
\inducedint_{\preimage{\funcg}(\setii)}
\condprobop{\sigalg{G}}\circ\, \preimage{\function}(\seti)
\, d\measlambda.
\]
The hypothesis that the conditional distribution
\[
\condprobop{\sigalg{G}}\circ\, \preimage{\function}:
\sigmaalgebra \to L_1(\uspace,\uspacesig,\measureiii)
\]
of $\function$ on $\sigmaalgebra$ given $\sigalg{G}$
is regular means that
$\funck^\seti
\in
\condprobop{\sigalg{G}}\circ\, \preimage{\function}(\seti),$
so
\[
\inducedint_{\preimage{\funcg}(\setii)}
\condprobop{\sigalg{G}}\circ\, \preimage{\function}(\seti)
\, d\measlambda
=
\int_{\preimage{\funcg}(\setii)}
\funck^\seti \, d\measlambda,
\]
and with $\funck^\seti = a\circ \funcg$,
\[
\int_{\preimage{\funcg}(\setii)}
\funck^\seti \, d\measlambda
=
\int_{\preimage{\funcg}(\setii)}
( a\circ\funcg ) \, d\measlambda.
\]
Use the fact that
\begin{align*}
\charfunction{\preimage{\funcg}(\setii)}{}\cdot{}(a\circ\funcg)
& =
(\charfunction{\setii}{}\circ{} \funcg)\cdot(a\circ\funcg) \\
& =
(\charfunction{\setii}{}\cdot{} a)\circ \funcg \\
\end{align*}
and write
\[
\int_{\preimage{\funcg}(\setii)}
( a\circ\funcg ) \, d\measlambda
=
\int_\uspace
(\charfunction{\setii}{}\cdot{} a)\circ \funcg
\, d\measlambda.
\]
Apply a change of variable:
\begin{align*}
\int_\uspace
(\charfunction{\setii}{}\cdot{} a)\circ \funcg
\, d\measlambda
& =
\int_\measurespaceii
(\charfunction{\setii}{}\cdot{} a)\, d\marginaltwo \\
& =
\int_\measurespaceii
\charfunction{\setii}(\mspaceeltii)
\cdot
a(\mspaceeltii)\, d\marginaltwo(\mspaceeltii).
\end{align*}
We know that
\[
a(\mspaceeltii)
=
\funck_\uspaceelt(\seti)
=
\int_\measurespace
\charfunction{\seti} (\mspaceelt)
\, d\funck_\uspaceelt (\mspaceelt)
\]
for $\mspaceeltii = \funcg(\uspaceelt)$.
By substitution for $a(\mspaceeltii)$:
\[
\int_\measurespaceii
\charfunction{\setii}(\mspaceeltii)
\cdot
a(\mspaceeltii)\, d\marginaltwo(\mspaceeltii)
=
\int_\measurespaceii
\charfunction{\setii}(\mspaceeltii)
\left(\int_\measurespace
\charfunction{\seti} (\mspaceelt)
\, d\funck_\uspaceelt (\mspaceelt)\right)
   d\marginaltwo (\mspaceeltii).
\]
By linearity of the integral, we can rewrite:
\[
\int_\measurespaceii
\charfunction{\setii}(\mspaceeltii)
\left(\int_\measurespace
\charfunction{\seti} (\mspaceelt)
\, d\funck_\uspaceelt (\mspaceelt)\right)
   d\marginaltwo (\mspaceeltii)
=
\int_\measurespaceii
\int_\measurespace
\charfunction{\seti} (\mspaceelt)
\charfunction{\setii}(\mspaceeltii)
\, d\funck_\uspaceelt (\mspaceelt)
\, d\marginaltwo (\mspaceeltii).
\]
And since
$\charfunction{\seti} (\mspaceelt)
\charfunction{\setii}(\mspaceeltii)
=
\charfunction{\seti\times\setii}(\mspaceelt,\mspaceeltii)$:
\begin{align*}
\int_\measurespaceii
\int_\measurespace
\charfunction{\seti} (\mspaceelt)
\charfunction{\setii}(\mspaceeltii)
\, d\funck_\uspaceelt (\mspaceelt)
\, d\marginaltwo (\mspaceeltii)
& =
\int_\measurespaceii
\int_\measurespace
\charfunction{\seti\times\setii}
(\mspaceelt,\mspaceeltii)
\, d\funck_\uspaceelt (\mspaceelt)
\, d\marginaltwo (\mspaceeltii) \\
& =
\int_\measurespaceii
\int_\measurespace
\funcj (\mspaceelt,\mspaceeltii)
\, d\funck_\uspaceelt (\mspaceelt)
\, d\marginaltwo (\mspaceeltii).
\end{align*}
By transitivity of equality then,
\[
\int_{\measurespace\times\measurespaceii}
\funcj
\, d\measonprod
=
\int_\measurespaceii
\int_\measurespace
\funcj (\mspaceelt,\mspaceeltii)
\, d\funck_\uspaceelt (\mspaceelt)
\, d\marginaltwo (\mspaceeltii),
\]
as required.
\end{proof}


\begin{rmk}
Just as in Remark~\ref{expected_value_probability} where the expected value could be computed as an integral with respect to a probability distribution, the regression function can be computed with respect to a probability measure corresponding to a conditional distribution.

Recall from Definition~\ref{cme_function} how the regression function $r$ was defined.
Let
$(\uspace,\uspacesig,\measlambda)$ be a probability space.
Let functions
$\funcf:\uspace\to\measurespace$
and
$\funcg:\uspace\to\measurespaceii$
be measurable.
Let $\funch:\measurespaceii\to\R$.
Setting $\sigalg{F}=\preimage{\funcf}(\sigmaalgebra)$, if
\[
\kondexpgvn{\ellclass{\funch\circ\funcg}{\measlambda}}{\funcf}
=
\ellclass{r \circ \funcf}{\measlambda\restrictedto{\sigalg{F}}}
\]
with the function  $r$ being an $(\sigmaalgebra,\borel_\R)$\hyp{}measurable function,
as illustrated in the following diagram, letting the function $e$ denote any representative of the class
$\kondexpgvn{\ellclass{\funch\circ\funcg}{\measlambda}}{\funcf}$:
\[
\begin{gathered}
\xymatrix@R=16pt@C=30pt{
(\uspace, \uspacesig)
\ar[r]^-{\funch\,\circ\,\funcg}
&
(\R, \borel_\R)
\\
\bigl(\uspace, \sigalg{F} \bigr)
\ar[r]^-{e}
\ar[dr]_{\funcf}
&
(\R,\borel_\R)
\\
&
(\measurespace, \sigmaalgebra)
\ar@{.>}[u]_{r}
\\
}
\end{gathered}
\quad
\text{meaning}
\quad
\kondexpgvn{\ellclass{\funch\circ\funcg}{\measlambda}}{\funcf}
=
\ellclass{r \circ \funcf}{\measlambda\restrictedto{\sigalg{F}}}
\]
We are calling the induced function $r$ the \emph{regression function}.
Under certain conditions, this function can be computed as
\[
r(\mspaceelt)
=
\int_\uspace (\funch\circ\funcg) \, d \funck_\uspaceelt
\quad
\text{where $\funcf(\uspaceelt)=\mspaceelt$}
\]
for $\measlambda\circ \preimage{\funcf}$ almost all $\mspaceelt\in\measurespace$.
In this case, $\funck$ is the Markov kernel corresponding to the conditional probability distribution
$\condprobop{\sigalg{F}}\circ \preimage{\funcg}$.
Very roughly, this might involve two changes of variable, and an application of
Proposition~\ref{joint_decomposition}.
The changes of variable look like
\[
\int_{\preimage{\funcf}(\setiii)}
(r\circ\funcf)\, d\measlambda
=
\int_\setiii r\, d(\lambda\circ\preimage{\funcf})
\]
and
\[
\int_{\preimage{\funcf}(\setiii)}
(\funch\circ\funcg)\, d\measlambda
=
\int_{\setiii\times\measurespaceii}
(\funch\circ\projectiontwo)
\,d\bigl( \measlambda \circ \preimage{(\funcf,\funcg)} \bigr).
\]
It seems the only condition is the function $\funch\circ\projectiontwo$ should be integrable with respect to the joint measure
$\measlambda \circ \preimage{(\funcf,\funcg)}$.

If the idea that the regression function can be computed this way turns out to be useful, then we will come back and fill in the details.
\end{rmk}



\begin{prop}\label{conditional_density}
Let
$(\uspace, \uspacesig, \measureiii)$
be a probability space, and let functions
$\function:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$
and
$\funcg:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$
be measurable. Set
$\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$.
Let $\measonprod$ denote the joint measure $\measureiii\circ\preimage{(\function,\funcg)}$,
and let $\marginaltwo$ denote the marginal measure $\measlambda\circ\preimage{\funcg}$.
Let $\measmu$ be a \textsigma\hyp{}finite  measure on
$\sigmaalgebra$.

If the joint measure
$\measonprod\abscont (\measmu\times\marginaltwo)^*$, where
$\funck$
denotes the corresponding Markov kernel given
$(\uspace,\sigalg{G})$ and $(\measurespace,\sigmaalgebra)$ such that
$\funck^\seti\in
\condprobop{\sigalg{G}}\circ\, \preimage{\function}(\seti)$
for all $\seti\in\sigmaalgebra$,
then
for $\marginaltwo^*$\hyp{}almost all $\mspaceeltii\in\measurespaceii$, each measure
$\funck_\uspaceelt$
on $\sigmaalgebra$ such that $\funcg(\uspaceelt) = \mspaceeltii$
has the following density function with respect to the measure
$\measure$:
\[
\frac{d \funck_\uspaceelt}{d \measure}
:\measurespace\to\R
:\mspaceelt\mapsto
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
( \mspaceelt,\mspaceeltii ).
\]
\end{prop}


\begin{proof}
Let
$\measonprod\abscont (\measmu\times\marginaltwo)^*$, with a reminder that $\measmu$ is a reference measure on $\sigmaalgebra$, and $\marginaltwo$ is a marginal measure on
$\sigmaalgebraii$.
We are letting
$\funck$
denote the corresponding Markov kernel given
$(\uspace,\sigalg{G})$ and $(\measurespace,\sigmaalgebra)$, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{
L_1(\uspace, \uspacesig, \measureiii) \ar[r]^{\condexpop{\sigalg{G}}}
& L_1(\uspace, \uspacesig, \measureiii)
& \uspace
\ar[d]_-{\fixinthesecond{\seti}}
\ar[dr]^{\funck^\seti}
\\
&
& \uspace\times\sigmaalgebra \ar[r]^{\funck}
& [0,1]
\\
\uspacesig
\ar[uu]^{Q\,\circ\,\charfunction{}}
\ar[uur]_{\condprobop{\sigalg{G}}}
& \sigmaalgebra
\ar[uu]_{\condprobop{\sigalg{G}}\circ \preimage{\function}}
\ar[l]_{\preimage{\function}}
& \sigmaalgebra
\ar[u]^{\fixinthefirst{\uspaceelt}}
\ar[ur]_{\funck_\uspaceelt}
&
\\
}
\]
It is sufficient to show that
for $\marginaltwo^*$\hyp{}almost all $\mspaceeltii\in\measurespaceii$,
if $\seti\in\sigmaalgebra$, and
$\mspaceeltii = \funcg(\uspaceelt)$,
then
\[
\funck_\uspaceelt(\seti)
=
\int_\seti
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
( \mspaceelt, \mspaceeltii )
\,d\measmu(\mspaceelt).
\]

Let
$\seti\in\sigmaalgebra$
and
$\setii\in\sigmaalgebraii$.
Then
$\charfunction{\seti\times\setii}$
is integrable with respect to the joint measure
$\measonprod$.
Since
$\measonprod \abscont (\measmu\times\marginaltwo)^*$,
it follows by Proposition~\ref{radon_nikodym_corollary} that
\[
\int_{\measurespace\times\measurespaceii}
\charfunction{\seti\times\setii}
\, d\measonprod
=
\int_{\measurespace\times\measurespaceii}
\charfunction{\seti\times\setii}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
d(\measmu\times\marginaltwo).
\]
By Fubini's Theorem~\ref{fubini},
\[
\int_{\measurespace\times\measurespaceii}
\charfunction{\seti\times\setii}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
d(\measmu\times\marginaltwo)
=
\int_{\measurespaceii}
\int_{\measurespace}
\charfunction{\seti\times\setii}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
d \measmu
\, d \marginaltwo .
\]
But also, by Proposition~\ref{joint_decomposition},
\[
\int_{\measurespace\times\measurespaceii}
\charfunction{\seti\times\setii}
\, d \measonprod
=
\int_\measurespaceii\int_\measurespace
\charfunction{\seti\times\setii}
(\mspaceelt,\mspaceeltii)
\, d \funck_\uspaceelt(\mspaceelt)
\, d \marginaltwo(\mspaceeltii),
\]
where  $\funcg(\uspaceelt) = \mspaceeltii$.
By transitivity of equality, this shows that
\[
\int_{\measurespaceii}
\int_{\measurespace}
\charfunction{\seti\times\setii}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
d \measmu
\, d \marginaltwo
=
\int_\measurespaceii
\int_\measurespace
\charfunction{\seti\times\setii}
(\mspaceelt,\mspaceeltii)
\, d \funck_\uspaceelt(\mspaceelt)
\, d \marginaltwo(\mspaceeltii),
\]
where  $\funcg(\uspaceelt) = \mspaceeltii$.
We can rewrite this as integration over sets:
\[
\int_{\setii}
\int_{\seti}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
d \measmu
\, d \marginaltwo
=
\int_\setii
\int_\seti
1_\measurespace
(\mspaceelt)
\, d \funck_\uspaceelt(\mspaceelt)
\, d \marginaltwo(\mspaceeltii),
\]
where  $\funcg(\uspaceelt) = \mspaceeltii$.
Since this is true for all $\setii\in\sigmaalgebraii$, it follows by Proposition~\ref{equal_function_test} that
\[
\int_{\seti}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
d \measmu(\mspaceelt)
=
\int_\seti
1_\measurespace
\, d \funck_\uspaceelt
\]
for $\marginaltwo^*$\hyp{}almost all $\mspaceeltii\in\measurespaceii$, and where
$\funcg(\uspaceelt)=\mspaceeltii$.
See that
\[
\int_\seti
1_\measurespace
\, d \funck_\uspaceelt
=
\funck_\uspaceelt(\seti).
\]
This means we have shown that
\[
\funck_\uspaceelt(\seti)
=
\int_{\seti}
\frac{d\measonprod}{d(\measure\times\marginaltwo)^*}
(\mspaceelt,\mspaceeltii)
d \measmu(\mspaceelt)
\]
for $\marginaltwo^*$\hyp{}almost all $\mspaceeltii\in\measurespaceii$, and where
$\funcg(\uspaceelt)=\mspaceeltii$, as required.
\end{proof}








\section{Conditional Independence}
%*********************************************************
%*********************************************************




\begin{defnboldnote}\label{conditionally_independent}
Let
$(\measurespace,\sigmaalgebra,\measure)$
be a probability space, and let $\sigmaalgebraii$ be a  $\textsigma$-subalgebra of
$\sigmaalgebra$.
Also, let $\sigmaalgebraiii$ and $\sigmaalgebraiv$ be \textsigma-subalgebras of $\sigmaalgebra$.
Then $\sigmaalgebraiii$ and $\sigmaalgebraiv$ are
\term{conditionally independent \textsigma\hyp{}subalgebras} given $\sigmaalgebraii$
if
\[
\condprobsub{\setiii\meets\setiv}{\sigmaalgebraii}
=
\condprobsub{\setiii}{\sigmaalgebraii}
\cdot
\condprobsub{\setiv}{\sigmaalgebraii}
\]
for all $\setiii\in\sigmaalgebraiii$ and for all $\setiv\in\sigmaalgebraiv$.
The notation
$\condindep{\sigmaalgebraiii}{\sigmaalgebraiv}{\sigmaalgebraii}$
may be used.
\nomenclature[conditionally independent]
{$\condindep{\sigmaalgebraiii}{\sigmaalgebraiv}{\sigmaalgebraii}$,}
{the \textsigma\hyp{}algebras $\sigmaalgebraiii$ and $\sigmaalgebraiv$ are conditionally independent given $\sigmaalgebraii$}
\end{defnboldnote}

\begin{example}
Let us try to understand conditional independence in two extreme cases, namely
\begin{itemize}
\item
case
$\sigmaalgebraii
=
\{\measurespace, \mtset\}$,
where conditional independence given
$\sigmaalgebraii$ is equivalent to independence with respect to the  measure $\measure^*$, and
\item
case
$\sigmaalgebraii
=
\sigmaalgebra$,
where all \textsigma\hyp{}subalgebras of $\sigmaalgebra$ are conditionally independent given
$\sigmaalgebraii$.
\end{itemize}

Case
$\sigmaalgebraii
=
\{\measurespace, \mtset\}$.
Verify that $\{\measurespace, \mtset\}$ is independent of every
$\textsigma$\hyp{}subalgebra of $\sigmaalgebra$ with respect to
$\measure^*$, for if $\sigalg{T}$ were another \textsigma\hyp{}subalgebra, we see that
\[
\measure^*(\seti\meets\setii)
=
\measure^*(\seti) \cdot \measure^*(\setii)
\quad
\text{for all $\seti\in \sigalg{T}$ and all $\setii\in \{\measurespace, \mtset\}$.}
\]
It follows then by Proposition~\ref{conditional_is_expected} that
\[
\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}
=
\bigl(\expval{\ellclass{\function}{\measure}}\bigr)
\cdot \ellclass{1}{\measure}
\]
for every
$\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$.
For
$\setiii\in\sigmaalgebraiii$ and for $\setiv\in\sigmaalgebraiv$,
the condition
\[
\condprobsub{\setiii\meets\setiv}{\sigmaalgebraii}
=
\condprobsub{\setiii}{\sigmaalgebraii}
\cdot
\condprobsub{\setiv}{\sigmaalgebraii}
\]
is equivalent by definition to
\[
\condexpsub{\ellclass{\charfunction{\setiii\meets\setiv}}{\measure}}{\sigmaalgebraii}
=
\condexpsub{\ellclass{\charfunction{\setiii}}{\measure}}{\sigmaalgebraii}
\cdot
\condexpsub{\ellclass{\charfunction{\setiv}}{\measure}}{\sigmaalgebraii},
\]
which in turn is equivalent to
\begin{align*}
\bigl(\expval{\ellclass{\charfunction{\setiii\meets\setiv}}{\measure}}\bigr)
\cdot \ellclass{1}{\measure}
& =
\bigl(\expval{\ellclass{\charfunction{\setiii}}{\measure}}\bigr)
\cdot \ellclass{1}{\measure}
\cdot
\bigl(\expval{\ellclass{\charfunction{\setiv}}{\measure}}\bigr)
\cdot \ellclass{1}{\measure} \\
& =
\bigl(\expval{\ellclass{\charfunction{\setiii}}{\measure}}\bigr)
\bigl(\expval{\ellclass{\charfunction{\setiv}}{\measure}}\bigr)
\cdot \ellclass{1}{\measure},\\
\end{align*}
implying that
\[
\measure^*(\setiii\meets\setiv) = \measure^*(\setiii)\cdot\measure^*(\setiv).
\]
This shows that conditional independence given
$\sigmaalgebraii = \{\measurespace, \mtset\}$ is equivalent to independence with respect to
$\measure^*$.


Case $\sigmaalgebraii = \sigmaalgebra$.
Then for all $\setiii\in\sigmaalgebraiii$ and for all $\setiv\in\sigmaalgebraiv$,
the functions
$\charfunction{\setiii\meets\setiv}$, $\charfunction{\setiii}$,
and $\charfunction{\setiv}$ are
$\bigl( \sigmaalgebraii, \borel_\R \bigr)$\hyp{}measurable.
It follows by Proposition~\ref{subalgebra_fixed} that the condition
\[
\condexpsub{\ellclass{\charfunction{\setiii\meets\setiv}}{\measure}}{\sigmaalgebraii}
=
\condexpsub{\ellclass{\charfunction{\setiii}}{\measure}}{\sigmaalgebraii}
\cdot
\condexpsub{\ellclass{\charfunction{\setiv}}{\measure}}{\sigmaalgebraii}
\]
is equivalent to
\[
\ellclass{\charfunction{\setiii\meets\setiv}}{\measure}
=
\ellclass{\charfunction{\setiii}}{\measure}
\cdot
\ellclass{\charfunction{\setiv}}{\measure},
\]
which is equivalent to
\[
\charfunction{\setiii\meets\setiv}
=
\charfunction{\setiii}
\cdot
\charfunction{\setiv}
\quad\text{$\measure^\kernast$\hyp{}almost everywhere on $\measurespace$.}
\]
This is always true.
This shows that all \textsigma\hyp{}subalgebras of $\sigmaalgebra$ are conditionally independent given $\sigmaalgebra$.
\end{example}






\begin{notn}\label{conditionally_independent_functions}
Let
$(\uspace,\uspacesig,\measureiii)$
be a probability space, and let functions
$\function:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$,
$\functionii:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$,
and
$\functioniii:(\uspace,\uspacesig)\to (\measurespaceiii,\sigmaalgebraiii)$
be measurable:
\[
\xymatrix@R=14pt@C=30pt{
 & \measurespace \\
 \uspace
 \ar[ur]^\function
 \ar[r]^\functionii
 \ar[dr]_\functioniii
 & \measurespaceii\\
 & \measurespaceiii \\
}
%
\qquad
%
\xymatrix@R=14pt@C=30pt{
 & \sigmaalgebra \ar[dl]_{\preimage{\function}} \\
 \uspacesig & \sigmaalgebraii \ar[l]_-{\quad \preimage{\functionii}}\\
 & \sigmaalgebraiii \ar[ul]^{\preimage{\functioniii}}\\
}
\]
Say that $\funcf$ and $\funcg$ are conditionally independent
given $\funch$ if
\[
\condindep{\preimage{\funcf}(\sigmaalgebra)}{\preimage{\funcg}(\sigmaalgebraii)}
{\preimage{\funch}(\sigmaalgebraiii)}.
\]
\end{notn}














\begin{prop}\label{abs_cont_reg}
Let
$(\uspace,\uspacesig,\measlambda)$
be a probability space, and let functions
$\function:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$,
$\functionii:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$,
and
$\functioniii:(\uspace,\uspacesig)\to (\measurespaceiii,\sigmaalgebraiii)$
be measurable, with \textsigma-finite  measures
$\measure$, $\measureii$, and $\measureiv$ on respective \textsigma-algebras
$\sigmaalgebra$, $\sigmaalgebraii$, and $\sigmaalgebraiii$.
Set $\sigalg{H}=\preimage{\funch}(\sigmaalgebraiii)$.
If
$\measureiii\circ\preimage{(\function,\functionii,\functioniii)}
\abscont
(\measure\times\measureii\times\measureiv)^*$ on
$\productsig{\sigmaalgebra}{\sigmaalgebraii,\sigmaalgebraiii}$,
then the conditional distributions
$\condprobop{\sigalg{H}}\circ \preimage{\funcf}$,
$\condprobop{\sigalg{H}}\circ \preimage{\funcg}$,
and
$\condprobop{\sigalg{H}} \circ \preimage{(\funcf,\funcg)}$
are regular.
\end{prop}

\begin{proof}
Set
$\sigalg{F}=\preimage{\funcf}(\sigmaalgebra)$,
and $\sigalg{G}=\preimage{\funcg}(\sigmaalgebraii)$.


Verify that if
\[
\measlambda\circ\preimage{(\function,\functionii,\functioniii)}
\abscont
(\measmu\times\measnu\times\measrho)^*
\]
on
$\productsig{\sigmaalgebra}{\sigmaalgebraii,\sigmaalgebraiii}
=
\productsig{\sigmaalgebra}{\productsig{\sigmaalgebraii}{\sigmaalgebraiii}}$,
then by applying the proof of Proposition~\ref{reference_implies_marginals}, you get
\[
\measlambda\circ \preimage{(\funcg,\funch)}
\abscont
(\measnu\times\measrho)^*
\]
on
$\productsig{\sigmaalgebraii}{\sigmaalgebraiii}$.
In particular, by applying the proof, you show
\[
\frac{d(\measlambda\circ \preimage{(\funcg,\funch)})}{d(\measnu\times\measrho)^*}
:\measurespaceii\times\measurespaceiii \to  \R
:(\mspaceeltii,\mspaceeltiii)\mapsto
\int_\measurespace
\frac{d(\measlambda\circ\preimage{(\function,\functionii,\functioniii)})}
{d(\measmu\times\measnu\times\measrho)^*}
(\mspaceelt,\mspaceeltii,\mspaceeltiii)\,d\measmu(\mspaceelt).
\]
Then by Proposition~\ref{reference_implies_mixed_and_marginals},
\[
\measlambda\circ \preimage{(\funcg,\funch)}
\abscont
\bigl((\measlambda\circ\preimage{\funcg})
\times
(\measlambda\circ\preimage{\funch})\bigr)^*,
\]
and so by Proposition~\ref{marginal_implies_regular},
the conditional distribution
$\condprobop{\sigalg{H}}\circ \preimage{\funcg}$
is regular.

Symmetrically, the conditional distribution
$\condprobop{\sigalg{H}}\circ \preimage{\funcf}$
must also be regular.

To show that
$\condprobop{\sigalg{H}} \circ \preimage{(\funcf,\funcg)}$
is regular, again, by Proposition~\ref{reference_implies_mixed_and_marginals},
\[
\measlambda\circ \preimage{(\funcf, \funcg, \funch)}
\abscont
\bigl((\measlambda\circ\preimage{(\funcf,\funcg)})
\times
(\measlambda\circ\preimage{\funch})\bigr)^*
\]
on
$\productsig{\sigmaalgebra}{\sigmaalgebraii,\sigmaalgebraiii}
=
\productsig{\productsig{\sigmaalgebra}{\sigmaalgebraii}}{\sigmaalgebraiii}$,
and so by Proposition~\ref{marginal_implies_regular},
the conditional distribution
$\condprobop{\sigalg{H}}\circ \preimage{(\funcf,\funcg)}$
is regular.
\end{proof}


%*********************************
%*********************************
%*********************************
%*********************************
%\section{Conditional Density Notation}
\begin{notn}\label{densities}
Let
$(\uspace, \uspacesig, \measureiii)$
be a probability space, with functions
$\funcf:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$,
$\funcg:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$
and
$\funch:(\uspace,\uspacesig)\to (\measurespaceiii,\sigmaalgebraiii)$
measurable.
Let $\measmu$, $\measnu$, and $\measrho$ be \textsigma\hyp{}finite measures on
$\sigmaalgebra$, $\sigmaalgebraii$, and $\sigmaalgebraiii$, respectively, and let
$\measlambda\circ \preimage{(\funcf,\funcg,\funch)}
\abscont
(\measmu\times\measnu\times\measrho)^*$
on
$\textsigma(\sigmaalgebra,\sigmaalgebraii,\sigmaalgebraiii)$.
Set:
\begin{align*}
\funcj
& =
\frac{d \bigl(\measlambda\circ \preimage{(\funcf,\funcg,\funch)}\bigr)}
{d(\measmu\times\measnu\times\measrho)^*}
:
\measurespace\times\measurespaceii\times\measurespaceiii\to\R,
\\
%
m_{\funcf,\funch}
& =
\frac{d \bigl( \measlambda\circ \preimage{(\funcf,\funch)} \bigr)}
{d(\measmu\times\measrho)^*}
:\measurespace\times\measurespaceiii\to\R,
\\
%
m_{\funcg,\funch}
& =
\frac{d \bigl( \measlambda\circ\preimage{(\funcg,\funch)} \bigr)}
{d(\measnu\times\measrho)^*}
:\measurespaceii\times\measurespaceiii\to\R,
\\
%
m_\funch
& =
\frac{d \bigl( \measlambda\circ\preimage{\funch} \bigr)}
{d \measrho}
:\measurespaceiii\to\R.
\end{align*}

The letter `$j$' was intended to roughly correspond with `joint density,' and likewise the letter
`$m$' with `marginal density.'
I have seen notation such as `$p(x,y\mid z)$' being used to try to indicate the quotient
$\dfrac{\funcj(x,y,z)}{m_\funch (z)}$.
Similarly, something like `$p(x\mid z)$', `$p(y\mid z)$', and `$p(x\mid y,z)$' might be used to try to indicate the respective quotients
$\dfrac{m_{\funcf,\funch}(x,z)}{m_\funch (z)}$,
$\dfrac{m_{\funcg,\funch}(y,z)}{m_\funch (z)}$,
and
$\dfrac{\funcj(x,y,z)}{m_{\funcg,\funch}(y,z)}$.
Let us use that notation here.
\end{notn}

%*********************************
%*********************************
%*********************************
%*********************************




\begin{prop}\label{conditional_independence_equivalence}
Let
$(\uspace,\uspacesig,\measlambda)$
be a probability space, and let functions
$\function:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$,
$\functionii:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$,
and
$\functioniii:(\uspace,\uspacesig)\to (\measurespaceiii,\sigmaalgebraiii)$
be measurable, with \textsigma-finite measures
$\measure$, $\measureii$, and $\measureiv$ on respective \textsigma-algebras
$\sigmaalgebra$, $\sigmaalgebraii$, and $\sigmaalgebraiii$.
Set $\sigalg{H}=\preimage{\funch}(\sigmaalgebraiii)$.
Let
$\measureiii\circ\preimage{(\function,\functionii,\functioniii)}
\abscont
(\measure\times\measureii\times\measureiv)^*$ on
$\productsig{\sigmaalgebra}{\sigmaalgebraii,\sigmaalgebraiii}$,
and let
$\funck$,
$\funcl$,
and
$\funcm$
be Markov kernels corresponding to the respective regular conditional distributions
$\condprobop{\sigalg{H}}\circ \preimage{\funcf}$,
$\condprobop{\sigalg{H}}\circ \preimage{\funcg}$,
and
$\condprobop{\sigalg{H}} \circ \preimage{(\funcf,\funcg)}$.

The following are equivalent:
%
\begin{enumerate}
\item[1)]
\[
\condindep{\preimage{\funcf}(\sigmaalgebra)}{\preimage{\funcg}(\sigmaalgebraii)}
{\preimage{\funch}(\sigmaalgebraiii)},
\]
%
\item[2)]
\[
\funcm_\uspaceelt
(\seti\times\setii)
=
\funck_\uspaceelt(\seti)
\cdot
\funcl_\uspaceelt(\setii)
\]
for all $\seti\in\sigmaalgebra$, $\setii\in\sigmaalgebraii$, and $\measlambda^\kernast$\hyp{}almost all
$\uspaceelt\in\uspace$,
%
\item[3)]
\[
p(x,y\mid z)
=
p(x\mid z) \cdot p(y\mid z)
\]
for
$(\measmu\times\measnu)^\kernast$\hyp{}almost all
$(x,y)\in\measurespace\times\measurespaceii$ and
$(\measlambda\circ\preimage{\funch})$\hyp{}almost all $\mspaceeltiii\in\measurespaceiii$, and
%
\item[4)]
\[
p(x\mid y,z)
=
p(x\mid z)
\]
for
$(\measmu\times\measnu)^\kernast$\hyp{}almost all
$(x,y)\in\measurespace\times\measurespaceii$ and
$(\measlambda\circ\preimage{\funch})$\hyp{}almost all $\mspaceeltiii\in\measurespaceiii$.
\end{enumerate}
\end{prop}




\begin{proof}
Set 
$\sigalg{F}=\preimage{\funcf}(\sigmaalgebra)$, 
and $\sigalg{G}=\preimage{\funcg}(\sigmaalgebraii)$.
We know the conditional distributions
are regular by Proposition~\ref{abs_cont_reg}, so they do have corresponding Markov kernels by Proposition~\ref{equivalent_definition_regular_distribution}.
The fact that $(1) \Leftrightarrow (2)$ is nothing more than wading through a definition or two.

\textbf{(1) $\Rightarrow$ (2)}\quad
Let
$\condindep{\preimage{\funcf}(\sigmaalgebra)}{\preimage{\funcg}(\sigmaalgebraii)}
{\preimage{\funch}(\sigmaalgebraiii)}$, or using $\sigalg{H}$ in place of
$\preimage{\funch}(\sigmaalgebraiii)$,
\[
\condindep{\preimage{\funcf}(\sigmaalgebra)}{\preimage{\funcg}(\sigmaalgebraii)}
{\sigalg{H}}.
\]
By the very Definition~\ref{conditionally_independent} of conditionally independent \textsigma\hyp{}subalgebras,
this is equivalent to saying
\[
\condprobsub{\lilstrut\preimage{\funcf}(\seti) \meets \preimage{\funcg}(\setii)}{\sigalg{H}}
=
\condprobsub{\lilstrut\preimage{\funcf}(\seti)}{\sigalg{H}}
\cdot
\condprobsub{\lilstrut\preimage{\funcg}(\setii)}{\sigalg{H}}
\]
for all $\seti\in\sigmaalgebra$ and for all $\setii\in\sigmaalgebraii$.
This is an equality of classes in
$L_1(\uspace,\uspacesig,\measureiii)$, and can be rewritten as
\begin{equation}
\condprobop{\sigalg{H}} \circ \preimage{(\funcf,\funcg)}
(\seti\times\setii)
=
\condprobop{\sigalg{H}}\circ \preimage{\funcf}(\seti)
\cdot
\condprobop{\sigalg{H}}\circ \preimage{\funcg}(\setii).
\end{equation}
Recall that two classes in
$L_1(\uspace,\uspacesig,\measureiii)$
are equal precisely when they have representatives that are equal for
$\measlambda^\kernast$\hyp{}almost all $\uspaceelt$ in  $\uspace$.
Such representatives in this case are easy to find since
the corresponding Markov kernels have the property that:
\[
\funcm^{\seti\times\setii} \in
\condprobop{\sigalg{H}} \circ \preimage{(\funcf,\funcg)}
(\seti\times\setii),
\]
\[
\funck^\seti \in
\condprobop{\sigalg{H}}\circ \preimage{\funcf}(\seti),
\]
and
\[
\funcl^\setii \in
\condprobop{\sigalg{H}}\circ \preimage{\funcg}(\setii).
\]
It follows that
\[
\funcm^{\seti\times\setii}(\uspaceelt)
=
\funck^\seti(\uspaceelt)
\cdot
\funcl^\setii(\uspaceelt)
\quad
\text{for $\measlambda^\kernast$\hyp{}almost all $\uspaceelt\in\uspace$.}
\]
Since $\funck$, $\funcl$, and $\funcm$ are Markov kernels,
\[
\funcm_\uspaceelt(\seti\times\setii)
=
\funck_\uspaceelt(\seti)
\cdot
\funcl_\uspaceelt(\setii)
\]
for all $\seti\in\sigmaalgebra$, $\setii\in\sigmaalgebraii$, and for
$\measlambda^\kernast$\hyp{}almost all $\uspaceelt\in\uspace$, as required.
\hfill\qedsymbol

\textbf{(1) $\Leftarrow$ (2)}\quad
Let
\[
\funcm_\uspaceelt(\seti\times\setii)
=
\funck_\uspaceelt(\seti)
\cdot
\funcl_\uspaceelt(\setii)
\]
for all $\seti\in\sigmaalgebra$, $\setii\in\sigmaalgebraii$, and
$\measlambda^\kernast$\hyp{}almost all $\uspaceelt\in\uspace$.
Since  $\funck$, $\funcl$, and $\funcm$ are Markov kernels, so equalities like
\[
\funcm_\uspaceelt(\seti\times\setii)
=
\funcm^{\seti\times\setii}(\uspaceelt)
\]
hold, it follows that
\[
\funcm^{\seti\times\setii}(\uspaceelt)
=
\funck^\seti(\uspaceelt)
\cdot
\funcl^\setii(\uspaceelt)
\]
for all $\seti\in\sigmaalgebra$, $\setii\in\sigmaalgebraii$, and
for
$\measlambda^\kernast$\hyp{}almost all $\uspaceelt\in\uspace$.
Check that the function
$\funcm^{\seti\times\setii}$
is bounded, and is
$(\sigalg{H},\borel_\R)$\hyp{}measurable, implying it is
$\measlambda^\kernast$\hyp{}measurable, so by Proposition~\ref{dominated_by_integrable}
is integrable with respect to $\measlambda$. It follows that the function
$\funck^\seti\cdot\funcl^\setii$
is integrable with respect to $\measlambda$, even by the very Definition~\ref{integrable} of integrability.
Then according to the Definition~\ref{Lp} of the product of classes,
\begin{align*}
\ellclass{\funck^\seti}{}
\cdot
\ellclass{\funcl^\setii}{}
& \definedby
\ellclass{\funck^\seti\cdot\funcl^\setii}{} \\
& =
\ellclass{\funcm^{\seti\times\setii}}{}. \\
\end{align*}
Because these Markov kernels correspond to their regular conditional distributions, and so for example
$\ellclass{\funck^\seti}{}
=
\condprobop{\sigalg{H}}\circ \preimage{\funcf}(\seti)$,
it follows from the equality
\[
\ellclass{\funck^\seti}{}
\cdot
\ellclass{\funcl^\setii}{}
=
\ellclass{\funcm^{\seti\times\setii}}{}
\]
that
\[
\condprobop{\sigalg{H}} \circ \preimage{\funcf}(\seti)
\cdot
\condprobop{\sigalg{H}} \circ \preimage{\funcg}(\setii)
=
\condprobop{\sigalg{H}} \circ \preimage{(\funcf,\funcg)}
(\seti\times\setii),
\]
which is equivalent to
$\condindep{\preimage{\funcf}(\sigmaalgebra)}{\preimage{\funcg}(\sigmaalgebraii)}
{\preimage{\funch}(\sigmaalgebraiii)}$,
as required.\hfill\qedsymbol



\textbf{(2) $\Rightarrow$ (3)}\quad
Let
\[
\funcm_\uspaceelt
(\seti\times\setii)
=
\funck_\uspaceelt(\seti)
\cdot
\funcl_\uspaceelt(\setii)
\]
for all $\seti\in\sigmaalgebra$, $\setii\in\sigmaalgebraii$, and $\measlambda^\kernast$\hyp{}almost all
$\uspaceelt\in\uspace$.
By Proposition~\ref{conditional_density},
\begin{align*}
\funcm_\uspaceelt
(\seti\times\setii)
= &
\int_{\seti\times\setii}
p(\mspaceelt,\mspaceeltii\mid\mspaceeltiii)
\,d(\measmu\times\measnu)(\mspaceelt,\mspaceeltii),
\\
\funck_\uspaceelt
(\seti)
= &
\int_\seti p(\mspaceelt\mid\mspaceeltiii)
\, d\measmu(\mspaceelt),
\\
\funcl_\uspaceelt
(\setii)
= &
\int_\setii p(\mspaceeltii\mid\mspaceeltiii)
\, d\measnu(\mspaceeltii).
\\
\end{align*}
Since
$\funcm_\uspaceelt
(\seti\times\setii)
=
\funck_\uspaceelt(\seti)
\cdot
\funcl_\uspaceelt(\setii)$, it follows by substitution that
\[
\int_{\seti\times\setii}
p(\mspaceelt,\mspaceeltii\mid\mspaceeltiii)
\,d(\measmu\times\measnu)(\mspaceelt,\mspaceeltii)
=
\int_\seti p(\mspaceelt\mid\mspaceeltiii)
\, d\measmu(\mspaceelt)
\cdot
\int_\setii p(\mspaceeltii\mid\mspaceeltiii)
\, d\measnu(\mspaceeltii)
\]
And by Fubini's Theorem~\ref{fubini},
\[
\int_\seti p(\mspaceelt\mid\mspaceeltiii)
\, d\measmu(\mspaceelt)
\cdot
\int_\setii p(\mspaceeltii\mid\mspaceeltiii)
\, d\measnu(\mspaceeltii)
=
\int_{\seti\times\setii}
p(\mspaceelt\mid\mspaceeltiii)\cdot
p(\mspaceeltii\mid\mspaceeltiii)
\, d(\measmu\times\measnu)(\mspaceelt,\mspaceeltii).
\]
By transitivity of equality,
\[
\int_{\seti\times\setii}
p(\mspaceelt,\mspaceeltii\mid\mspaceeltiii)
\,d(\measmu\times\measnu)(\mspaceelt,\mspaceeltii)
=
\int_{\seti\times\setii}
p(\mspaceelt\mid\mspaceeltiii)\cdot
p(\mspaceeltii\mid\mspaceeltiii)
\, d(\measmu\times\measnu)(\mspaceelt,\mspaceeltii)
\]
for all $\seti\times\setii$ in the semiring
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$, and so
by Proposition~\ref{uniqueness_radon_nikodym},
\[
p(\mspaceelt,\mspaceeltii\mid\mspaceeltiii)
=
p(\mspaceelt\mid\mspaceeltiii)\cdot
p(\mspaceeltii\mid\mspaceeltiii)
\]
for $(\measmu\times\measnu)^\kernast$\hyp{}almost all $(\mspaceelt,\mspaceeltii)$ in
$\measurespace\times\measurespaceii$.
(But what is the qualifier on $\mspaceeltiii$? Likely
$\marginalthree^\kernast$\hyp{}almost all
$\mspaceeltiii\in\measurespaceiii$.)
Although it is true that
$\productsig{\sigmaalgebra}{\sigmaalgebraii}$
is a \textsigma\hyp{}algebra, it is regarded here as a semiring, for that is all the structure which is actually needed.

\textbf{(2) $\Leftarrow$ (3)}\quad
Let
\[
p(\mspaceelt,\mspaceeltii\mid\mspaceeltiii)
=
p(\mspaceelt\mid\mspaceeltiii)\cdot
p(\mspaceeltii\mid\mspaceeltiii)
\]
for $(\measmu\times\measnu)^\kernast$\hyp{}almost all $(\mspaceelt,\mspaceeltii)$ in
$\measurespace\times\measurespaceii$, and for
$\marginalthree^\kernast$\hyp{}almost all
$\mspaceeltiii\in\measurespaceiii$.

\textbf{(3) $\Leftrightarrow$ (4)}\quad
Divide both sides of (3) by $p(\mspaceeltii\mid\mspaceeltiii)$.
\end{proof}




\chapter{Bayesian Statistics}\label{bayesian_statistics}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\lettrine{S}{tatistics} is a mathematical analysis of guesswork. This kind of guesswork is called inductive inference.
Its purpose is to identify a probability distribution or a conditional distribution. The particular kind of guesswork we will use is considered \emph{Bayesian} since it involves a parameter that induces a  probability distribution. A parameter here is just a measurable function.

There are no topological restrictions imposed on the objects in this chapter. No Borel space conditions, no separable conditions.  We rely instead upon measure-theoretic conditions.

This chapter provides the smallest possible glimpse of Bayesian statistics.

Suppose
$(\uspace, \uspacesig)$ and
$(\measurespace, \sigmaalgebra)$ are measurable spaces.
Let
$(\uspace,\uspacesig,\measlambda)$
be a probability space, and let $\sigalg{G}$ be a \textsigma-subalgebra of
$\uspacesig$.
The conditional probability
$
\condprobop{\sigalg{G}}:
\uspacesig \to
L_1(\uspace,\uspacesig,\measlambda)
$
on $\uspacesig$ given $\sigalg{G}$
could not possibly be a probability measure since the  codomain
of the conditional probability $\condprobop{\sigalg{G}}$ is the quotient space
$L_1(\uspace,\uspacesig,\measlambda)$ rather than the interval $[0,1]$.
For the same reason, no conditional distribution
${\condprobop{\sigalg{G}}}\circ \preimage{\funcf}
: \sigmaalgebra \to L_1(\uspace,\uspacesig,\measlambda)$
of $\funcf$ on $\sigmaalgebra$ given $\sigalg{G}$
could possibly be a probability measure,
with $\funcf:\uspace\to\measurespace$ here being any
$(\uspacesig,\sigmaalgebra)$\hyp{}measurable function.
However, a \emph{regular} conditional distribution corresponds to a Markov kernel $\funck$ defining a whole family of probability measures on the
\textsigma-algebra $\sigmaalgebra$:
\[
\xymatrix@R=16pt@C=30pt{
L_1(\uspace,\uspacesig,\measlambda)
\ar[r]^{\condexpop{\sigalg{G}}}
& L_1(\uspace,\uspacesig,\measlambda)
& \uspace
\ar[d]_-{\fixinthesecond{\seti}}
\ar[dr]^{\qquad\text{$\funck\circ\fixinthesecond{\seti} \in \condprobop{\sigalg{G}}\circ \preimage{\funcf}(\seti)$}}
\\
&
& \uspace\times\sigmaalgebra \ar[r]^{\funck}
& [0,1]
\\
\uspacesig
\ar[uu]^{Q\,\circ\, \charfunction{}}
\ar[uur]^{\condprobop{\sigalg{G}}}
& \sigmaalgebra
\ar[uu]_{\condprobop{\sigalg{G}}\circ \preimage{\funcf}}
\ar[l]_{\preimage{\funcf}}
& \sigmaalgebra
\ar[ur]_{\qquad\text{probability measure}}
\ar[u]^{\fixinthefirst{\uspaceelt}}
&
\\
}
\]
By some schools of thought, just a family
of probability measures itself, indexed by a parameter space, is considered to be a statistical experiment.

Let
\[
\bigl(\pspace\times\sspace,
\productsig{\pspacesig}{\sspacesig},
\measonprod\bigr)
\]
be a probability space.
The measure $\measonprod$ is called the \emph{joint}.
Call the measurable space $(\pspace, \pspacesig)$ the \emph{attribute space}, or \emph{parameter space}, and call the measurable space
$(\sspace, \sspacesig)$ the
\emph{sample space}.
Let $\projectionone$ and $\projectiontwo$ denote the respective coordinate projections of
$\pspace\times\sspace$ onto $\pspace$ and $\sspace$. Also let $\preimage{\projectionone}$ and
$\preimage{\projectiontwo}$ denote the respective induced maps
$\preimage{\projectionone}:\pspacesig\to\productsig{\pspacesig}{\sspacesig}$
and
$\preimage{\projectiontwo}:\sspacesig\to\productsig{\pspacesig}{\sspacesig}$, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{
\pspace
&
&
\pspacesig
\ar[d]^-{\preimage{\projectionone}}
\ar[dl]_-{\marginalone}
& \seti \ar@{|->}[d]
\\
\pspace\times\sspace \ar[u]^-{\projectionone} \ar[d]_-{\projectiontwo} &
[0,1] &
\productsig{\pspacesig}{\sspacesig}  \ar[l]_\measonprod
& \seti\times\sspace
\\
\sspace
&
&
\sspacesig
\ar[u]_-{\preimage{\projectiontwo}}
\ar[ul]^-{\marginaltwo}
\\
}
\]

The projection $\projectionone$
is
$\bigl( \productsig{\pspacesig}{\sspacesig}, \pspacesig \bigr)$\hyp{}measurable,
and induces the marginal probability distribution
$\marginalone\definedby\measonprod\circ\preimage{\projectionone}$ of $\projectionone$ on the parameter space
\textsigma-algebra $\pspacesig$,
which is called the \emph{prior probability distribution}.
The projection $\projectiontwo$
is
$\bigl(\productsig{\pspacesig}{\sspacesig}, \sspacesig \bigr)$\hyp{}measurable,
and induces the marginal probability distribution
$\marginaltwo\definedby\measonprod\circ\preimage{\projectiontwo}$ of $\projectiontwo$ on the sample space
\textsigma-algebra $\sspacesig$,
which is called the \emph{predictive probability distribution}.
Consequently:
\[
\prior(\pspaceset)
= ( \measonprod\circ\preimage{\projectionone} ) (\pspaceset)
= \measonprod(\pspaceset\times\sspace)
\quad \text{for all $\pspaceset\in\pspacesig$},
\]
and
\[
\predictive(\sspaceset)
= ( \measonprod\circ\preimage{\projectiontwo} ) (\sspaceset)
= \measonprod(\pspace\times\sspaceset)
\quad \text{for all $\sspaceset\in\sspacesig$}.
\]


Let functions
$\function:(\uspace,\uspacesig)\to (\measurespace,\sigmaalgebra)$
and
$\functionii:(\uspace,\uspacesig)\to (\measurespaceii,\sigmaalgebraii)$
be measurable, as illustrated by the following commutative diagrams:
\[
\xymatrix@R=16pt@C=34pt{
 & \measurespace
 \\
 \uspace
 \ar[ur]^{\funcf}
 \ar[dr]_{\funcg}
 \ar[r]^{\funcf, \funcg} &
 \measurespace \times \measurespaceii  \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
 & \measurespaceii  \\
}
\qquad
\xymatrix@R=18pt@C=34pt{
 & & \sigmaalgebra
 \ar[dl]_{\preimage{\funcf}}
 \ar[d]^{\preimage{\projectionone}}
 \ar@/_10pt/[lld]_{\marginalone}
 \\
 [0,1] & \uspacesig \ar[l]_-{\measlambda} &
 \productsig{\sigmaalgebra}{\sigmaalgebraii}
 \ar[l]_{\hskip8pt \preimage{(\funcf,\funcg)}}
 \\
 & & \sigmaalgebraii
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{\funcg}}
  \ar@/^10pt/[llu]^{\marginaltwo}
  \\
}
\]
Set $\sigalg{F} = \preimage{\funcf}(\sigmaalgebra)$.
Call the  conditional distribution
$\condprobop{\sigalg{F}}
\circ\,
\preimage{\funcg}$ of
$\funcg$
on $\sspacesig$
given $\sigalg{F}$ the \term{sampling
conditional distribution}, as illustrated:
\[
\xymatrix@R=40pt{
L_1(\uspace,\uspacesig,\measlambda)
\ar[r]^-{\condexpop{\sigalg{F}}}
& L_1(\uspace,\uspacesig,\measlambda)
\\
\uspacesig
\ar[u]^-{Q\, \circ\, \charfunction{}} \ar[ur]_{\condprobop{\sigalg{F}}}
& \sspacesig
\ar[l]^-{\preimage{\funcg}}
\ar[u]_{\condprobop{\sigalg{F}}\circ\,\preimage{\funcg}}
}% end \xymatrix
\]

Set $\sigalg{G} = \preimage{\funcg}(\sigmaalgebraii)$.
Call the  conditional distribution
$\condprobop{\sigalg{G}}
\circ\,
\preimage{\funcf}$ of
$\funcf$
on $\pspacesig$
given $\sigalg{G}$ the \term{posterior conditional distribution}, as illustrated:
\[
\xymatrix@R=40pt{
L_1(\uspace,\uspacesig,\measlambda)
\ar[r]^-{\condexpop{\sigalg{G}}}
& L_1(\uspace,\uspacesig,\measlambda)
\\
\uspacesig
\ar[u]^-{Q\, \circ\, \charfunction{}} \ar[ur]_{\condprobop{\sigalg{G}}}
& \pspacesig
\ar[l]^-{\preimage{\funcf}}
\ar[u]_{\condprobop{\sigalg{G}} \circ\, \preimage{\funcf}}
}% end \xymatrix
\]

The sampling and posterior conditional distributions could not possibly be probability measures, and this should be clear since their codomains are $L_1$ spaces rather than
the interval $[0,1]$.
However, were they \emph{regular} conditional distributions, then they would induce whole families of probability measures on the parameter and sample space \textsigma-algebras by way of their corresponding Markov kernels.
What measure-theoretic conditions might be sufficient to imply that these conditional distributions are regular?


One simple condition is when
$\measonprod\abscont (\marginalone\times\marginaltwo)^*$.
Then both the sampling conditional distribution and the posterior conditional distribution are regular. This is just an application of Proposition~\ref{marginal_implies_regular}.


Here, in turn, is a measure-theoretic condition sufficient to imply that
$\measonprod\abscont (\marginalone\times\marginaltwo)^*$.
Suppose
$\{ P_\mspaceelt :\mspaceelt\in\measurespace \}$
is a family of probability measures on the sample space \textsigma-algebra
$\sigmaalgebraii$,
and suppose that the \textsigma\hyp{}algebra $\sigmaalgebra$ is such that for each
$\setii\in\sigmaalgebraii$, the function defined by
\[
P^\setii
:\measurespace \to [0,1]
:\mspaceelt \mapsto P_\mspaceelt(\setii)
\]
is $\bigl(\sigmaalgebra,\borel_{[0,1]}\bigr)$\hyp{}measurable.
Further suppose the joint probability measure $\joint$  is defined in terms of
a given probability measure $\wouldbeprior$ on the parameter space \textsigma-algebra
$\pspacesig$ by
\[
\measonprod(\pspaceset\times\sspaceset)
=
\int_\pspaceset P^\sspaceset(\pspaceelt)
\, d\wouldbeprior(\pspaceelt)
\quad
\text{for all $\sspaceset\in\sspacesig$ and all $\pspaceset \in \pspacesig$.}
\]
Then, by Proposition~\ref{not_a_product_measure}, the given measure $\wouldbeprior$ must actually equal the marginal
$\prior$.
If also $\measnu$ is a \textsigma-finite measure on $\sspacesig$
such that each
$P_\pspaceelt\abscont \measnu$, and if
$\funcf : \pspace\times\sspace\to\R$ is a
$\bigl(\productsig{\pspacesig}{\sspacesig},\borel_\R\bigr)$\hyp{}measurable function
such that each $\funcf_\pspaceelt$ is equal to the Radon-Nikodym derivative:
\begin{equation}\label{as_density}
\function_\pspaceelt
=
d P_\pspaceelt/d\measnu,
\end{equation}
then
$\joint \abscont (\prior \times\measnu)^*$
with
$\function
=
d\measonprod/d(\prior \times\measnu)^*$,
and consequently
$\measonprod\abscont (\prior\times\predictive)^*$.
Further, if the function
$\funcg: \pspace\times\sspace\to\R$ is defined by setting
\[\functionii(\pspaceelt,\sspaceelt)
=
\frac
{\function(\pspaceelt,\sspaceelt)}
{\int_\pspace \function(\pspaceelt,\sspaceelt)\,
d\prior(\pspaceelt)},
\]
then
$\functionii
=
d\measonprod/d(\prior\times\predictive)^*$.
This implies that $\predictive \abscont \measnu$ on $\sspacesig$, for if $\sspaceset\in\sspacesig$, then
\[
\predictive(\sspaceset)
= \measonprod(\pspace \times \sspaceset)
= \int_{\pspace \times \sspaceset} \function \, d(\prior\times\measnu)
= \int_\sspaceset\left( \int_\pspace \function(\pspaceelt, \sspaceelt)\,d\prior(x)\right) d\measnu(\sspaceelt).
\]
This says
\[
\frac{d\predictive}{d\measnu}:
\sspace\to\R:
\sspaceelt\mapsto \int_\pspace \function(\pspaceelt,\sspaceelt)\,d\prior(x).
\]

The family $\{ P_\pspaceelt :\pspaceelt\in\pspace \}$ of probability measures on the sample space \textsigma-algebra $\sspacesig$ must satisfy
\[
P_\pspaceelt(\sspaceset)
=
\int_\sspaceset \functionii(\pspaceelt,\sspaceelt)
\, d\predictive(\sspaceelt)
\quad \text{for all $\sspaceset\in\sspacesig$},
\]
and a family $\{ \prior_\sspaceelt :\sspaceelt\in\sspace \}$ of probability measures on the parameter space \textsigma-algebra $\pspacesig$, defined for those
$\sspaceelt\in\sspace$ such that $\funcf^\sspaceelt$ is integrable with respect to $\prior$, is defined by
\begin{equation}\label{bayes_eq}
\prior_\sspaceelt(\pspaceset)
=
\int_\pspaceset \functionii(\pspaceelt,\sspaceelt)
\, d\prior(\pspaceelt)
\quad \text{for all $\pspaceset\in\pspacesig$},
\end{equation}
or equivalently by
\[
\frac{d\prior_\sspaceelt}{d\prior}
:\pspace\to\R
:\pspaceelt
\mapsto
\frac
{\function(\pspaceelt,\sspaceelt)}
{\int_\pspace \function(\pspaceelt,\sspaceelt)\,
d\prior(\pspaceelt)}.
\]
The equality~(\ref{bayes_eq}) may also be  seen as
Bayes' Theorem\index{Bayes' Theorem@Bayes' Theorem}
in the case where there is a \textsigma-finite measure $\measlambda$ on $\pspacesig$
with $\prior \abscont \measlambda$, say with density function
$\functioniii
=
d\prior/d\measlambda
\in\cali{L}_1(\pspace, \pspacesig,\measlambda)$. In this case,
\[
\prior_{\sspaceelt}(\pspaceset)
=
\frac
{\displaystyle
\int_\pspaceset \function(\pspaceelt,\sspaceelt)\functioniii(\pspaceelt)
\,d\measlambda(\pspaceelt)
}
{\displaystyle
\int_{\pspace} \function(\pspaceelt,\sspaceelt)\functioniii(\pspaceelt)
\,d\measlambda(\pspaceelt)
}
\quad
\text{for all $\pspaceset\in\pspacesig$,}
\]
or equivalently,
\begin{align*}\label{bayes_theorem}
\frac{d\prior_\sspaceelt}{d\measlambda}:
\pspace\to\R:
\pspaceelt
& \mapsto
\frac{\function(\pspaceelt,\sspaceelt)\functioniii(\pspaceelt)}
{\displaystyle
\int_{\pspace} \function(\pspaceelt,\sspaceelt)\functioniii(\pspaceelt)
\,d\measlambda(\pspaceelt)}
\\
& =
\frac{\function^\sspaceelt(\pspaceelt)\functioniii(\pspaceelt)}
{\displaystyle
\int_{\pspace} \function^\sspaceelt(\pspaceelt)\functioniii(\pspaceelt)
\,d\measlambda(\pspaceelt)}
,\\
\end{align*}
where $\function(\pspaceelt,\sspaceelt)$, or in particular $\function^{\sspaceelt}$, might be referred to as ``the likelihood,'' illustrated in the following diagram:
\[
\xymatrix@R=16pt@C=30pt{
\pspace \ar[dr]^{\function^\sspaceelt\quad \rlap{\emph{\scriptsize the likelihood}}}
& \\
\pspace\times\sspace
\ar[u]^{\projectionone}
\ar[d]_{\projectiontwo}
\ar[r]^{\function}
& \R \\
\sspace
\ar[ur]_{\function_\pspaceelt \quad \rlap{\emph{\scriptsize Radon-Nikodym derivative}}}
&
}
\]

The collection
$\{\function^\sspaceelt:\sspaceelt\in\sspace \}$
of likelihood functions $\pspace\to\R$ is indexed by the sample space
$\sspace$, which is one way that a particular sample $\sspaceelt$ may be used in applications; the sample itself determines the likelihood function by indexing into the collection. It is interesting how the sample\index{sample}, or \term{observation}, or \term{data}, can be seen as selecting a likelihood function from a collection, and warrants further thought. On the other hand, you always need information\index{information} to make an intelligent selection. Perhaps that is all there is to it.




%***************************************************************
%***************************************************************
%***************************************************************
%***************************************************************
\chapter{Bayesian Statistical Models}\label{bayesian_statistical_models_examples}


%***************************************************************
%***************************************************************
\section{Outline}
Here is a partial list of steps that will be applied to each of the examples that follow:
\begin{itemize}
\item
Establish an indexed, or parametrized, family
$\{ P_\pspaceelt :\pspaceelt\in\pspace \}$
of sampling probabilities on the sample space \textsigma-algebra 
$\sspacesig$. Hopefully, each
$P_\pspaceelt$
is absolutely continuous with respect to a \textsigma-finite reference measure on $\sspacesig$.
\item
Verify that some function
$\function : \pspace\times\sspace\to\R$
has $\funcf_\pspaceelt$ as  the density function for
$P_\pspaceelt$ with respect to the reference measure.
\item
Define a prior probability measure on the parameter space \textsigma-algebra
$\pspacesig$.
Say that $\funch$ is a density function for the prior with respect to a \textsigma-finite reference measure on $\pspacesig$, temporarily call this measure $\measnu$.
\item
Then understand that the map
\[
\pspace\to\R:
\pspaceelt
\mapsto
\frac{\function(\pspaceelt,\sspaceelt)\functioniii(\pspaceelt)}
{\displaystyle
\int_{\pspace} \function(\pspaceelt,\sspaceelt)\functioniii(\pspaceelt)
\,d\measureii(\pspaceelt)}
=
\frac{\function^\sspaceelt(\pspaceelt)\functioniii(\pspaceelt)}
{\displaystyle
\int_{\pspace} \function^\sspaceelt(\pspaceelt)\functioniii(\pspaceelt)
\,d\measureii(\pspaceelt)}
\]
is a density function for the posterior probability measure of the parameter given the data,
with respect to $\measnu$ on $\pspacesig$.
\end{itemize}



%***************************************************************
%***************************************************************
\section{Globe Tossing Model}\label{globe_tossing}
This example of an experiment is highly paraphrased from Richard McElreath's  \textsl{Statistical Rethinking, Second Edition}~\cite{sr_mcelreath_2020}.
The experiment is tossing a globe $N$ times into the air, catching it, and wherever an index finger happens to touch the surface of the globe, record  \textit{water} should this surface corresponds to water, and record \textit{land} should it correspond to land. This $N$-tuple is the sample. Deduce from this experiment the probability distribution of the proportion $p$ of the surface covered with water. This proportion $p$ is the parameter.
Quoting from \textsl{Statistical Rethinking}~\cite{sr_mcelreath_2020}, page 78, verbatim:
\begin{quoting}\small
\textbf{4.2.1. Re-describing the globe tossing model.} It’s good to work with examples. Recall the
proportion of water problem from previous chapters. The model in that case was always:
\begin{align*}
W & \sim \text{Binomial}(N, p) \\
p & \sim \text{Uniform}(0, 1)
\end{align*}
where $W$ was the observed count of water, $N$ was the total number of tosses, and $p$ was the
proportion of water on the globe. Read the above statement as:
\begin{itemize}
\item[]The count $W$ is distributed binomially with sample size $N$ and probability $p$.
\item[]The prior for $p$ is assumed to be uniform between zero and one.
\end{itemize}
\end{quoting}
And in a display following this, find:
\begin{quoting}\small
\[
\text{Pr}(p\vert w,n)
=
\frac{\text{Binomial}(w\vert n,p)\,\text{Uniform}(p\vert 0,1)}
{\int \text{Binomial}(w\vert n,p)\,\text{Uniform}(p\vert 0,1)\, dp}
\]
\end{quoting}


Let $U$ denote the domain of the measurable functions $p$ and $W$, as illustrated:
\[
\xymatrix@R=16pt@C=35pt{
 % & \pspace \rlap{ $=[0,1]$}
 % get used to using \makebox:
 & \pspace \makebox[0pt][l]{$\ = [0,1]$}
 \\
 U
 \ar[ur]^{\makebox[0pt][r]{\scriptsize{$p$}}}
 \ar[dr]_{\makebox[0pt][r]{\scriptsize{$W$}}}
 \ar[r]^{p\times W} &
 \pspace\times\sspace \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
  & \sspace\rlap{ $=\{0,\ldots,N\}$} \\
}
%
\hspace{50pt}
%
\xymatrix@R=16pt@C=35pt{
 & \pspacesig \rlap{ $=\borel_{[0,1]}$}
 \ar[dl]_{\makebox[0pt][r]{\scriptsize{$\preimage{p}$}}}
 \ar[d]^{\preimage{\projectionone}}
 \\
 \sigalg{D}  & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]_{\ \preimage{p\times W}}
 \\
  & \sspacesig \rlap{ $=\powerset(\sspace)$}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\makebox[0pt][r]{\scriptsize{$\preimage{W}$}}}
  \\
}
\]
so that the underlying space  $U$ is the Cartesian product of the interval $[0,1]$, representing all possible proportions of water to land, with the collection of all $N$-tuples of \textit{water}'s and \textit{land}'s. The function $W$ is supposed to count the number of \textit{water}'s in an $N$-tuple of \textit{water}'s and \textit{land}'s.  Let 
$\sigalg{D}$ denote a \textsigma-algebra of subsets of $U$, to be qualified momentarily. Then 
the parameter space $\pspace$ and 
sample space $\sspace$ 
are the respective codomains, where $\pspace=[0,1]$ with \textsigma-algebra 
$\pspacesig = \borel_{[0,1]}$, and 
$\sspace$ is the set of integers $\{0,\ldots,N\}$ with \textsigma-algebra
$\sspacesig=\powerset(\sspace)$.

We suppose $(U,\sigalg{D},Q)$ is a probability space such that the following diagram commutes:
\[
\xymatrix@R=16pt@C=35pt{
 & & \pspacesig
 \ar@/_10pt/[dll]_{\makebox[0pt][r] {\scriptsize{$Q\circ\preimage{p}$}} }
 \ar[dl]_{\makebox[0pt][r]{\scriptsize{$\preimage{p}$}}}
 \ar[d]^{\preimage{\projectionone}}
 \\
 [0,1] & \sigalg{D} \ar[l]_-{\ Q} &
 \productsig{\pspacesig}{\sspacesig}
 \ar[l]_{\ \preimage{p\times W}}
 \\
 & & \sspacesig
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\makebox[0pt][r]{\scriptsize{$\preimage{W}$}}}
  \ar@/^10pt/[ull]^{\makebox[0pt][r] {\scriptsize{$Q\circ\preimage{W}$}} }
  \\
}
\]
We can take $\sigalg{D}$ to be the \textsigma-algebra generated by
the product of $[0,1]$ with the collection of $N$-tuples of \textit{water}'s and \textit{land}'s.
The probability distributions can be specified, although the specification of the measure $Q$ appears induced, and will not be stressed here:
\begin{align*}
W & \sim \text{Binomial}(N, \pspaceelt) = Q\circ \preimage{W}\\
p & \sim \text{Uniform}(0, 1) = Q\circ \preimage{p}
\end{align*}
Define $\function:\pspace \times \sspace \to\R$ by
\begin{align*}
\function(\pspaceelt,w)
& =
\frac{N!}
{w!(N-w)!}
\pspaceelt^w(1-\pspaceelt)^{N-w} \\
& \defines
\text{Binomial}(w\vert N,\pspaceelt)
\end{align*}
so the following diagram commutes:
\[
\xymatrix@R=16pt@C=30pt{ 
\pspace
\ar[dr]^{\makebox[0pt][l]{\scriptsize{$\function^w$\quad\emph{the likelihood}}}}
& \\
\pspace\times\sspace 
\ar[u]^{\projectionone}
\ar[d]_{\projectiontwo}
\ar[r]^{\function}
& \R \\
\sspace 
\ar[ur]_{\makebox[0pt][l]{\scriptsize{$\function_x$\quad\emph{Radon-Nikodym derivative}}}}
& 
}
\]

Let $\kappa$ denote counting measure on the sample space \textsigma-algebra $\sspacesig$,
and define a family $\{P_\pspaceelt :\pspaceelt\in \pspace \}$ of probability measures on
$\sspacesig$ by
\[
P_\pspaceelt{(\setii)} =
\int_{w\in\setii}\function_\pspaceelt(w)\,d\kappa(w) =
\sum_{w\in\setii}\function_\pspaceelt(w)
\quad \setii\in\sspacesig.
\]
Let us verify one of the requirements that a measure must satisfy in order to be a probability measure; namely that
$P_\pspaceelt(\sspace)=1$ for any $\pspaceelt\in\pspace$. This verification is based on the binomial theorem:
\[
(a+b)^N=\sum_{w=0}^N
\frac{N!}
{w!(N-w)!}
a^w b^{N-w},
\]
taking $a=\pspaceelt$ and $b=1-\pspaceelt$.

By definition, each of the sampling probabilities $P_\pspaceelt$ is absolutely continuous with respect to counting measure $\kappa$, with
$\function_\pspaceelt = d P_\pspaceelt/ d \kappa$. That is, the function $\function_\pspaceelt$ represents the Radon-Nikodym derivative of $P_\pspaceelt$ with respect to  $\kappa$.


Let $\prior$ be the probability measure on the parameter space \textsigma-algebra  
$\pspacesig = \borel_{[0,1]}$ represented by the density 
\[
\functioniii(\pspaceelt) = \text{Uniform}(\pspaceelt\vert 0,1)
\]
with respect to Lebesgue measure $\measureii$ restricted to $\borel_{[0,1]}$.
In this case, the function $\functioniii$ agrees with the constant function $1$ on  $[0,1]$,
and the prior $\prior$ also happens to agree with Lesbesgue measure $\measureii$ on $\borel{[0,1]}$. Namely,
\[
\prior(\seti) = \int_\seti \functioniii(\pspaceelt)\,d \measureii(\pspaceelt)
\quad\text{for all $\seti\in\borel_{[0,1]}$}.
\]
According to Bayes' theorem, the Radon-Nikodym derivative of the posterior probability $\prior_w$ with respect to $\measureii$ has a representative, denoted here by
$\text{Pr}(\pspaceelt\vert w,N) \in \cali{L}_1(\pspace,\pspacesig,\measureii)$, which may be called the
\emph{posterior density:}
\[
\text{Pr}(\pspaceelt\vert w,N) \definedby
\dfrac
{\function^w(\pspaceelt)\functioniii(\pspaceelt)}
{\int_{\pspace} \function^w(\pspaceelt)\functioniii(\pspaceelt)
\,d\measureii(\pspaceelt)}
\in
\frac{d\prior_w}{d\measureii}.
\]
Finally, this can also be written as:
\[
\text{Pr}(\pspaceelt\vert w,N)
=
\dfrac{
\overbrace{\text{Binomial}(w\vert N,\pspaceelt)}^{\function^w(\pspaceelt)}\,
\overbrace{\text{Uniform}(\pspaceelt\vert 0,1)}^{h(\pspaceelt)}
}
{\int_{[0,1]} \text{Binomial}(w\vert N,\pspaceelt)\,
\underbrace{\text{Uniform}(\pspaceelt\vert 0,1)\, d\pspaceelt}_{\functioniii(\pspaceelt)\,d\measureii(\pspaceelt)}},
\]
which is not difficult to see as a slight translation of
\[
\text{Pr}(p\vert w,n)
=
\frac{\text{Binomial}(w\vert n,p)\,\text{Uniform}(p\vert 0,1)}
{\int \text{Binomial}(w\vert n,p)\,\text{Uniform}(p\vert 0,1)\, dp}.
\]


%***************************************************************
%***************************************************************
\section{Gaussian Model of Height}\label{gaussian_model}
Another example of an experiment with the joint absolutely continuous with respect to the product of the prior and predictive probability distributions,
paraphrased from \textsl{Statistical Rethinking, Second Edition}~\cite{sr_mcelreath_2020}. 
The experiment is modelling a collection $\{h_i\}$ of heights.
Quoting, beginning bottom page 78:
\begin{quoting}\small
For the moment, we want a single measurement variable to
model as a Gaussian distribution. There will be two parameters describing the distribution's
shape, the mean $\mu$ and the standard deviation $\sigma$.
\end{quoting}
and continuing on page 82:
\begin{quoting}\small
In most cases, priors are specified independently for each parameter, which amounts to assuming
$\text{Pr}(\mu,\sigma) 
= \text{Pr}(\mu)\text{Pr}(\sigma)$. 
Then we can write:\reqnomode
\begin{align*}
h_i & \sim \text{Normal}(\mu,\sigma) \tag*{[\textsf{\small{likelihood}}]} \\
\mu & \sim \text{Normal}(178,20)     \tag*{[\textsf{\small $\mu$ prior}]} \\
\sigma & \sim \text{Uniform}(0,50)   \tag*{[\textsf{\small $\sigma$ prior}]}
\end{align*}
\end{quoting}
and in a display following, find:
\begin{align*}
& \text{Pr}(\mu,\sigma\vert h) =
\\
& =
\frac{
\prod_i
\text{Normal}(h_i\vert \mu,\sigma)
\,\text{Normal}(\mu\vert 178,20)
\,\text{Uniform}(\sigma\vert 0,50)
}
{
\int\int
\prod_i
\text{Normal}(h_i\vert \mu,\sigma)
\,\text{Normal}(\mu\vert 178,20)
\,\text{Uniform}(\sigma\vert 0,50)
\,d\mu\, d\sigma
}
\\
\end{align*}


Let $U$ denote the domain of the functions $(\mu,\sigma)$ and height $h$, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{ 
 & \pspace \rlap{ $=\R\times\R^+$}
 \\
 U \ar[ur]^{(\mu,\sigma)} \ar[dr]_h \ar[r] & 
 \pspace\times\sspace \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
  & \sspace\rlap{ $=\R^n$} \\
}
%
\hspace{50pt}
%
\xymatrix@R=16pt@C=30pt{ 
 & \pspacesig \rlap{ $=\borel_{\R\times\R^+}$}
 \ar[dl]_{\preimage{(\mu,\sigma)}} 
 \ar[d]^{\preimage{\projectionone}}
 \\
 \sigalg{D}  & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]  
 \\
  & \sspacesig \rlap{ $=\borel_{\R^n}$}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{h}}
  \\
}
\]
so that the underlying space  $U$ is the Cartesian product of possible means and standard deviations with $n$-tuples of heights.
We suppose $(U,\sigalg{D},Q)$ is a probability space such that the following diagram commutes:
\[
\xymatrix@R=16pt@C=30pt{ 
 & & \pspacesig \rlap{ $=\borel_{\R\times\R^+}$}
 \ar[dl]_{\kern30pt\preimage{(\mu,\sigma)}} 
 \ar[d]^{\preimage{\projectionone}}
 \ar@/_10pt/[lld]_{Q\circ \preimage{(\mu,\sigma)}}
 \\
 [0,1] & \sigalg{D} \ar[l]_-{\ Q} & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]  
 \\
 & & \sspacesig \rlap{ $=\borel_{\R^n}$}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{h}}
  \ar@/^10pt/[llu]^{Q\circ\preimage{h}}
  \\
}
\]

Define $\function:\pspace \times \sspace \to\R$ by
\begin{align*}
\function\bigl((r,s),t\bigr)
& =
\prod_i
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t_i-r}{s}
\right)^2
\right\}
\end{align*}
so the following diagram commutes:
\[
\xymatrix@R=16pt@C=30pt{ 
\pspace \ar[dr]^{\function^t\quad \rlap{\emph{\scriptsize the likelihood}}}
& \\
\pspace\times\sspace 
\ar[u]^{\projectionone}
\ar[d]_{\projectiontwo}
\ar[r]^{\function}
& \R \\
\sspace 
\ar[ur]_{\function_{(r,s)} \quad \rlap{\emph{\scriptsize Radon-Nikodym derivative}}} 
& 
}
\]
Let $\measureiii_n$ denote Lebesgue measure on the sample space \textsigma-algebra 
$\sspacesig=\borel_{\R^n}$.
Define a family $\{P_{(r,s)} : (r,s) \in \pspace \}$ of probability measures on $\sspacesig$ by defining
$P_{(r,s)}$ on the
rectangles $\prod_i[a_i,b_i]$ of $\sspacesig$:
\[
P_{(r,s)}\left(\prod_i[a_i,b_i]\right) =
\prod_i\text{Normal}(r,s)\bigl([a_i,b_i]\bigr)
\]
Let us verify one of the requirements that a measure must satisfy in order to be a probability measure; namely that
$P_{(r,s)}(\sspace)=1$ for any $(r,s)\in\pspace$.
This verification is based on the fact that the functions
\[
p:\R\to\R^+
:t \mapsto
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t-r}{s}
\right)^2
\right\}
\]
are well-known to be a probability density functions.

Each of the sampling probabilities $P_{(r,s)}$ is absolutely continuous with respect to Lebesgue measure
$\measureiii_n$ on $\borel_{\R^n}$, and
the function $\function_{(r,s)}$ represents the Radon-Nikodym derivative of 
$P_{(r,s)}$ with respect to $\measureiii_n$.

Define a probability measure $\rho$ on the rectangles $\setii\times\setiii$ of the parameter space \textsigma-algebra 
$\pspacesig=\borel_{\R\times\R^+}$ by
\begin{align*}
\rho(\setii\times\setiii)
&=\text{Normal}(178,20)(\setii)\cdot\text{Uniform}(0,50)(\setiii).
\end{align*}
See that the prior probability distribution $\rho$ is absolutely continuous with respect to a different Lebesgue measure, call it
$\lambda_2$, on $\pspacesig=\borel_{\R\times\R^+}$,
and let $\functioniii\in\cali{L}_1(\pspace,\pspacesig,\lambda_2)$ be defined by
\[
\functioniii:\R\times\R^+\to\R:(r,s)\mapsto
\text{Normal}(r\vert 178,20)\cdot
\text{Uniform}(s\vert 0,50)
\]
so that the function $\functioniii$ represents the Radon-Nikodym derivative $d\rho/d\lambda_2$.
According to Bayes' theorem, the Radon-Nikodym derivative of the posterior probability 
$\rho_t$ with respect to $\lambda_2$ has a representative, denoted here by 
$\text{Pr}(r,s\vert t)\in\cali{L}_1(\pspace, \pspacesig,\lambda)$,
where 
\[
\text{Pr}(r,s\vert t)
=
\frac{\function^t(r,s)\,\functioniii(r,s)}
{\int_{\pspace}\function^t(r,s)\,\functioniii(r,s)\,d\lambda_2(r,s)}.
\]
Finally, write 
\begin{align*}
\function^t (r,s)
& =
\prod_i
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t_i-r}{s}
\right)^2
\right\} \\
& = \prod_i\text{Normal}(t_i\vert r,s) 
\end{align*}
so that
\begin{align*}
& \text{Pr}(r,s\vert t) =
\\
&
\frac{
\overbrace{\textstyle{\prod_i}\text{Normal}(t_i\vert r,s)}^{\function^t(r,s)}\,
\overbrace{\text{Normal}(r\vert 178,20)\,
\text{Uniform}(s\vert 0,50)}^{\functioniii(r,s)}
}
{
\int_{\R\times\R^+}
\prod_i\text{Normal}(t_i\vert r,s)\,
\underbrace{\text{Normal}(r\vert 178,20)\,
\text{Uniform}(s\vert 0,50)\,
d\lambda_2(r,s)}_{\functioniii(r,s)\,d\lambda_2(r,s)}
}
\\
\end{align*}
which is our slight translation of 
\begin{align*}
& \text{Pr}(\mu,\sigma\vert h) =
\\
& =
\frac{
\prod_i
\text{Normal}(h_i\vert \mu,\sigma)
\,\text{Normal}(\mu\vert 178,20)
\,\text{Uniform}(\sigma\vert 0,50)
}
{
\int\int
\prod_i
\text{Normal}(h_i\vert \mu,\sigma)
\,\text{Normal}(\mu\vert 178,20)
\,\text{Uniform}(\sigma\vert 0,50)
\,d\mu\, d\sigma
}.
\\
\end{align*}


%***************************************************************
%***************************************************************
\section{The Linear Model}\label{linear_model}
The linear model we will use here can be seen as an extension of the Gaussian model in
Example~\ref{gaussian_model} by including weight, assuming a relation between height and weight.  The word  \emph{relation} is used  in the mathematical sense; it is a subset of a Cartesian product.
The model is given in this quote from \textsl{Statistical Rethinking}, page 93:
\begin{quoting}\small
Now how do we get weight into a Gaussian model of height? Let $x$ be the name for the
column of weight measurements, \texttt{d2\$weight}.
Let the average of the $x$ values be $\bar x$, ``ex bar''.
Now we have a predictor variable $x$, which is a list of measures of the same length as $h$. To get
weight into the model, we define the mean $\mu$ as a function of the values in $x$. This is what it
looks like, with explanation to follow:\reqnomode
\begin{align*}
h_i    & \sim \text{Normal}(\mu_i,\sigma) \tag*{[\textsf{\small likelihood}]}    \\
\mu_i  & = \alpha + \beta(x_i - \bar x)   \tag*{[\textsf{\small linear model}]}  \\
\alpha & \sim \text{Normal}(178,20)       \tag*{[\textsf{\small $\alpha$ prior}]}\\  
\beta  & \sim \text{Normal}(0,10)         \tag*{[\textsf{\small $\beta$ prior}]}   \\
\sigma & \sim \text{Uniform}(0,50)        \tag*{[\textsf{\small $\sigma$ prior}]} \\
\end{align*}
\end{quoting}
See that this model includes no probability distribution for the weight measurements $x_i$, but the measurable functions $h_i$, $\alpha$, $\beta$, and $\sigma$ do have probability distributions included in the model. We consider the $x_i$ as known values.

Let $U$ denote the domain of the functions $(\alpha, \beta,\sigma)$ and  $h$, as illustrated:
\[
\xymatrix@R=16pt@C=30pt{ 
 & \pspace \makebox[0pt][l]{ $=\R^2\times\R^+$}
 \\
 U \ar[ur]^{(\alpha, \beta,\sigma)}
 \ar[dr]_h
 \ar[r] &
 \pspace\times\sspace \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
  & \sspace\makebox[0pt][l]{ $= \R^n$}
  \\
}
%
\hspace{50pt}
%
\xymatrix@R=16pt@C=30pt{ 
 & \pspacesig \makebox[0pt][l]{ $=\borel_{\R^2\times\R^+}$}
 \ar[dl]_{\makebox[0pt][r]{$\scriptstyle\preimage{(\alpha,\beta,\sigma)}$}}
 \ar[d]^{\preimage{\projectionone}}
 \\
 \sigalg{D}  & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]  
 \\
  & \sspacesig \makebox[0pt][l]{ $=\borel_{\R^n}$}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\makebox[0pt][r]{$\scriptstyle\preimage{h}$}}
  \\
}
\]
We suppose $(U,\sigalg{D},Q)$ is a probability space such that the following diagram commutes:
\[
\xymatrix@R=16pt@C=30pt{ 
 & & \pspacesig \rlap{ $=\borel_{\R^2\times\R^+}$}
 \ar[dl]_{\kern30pt\preimage{(\alpha,\beta,\sigma)}} 
 \ar[d]^{\preimage{\projectionone}}
 \ar@/_10pt/[lld]_{Q\circ \preimage{(\alpha,\beta,\sigma)}}
 \\
 [0,1] & \sigalg{D} \ar[l]_-{\ Q} & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]  
 \\
 & & \sspacesig \rlap{ $=\borel_{\R^n}$}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{h}}
  \ar@/^10pt/[llu]^{Q\circ\preimage{h}\quad}
  \\
}
\]
Define $\function:\pspace \times \sspace \to\R$ by
\begin{align*}
\function\bigl((a,b,s),t\bigr)
& =
\prod_i
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t_i-\bigl( a\cdot 1 + b(x_i-\bar x) \bigr)}{s}
\right)^2
\right\} \\
& = 
\prod_i
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t_i-\mu_i}{s}
\right)^2
\right\} \\
& =
\prod_i
\text{Normal}(t_i\vert \mu_i, s),
\end{align*}
where $\mu_i=a\cdot 1 + b(x_i-\bar x)$,
so the following diagram commutes:
\[
\xymatrix@R=16pt@C=30pt{ 
\pspace
\ar[dr]^{\makebox[0pt][l]{$\scriptstyle{\function^t \quad \emph{\scriptsize the likelihood}}$}}
& \\
\pspace\times\sspace 
\ar[u]^{\projectionone}
\ar[d]_{\projectiontwo}
\ar[r]^{\function}
& \R \\
\sspace 
\ar[ur]_{\makebox[0pt][l]{$\scriptstyle{\function_{(a,b,s)} \quad \emph{\scriptsize Radon-Nikodym derivative}}$}}
& 
}
\]

Define a family $\{P_{(a,b,s)}:(a,b,s)\in\pspace\}$ of measures on the sample space \textsigma-algebra
$\sspacesig=\borel_{\R^n}$ in terms of the indefinite integrals of the collection
$\{ \function_{(a,b,s)} : (a,b,s)\in\pspace \}$, integrated with respect to Lebesgue measure, call it
$\lambda_{n}$, on
$\borel_{\R^n}$;
\[
P_{(a,b,s)}(\setii)=
\int_\setii \function_{(a,b,s)} \,d\lambda_{n}
\quad
\text{for all $\setii\in\borel_{\R^n}$}.
\]
Let us verify a requirement that a measure must satisfy in order to be a probability measure; namely that
$P_{(a,b,s)}(\sspace)=1$ for any $(a,b,s)\in\pspace$.
This is based on the fact that the functions
\[
p:\R\to\R^+
:t \mapsto
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t-r}{s}
\right)^2
\right\}
\]
are well-known to be a probability density functions.

\begin{quoting}\small
For the purpose of comparison, see that the sum
$a_1^2+a_2^2+a_3^2$ can be written as $A^{\textsf{T}}A$ with
$A^{\textsf{T}} = [a_1\ a_2\ a_3]$.
Were you to then write $a_i=y_i-(1\cdot\beta_0+x_i\cdot\beta_1)$, with $\beta=(\beta_0,\beta_1)$,  and with $X$ and $Y$ now functions or vectors or variables or whatever, you would end up with something like:
\[
\function(\beta,\sigma^2,Y)=
\left(2\pi\sigma^2\right)^{-n/2}
\exp\left\{
-\frac{1}{2\sigma^2}[Y-X\beta]^{\textsf{T}}[Y-X\beta]
\right\},
\]
which you could compare with equation $(3.1)$ on page 51 of Marin \& Robert, \textsl{Bayesian Core}, which says the likelihood of the \emph{ordinary normal linear model} is
\[
l(\beta,\sigma^2\vert y,X) 
=
\left(2\pi\sigma^2\right)^{-n/2}
\exp\left\{
-\frac{1}{2\sigma^2}(y-X\beta)^{\textsf{T}}(y-X\beta)
\right\}.
\]
The translation between their point of view and ours is not exact. For one thing,  our $a$ and $b$ would be part of their $\beta$.
For another, if the particular data included the $y$-values at known $X$ values, say when $X$ is equal to $X_0$, then our $f$ would relate to their $l$ by something like:
\[
f(\beta,\sigma^2,y)
=
l(\beta,\sigma^2\vert y,X)\Big|_{X=X_0}
\]
\end{quoting}


Define a probability measure $\rho$ on the rectangles 
$\seti\times\setii\times\setiii$ of the parameter space \textsigma-algebra 
$\pspacesig=\borel_{\R^2\times\R^+}$ by
\begin{align*}
& \rho(\seti\times\setii\times\setiii) =
\\
& =
\text{Normal}(178,20)(\seti)\cdot
\text{Normal}(0,10)(\setii)\cdot
\text{Uniform}(0,50)(\setiii).
\end{align*}
See that the prior probability distribution $\rho$ is absolutely continuous with respect to a different Lebesgue measure, call it
$\lambda$, on $\pspacesig=\borel_{\R^2\times\R^+}$,
and let
$\funch:\R^2\times\R^+\to\R$ in
$\cali{L}_1(\pspace,\pspacesig,\lambda)$ be defined by
\[
\funch (a,b,s) =
\text{Normal}(a\vert 178,20)\cdot
\text{Normal}(b\vert 0,20)\cdot
\text{Uniform}(s\vert 0,50)
\]
so that $\functioniii$ represents the Radon-Nikodym derivative $d\rho/d\lambda$.
According to Bayes' theorem, the Radon-Nikodym derivative of the posterior probability 
$\rho_{t}$ with respect to $\lambda$ has a representative, denoted here by
$\text{Pr}(a,b,s\,\vert\, t)\in\cali{L}_1(\pspace, \pspacesig,\lambda)$,
where 
\[
\text{Pr}(a,b,s\,\vert\, t)
=
\frac{\function^{t}(a,b,s)\,\functioniii(a,b,s)}
{\int_{\pspace}\function^{t}(a,b,s)\,\functioniii(a,b,s)\,d\lambda(a,b,s)},
\]
with 
\[
\mu_i=a\cdot 1 + b(x_i-\bar x)
\]
and with
\[
\funcf^t(a,b,s) =
\prod_i
\frac{1}{s\sqrt{2\pi}}
\exp
\left\{
-\frac{1}{2}
\left(
\frac{t_i-\mu_i}{s}
\right)^2
\right\}.
\]




%***************************************************************
%***************************************************************
\section{Logistic Regression}\label{logistic_regression}
The logit function is defined by
\[
\text{logit} : (0,1) \to \R: p\mapsto \ln\left( \frac{p}{1-p} \right),
\]
and the logistic function is defined by
\[
\text{logistic}:\R\to (0,1): a\mapsto  \frac{\exp(a)}{1+\exp(a)}.
\]
The logit function is the inverse of the logistic function, that is,
\[
\text{logit}(p)=a \quad \Leftrightarrow \quad 
p = \text{logistic}(a),
\]
which says
\[
\ln\left( \frac{p}{1-p} \right) = a \quad
\Leftrightarrow \quad 
p = \frac{\exp(a)}{1+\exp(a)}.
\]
The expression
$p/(1-p)$
can be seen as the odds ratio.

The logistic regression model we will look at here, 
quoted from the tentative model displayed in \textsl{Statistical Rethinking,} page 327, is:
\begin{quoting}\small
\begin{align*}
L_i & \sim \text{Binomial}(1,p_i) \\
\text{logit}(p_i) & = \alpha_{\textsc{actor}[i]} + \beta_{\textsc{treatment}[i]} \\
\alpha_j & \sim \text{ to be determined} \\
\beta_k & \sim \text{ to be determined} \\
\end{align*}
\end{quoting}
The ``$\alpha_j \sim$  to be determined'' will later be
$\alpha_j  \sim \text{Normal}(0,1.5)$, and
``$\beta_k  \sim$ to be determined'' will later be
$\beta_k  \sim \text{Normal}(0,0.5)$.


Let  $(\alpha, \beta):U\to\pspace$ and $(L,\textsc{actor}, \textsc{treatment}):U\to\sspace$ 
be maps such that the following diagrams commute:
\[
\xymatrix@R=16pt@C=30pt{ 
 & \pspace 
 \\
 U \ar[ur]^{(\alpha, \beta)} 
 \ar[dr]_{\llap{\scriptsize{$(L,\textsc{actor}, \textsc{treatment})$}}}
 \ar[r] & 
 \pspace\times\sspace \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
  & \sspace \\
}
%
\hspace{60pt}
%
\xymatrix@R=16pt@C=30pt{ 
 & \pspacesig
 \ar[dl]_{\preimage{(\alpha,\beta)}} 
 \ar[d]^{\preimage{\projectionone}}
 \\
 \sigalg{D}  & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]  
 \\
  & \sspacesig
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{\llap{\scriptsize{$(L,\textsc{actor}, \textsc{treatment})$}}}}
  \\
}
\]
with
\[
\pspace = \R^7 \times \R^4
\]
and
\[
\sspace =
\{0,1\}^n \times \{ 1,\ldots,7 \}^n \times \{1,2,3,4 \}^n,
\]
where 
$\pspacesig = \borel_{\R^7 \times \R^4}$ and $\sspacesig=\powerset(\sspace)$.
We are supposing $(U,\sigalg{D},Q)$ is a probability space such that the following diagram commutes:
\[
\xymatrix@R=16pt@C=30pt{ 
 & & \pspacesig \rlap{ $=\borel_{\R^7\times\R^4}$}
 \ar[dl]_{\kern30pt\preimage{(\alpha,\beta)}} 
 \ar[d]^{\preimage{\projectionone}}
 \ar@/_10pt/[lld]_{Q\circ \preimage{(\alpha,\beta)}}
 \\
 [0,1] & \sigalg{D} \ar[l]_-{\ Q} & 
 \productsig{\pspacesig}{\sspacesig} 
 \ar[l]  
 \\
 & & \sspacesig \rlap{ $=\powerset(\sspace)$}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{(L,\text{etc.})}}
  \ar@/^10pt/[llu]^{\llap{\scriptsize{$Q\circ\preimage{(L,\textsc{actor},\textsc{treatment})}$}}}
  \\
}
\]

Define $\function:\pspace\times\sspace \to \R$ by 
\begin{align*}
\bigl((a,b),(q,r,s)\bigr)
& \mapsto
\prod_i
\bigl( \text{logistic}(a_{r_i} + b_{s_i}) \bigr)^{q_i}
\bigl( 1 - \text{logistic}(a_{r_i} + b_{s_i}) \bigr)^{1-q_i} \\
& = \prod_i
\text{Binomial}(q_i \vert 1, p_i),\quad \text{ with $p_i = \text{logistic}(a_{r_i} + b_{s_i})$} \\
\end{align*}
so the following diagram commutes
\[
\xymatrix@R=16pt@C=30pt{ 
\pspace \ar[dr]^{\ \function^{(q,r,s)}\quad \rlap{\emph{\scriptsize the likelihood}}}
& \\
\pspace\times\sspace 
\ar[u]^{\projectionone}
\ar[d]_{\projectiontwo}
\ar[r]^{\function}
& \R \\
\sspace 
\ar[ur]_{\function_{(a,b)} \quad \rlap{\emph{\scriptsize Radon-Nikodym derivative}}} 
& 
}
\]

Define a family $\{P_{(a,b)}:(a,b)\in\pspace\}$ of measures on the sample space \textsigma-algebra
$\sspacesig=\powerset(\sspace)$ in terms of the indefinite integrals of the collection
$\{ \function_{(a,b)} : (a,b)\in\pspace \}$, integrated with respect to counting measure on 
$\powerset(\sspace)$, calling counting measure $\delta$ here;
\begin{align*}
P_{(a,b)}(\setii)
& = \int_\setii \function_{(a,b)} \,d\delta \\
& = \sum_{(q,r,s)\in\setii} \function_{(a,b)}(q,r,s) \\
& = \sum_{(q,r,s)\in\setii} \prod_i \text{Binomial}(q_i\vert 1,p_i),
\end{align*}
with $p_i=\text{logistic}(a_{r_i} + b_{s_i})$.
These measures are probability measures because they are defined in terms of the density 
\[
\prod_i \text{Binomial}(q_i\vert 1,p_i)
\]
of a probability measure. Roughly.

Define a probability measure $\rho$ on the rectangles 
$\seti\times\setii$ of the parameter space \textsigma-algebra 
$\pspacesig=\borel_{\R^7\times\R^4}$ by
\begin{align*}
\rho(\seti\times\setii)
&=
\text{Normal}(0,1.5)(\seti)\cdot
\text{Normal}(0,0.5)(\setii).
\end{align*}
The prior probability distribution $\rho$ is absolutely continuous with respect to a Lebesgue measure, call it
$\lambda$, on $\pspacesig=\borel_{\R^7\times\R^4}$.
Let $\functioniii\in\cali{L}_1(\pspace,\pspacesig,\lambda)$ be defined by
\[
\functioniii:\R^7\times\R^4\to\R:(a,b)\mapsto
\text{Normal}(a\vert 0,1.5)\cdot
\text{Normal}(b\vert 0,0.5).
\]
so that $\functioniii$ represents the Radon-Nikodym derivative $d\rho/d\lambda$.
According to Bayes' theorem, the Radon-Nikodym derivative of the posterior probability 
$\rho_{(q,r,s)}$ with respect to $\lambda$ has a representative, denoted here by 
$\text{Pr}(a,b\,\vert\, q,r,s)\in\cali{L}_1(\pspace, \pspacesig,\lambda)$,
where
\[
\text{Pr}(a,b\,\vert\, q,r,s)
=
\frac{\function^{(q,r,s)}(a,b)\,\functioniii(a,b)}
{\int_{\pspace}\function^{(q,r,s)}(a,b)\,\functioniii(a,b)\,d\lambda(a,b)}.
\]










%***************************************************************
%***************************************************************
\chapter{Expectation Operators as Projections}
%\section{Orthogonal Projections}
%\input{chapters/orthogonalprojections}
\newcommand{\proj}{\mathfrak{Proj}}
\newcommand{\projsub}[1]{\mathop{\proj\kern-1pt}\nolimits_#1}
\newcommand{\projgvn}[2]
{\mathop{\proj}\nolimits(#2,#1)}
\newcommand{\raum}[1]{\mathfrak{#1}}
\newcommand{\inner}[2]{\left\langle#1,#2\right\rangle}
\newcommand{\hilbertspace}{\mathfrak{H}}
\newcommand{\hilbertsubspace}{\mathfrak{M}}
\newcommand{\hilbertelt}{x}
\newcommand{\hilberteltii}{y}
\newcommand{\hilbertortho}{e_1}
\newcommand{\hilbertorthoii}{e_2}
\newcommand{\hilbertorthoi}{e_i}
\newcommand{\hilbertorthon}{e_n}

\lettrine{A}{n orthogonal} projection on a Hilbert space is a linear idempotent whose kernel is orthogonal to its range.
There is a one-to-one correspondence between the closed subspaces of a Hilbert space and its orthogonal projections.
Let $\hilbertspace$ be a Hilbert space, and let $\hilbertsubspace$ be a closed subspace of $\hilbertspace$. To each $\hilbertelt\in\hilbertspace$ there corresponds a unique element of $\hilbertsubspace$, denoted here by
$\proj(\hilbertelt)$,  such that 
$\hilbertelt-\proj(\hilbertelt) \perp \hilbertsubspace$.
The map $\hilbertspace \to \hilbertspace$ defined by 
$\hilbertelt\mapsto \proj(\hilbertelt)$ is called the orthogonal projection of 
$\hilbertspace$ onto $\hilbertsubspace$ along ${\hilbertsubspace}^\perp$, or simply the
\emph{orthogonal projection of $\boldsymbol{\hilbertspace}$ 
onto $\boldsymbol{\hilbertsubspace}$}.

Orthogonal projections are contractive in the sense that any nonzero orthogonal projection on a Hilbert space has norm equal to 1.
For $\hilbertelt$ and $\hilberteltii$ in $\hilbertspace$, we let 
$\inner{\hilbertelt}{\hilberteltii}$ denote their inner product.

\begin{prop}
Let $\hilbertspace$ be a Hilbert space, and let $\hilbertsubspace$ be a closed subspace of $\hilbertspace$, where $\proj :\hilbertspace \to \hilbertspace$ is the orthogonal projection of $\hilbertspace$ onto $\hilbertsubspace$. Fix $\hilbertelt\in \hilbertspace$. Then $\proj(\hilbertelt)$ is that element of $\hilbertsubspace$ which is closest to $\hilbertelt$, meaning that
\[
\norm{\hilbertelt-\proj(\hilbertelt)}<\norm{\hilbertelt-\hilberteltii} 
\]
for all $\hilberteltii$ in the subspace $\hilbertsubspace$ such that 
$\proj(\hilbertelt)\neq \hilberteltii$.
\end{prop}



\begin{prop}
Let $\{\hilbertortho, \hilbertorthoii, \ldots, \hilbertorthon\}$ be an orthonormal set in a Hilbert space $\hilbertspace$, and let $\proj:\hilbertspace \to \hilbertspace$ be the orthogonal projection of $\hilbertspace$ onto the 
$\raum{Span}\{\hilbertortho, \hilbertorthoii, \ldots, \hilbertorthon\}$. 
Fix $\hilbertelt\in\hilbertspace$. Then 
$\proj(\hilbertelt) = \sum_{i=1}^{n} \inner{\hilbertelt}{\hilbertorthoi}\hilbertorthoi$. 
That is, 
\[
\norm{\hilbertelt - \sum_{i=1}^n a_i \hilbertorthoi} < 
\norm{\hilbertelt-\hilberteltii}
\]
for all 
$\hilberteltii$ in the $\raum{Span}\{\hilbertortho, \hilbertorthoii, \ldots, \hilbertorthon\}$ 
such that $\proj(\hilbertelt)\neq \hilberteltii$ 
if and only if  each scalar  $a_i$ equals the Fourier coefficient 
$\inner{\hilbertelt}{\hilbertorthoi}$ of $\hilbertelt$. 
\end{prop}





\section{Expectation as Projection}
\begin{quoting}
\textbf{In order to complete this section,}
you should look at the case in which the \textsigma\hyp{}subalgebra is generated by a finite partition.  After all, this is always the case you will be using when doing any computer modeling.

It means wheeling in a decent exposition of the finite case. Use Cheng\hyp{}Shang Chang's,
\textsl{Understanding Conditional Expectation via Vector Projection.}
Then decide how far you want to go with this. Can you do better than
\textsl{A Deep Dive Into How R Fits a Linear Model} from
\cf{http://madrury.github.io/}?
\end{quoting}

%
\begin{discussion}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a  probability space, and let 
$\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$.
The conditional expectation operator
$
\condexpop{\sigmaalgebraii}:
L_1 (\measurespace, \sigmaalgebra,\measure)\to
L_1 (\measurespace, \sigmaalgebra,\measure)
$
is idempotent; if $\ellclass{\function}{\measure}\in L_1(\measurespace, \sigmaalgebra,\measure)$, then $\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}\in 
L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$, and so by Proposition~\ref{subalgebra_fixed}, 
\[
\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}
=
\condexpsub{{(\condexpsub{\ellclass{\function}{\measure}}{\sigmaalgebraii}})}
{\sigmaalgebraii}.
\]
That is, 
$\condexpop{\sigmaalgebraii} = 
\condexpop{\sigmaalgebraii}\circ\condexpop{\sigmaalgebraii}$
on $L_1 (\measurespace, \sigmaalgebra,\measure)$.
\end{discussion}

\textbf{The inclusion in Discussion~\ref{not_a_subspace} is really an embedding;
see Discussion~\ref{L1_subspace_embedding}.
Change your subsets to embeddings.}


\begin{discussion}\label{not_a_subspace}
Let us see how the operator
$\condexpop{\sigmaalgebraii}$ restricts to 
$L_2(\measurespace, \sigmaalgebra,\measure)$.
The subspace
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
of the  space
$L_2(\measurespace, \sigmaalgebra,\measure)$ is closed.
Because the operator $\condexpop{\sigmaalgebraii}$ is contractive, it follows that 
$\condexpop{\sigmaalgebraii}$ maps
$L_2(\measurespace, \sigmaalgebra,\measure)$ 
into
$L_2(\measurespace, \sigmaalgebra,\measure)$.
We will denote the restriction of $\condexpop{\sigmaalgebraii}$ to 
$L_2(\measurespace, \sigmaalgebra,\measure)$ by 
$\condexpop{\sigmaalgebraii}\kern-2pt\vert$.
By definition, the range of the operator
$\condexpop{\sigmaalgebraii}:
L_2(\measurespace, \sigmaalgebra,\measure)
\to
L_2(\measurespace, \sigmaalgebra,\measure)$
is a subspace of 
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$,
but then by Proposition~\ref{subalgebra_fixed}, the subspace 
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
is fixed by 
$\condexpop{\sigmaalgebraii}$, and so the range of 
$\condexpop{\sigmaalgebraii}$
is actually equal to 
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
\end{discussion}


\begin{rmk}
Some implications are used without much fanfare; namely, if the classes $\ellclass{\function}{\measure}$ and 
$\ellclass{\functionii}{\measure}$ are in 
$L_2(\measurespace, \sigmaalgebra,\measure)$, then the product 
$\ellclass{\function}{\measure}\ellclass{\functionii}{\measure} 
= \ellclass{\function\functionii}{\measure}$ is in 
$L_1(\measurespace, \sigmaalgebra,\measure)$. This is a routine application of the Cauchy-Schwarz inequality, considered to be the $2+2$ of higher mathematics.
\end{rmk}




\begin{prop}\label{projection_proposition}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a  probability space, and let 
$\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$.
The conditional expectation operator 
$
\condexpop{\sigmaalgebraii}:
L_2(\measurespace, \sigmaalgebra,\measure)\to
L_2(\measurespace, \sigmaalgebra,\measure)
$ 
is  the unique orthogonal projection of the Hilbert space $L_2(\measurespace, \sigmaalgebra,\measure)$ onto the closed subspace $L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
\end{prop}



\begin{proof}
To show that $\condexpop{\sigmaalgebraii}$ is the orthogonal projection of
$L_2(\measurespace, \sigmaalgebra,\measure)$
onto
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$, we need to show that to each $\function\in L_2(\measurespace, \sigmaalgebra,\measure)$ there corresponds a unique element of 
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$, in this case 
$\condexpsub{\function}{\sigmaalgebraii}$, 
such that 
$\function - \condexpsub{\function}{\sigmaalgebraii} \perp \functioniii$ for all $\functioniii\in
L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.


We first show that if 
$\function\in L_2(\measurespace, \sigmaalgebra,\measure)$, 
then
$\function - \condexpsub{\function}{\sigmaalgebraii} \perp \functioniii$ for all $\functioniii\in
L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
Let 
$\function \in L_2(\measurespace, \sigmaalgebra,\measure)$.
We must show that  
\[
\inner{\function - \condexpsub{\function}{\sigmaalgebraii}}{\functioniii}=0
\quad
\text{for all 
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$},
\] 
which is equivalent to showing that 
\[
\inner{\function}{\functioniii} = \inner{\condexpsub{\function}{\sigmaalgebraii}}{\functioniii}
\quad
\text{for all 
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$},
\] 
and in turn, this means showing that
\[
\expvalof{\function\functioniii} = \expvalof{\functioniii \condexpsub{\function}{\sigmaalgebraii}}
\quad
\text{
for all 
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$}.
\]  
Let $\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
In order to apply Proposition~\ref{measurable_functions_factor_out}, 
check first that
$\function \in L_1(\measurespace, \sigmaalgebra,\measure)$, and this is because
$\function \in L_2(\measurespace, \sigmaalgebra,\measure)$ and 
$L_2(\measurespace, \sigmaalgebra,\measure) \subseteq
L_1(\measurespace, \sigmaalgebra,\measure)$ (since the measure space is finite).
Next check that
$\functioniii$ is
$(\sigmaalgebraii, \borel_\R)$\hyp{}measurable
since
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
Finally check that $\function\functioniii\in L_1(\measurespace, \sigmaalgebra,\measure)$ by Cauchy-Schwarz.
Therefore, 
since 
$\function \in L_1(\measurespace, \sigmaalgebra,\measure)$ and
$\functioniii:\measurespace\to\R$ is $(\sigmaalgebraii, \borel_\R)$\hyp{}measurable with 
$\function\functioniii\in L_1(\measurespace, \sigmaalgebra,\measure)$, 
it follows by Proposition~\ref{measurable_functions_factor_out} that 
$\expvalof{\function\functioniii} = \expvalof{\functioniii \condexpsub{\function}{\sigmaalgebraii}}$, as required.

We now show the uniqueness part; namely we show that if
$\function\in L_2(\measurespace, \sigmaalgebra,\measure)$, then 
$\condexpsub{\function}{\sigmaalgebraii}$ is the
unique element of 
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
such that 
$\function - \condexpsub{\function}{\sigmaalgebraii} \perp \functioniii$ for all $\functioniii\in
L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
Let
$\function\in L_2(\measurespace, \sigmaalgebra,\measure)$,
and suppose that there is a 
$\functionii \in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$
having the property that
$\function-\functionii\perp \functioniii$ for all $\functioniii\in
L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$.
We want to see that this implies $\functionii$ must equal 
$\condexpsub{\function}{\sigmaalgebraii}$.
To say that 
\[
\function-\functionii\perp \functioniii 
\quad\text{for all $\functioniii\in
L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$}
\]
means saying that 
\[
\inner{\function-\functionii}{\functioniii} = 0 
\quad\text{for all 
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$},
\]
or equivalently that 
\[
\inner{\function}{\functioniii} = \inner{\functionii}{\functioniii}
\quad\text{for all 
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$}.
\]
In terms of integrals, this says
\[
\int_\measurespace \function\functioniii \, d\measure
=
\int_\measurespace \functionii\functioniii \, d\measure
\quad\text{ 
for all
$\functioniii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$}.
\]
In particular, for every $B\in\sigmaalgebraii$, the characteristic function 
$\charfunction{B}$ is in 
$L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$, and so
\[
\int_\measurespace \function\charfunction{B} \, d\measure
=
\int_\measurespace \functionii\charfunction{B} \, d\measure
\quad\text{for all
$B\in\sigmaalgebraii$}.
\]
Since 
$\functionii\charfunction{B}
\in L_1(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$ 
for every $B\in\sigmaalgebraii$, by Cauchy-Schwarz,
it follows by Proposition~\ref{integral_over_subalgebra} that
\[
\int_\measurespace \functionii\charfunction{B}\, d\measure
=
\int_\measurespace \functionii\charfunction{B}\, d\measure\restrictedto{\sigmaalgebraii}
\quad\text{for all
$B\in\sigmaalgebraii$}.
\]
Consequently, 
\[
\int_\measurespace \function\charfunction{B} \, d\measure
=
\int_\measurespace \functionii\charfunction{B} \, d\measure\restrictedto{\sigmaalgebraii}
\quad
\text{for all
$B\in\sigmaalgebraii$,}
\]
which is the same as saying that
\[
\int_B \function \, d\measure
=
\int_B \functionii \, d\measure\restrictedto{\sigmaalgebraii}
\quad\text{for all $B\in\sigmaalgebraii$.}
\]
This means that $\functionii = \condexpsub{\function}{\sigmaalgebraii}$;  in fact, this is the defining feature of $\condexpsub{\function}{\sigmaalgebraii}$, which completes the proof.
\end{proof}



\begin{example}
Let $(\measurespace, \sigmaalgebra,\measure)$ be a  probability space, and let 
$\sigmaalgebraii$ be the smallest $\textsigma$-subalgebra of $\sigmaalgebra$, namely $\{\measurespace, \mtset\}$.
Then the conditional expectation operator 
$\condexpop{\sigmaalgebraii} :\Lone\to\Lone$ is equal to the expected value operator $\expval$ times the class containing the constant function $\oneonomega$
on
$\Lone$, meaning
$\condexpop{\sigmaalgebraii}(\ellclass{\functionii}{\measure}) 
= \expval{\ellclass{\functionii}{\measure}}\cdot\ellclass{\oneonomega}{\measure}$
for all $\ellclass{\functionii}{\measure} \in \Lone$. In this case, the closed subspace $L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$ consists of all classes that are constant $\Psubstar{\sigalgb}$-almost everywhere on $\measurespace$. 
Recall Discussion~\ref{the_cheapest_subalgebra}.
\end{example}





\chapter[Squared-Bias/Variance]{Squared-Bias/Variance Decompositions}
%\input{chapters/averagingoperators}

Throughout this section, let $(\measurespace, \sigmaalgebra,\measure)$ be a  probability space, and let 
$\sigmaalgebraii$ denote a $\textsigma$-subalgebra of $\sigmaalgebra$.



\begin{defn}
Let $\OpT$ be a bounded operator on $\Lone$. If for every pair $\function$ and $\functionii$ in $\Lone$  such that $\function\OpT \functionii\in\Lone$, the equality
\[
\OpT(\function\OpT \functionii) = (\OpT \function)( \OpT \functionii)
\]
holds, then the operator $\OpT$ is called an \term{averaging operator}. Such an operator is said to satisfy the \emph{averaging property}.
\end{defn}


As will be shown in Proposition~\ref{averaging_operator}, every conditional expectation operator is an averaging operator.

\begin{lemma}\label{range_factors_out}
If $\OpT$ is an averaging operator on $\Lone$, and if $\functionii$ is in the range of $\OpT$, then 
\[
\OpT(\function\functionii) = (\OpT \function)\functionii = \functionii\OpT \function.
\]
\end{lemma}

\begin{proof}
Let $\OpT$ be an averaging operator on $\Lone$, and let $\functionii$ be in the range of $\OpT$; that is, let $\functionii = \OpT \functioniii$. Since $\OpT$ is an averaging operator, it follows by definition that
$ \OpT(\function\OpT \functioniii) = \OpT \function \OpT \functioniii $.  Therefore, by substitution, 
\[
\OpT(\function\functionii) = \OpT(\function\OpT \functioniii) = \OpT \function \OpT \functioniii 
= (\OpT \function)\functionii = \functionii\OpT \function,
\]
as required.
\end{proof}

\begin{prop}\label{averaging_bias_variance}
Let $\OpT$ be an averaging operator on $\Lone$.
If $\function$ and $\functionii$ are in $\Ltwo$ with $\function\in\kernel\OpT$ and $\functionii\in\range \OpT$,  then 
\begin{align*}
\OpT\bigl((\function+\functionii)^2\bigr)
& =
\OpT(\function^2) + \OpT(\functionii^2), \text{ and}
\\
\OpT\bigl((\function-\functionii)^2\bigr)
& =
\OpT(\function^2) + \OpT(\functionii^2).
\end{align*}
\end{prop}

\begin{proof}
Let $\function$ and $\functionii$ be in $\Ltwo$ with $\function\in\kernel\OpT$ and $\functionii\in\range\OpT$.
The verification of the second displayed equality is short:
\begin{align*}
\OpT \bigl( (\function-\functionii)^2 \bigr)
& = \OpT(\function^2 -2\function\functionii +\functionii^2)\\
& = \OpT(\function^2) - 2\OpT(\function\functionii) + \OpT(\functionii^2)\\
& = \OpT(\function^2) - 2\functionii\OpT(\function) +\OpT(\functionii^2)
&& \text{$\functionii\in\range\OpT$, Lemma~\ref{range_factors_out}}\\
& = \OpT(\function^2) - 2\functionii\cdot 0 +\OpT(\functionii^2)
&& \text{$\function\in\kernel\OpT$}\\
& = \OpT(\function^2) + \OpT(\functionii^2),
\end{align*}
and the verification of the first displayed equality amounts to replacing the minus sign with a plus sign, completing the proof.
\end{proof}



\begin{prop}\label{averaging_operator}
If $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$, then
$\condexpop{\sigmaalgebraii}$ is an averaging operator.  That is, if $\function$ and $\functionii$ are  in $\Lone$, and if $\sigmaalgebraii$ is a $\textsigma$-subalgebra of $\sigmaalgebra$ with
$\function\condexpsub{\functionii}{\sigmaalgebraii}\in\Lone$, then 
\[
\condexpsub{(\function\condexpsub{\functionii}{\sigmaalgebraii})}{\sigmaalgebraii}
=
(\condexpsub{\function}{\sigmaalgebraii})( \condexpsub{\functionii}{\sigmaalgebraii}).
\]
\end{prop}

\begin{proof}
Since $\condexpsub{\functionii}{\sigmaalgebraii}$ is $(\sigmaalgebraii,\borel_\R)$\hyp{}measurable,
and $\function\condexpsub{\functionii}{\sigmaalgebraii}\in\Lone$, it follows by Proposition~\ref{measurable_functions_factor_out} that
$\condexpsub{(\function\condexpsub{\functionii}{\sigmaalgebraii})}{\sigmaalgebraii} 
= 
(\condexpsub{\function}{\sigmaalgebraii})(\condexpsub{\functionii}{\sigmaalgebraii})$, as required.
\end{proof}



\begin{defn}
Let $\function$ and $\functionii$ be in $\Ltwo$, and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$.  
The \term{conditional variance} of $\function$ given $\sigmaalgebraii$, which we will denote by  
$\condvarsub{\function}{\sigmaalgebraii}$, is defined by 
\[
\condvarsub{\function}{\sigmaalgebraii}
\definedby
\condexpsub{\bigl([\function - \condexpsub{\function}{\sigmaalgebraii}]^2\bigr)}{\sigmaalgebraii}.
\]
Likewise, the (absolute, or unconditional) \term{variance} of $\function$, which we will denote by 
$\varianceof{\function}$, is defined by
\[
\varianceof{\function}
\definedby
\expval\bigl((\function-\expval{\function})^2\bigr).
\]
The \term{conditional covariance} of $\function$ and $\functionii$ given $\sigmaalgebraii$, which we may denote by  
$\condcovsub{\function}{\functionii}{\sigmaalgebraii}$, is defined by
\[
\condcovsub{\function}{\functionii}{\sigmaalgebraii}
\definedby
\condexpsub{\lilstrut
[\function - \condexpsub{\function}{\sigmaalgebraii}][\functionii-\condexpsub{\functionii}{\sigmaalgebraii}]}
{\sigmaalgebraii}.
\]
Likewise, the (absolute, or unconditional) \term{covariance} of $\function$ and $\functionii$, which we may denote by 
$\covarianceof{\function}{\functionii}$, is defined by
\[
\covarianceof{\function}{\functionii}
\definedby
\expval\bigl((\function-\expval{\function})(\functionii-\expval{\functionii})\bigr).
\]
\end{defn}


\begin{defn}
Let $\function$ and $\functionii$ be in $\Lone$. Inasmuch as $\function$ can be considered an estimator of the estimand $\functionii$, the \term{conditional bias} in the estimator $\function$ given a \textsigma-subalgebra 
$\sigmaalgebraii$ is then $\condexpsub{\function}{\sigmaalgebraii}-\functionii$.
\end{defn}



\begin{rmk}
If a function $\function$ is a $(\sigalgb,\borel_\R)$\hyp{}measurable function, then so is its square $\function^2$.  Generally, the collection of $(\sigalgb,\borel_\R)$\hyp{}measurable functions is at least closed with respect to products.  Consequently, if 
$\function\in\range\condexpop{\sigalgb}$, then 
$\function^2\in\range\condexpop{\sigalgb}$.
\end{rmk}




\begin{prop}\label{conditional_bias_variance}
Let $\function\in\Ltwo$ and let $\sigmaalgebraii$ be a $\textsigma$-subalgebra of $\sigmaalgebra$ with
$\functionii\in L_2(\measurespace, \sigmaalgebraii,\measure\restrictedto{\sigmaalgebraii})$. Then
\begin{align*}
\condexpsub{[\function-\functionii]^2}{\sigmaalgebraii} 
&=
\underbrace{\condexpsub{[\function-\condexpsub{\function}{\sigmaalgebraii}]^2}{\sigmaalgebraii}}_{\text{cond'l variance}} 
\ +
\ \underbrace{[\condexpsub{\function}{\sigmaalgebraii}-\functionii]^2}
_{\llap{$\scriptstyle\text{squared cond'l bias}$}}\\
&=\condvarsub{\function}{\sigmaalgebraii} + [\condexpsub{\function}{\sigmaalgebraii}-\functionii]^2
\end{align*}
\end{prop}

\begin{proof}
In order to apply Proposition~\ref{averaging_bias_variance}, we acknowledge that $\condexpop{\sigalgb}$ is an averaging operator (Proposition~\ref{averaging_operator}) and that $\function-\condexpsub{\function}{\sigmaalgebraii} \in \kernel \condexpop{\sigmaalgebraii}$
and that
$\condexpsub{\function}{\sigmaalgebraii}-\functionii \in \range \condexpop{\sigalgb}$. By Proposition~\ref{averaging_bias_variance}, it follows that
\[
\condexpsub{[\function-\condexpsub{\function}{\sigalgb} + \condexpsub{\function}{\sigalgb} - \functionii]^2}{\sigalgb} 
=
\condexpsub{[\function-\condexpsub{\function}{\sigalgb}]^2}{\sigalgb}
+
\condexpsub{[\condexpsub{\function}{\sigalgb}-\functionii]^2}{\sigalgb}.
\] 
Since $\condexpsub{\function}{\sigalgb}-\functionii\in\range\condexpop{\sigalgb}$, it follows that 
$[\condexpsub{\function}{\sigalgb}-\functionii]^2\in\range \condexpop{\sigalgb}$. And a projection fixes its range, so 
\[
\condexpsub{[\condexpsub{\function}{\sigalgb}-\functionii]^2}{\sigalgb} 
= [\condexpsub{\function}{\sigalgb}-\functionii]^2.
\]
Consequently, combining these equalities, 
\begin{align*}
\condexpsub{[\function-\functionii]^2}{\sigmaalgebraii}
& =
\condexpsub{[\function-\condexpsub{\function}{\sigalgb} + \condexpsub{\function}{\sigalgb} - \functionii]^2}{\sigalgb}\\
& =
\condexpsub{[\function-\condexpsub{\function}{\sigalgb}]^2}{\sigalgb}
+
\condexpsub{[\condexpsub{\function}{\sigalgb}-\functionii]^2}{\sigalgb}\\
& =
\condexpsub{[\function-\condexpsub{\function}{\sigalgb}]^2}{\sigalgb}
+
[\condexpsub{\function}{\sigalgb}-\functionii]^2,
\end{align*}
as required.
\end{proof}



\chapter{Acknowledgements}
%*********************************************************
%*********************************************************
%*********************************************************
%*********************************************************
\begin{itemize}
\item
Most of the measure and integration theory here came from
\textsl{Principles of Real Analysis}~\cite{pora_aliprantis_1990}, Aliprantis and Burkinshaw.
\item
Conditional distribution section started with Loeve,
\textsl{Probability Theory}~\cite{pt_loeve_1960}.
\item
Bayesian statistics section began as an elaboration of sections 1.2.1 and 1.2.2 in
\textsl{Elements of Bayesian Statistics}~\cite{eobs_florens_1990}, Florens, Mouchart, and Rolin.
\item
The Bayesian statistics examples came from
\textsl{Statistical Rethinking}~\cite{sr_mcelreath_2020}, Richard McElreath.
\item
Abstract algebra can be found in any elementary algebra text. Hungerford, say.
\end{itemize}


\chapter{Afterword}
Initially, when trying to learn statistics, I had been trying to understand regression models, and had a background in functional analysis and operator theory, but little in the way of statistics.
The hopeful outcomes at the start were:
\begin{enumerate}
\item
Understand Kolmogorov's \emph{conditional mathematical expectation.}
\item
Explain regression models to myself in a clear way.
\item
Make real mathematical sense out of the bias-variance tradeoff.
\end{enumerate}
It turns out that
conditional mathematical expectation is an application of the Radon-Nikodym theorem.
Regression models are nothing but projections.
And there is a decomposition of  conditional expectation into a conditional variance and a squared conditional bias because conditional mathematical expectation is a so-called averaging operator.
Not that I was disappointed.


\backmatter

\bibliographystyle{plain}
\bibliography{stats.bib}

\printnomenclature
\printindex
\end{document}
%End of the real Document.
%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
%*********************************************************

%***************************************************************
%***************************************************************
\section{Criteo}
The Criteo display ad Kaggle challenge.  The idea is to predict whether or not an online advertisement will be mouse-clicked, given 13 integer valued features and 26 categorical features.
There is a set of ``training'' data, meaning we are given the features and also told whether the corresponding ad was clicked on. There is also a `test' set of data, meaning we are given the features, but need to predict whether the corresponding ad is clicked on.
There are many missing values in the data. We will use logistic regression to model the probability of clicking on an online ad.

\section{Lost Bayesian Diagrams}

\begin{figure}[htb]
%***************************************************************
%***************************************************************
\begin{framed}\small
Each function $\predictive^\sspaceset:\pspace\to [0,1]$ is
supposed to be
$\bigl(\pspacesig,\borel_{[0,1]}\bigr)$\hyp{}measurable, and
each function $\pspace\times\sspace\to [0,1]$ is
supposed to be
$\bigl(\preimage{\projectionone}(\pspacesig), \borel_{[0,1]}\bigr)$\hyp{}measurable:
\[
\xymatrix@R=30pt{
L_1 \bigl(\pspace\times\sspace,
\sagb,
\measonprod\bigr) \ar[r]^-{\condexpop{\preimage{\projectionone}(\pspacesig)}}
& L_1 \bigl(\pspace\times\sspace,
\sagb,
\measonprod\bigr)
\\
\sagb
\ar[u]^-{Q\, \circ\, \charfunction{}}
\ar[ur]_{\condprobop{\preimage{\projectionone}(\pspacesig)}}
& \sspacesig
\ar[l]^-{\preimage\projectiontwo}
\ar[u]_{\genfrac{}{}{0pt}{1}{\text{sampling}\hfill}{\text{cond'l dist.}}}
}
\]
\[
\xymatrix@R=18pt@C=30pt{
\pspace\times\sspace
\ar[d]
\ar[dr]
\\
\pspace\times\sspace\times\sspacesig
\ar[r] & [0,1]
\\
\sspacesig
\ar[ur]_{\quad\predictive_{(\pspaceelt,\sspaceelt)}=\predictive_\pspaceelt}
\ar[u] &
\\
}
%
\quad
\xymatrix@R=18pt@C=34pt{
\pspace
\ar[d]_-{\fixinthesecond{\sspaceset}}
\ar[dr]^{\predictive^\sspaceset}
\\
\pspace\times\sspacesig
\ar[r]^{\predictive^\pspacesig} & [0,1]
\\
\sspacesig
\ar[ur]_{\predictive_\pspaceelt}
\ar[u]^{\fixinthefirst{\pspaceelt}} &
\\
}
\]
The sampling conditional distribution $\condprobop{\preimage{\projectionone}(\pspacesig)}
\circ\,
\preimage{\projectiontwo}$ is the conditional distribution of
$\projectiontwo$
on $\sspacesig$
given $\preimage{\projectionone}(\pspacesig)$.
\end{framed}
\caption{\textsf{Sampling conditional distribution and Markov kernels.}}
\label{bayesian_nutshell1}
\end{figure}


\begin{figure}[htb]
%***************************************************************
%***************************************************************
\begin{framed}\small
Each function $\prior^\pspaceset:\sspace\to [0,1]$ is
supposed to be
$\bigl(\sspacesig,\borel_{[0,1]}\bigr)$\hyp{}measurable, and
each function $\pspace\times\sspace\to [0,1]$ is
supposed to be
$\bigl(\preimage{\projectiontwo}(\sspacesig), \borel_{[0,1]}\bigr)$\hyp{}measurable:
%
\[
\xymatrix@R=30pt{
L_1 \bigl(\pspace\times\sspace,
\sagb,
\measonprod\bigr)
\ar[r]^-{\condexpop{\preimage{\projectiontwo}(\sspacesig)}}
& L_1 \bigl(\pspace\times\sspace,
\sagb,
\measonprod\bigr)
\\
\sagb
\ar[u]^-{Q\, \circ\, \charfunction{}} \ar[ur]_{\condprobop{\preimage{\projectiontwo}(\sspacesig)}}
& \pspacesig
\ar[l]^-{\preimage\projectionone}
\ar[u]_{\genfrac{}{}{0pt}{1}{\text{posterior}\hfill}{\text{cond'l dist.}}}
}
\]
\[
\xymatrix@R=18pt@C=30pt{
\pspace\times\sspace
\ar[d]
\ar[dr]
\\
\pspace\times\sspace\times\pspacesig
\ar[r] & [0,1]
\\
\pspacesig
\ar[ur]_{\quad \prior_{(\pspaceelt,\sspaceelt)}=\prior_\sspaceelt}
\ar[u] &
\\
}
%
\quad
\xymatrix@R=18pt@C=34pt{
\sspace
\ar[d]_-{\fixinthesecond{\pspaceset}}
\ar[dr]^{\prior^\pspaceset}
\\
\sspace\times\pspacesig
\ar[r]^{\prior^\sspacesig} & [0,1]
\\
\pspacesig
\ar[ur]_{\prior_\sspaceelt}
\ar[u]^{\fixinthefirst{\sspaceelt}} &
\\
}
\]
The posterior conditional distribution
$\condprobop{\preimage{\projectiontwo}(\sspacesig)}
\circ\,
\preimage{\projectionone}$ is the conditional distribution of
$\projectionone$
on $\pspacesig$
given $\preimage{\projectiontwo}(\sspacesig)$.
\end{framed}
\caption{\textsf{Posterior conditional distribution and Markov kernels.}}
\label{bayesian_nutshell2}
\end{figure}





%****************************************************
%An alternate approach to joint and marginal dnesities based on underlying 
%sigmaalgebras.
\begin{defn}
Let $(\measurespace,\sigmaalgebra,\measure)$ be a probability space, and let 
$\function:(\measurespace,\sigmaalgebra) \to (\measurespaceii,\sigmaalgebraii)$ 
be measurable. Then the induced probability measure 
$\measure\circ\preimage{\function}$ on $\sigmaalgebraii$,
defined by 
\[
\measure\circ\preimage{\function} 
: \sigmaalgebraii\to [0,1] 
: B\mapsto\measure\bigl(\preimage{\function}(B)\bigr),
\]
is called the 
\term{probability distribution} of $\function$ on 
$\sigmaalgebraii$, or the \term{law} of $\function$.
The notation 
\[
\measure_\function\definedby \measure\circ\preimage{\function}
\]
may be used.
Probability distributions are probabilities induced on a \textsigma\hyp{}algebra of the codomain of a measurable function.
\end{defn}


\begin{rmk}
By pure set theory, the following diagrams commute:
\[
\xymatrix@R=16pt@C=36pt{ 
 & \measurespace
 \\
 \uspace \ar[ur]^{\function} \ar[dr]_{\functionii} \ar[r]^{\function,\functionii} & 
 \measurespace\times\measurespaceii \ar[u]_\projectionone \ar[d]^\projectiontwo
 \\
  & \measurespaceii\\
}
\quad
\xymatrix@R=16pt@C=40pt{ 
 & \powerset(\measurespace)
 \ar[dl]_{\preimage{\function}} 
 \ar[d]^{\preimage{\projectionone}}
 \\
 \powerset(\uspace)
 \ar[r]^{\ \preimage{(\function,\functionii)}} & 
 \powerset(\measurespace\times\measurespaceii)
 \ar[l]  
 \\
 & \powerset(\measurespaceii)
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{\functionii}}
  \\
}
\]
What Proposition~\ref{joint_measurable_implies_partial} says is that this diagram commutes:
\[
\xymatrix@R=16pt@C=40pt{ 
 & \measurable{\measure^\kernast}
 \ar[dl]_{\preimage{\function}} 
 \ar[d]^{\preimage{\projectionone}}
 \\
 \measurable{\measureiii^\kernast}
 \ar[r]^{\ \preimage{(\function,\functionii)}} & 
 \measurable{(\measure\times\measureii)^\kernast}
 \ar[l]  
 \\
 & \measurable{\measureii^\kernast}
  \ar[u]_{\preimage{\projectiontwo}}
  \ar[ul]^{\preimage{\functionii}}
  \\
}
\]
\end{rmk}





\begin{prop}\label{joint_measurable_implies_partial}
Let $(\uspace, \uspacesemiring,\measureiii)$,
$(\measurespace,\semiring,\measure)$, and 
$(\measurespaceii,\semiringii,\measureii)$
be measure spaces.
If
$\function,\functionii:\uspace\to\measurespace\times
\measurespaceii$ is 
$\bigl(\measurable{\measureiii^\kernast}, 
\measurable{(\measure\times\measureii)^\kernast}\bigr)$\hyp{}measurable,
then
$\function: \uspace
\to
\measurespace$ is  
$(\measurable{\measureiii^\kernast},\measurable{\measure^\kernast})$\hyp{}measurable
and 
$\functionii: \uspace
\to
\measurespaceii$ is
$(\measurable{\measureiii^\kernast},\measurable{\measureii^\kernast})$\hyp{}measurable.
\end{prop}


\begin{proof} First, a little set theory.
If 
$\seti\times\measurespaceii
\in
\powerset(\measurespace\times\measurespaceii)$,
then
\begin{align*}
\preimage{(\function,\functionii)}(\seti\times\measurespaceii)
& = \{ \uspaceelt\in\uspace : \function(\uspaceelt)\in\seti \text{ and }
\functionii(\uspaceelt)\in\measurespaceii \}
\\
& = \{ \uspaceelt\in\uspace : 
\uspaceelt\in\preimage{\function}(\seti) 
\text{ and } 
\uspaceelt\in\preimage{\functionii}(\measurespaceii)\}
\\
& = \preimage{\function}(\seti)\meets\preimage{\functionii}(\measurespaceii)
\\
& = \preimage{\function}(\seti) \text{ since $\preimage{\functionii}(\measurespaceii)=\uspace$.}
\end{align*}

We will now show that 
$\function: \uspace
\to
\measurespace$ is  
$(\measurable{\measureiii^\kernast},\measurable{\measure^\kernast})$\hyp{}measurable.
Let $\seti\in\measurable{\measure^\kernast}$, and we need to see that 
$\preimage{\function}(\seti)\in\measurable{\measureiii^\kernast}$.
We know $\measurespaceii\in\measurable{\measure^\kernast}$ since 
$\measurable{\measure^\kernast}$ is at least an algebra, see Definition~\ref{algebra}.
With 
$\seti\in\measurable{\measure^\kernast}$
and
$\measurespaceii\in\measurable{\measureii^\kernast}$,
it follows that 
$\seti\times\measurespaceii \in
\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}$. And Proposition~\ref{semiring_inclusion} says that 
$\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}
\subseteq
\measurable{(\measure\times\measureii)^\kernast}$.
So 
$\seti\times\measurespaceii \in
\measurable{(\measure\times\measureii)^\kernast}$.
By the hypothesis that 
$\function,\functionii:\uspace\to\measurespace\times
\measurespaceii$ is 
$\bigl(\measurable{\measureiii^\kernast}, 
\measurable{(\measure\times\measureii)^\kernast}\bigr)$\hyp{}measurable, it follows that
$\preimage{(\function,\functionii)}(\seti\times\measurespaceii)
\in
\measurable{\measureiii^\kernast}$. And we have shown that 
$\preimage{(\function,\functionii)}(\seti\times\measurespaceii)
=\preimage{\function}(\seti)$, so 
$\preimage{\function}(\seti)
\in
\measurable{\measureiii^\kernast}$, as required.
\end{proof}




\begin{prop}\label{marginal_absolute_continuity}
Let $(\uspace, \uspacesemiring,\measureiii)$
be a measure space, and let
$(\measurespace,\semiring,\measure)$ and 
$(\measurespaceii,\semiringii,\measureii)$
 be \textsigma\hyp{}finite measure spaces.
Also let
$\function,\functionii:\uspace\to\measurespace\times
\measurespaceii$ be 
$\bigl(\measurable{\measureiii^\kernast}, 
\measurable{(\measure\times\measureii)^\kernast}\bigr)$\hyp{}measurable.
If
$(\measureiii_{\function,\functionii})^*
\abscont
(\measure\times\measureii)^*$ on 
$\measurable{(\measure\times\measureii)^\kernast}$, then
${\measureiii_\function}^* \abscont \measure^*$ on 
$\measurable{\measure^\kernast}$
and 
${\measureiii_\functionii}^* \abscont \measureii^*$ on 
$\measurable{\measureii^\kernast}$.
\end{prop}


\begin{proof} 
Let
$(\measureiii_{\function,\functionii})^*
\abscont
(\measure\times\measureii)^*$ on $\measurable{(\measure\times\measureii)^\kernast}$.
We will show that 
${\measureiii_\function}^* \abscont \measure^*$ on 
$\measurable{\measure^\kernast}$.


Let $\seti\in\measurable{\measure^\kernast}$ with $\measure^*(\seti)=0$. 
We need to see that 
${\measureiii_\function}^*(\seti)=0$.
The whole space 
$\measurespaceii\in\measurable{\measureii^\kernast}$ since 
$\measurable{\measureii^\kernast}$ is at least an algebra, and the whole space is an element of any algebra; see Definition~\ref{algebra}.
With 
$\seti\in\measurable{\measure^\kernast}$
and
$\measurespaceii\in\measurable{\measureii^\kernast}$,
it follows that 
$\seti\times\measurespaceii \in
\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}$.
Because measures $\measure$ and $\measureii$ are \textsigma\hyp{}finite, we can apply
Proposition~\ref{agreeable_product_measures} which says that the measures 
$\measure^*\times\measureii^*$ and
$(\measure\times\measureii)^*$ agree on the semiring
$\productsemiring{\measurable{\measure^\kernast}}{\measurable{\measureii^\kernast}}$,
so 
\begin{align*}
(\measure\times\measureii)^*(\seti\times\measurespaceii)
& = (\measure^*\times\measureii^*)(\seti\times\measurespaceii)
&\text{$\measure^*\times\measureii^*$ and
$(\measure\times\measureii)^*$ agree here}
\\
& = \measure^*(\seti)\cdot\measureii^*(\measurespaceii)
&\text{Proposition~\ref{product_measure}}
\\
& = 0 
& \measure^*(\seti) = 0.
\\
\end{align*}
This shows that 
$\seti\times\measurespaceii$ is a 
$(\measure\times\measureii)^\kernast$\hyp{}null set in
$\measurable{(\measure\times\measureii)^\kernast}$.
By the hypothesis that 
$(\measureiii_{\function,\functionii})^*
\abscont
(\measure\times\measureii)^*$ on 
$\measurable{(\measure\times\measureii)^\kernast}$,
it follows that 
$(\measureiii_{\function,\functionii})^*(\seti\times\measurespaceii) = 0$.
By Proposition~\ref{preimage_of_a_null_set}, 
\[
\measureiii^* \bigl( \preimage{(\function,\functionii)}(\seti\times\measurespaceii) \bigr)
= 0.
\]
Since 
$\preimage{(\function,\functionii)}(\seti\times\measurespaceii) 
=
\preimage{\function}(\seti)$,
it follows that 
$\measureiii^*\bigl(\preimage{\function}(\seti)\bigr) = 0$. 
By Proposition~\ref{joint_measurable_implies_partial}, the function 
$\function: \uspace
\to
\measurespace$ is  
$(\measurable{\measureiii^\kernast},\measurable{\measure^\kernast})$\hyp{}measurable
so by Proposition~\ref{preimage_of_a_measurable_set}, 
$\measureiii^*\bigl(\preimage{\function}(\seti)\bigr)
=
{\measureiii_\function}^*(\seti)$,
and consequently 
${\measureiii_\function}^*(\seti) = 0$,
as required.
\end{proof}

\begin{notn}\label{density_notation}
In order to get the marginal densities, you integrate out the joint density.
Set 
\[
\funcj = \frac{d\measureiii_{\function,\functionii}}{d(\measure\times\measureii)},
\quad
m_\function = \frac{d\measureiii_\function}{d\measure},
\quad\text{and}\quad
m_\functionii = \frac{d\measureiii_\functionii}{d\measureii}.
\]
The letter `$\funcj$' was intended to roughly correspond with `joint density,' and likewise the letter  
`$m$' with `marginal density.'
The usefulness of this notation remains to be seen.
\end{notn}



\begin{prop}\label{marginal_density}
\textbf{Explain how this proposition is vastly different than Proposition~\ref{reference_implies_marginals}.}
Let 
$(\uspace,\uspacesig,\measureiii)$,
$(\measurespace,\sigmaalgebra,\measure)$, and  
$(\measurespaceii,\sigmaalgebraii,\measureii)$ be measure spaces,
where $\measureiii$ is finite, and
measures  $\measure$ and $\measureii$ are \textsigma-finite.
Let functions
$\function:
(\measurespaceiii,\sigmaalgebraiii)
\to
(\measurespace,\sigmaalgebra)$ 
and
$\functionii:
(\measurespaceiii,\sigmaalgebraiii)
\to
(\measurespaceii,\sigmaalgebraii)$ 
be measurable.
If
$\measureiii\circ \preimage{(\function,\functionii)} 
\abscont
\measure\times\measureii$,
then for $\measure^\kernast$-almost all $\mspaceelt\in\measurespace$,
\[
m_\function (\mspaceelt)
=
\int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)
\]
and for $\measureii^\kernast$-almost all $\mspaceeltii\in\measurespaceii$,
\[
m_\functionii (\mspaceeltii)
=
\int_\measurespace \funcj(\mspaceelt,\mspaceeltii) \, d\measure(\mspaceelt).
\]
\end{prop}

\begin{proof}
We will show that
$m_\function(\mspaceelt)
=
\int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)$
for $\measure^\kernast$-almost all $\mspaceelt\in\measurespace$.
Because $m_\function$ is the density function of 
$\measureiii\circ\preimage{\function}$ with respect to $\measure$, we know
\[
(\measureiii\circ\preimage{\function})(\seti)
=
\int_\seti m_\function (\mspaceelt)\, d\measure(\mspaceelt)
\quad\text{for all $\seti\in\sigmaalgebra$}.
\]
This means it is sufficient to show, according to the uniqueness of the Radon-Nikodym derivative, that
\[
(\measureiii\circ\preimage{\function})(\seti)
=
\int_\seti 
\left( \int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)\right)
\, d\measure(\mspaceelt)
\quad\text{for all $\seti\in\sigmaalgebra$}.
\]
Recall from the proof of Proposition~\ref{marginal_absolute_continuity} that
\begin{align*}
(\measureiii\circ\preimage{\function})(\seti)
& = \bigl( \measureiii\circ \preimage{(\function,\functionii)}\circ \preimage{\projectionone}\bigr)
(\seti)\\
& = \measureiii\bigl( \preimage{(\function,\functionii)} 
(\preimage{\projectionone}(\seti))\bigr)\\
& = \measureiii\bigl( \preimage{(\function,\functionii)} 
(\seti\times\measurespaceii)\bigr)\\
& = (\measureiii\circ \preimage{(\function,\functionii)}) 
(\seti\times\measurespaceii)\\
\end{align*}
and
witness the following sketch, where the substitution 
$\funcj\,d(\measure\times\measureii) = d (\measureiii\circ \preimage{(\function,\functionii)})$ is also made:
\begin{align*}
\int_\seti 
\left( \int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)\right)
\, d\measure(\mspaceelt)
& =
\int_\measurespace \charfunction{\seti}(\mspaceelt)
\left( \int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)\right)
\, d\measure(\mspaceelt) \\
& = \int_\measurespace 
 \int_\measurespaceii \charfunction{\seti}(\mspaceelt)\, \funcj(\mspaceelt,\mspaceeltii) 
\, d\measureii(\mspaceeltii)
\, d\measure(\mspaceelt) \\
& = 
 \int_{\measurespace\times\measurespaceii} 
 \charfunction{\seti}(\mspaceelt)\, \funcj(\mspaceelt,\mspaceeltii) 
\, d(\measure\times\measureii) (\mspaceelt,\mspaceeltii)\\
& = 
 \int_{\measurespace\times\measurespaceii} 
 \charfunction{\seti\times\measurespaceii}(\mspaceelt,\mspaceeltii)\, \funcj(\mspaceelt,\mspaceeltii) 
\, d(\measure\times\measureii) (\mspaceelt,\mspaceeltii)\\
& = 
 \int_{\measurespace\times\measurespaceii} 
 \charfunction{\seti\times\measurespaceii}(\mspaceelt,\mspaceeltii) 
\, d (\measureiii\circ \preimage{(\function,\functionii)}) (\mspaceelt,\mspaceeltii) \\
& = (\measureiii\circ \preimage{(\function,\functionii)}) (\seti\times\measurespaceii)\\
& = (\measureiii\circ\preimage{\function})(\seti),
\end{align*}
completing the proof.
\end{proof}



\begin{prop}
Let $(\uspace, \uspacesemiring,\measureiii)$
be a measure space, and let
$(\measurespace,\semiring,\measure)$ and 
$(\measurespaceii,\semiringii,\measureii)$
 be \textsigma\hyp{}finite measure spaces.
Also let the function
$\function,\functionii:\uspace\to\measurespace\times
\measurespaceii$ be 
$\bigl(\measurable{\measureiii^\kernast}, 
\measurable{(\measure\times\measureii)^\kernast}\bigr)$\hyp{}measurable.
If
$(\measureiii_{\function,\functionii})^*
\abscont
(\measure\times\measureii)^*$ on 
$\measurable{(\measure\times\measureii)^\kernast}$, then for $\measure^\kernast$-almost all $\mspaceelt\in\measurespace$,
\[
m_\function (\mspaceelt)
=
\int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)
\]
and for $\measureii^\kernast$-almost all $\mspaceeltii\in\measurespaceii$,
\[
m_\functionii (\mspaceeltii)
=
\int_\measurespace \funcj(\mspaceelt,\mspaceeltii) \, d\measure(\mspaceelt).
\]
\end{prop}

\begin{proof}
We will show that
$m_\function(\mspaceelt)
=
\int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)$
for $\measure^\kernast$-almost all $\mspaceelt\in\measurespace$.
Because $m_\function$ is the density function of 
$\measureiii\circ\preimage{\function}$ with respect to $\measure$, we know
\[
(\measureiii\circ\preimage{\function})(\seti)
=
\int_\seti m_\function (\mspaceelt)\, d\measure(\mspaceelt)
\quad\text{for all $\seti\in\sigmaalgebra$}.
\]
This means it is sufficient to show, according to the uniqueness of the Radon-Nikodym derivative, that
\[
(\measureiii\circ\preimage{\function})(\seti)
=
\int_\seti 
\left( \int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)\right)
\, d\measure(\mspaceelt)
\quad\text{for all $\seti\in\sigmaalgebra$}.
\]
Recall from the proof of Proposition~\ref{marginal_absolute_continuity} that
\begin{align*}
(\measureiii\circ\preimage{\function})(\seti)
& = \bigl( \measureiii\circ \preimage{(\function,\functionii)}\circ \preimage{\projectionone}\bigr)
(\seti)\\
& = \measureiii\bigl( \preimage{(\function,\functionii)} 
(\preimage{\projectionone}(\seti))\bigr)\\
& = \measureiii\bigl( \preimage{(\function,\functionii)} 
(\seti\times\measurespaceii)\bigr)\\
& = (\measureiii\circ \preimage{(\function,\functionii)}) 
(\seti\times\measurespaceii)\\
\end{align*}
and
witness the following sketch, where the substitution 
$\funcj\,d(\measure\times\measureii) = d (\measureiii\circ \preimage{(\function,\functionii)})$ is also made:
\begin{align*}
\int_\seti 
\left( \int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)\right)
\, d\measure(\mspaceelt)
& =
\int_\measurespace \charfunction{\seti}(\mspaceelt)
\left( \int_\measurespaceii \funcj(\mspaceelt,\mspaceeltii) \, d\measureii(\mspaceeltii)\right)
\, d\measure(\mspaceelt) \\
& = \int_\measurespace 
 \int_\measurespaceii \charfunction{\seti}(\mspaceelt)\, \funcj(\mspaceelt,\mspaceeltii) 
\, d\measureii(\mspaceeltii)
\, d\measure(\mspaceelt) \\
& = 
 \int_{\measurespace\times\measurespaceii} 
 \charfunction{\seti}(\mspaceelt)\, \funcj(\mspaceelt,\mspaceeltii) 
\, d(\measure\times\measureii) (\mspaceelt,\mspaceeltii)\\
& = 
 \int_{\measurespace\times\measurespaceii} 
 \charfunction{\seti\times\measurespaceii}(\mspaceelt,\mspaceeltii)\, \funcj(\mspaceelt,\mspaceeltii) 
\, d(\measure\times\measureii) (\mspaceelt,\mspaceeltii)\\
& = 
 \int_{\measurespace\times\measurespaceii} 
 \charfunction{\seti\times\measurespaceii}(\mspaceelt,\mspaceeltii) 
\, d (\measureiii\circ \preimage{(\function,\functionii)}) (\mspaceelt,\mspaceeltii) \\
& = (\measureiii\circ \preimage{(\function,\functionii)}) (\seti\times\measurespaceii)\\
& = (\measureiii\circ\preimage{\function})(\seti),
\end{align*}
completing the proof.
\end{proof}
%****************************************************


\section{Regression}
A statistical model is an investigator's opinion of some data generating process.
A \emph{linear model} is a collection of methods for estimating a joint probability measure given sample data.

\subsection{Terminology}
What exactly are observations?

\begin{enumerate}

\item	
Hocking, Page 6. An observation may be viewed as a random variable generated by a probability distribution.

\item
Larsen and Marx, 3rd edition, page 353. If $n$ observations are drawn from some probability distribution, we know that the accompanying sample space is a set of $n$-tuples. Moreover, any estimator has the effect of partitioning that sample space into a set of mutually exclusive and exhaustive subsets. For example, suppose two observations are drawn from a Poisson distribution 
$p_X(k; \lambda) = e^{-\lambda}\lambda^k /k!$,
for the purpose of estimating $\lambda$ with 
$\hat \lambda = \bar X = (X_1+X_2)/2.$
Notice that $\hat\lambda$ will equal 3 if any of the following 2-tuples occurs: 
(0,6), (1,5), (2,4), (3,3), (4,2), (5,1), or (6,0).
Likewise, $\lambda$ will equal $2.5$ if either
(0,5), (1,4), (2,3), (3,2), (4,1), or (5,0) is the sample drawn. Clearly, each possible outcome can be assigned to a unique subset of the 2-tuples according to the value of $\hat\lambda$ it produces.

\item Kleijn, page 1. The data is a measurement or observation which we denote by $Y$ taking values in a corresponding sample space.
\end{enumerate}

A data set can be considered as multiples of characteristic functions concentrated at points, or their images in $L_1$, meaning the data set is a collection of functions or classes.




\section{Some Quotes}

\subsection{Signal and noise}
{\bf 11-18-15}\quad
See the section \lq Interpretation of Regression Coefficients\rq\ in \emph{Linear Statistical Models}~\cite{jhs-lsm-1995} for an explanation of what is considered signal.


\subsection{Coordinate Free Approach}
The following excerpt is from \cite{gfoai-kv-1997}, page 338, and it seems to imply that some things, like expectation, are independent of the inner product, whereas others, like covariance, are not.  Care to elaborate?
\begin{quote}
A coordinate-free definition of weak sphericity and related concepts may be
made as follows. Let $(V, \innerp{\cdot}{\cdot})$ be an inner product space. A function $Y$ taking
values in $V$ is a $V$-valued random vector if and only if $\innerp{v}{Y}$ is a random
variable for each $v\in V$. We will assume further that the second moment of
$\innerp{v}{Y}$ is finite for each $v\in V$. Since $\expval{\innerp{v}{Y}}$ is a linear functional on $V$, the
representation theorem for linear functionals says there is a unique element in
$V$, call it $\expval{Y}$, such that
\[
\expval{\innerp{v}{Y}} = \innerp{v}{\expval{Y}}
\]
for all $v\in V$. The unique vector $\expval{Y} \in V$ is the expected value of the $V$-valued
random vector $Y$. Let $Z$ be a second random vector taking values in $V$. Since
$\cov{\innerp{v}{Y}}{\innerp{w}{Z}}$ is a bilinear functional on $V$, the representation theorem for
a bilinear functional says there exists a unique linear operator, call it $\cov{Y}{Z}$
such that
\[\cov{\innerp{v}{Y}}{\innerp{w}{Z}} = \innerp{v}{\cov{Y}{Z}w}\] 
for all $v,w\in V$. The covariance of $V$-valued random vectors $Y$ and $Z$ is defined to be the linear operator $\cov{Y}{Z}$. The dispersion matrix for $Y$ is
$\Sigma = \cov{Y}{Y}$.
The distribution of a random vector $Y$ taking values in $V$ is weakly spherical
(with respect to $\innerp{\cdot}{\cdot}$) if its dispersion matrix is proportional to the identity
transformation; that is,
\[\Sigma = \sigma^2 I.\]
The expected value $\expval{Y}$ does not depend on the inner product $\innerp{\cdot}{\cdot}$, but the
covariance and dispersion do.
\end{quote}
See Drygas \cite{tcfatgme-hd-1970}, page 49, for an explanation as to why you can assume that the dispersion matrix is the identity.

%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\subsection{The $\textsigma$-algebra induced by a function}
From \emph{Infinite Dimensional Analysis: A Hitchhiker's Guide} \cite{idaahg-aliprantis-2006}, page 147.


If $f:X \to (Y, \Sigma)$ is a function and $\Sigma$ is a \textsigma-algebra of subsets of $Y$, then it is easy to see that $\sagb(f) = \left\{\preimage{f} (A) : A \in\Sigma\right\}$ is a \textsigma-algebra of subsets of $X$, known as the
\textsigma-algebra induced by $f$. It turns out that a real function that is $\sagb(f)$-measurable
can actually be written as a function of $f$, a fact that is of extreme importance in
the theory of conditional expectations in probability.

\begin{thm} Let $(Y,\Sigma)$ be a measurable space, $f : X \to (Y, \Sigma)$, and $g : X \to \R$.
Then the function $g$ is $\sagb(f)$-measurable if and only if there exists a $\Sigma$-measurable
function $h : Y \to\R$ such that $g = h \circ f$.
\end{thm}

\subsection{Hypothesis Matrix}
Interesting couple of sentences concerning hypothesis tests, from \cite{gafs-mo-1984}, page 498:
\begin{quote}
Consider the linear model $\expval{Y} = XB,$ where $X$ is $n \times p$ of rank $p$, and
hypothesis $H_0 : AB = C$, where $A$ is $q\times p$ of rank $q$. We have already discussed
the computation of $E = (Y - X\widehat B)'(Y - X\widehat B)$ in the previous section and we
now turn our attention to\ldots
\end{quote}
What makes it interesting is that it appears that the hypothesis is stated in terms of matrices.
 

%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\subsection{Least Square Regression} 

From \emph{Functional Analysis for Probability and Stochastic Processes}, page 128. \cite{fafpasp-bobrowski-2005}

Let $X$ and $Y$ be given square integrable
random variables. The problem of finding constants $a$ and $b$ such that
the square distance between $Y$ and $aX + b$ is the least is known as the
problem of \emph{least square regression}. An equivalent formulation of this
problem is to find the projection $\measure Y$ of $Y$ on the span$\{1_\measurespace , X\}$. Since this
span is the same as span$\{1_\measurespace , X - (E X)1_\measurespace \}$, and $1_\measurespace$ and 
$X - (E X)1_\measurespace$
are orthogonal, we find that
\[
\measure Y = \ldots = 
\frac{\cov{X}{Y}}{\sigma_X^2}
\bigl(X-\expval(X)1_\measurespace\bigr) + \expval(Y)1_\measurespace.
\]
The quantity 
\[
\rho =\rho_{X,Y} = \frac{\cov{X}{Y}}{\sigma_X \sigma_Y}
\]
is called the \emph{correlation coefficient}. The above formula is often written as
\[
\measure Y - \expval(Y)1_\measurespace =
\rho
\frac{\sigma_X}{\sigma_Y}
\bigl(X-\expval(X)1_\measurespace\bigr).
\]




 
 
%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\subsection{Conditional Expectation}

\emph{An Introduction to Statistical Learning} \cite{aitsl-james-2013}, page 19, says
\begin{align} \mathbb E(Y - \widehat Y)^2 &=\mathbb E\left[f(X) + \epsilon - \widehat f(X)\right]^2\\&= \mathbb E\left[\left(f(X) - \widehat f(X)\right)^2 + 2\epsilon\left(f(X) - \widehat f(X)\right)+\epsilon^2\right]\\ &=\left(f(X) - \widehat f(X)\right)^2 + \mathrm{Var}(\epsilon) \end{align} 
For a function to equal an expectation, the expectation must be conditional.  Quoted from Cross Validated, \emph{Mean Square Error as Reducible and Irreducible Component}: 
\begin{quote}
Recall that the expectation of $Y$ is conditional on $x$, so every $E(\cdot)$ below is actually $E(\cdot\vert x)$. Thus all terms with only $x$ are constants inside the expectation.
\begin{align*}
E(Y - \widehat{Y})^2 & = E\left[(f(x) - \widehat{f}(x))^2 + 2\epsilon (f(x) - \widehat{f}(x)) + \epsilon^2   \right]\\
& = E\left[(f(x) - \widehat{f}(x))^2 \right] + 2E(\epsilon) E(f(x) - \widehat{f}(x)) + E(\epsilon^2)\\
& = \bigl(f(x) - \widehat{f}(x)\bigr)^2 + Var(\epsilon).
\end{align*}

The first term of the last line is decomposed as below:
\begin{align*}
=\left[f(x)-\widehat{f}(x)+\expval\widehat{f}(x) - \expval{\widehat{f}(x)}\right]^2+Var(\epsilon)
& =
(\underbrace{E(\widehat{f}(x))-f(x)}_{\text{Bias}})^2 + (\underbrace{E(\widehat{f}(x))-\widehat{f}(x))^2}_{\text{Var}\widehat{f}(x)} +Var(\epsilon)
\end{align*}
\end{quote}
 

%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\subsection{The Variance of Functions} 

From \emph{An Introduction to Statistical Learning} \cite{aitsl-james-2013}, page 34: 
\[
E\left(y_0 - \widehat{f}(x_0)\right)^2 
= \text{Var}(\widehat{f}(x_0)) + [\text{Bias}(\widehat{f}(x_0))]^2 + \text{Var}(\epsilon)\]

Response from \emph{Cross Validated}:
\begin{quote}
Given that every time $\widehat{f}$ appears in a formula it has been applied to a \lq given value\rq\ $x_0$, the variance applies to the number $\widehat{f}(x_0)$, not to $\widehat{f}$ itself. Since that number presumably has been developed from data that are modeled with random variables, it is also a (real-valued) random variable. The usual concept of variance applies.
\end{quote}

And further clarification:
\begin{quote}
A learning algorithm $\mathcal{A}$
can be viewed as a higher level function, mapping training sets to functions.
$\mathcal{A} : \mathcal{T} \rightarrow \{f \mid f: X \rightarrow \mathbb{R} \},$
where $\mathcal{T}$ is the space of possible training sets. This can be a bit hairy conceptually, but basically each individual training set results, after using the model training algorithm, in a specific function $f$ which can be used to make predictions given a data point $x$.

If we view the space of training sets as a probability space, so that there is some distribution of possible training data sets, then the model training algorithm becomes a function valued random variable, and we can think of statistical concepts. In particular, if we fix a specific data point $x_0$, then we get the numeric valued random variable
\[ \mathcal{A}_{x_0}(T) = \mathcal{A}(T)(x_0)\]
I.e., first train the algorithm on $\mathcal{T}$, and then evaluate the resulting model at $x_0$. This is just a plain old, but rather ingeniously constructed, random variable on a probability space, so we can talk about its variance. This is the variance in your formula from ISL.
\end{quote}



%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\subsection{Information in \textsigma-algebras.}

For an example of the misery involved in the heuristic equating of \textsigma-algebras and \lq\lq information\rq\rq, see Billingsley \cite{pam-billingsley-1995}, page 58, Example 4.10.  See also page 437 therein, the section entitled, \lq\lq Difficulties and Curiosities.\rq\rq\  This is a good one. 





%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\subsection{Sufficiency, Rao-Blackwell.}

From The Bayesian Choice \cite{tbc-robert-2007}, Introduction, page 14, 
\begin{quote} 
We will see in Chapter 2 that when an estimator is evaluated under a convex loss, the optimal procedures only depend on sufficient statistics (this is the Rao-Blackwell theorem).
\end{quote}




%*********************************************************	
%*********************************************************	
%*********************************************************	
%*********************************************************
\bibliographystyle{plain}
%\bibliographystyle{alpha}
%\bibliographystyle{amsplain}
%\bibliographystyle{amsalpha}
\bibliography{stats}
\printindex
\end{document}
